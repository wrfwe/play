(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.Rematrix={})})(this,function(exports){"use strict";function format(source){if(source.constructor!==Array){throw new TypeError("Expected array.")}if(source.length===16){return source}if(source.length===6){var matrix=identity();matrix[0]=source[0];matrix[1]=source[1];matrix[4]=source[2];matrix[5]=source[3];matrix[12]=source[4];matrix[13]=source[5];return matrix}throw new RangeError("Expected array with either 6 or 16 values.")}function identity(){var matrix=[];for(var i=0;i<16;i++){i%5==0?matrix.push(1):matrix.push(0)}return matrix}function inverse(source){var m=format(source);var s0=m[0]*m[5]-m[4]*m[1];var s1=m[0]*m[6]-m[4]*m[2];var s2=m[0]*m[7]-m[4]*m[3];var s3=m[1]*m[6]-m[5]*m[2];var s4=m[1]*m[7]-m[5]*m[3];var s5=m[2]*m[7]-m[6]*m[3];var c5=m[10]*m[15]-m[14]*m[11];var c4=m[9]*m[15]-m[13]*m[11];var c3=m[9]*m[14]-m[13]*m[10];var c2=m[8]*m[15]-m[12]*m[11];var c1=m[8]*m[14]-m[12]*m[10];var c0=m[8]*m[13]-m[12]*m[9];var determinant=1/(s0*c5-s1*c4+s2*c3+s3*c2-s4*c1+s5*c0);if(isNaN(determinant)||determinant===Infinity){throw new Error("Inverse determinant attempted to divide by zero.")}return[(m[5]*c5-m[6]*c4+m[7]*c3)*determinant,(-m[1]*c5+m[2]*c4-m[3]*c3)*determinant,(m[13]*s5-m[14]*s4+m[15]*s3)*determinant,(-m[9]*s5+m[10]*s4-m[11]*s3)*determinant,(-m[4]*c5+m[6]*c2-m[7]*c1)*determinant,(m[0]*c5-m[2]*c2+m[3]*c1)*determinant,(-m[12]*s5+m[14]*s2-m[15]*s1)*determinant,(m[8]*s5-m[10]*s2+m[11]*s1)*determinant,(m[4]*c4-m[5]*c2+m[7]*c0)*determinant,(-m[0]*c4+m[1]*c2-m[3]*c0)*determinant,(m[12]*s4-m[13]*s2+m[15]*s0)*determinant,(-m[8]*s4+m[9]*s2-m[11]*s0)*determinant,(-m[4]*c3+m[5]*c1-m[6]*c0)*determinant,(m[0]*c3-m[1]*c1+m[2]*c0)*determinant,(-m[12]*s3+m[13]*s1-m[14]*s0)*determinant,(m[8]*s3-m[9]*s1+m[10]*s0)*determinant]}function multiply(m,x){var fm=format(m);var fx=format(x);var product=[];for(var i=0;i<4;i++){var row=[fm[i],fm[i+4],fm[i+8],fm[i+12]];for(var j=0;j<4;j++){var k=j*4;var col=[fx[k],fx[k+1],fx[k+2],fx[k+3]];var result=row[0]*col[0]+row[1]*col[1]+row[2]*col[2]+row[3]*col[3];product[i+k]=result}}return product}function parse(source){if(typeof source==="string"){var match=source.match(/matrix(3d)?\(([^)]+)\)/);if(match){var raw=match[2].split(", ").map(parseFloat);return format(raw)}}return identity()}function rotate(angle){return rotateZ(angle)}function rotateX(angle){var theta=Math.PI/180*angle;var matrix=identity();matrix[5]=matrix[10]=Math.cos(theta);matrix[6]=matrix[9]=Math.sin(theta);matrix[9]*=-1;return matrix}function rotateY(angle){var theta=Math.PI/180*angle;var matrix=identity();matrix[0]=matrix[10]=Math.cos(theta);matrix[2]=matrix[8]=Math.sin(theta);matrix[2]*=-1;return matrix}function rotateZ(angle){var theta=Math.PI/180*angle;var matrix=identity();matrix[0]=matrix[5]=Math.cos(theta);matrix[1]=matrix[4]=Math.sin(theta);matrix[4]*=-1;return matrix}function scale(scalar,scalarY){var matrix=identity();matrix[0]=scalar;matrix[5]=typeof scalarY==="number"?scalarY:scalar;return matrix}function scaleX(scalar){var matrix=identity();matrix[0]=scalar;return matrix}function scaleY(scalar){var matrix=identity();matrix[5]=scalar;return matrix}function scaleZ(scalar){var matrix=identity();matrix[10]=scalar;return matrix}function skew(angleX,angleY){var thetaX=Math.PI/180*angleX;var matrix=identity();matrix[4]=Math.tan(thetaX);if(angleY){var thetaY=Math.PI/180*angleY;matrix[1]=Math.tan(thetaY)}return matrix}function skewX(angle){var theta=Math.PI/180*angle;var matrix=identity();matrix[4]=Math.tan(theta);return matrix}function skewY(angle){var theta=Math.PI/180*angle;var matrix=identity();matrix[1]=Math.tan(theta);return matrix}function toString(source){return"matrix3d("+format(source).join(", ")+")"}function translate(distanceX,distanceY){var matrix=identity();matrix[12]=distanceX;if(distanceY){matrix[13]=distanceY}return matrix}function translateX(distance){var matrix=identity();matrix[12]=distance;return matrix}function translateY(distance){var matrix=identity();matrix[13]=distance;return matrix}function translateZ(distance){var matrix=identity();matrix[14]=distance;return matrix}exports.format=format;exports.identity=identity;exports.inverse=inverse;exports.multiply=multiply;exports.parse=parse;exports.rotate=rotate;exports.rotateX=rotateX;exports.rotateY=rotateY;exports.rotateZ=rotateZ;exports.scale=scale;exports.scaleX=scaleX;exports.scaleY=scaleY;exports.scaleZ=scaleZ;exports.skew=skew;exports.skewX=skewX;exports.skewY=skewY;exports.toString=toString;exports.translate=translate;exports.translateX=translateX;exports.translateY=translateY;exports.translateZ=translateZ;Object.defineProperty(exports,"__esModule",{value:true})});var PIXI=function(t){"use strict";var e=setTimeout;function r(t){return Boolean(t&&void 0!==t.length)}function i(){}function n(t){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(t,this)}function o(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,n._immediateFn(function(){var r=1===t._state?e.onFulfilled:e.onRejected;if(null!==r){var i;try{i=r(t._value)}catch(t){return void a(e.promise,t)}s(e.promise,i)}else(1===t._state?s:a)(e.promise,t._value)})):t._deferreds.push(e)}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof n)return t._state=3,t._value=e,void h(t);if("function"==typeof r)return void l((i=r,o=e,function(){i.apply(o,arguments)}),t)}t._state=1,t._value=e,h(t)}catch(e){a(t,e)}var i,o}function a(t,e){t._state=2,t._value=e,h(t)}function h(t){2===t._state&&0===t._deferreds.length&&n._immediateFn(function(){t._handled||n._unhandledRejectionFn(t._value)});for(var e=0,r=t._deferreds.length;e<r;e++)o(t,t._deferreds[e]);t._deferreds=null}function u(t,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=r}function l(t,e){var r=!1;try{t(function(t){r||(r=!0,s(e,t))},function(t){r||(r=!0,a(e,t))})}catch(t){if(r)return;r=!0,a(e,t)}}n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,e){var r=new this.constructor(i);return o(this,new u(t,e,r)),r},n.prototype.finally=function(t){var e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return r})},function(r){return e.resolve(t()).then(function(){return e.reject(r)})})},n.all=function(t){return new n(function(e,i){if(!r(t))return i(new TypeError("Promise.all accepts an array"));var n=Array.prototype.slice.call(t);if(0===n.length)return e([]);var o=n.length;function s(t,r){try{if(r&&("object"==typeof r||"function"==typeof r)){var a=r.then;if("function"==typeof a)return void a.call(r,function(e){s(t,e)},i)}n[t]=r,0==--o&&e(n)}catch(t){i(t)}}for(var a=0;a<n.length;a++)s(a,n[a])})},n.allSettled=function(t){return new this(function(e,r){if(!t||void 0===t.length)return r(new TypeError(typeof t+" "+t+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var i=Array.prototype.slice.call(t);if(0===i.length)return e([]);var n=i.length;function o(t,r){if(r&&("object"==typeof r||"function"==typeof r)){var s=r.then;if("function"==typeof s)return void s.call(r,function(e){o(t,e)},function(r){i[t]={status:"rejected",reason:r},0==--n&&e(i)})}i[t]={status:"fulfilled",value:r},0==--n&&e(i)}for(var s=0;s<i.length;s++)o(s,i[s])})},n.resolve=function(t){return t&&"object"==typeof t&&t.constructor===n?t:new n(function(e){e(t)})},n.reject=function(t){return new n(function(e,r){r(t)})},n.race=function(t){return new n(function(e,i){if(!r(t))return i(new TypeError("Promise.race accepts an array"));for(var o=0,s=t.length;o<s;o++)n.resolve(t[o]).then(e,i)})},n._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){e(t,0)},n._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var c=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;var p=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(t){i[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,i,n=arguments,o=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),s=1;s<arguments.length;s++){for(var a in r=Object(n[s]))d.call(r,a)&&(o[a]=r[a]);if(c){i=c(r);for(var h=0;h<i.length;h++)f.call(r,i[h])&&(o[i[h]]=r[i[h]])}}return o};if(self.Promise||(self.Promise=n),Object.assign||(Object.assign=p),Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!self.performance||!self.performance.now){var _=Date.now();self.performance||(self.performance={}),self.performance.now=function(){return Date.now()-_}}for(var m=Date.now(),v=["ms","moz","webkit","o"],y=0;y<v.length&&!self.requestAnimationFrame;++y){var E=v[y];self.requestAnimationFrame=self[E+"RequestAnimationFrame"],self.cancelAnimationFrame=self[E+"CancelAnimationFrame"]||self[E+"CancelRequestAnimationFrame"]}self.requestAnimationFrame||(self.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),r=16+m-e;return r<0&&(r=0),m=e,self.setTimeout(function(){m=Date.now(),t(performance.now())},r)}),self.cancelAnimationFrame||(self.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),self.ArrayBuffer||(self.ArrayBuffer=Array),self.Float32Array||(self.Float32Array=Array),self.Uint32Array||(self.Uint32Array=Array),self.Uint16Array||(self.Uint16Array=Array),self.Uint8Array||(self.Uint8Array=Array),self.Int32Array||(self.Int32Array=Array);var g=/iPhone/i,T=/iPod/i,b=/iPad/i,R=/\biOS-universal(?:.+)Mac\b/i,x=/\bAndroid(?:.+)Mobile\b/i,A=/Android/i,S=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,O=/Silk/i,I=/Windows Phone/i,P=/\bWindows(?:.+)ARM\b/i,M=/BlackBerry/i,D=/BB10/i,N=/Opera Mini/i,w=/\b(CriOS|Chrome)(?:.+)Mobile/i,C=/Mobile(?:.+)Firefox\b/i,L=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};var F,U,B,G,X,k,H,Y,j,V,W,z,q,K,Z,Q,J,$,tt,et=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,i=r.split("[FBAN");void 0!==i[1]&&(r=i[0]),void 0!==(i=r.split("Twitter"))[1]&&(r=i[0]);var n=function(t){return function(e){return e.test(t)}}(r),o={apple:{phone:n(g)&&!n(I),ipod:n(T),tablet:!n(g)&&(n(b)||L(e))&&!n(I),universal:n(R),device:(n(g)||n(T)||n(b)||n(R)||L(e))&&!n(I)},amazon:{phone:n(S),tablet:!n(S)&&n(O),device:n(S)||n(O)},android:{phone:!n(I)&&n(S)||!n(I)&&n(x),tablet:!n(I)&&!n(S)&&!n(x)&&(n(O)||n(A)),device:!n(I)&&(n(S)||n(O)||n(x)||n(A))||n(/\bokhttp\b/i)},windows:{phone:n(I),tablet:n(P),device:n(I)||n(P)},other:{blackberry:n(M),blackberry10:n(D),opera:n(N),firefox:n(C),chrome:n(w),device:n(M)||n(D)||n(N)||n(C)||n(w)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}(self.navigator);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(F||(F={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(U||(U={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(B||(B={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(G||(G={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(X||(X={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(k||(k={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(H||(H={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(Y||(Y={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(j||(j={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(V||(V={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(W||(W={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(z||(z={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(q||(q={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(K||(K={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(Z||(Z={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(Q||(Q={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(J||(J={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}($||($={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(tt||(tt={}));var rt={MIPMAP_TEXTURES:z.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:$.NONE,SPRITE_MAX_TEXTURES:function(t){var e,r=!0;(et.tablet||et.phone)&&(et.apple.device&&(e=navigator.userAgent.match(/OS (\d+)_(\d+)?/))&&parseInt(e[1],10)<11&&(r=!1),et.android.device&&(e=navigator.userAgent.match(/Android\s([0-9.]*)/))&&parseInt(e[1],10)<7&&(r=!1));return r?32:4}(),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:Z.AUTO,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:W.CLAMP,SCALE_MODE:V.LINEAR,PRECISION_VERTEX:Q.HIGH,PRECISION_FRAGMENT:et.apple.device?Q.HIGH:Q.MEDIUM,CAN_UPLOAD_SAME_BUFFER:!et.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},it="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function nt(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}var ot=nt(function(t){var e=Object.prototype.hasOwnProperty,r="~";function i(){}function n(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function o(t,e,i,o,s){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new n(i,o||t,s),h=r?r+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=r?r+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,o=i.length,s=new Array(o);n<o;n++)s[n]=i[n].fn;return s},a.prototype.listenerCount=function(t){var e=r?r+t:t,i=this._events[e];return i?i.fn?1:i.length:0},a.prototype.emit=function(t,e,i,n,o,s){var a=arguments,h=r?r+t:t;if(!this._events[h])return!1;var u,l,c=this._events[h],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,n),!0;case 5:return c.fn.call(c.context,e,i,n,o),!0;case 6:return c.fn.call(c.context,e,i,n,o,s),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=a[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,i);break;case 4:c[l].fn.call(c[l].context,e,i,n);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=a[f];c[l].fn.apply(c[l].context,u)}}return!0},a.prototype.on=function(t,e,r){return o(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return o(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,i,n){var o=r?r+t:t;if(!this._events[o])return this;if(!e)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||n&&!a.once||i&&a.context!==i||s(this,o);else{for(var h=0,u=[],l=a.length;h<l;h++)(a[h].fn!==e||n&&!a[h].once||i&&a[h].context!==i)&&u.push(a[h]);u.length?this._events[o]=1===u.length?u[0]:u:s(this,o)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&s(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}),st=ht,at=ht;function ht(t,e,r){r=r||2;var i,n,o,s,a,h,u,l=e&&e.length,c=l?e[0]*r:t.length,d=ut(t,0,c,r,!0),f=[];if(!d||d.next===d.prev)return f;if(l&&(d=function(t,e,r,i){var n,o,s,a,h,u=[];for(n=0,o=e.length;n<o;n++)s=e[n]*i,a=n<o-1?e[n+1]*i:t.length,(h=ut(t,s,a,i,!1))===h.next&&(h.steiner=!0),u.push(gt(h));for(u.sort(mt),n=0;n<u.length;n++)vt(u[n],r),r=lt(r,r.next);return r}(t,e,d,r)),t.length>80*r){i=o=t[0],n=s=t[1];for(var p=r;p<c;p+=r)(a=t[p])<i&&(i=a),(h=t[p+1])<n&&(n=h),a>o&&(o=a),h>s&&(s=h);u=0!==(u=Math.max(o-i,s-n))?1/u:0}return ct(d,f,r,i,n,u),f}function ut(t,e,r,i,n){var o,s;if(n===wt(t,e,r,i)>0)for(o=e;o<r;o+=i)s=Mt(o,t[o],t[o+1],s);else for(o=r-i;o>=e;o-=i)s=Mt(o,t[o],t[o+1],s);return s&&xt(s,s.next)&&(Dt(s),s=s.next),s}function lt(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!xt(i,i.next)&&0!==Rt(i.prev,i,i.next))i=i.next;else{if(Dt(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function ct(t,e,r,i,n,o,s){if(t){!s&&o&&function(t,e,r,i){var n=t;do{null===n.z&&(n.z=Et(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,o,s,a,h,u=1;do{for(r=t,t=null,o=null,s=0;r;){for(s++,i=r,a=0,e=0;e<u&&(a++,i=i.nextZ);e++);for(h=u;a>0||h>0&&i;)0!==a&&(0===h||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,h--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=i}o.nextZ=null,u*=2}while(s>1)}(n)}(t,i,n,o);for(var a,h,u=t;t.prev!==t.next;)if(a=t.prev,h=t.next,o?ft(t,i,n,o):dt(t))e.push(a.i/r),e.push(t.i/r),e.push(h.i/r),Dt(t),t=h.next,u=h.next;else if((t=h)===u){s?1===s?ct(t=pt(lt(t),e,r),e,r,i,n,o,2):2===s&&_t(t,e,r,i,n,o):ct(lt(t),e,r,i,n,o,1);break}}}function dt(t){var e=t.prev,r=t,i=t.next;if(Rt(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(Tt(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&Rt(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function ft(t,e,r,i){var n=t.prev,o=t,s=t.next;if(Rt(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,h=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,u=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,l=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,c=Et(a,h,e,r,i),d=Et(u,l,e,r,i),f=t.prevZ,p=t.nextZ;f&&f.z>=c&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&Tt(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Rt(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&Tt(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Rt(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=c;){if(f!==t.prev&&f!==t.next&&Tt(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Rt(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&Tt(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Rt(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function pt(t,e,r){var i=t;do{var n=i.prev,o=i.next.next;!xt(n,o)&&At(n,i,i.next,o)&&It(n,o)&&It(o,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(o.i/r),Dt(i),Dt(i.next),i=t=o),i=i.next}while(i!==t);return lt(i)}function _t(t,e,r,i,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&bt(s,a)){var h=Pt(s,a);return s=lt(s,s.next),h=lt(h,h.next),ct(s,e,r,i,n,o),void ct(h,e,r,i,n,o)}a=a.next}s=s.next}while(s!==t)}function mt(t,e){return t.x-e.x}function vt(t,e){if(e=function(t,e){var r,i=e,n=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>s){if(s=a,a===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===s)return r;var h,u=r,l=r.x,c=r.y,d=1/0;i=r;do{n>=i.x&&i.x>=l&&n!==i.x&&Tt(o<c?n:s,o,l,c,o<c?s:n,o,i.x,i.y)&&(h=Math.abs(o-i.y)/(n-i.x),It(i,t)&&(h<d||h===d&&(i.x>r.x||i.x===r.x&&yt(r,i)))&&(r=i,d=h)),i=i.next}while(i!==u);return r}(t,e)){var r=Pt(e,t);lt(e,e.next),lt(r,r.next)}}function yt(t,e){return Rt(t.prev,t,e.prev)<0&&Rt(e.next,t,t.next)<0}function Et(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function gt(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Tt(t,e,r,i,n,o,s,a){return(n-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(i-a)-(r-s)*(e-a)>=0&&(r-s)*(o-a)-(n-s)*(i-a)>=0}function bt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&At(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(It(t,e)&&It(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(Rt(t.prev,t,e.prev)||Rt(t,e.prev,e))||xt(t,e)&&Rt(t.prev,t,t.next)>0&&Rt(e.prev,e,e.next)>0)}function Rt(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function xt(t,e){return t.x===e.x&&t.y===e.y}function At(t,e,r,i){var n=Ot(Rt(t,e,r)),o=Ot(Rt(t,e,i)),s=Ot(Rt(r,i,t)),a=Ot(Rt(r,i,e));return n!==o&&s!==a||(!(0!==n||!St(t,r,e))||(!(0!==o||!St(t,i,e))||(!(0!==s||!St(r,t,i))||!(0!==a||!St(r,e,i)))))}function St(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ot(t){return t>0?1:t<0?-1:0}function It(t,e){return Rt(t.prev,t,t.next)<0?Rt(t,e,t.next)>=0&&Rt(t,t.prev,e)>=0:Rt(t,e,t.prev)<0||Rt(t,t.next,e)<0}function Pt(t,e){var r=new Nt(t.i,t.x,t.y),i=new Nt(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function Mt(t,e,r,i){var n=new Nt(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Dt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Nt(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wt(t,e,r,i){for(var n=0,o=e,s=r-i;o<r;o+=i)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}ht.deviation=function(t,e,r,i){var n=e&&e.length,o=n?e[0]*r:t.length,s=Math.abs(wt(t,0,o,r));if(n)for(var a=0,h=e.length;a<h;a++){var u=e[a]*r,l=a<h-1?e[a+1]*r:t.length;s-=Math.abs(wt(t,u,l,r))}var c=0;for(a=0;a<i.length;a+=3){var d=i[a]*r,f=i[a+1]*r,p=i[a+2]*r;c+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},ht.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)r.vertices.push(t[n][o][s]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r},st.default=at;var Ct=nt(function(t,e){!function(r){var i=e&&!e.nodeType&&e,n=t&&!t.nodeType&&t,o="object"==typeof it&&it;o.global!==o&&o.window!==o&&o.self!==o||(r=o);var s,a,h=2147483647,u=36,l=1,c=26,d=38,f=700,p=72,_=128,m="-",v=/^xn--/,y=/[^\x20-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=u-l,b=Math.floor,R=String.fromCharCode;function x(t){throw RangeError(g[t])}function A(t,e){for(var r=t.length,i=[];r--;)i[r]=e(t[r]);return i}function S(t,e){var r=t.split("@"),i="";return r.length>1&&(i=r[0]+"@",t=r[1]),i+A((t=t.replace(E,".")).split("."),e).join(".")}function O(t){for(var e,r,i=[],n=0,o=t.length;n<o;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<o?56320==(64512&(r=t.charCodeAt(n++)))?i.push(((1023&e)<<10)+(1023&r)+65536):(i.push(e),n--):i.push(e);return i}function I(t){return A(t,function(t){var e="";return t>65535&&(e+=R((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=R(t)}).join("")}function P(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function M(t,e,r){var i=0;for(t=r?b(t/f):t>>1,t+=b(t/e);t>T*c>>1;i+=u)t=b(t/T);return b(i+(T+1)*t/(t+d))}function D(t){var e,r,i,n,o,s,a,d,f,v,y,E=[],g=t.length,T=0,R=_,A=p;for((r=t.lastIndexOf(m))<0&&(r=0),i=0;i<r;++i)t.charCodeAt(i)>=128&&x("not-basic"),E.push(t.charCodeAt(i));for(n=r>0?r+1:0;n<g;){for(o=T,s=1,a=u;n>=g&&x("invalid-input"),((d=(y=t.charCodeAt(n++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:u)>=u||d>b((h-T)/s))&&x("overflow"),T+=d*s,!(d<(f=a<=A?l:a>=A+c?c:a-A));a+=u)s>b(h/(v=u-f))&&x("overflow"),s*=v;A=M(T-o,e=E.length+1,0==o),b(T/e)>h-R&&x("overflow"),R+=b(T/e),T%=e,E.splice(T++,0,R)}return I(E)}function N(t){var e,r,i,n,o,s,a,d,f,v,y,E,g,T,A,S=[];for(E=(t=O(t)).length,e=_,r=0,o=p,s=0;s<E;++s)(y=t[s])<128&&S.push(R(y));for(i=n=S.length,n&&S.push(m);i<E;){for(a=h,s=0;s<E;++s)(y=t[s])>=e&&y<a&&(a=y);for(a-e>b((h-r)/(g=i+1))&&x("overflow"),r+=(a-e)*g,e=a,s=0;s<E;++s)if((y=t[s])<e&&++r>h&&x("overflow"),y==e){for(d=r,f=u;!(d<(v=f<=o?l:f>=o+c?c:f-o));f+=u)A=d-v,T=u-v,S.push(R(P(v+A%T,0))),d=b(A/T);S.push(R(P(d,0))),o=M(r,g,i==n),r=0,++i}++r,++e}return S.join("")}if(s={version:"1.3.2",ucs2:{decode:O,encode:I},decode:D,encode:N,toASCII:function(t){return S(t,function(t){return y.test(t)?"xn--"+N(t):t})},toUnicode:function(t){return S(t,function(t){return v.test(t)?D(t.slice(4).toLowerCase()):t})}},i&&n)if(t.exports==i)n.exports=s;else for(a in s)s.hasOwnProperty(a)&&(i[a]=s[a]);else r.punycode=s}(it)}),Lt={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function Ft(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var Ut=function(t,e,r,i){e=e||"&",r=r||"=";var n={};if("string"!=typeof t||0===t.length)return n;var o=/\+/g;t=t.split(e);var s=1e3;i&&"number"==typeof i.maxKeys&&(s=i.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var h=0;h<a;++h){var u,l,c,d,f=t[h].replace(o,"%20"),p=f.indexOf(r);p>=0?(u=f.substr(0,p),l=f.substr(p+1)):(u=f,l=""),c=decodeURIComponent(u),d=decodeURIComponent(l),Ft(n,c)?Array.isArray(n[c])?n[c].push(d):n[c]=[n[c],d]:n[c]=d}return n},Bt=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},Gt=function(t,e,r,i){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map(function(i){var n=encodeURIComponent(Bt(i))+r;return Array.isArray(t[i])?t[i].map(function(t){return n+encodeURIComponent(Bt(t))}).join(e):n+encodeURIComponent(Bt(t[i]))}).join(e):i?encodeURIComponent(Bt(i))+r+encodeURIComponent(Bt(t)):""},Xt=nt(function(t,e){e.decode=e.parse=Ut,e.encode=e.stringify=Gt}),kt=ie,Ht=function(t,e){return ie(t,!1,!0).resolve(e)},Yt=function(t){Lt.isString(t)&&(t=ie(t));if(!(t instanceof jt))return jt.prototype.format.call(t);return t.format()};function jt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Vt=/^([a-z0-9.+-]+:)/i,Wt=/:[0-9]*$/,zt=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,qt=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Kt=["'"].concat(qt),Zt=["%","/","?",";","#"].concat(Kt),Qt=["/","?","#"],Jt=/^[+a-z0-9A-Z_-]{0,63}$/,$t=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,te={javascript:!0,"javascript:":!0},ee={javascript:!0,"javascript:":!0},re={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function ie(t,e,r){if(t&&Lt.isObject(t)&&t instanceof jt)return t;var i=new jt;return i.parse(t,e,r),i}jt.prototype.parse=function(t,e,r){if(!Lt.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),n=-1!==i&&i<t.indexOf("#")?"?":"#",o=t.split(n);o[0]=o[0].replace(/\\/g,"/");var s=t=o.join(n);if(s=s.trim(),!r&&1===t.split("#").length){var a=zt.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?Xt.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var h=Vt.exec(s);if(h){var u=(h=h[0]).toLowerCase();this.protocol=u,s=s.substr(h.length)}if(r||h||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var l="//"===s.substr(0,2);!l||h&&ee[h]||(s=s.substr(2),this.slashes=!0)}if(!ee[h]&&(l||h&&!re[h])){for(var c,d,f=-1,p=0;p<Qt.length;p++){-1!==(_=s.indexOf(Qt[p]))&&(-1===f||_<f)&&(f=_)}-1!==(d=-1===f?s.lastIndexOf("@"):s.lastIndexOf("@",f))&&(c=s.slice(0,d),s=s.slice(d+1),this.auth=decodeURIComponent(c)),f=-1;for(p=0;p<Zt.length;p++){var _;-1!==(_=s.indexOf(Zt[p]))&&(-1===f||_<f)&&(f=_)}-1===f&&(f=s.length),this.host=s.slice(0,f),s=s.slice(f),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var v=this.hostname.split(/\./),y=(p=0,v.length);p<y;p++){var E=v[p];if(E&&!E.match(Jt)){for(var g="",T=0,b=E.length;T<b;T++)E.charCodeAt(T)>127?g+="x":g+=E[T];if(!g.match(Jt)){var R=v.slice(0,p),x=v.slice(p+1),A=E.match($t);A&&(R.push(A[1]),x.unshift(A[2])),x.length&&(s="/"+x.join(".")+s),this.hostname=R.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=Ct.toASCII(this.hostname));var S=this.port?":"+this.port:"",O=this.hostname||"";this.host=O+S,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!te[u])for(p=0,y=Kt.length;p<y;p++){var I=Kt[p];if(-1!==s.indexOf(I)){var P=encodeURIComponent(I);P===I&&(P=escape(I)),s=s.split(I).join(P)}}var M=s.indexOf("#");-1!==M&&(this.hash=s.substr(M),s=s.slice(0,M));var D=s.indexOf("?");if(-1!==D?(this.search=s.substr(D),this.query=s.substr(D+1),e&&(this.query=Xt.parse(this.query)),s=s.slice(0,D)):e&&(this.search="",this.query={}),s&&(this.pathname=s),re[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){S=this.pathname||"";var N=this.search||"";this.path=S+N}return this.href=this.format(),this},jt.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",i=this.hash||"",n=!1,o="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&Lt.isObject(this.query)&&Object.keys(this.query).length&&(o=Xt.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||re[e])&&!1!==n?(n="//"+(n||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):n||(n=""),i&&"#"!==i.charAt(0)&&(i="#"+i),s&&"?"!==s.charAt(0)&&(s="?"+s),e+n+(r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+i},jt.prototype.resolve=function(t){return this.resolveObject(ie(t,!1,!0)).format()},jt.prototype.resolveObject=function(t){if(Lt.isString(t)){var e=new jt;e.parse(t,!1,!0),t=e}for(var r=new jt,i=Object.keys(this),n=0;n<i.length;n++){var o=i[n];r[o]=this[o]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var h=s[a];"protocol"!==h&&(r[h]=t[h])}return re[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!re[t.protocol]){for(var u=Object.keys(t),l=0;l<u.length;l++){var c=u[l];r[c]=t[c]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||ee[t.protocol])r.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var f=r.pathname||"",p=r.search||"";r.path=f+p}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var _=r.pathname&&"/"===r.pathname.charAt(0),m=t.host||t.pathname&&"/"===t.pathname.charAt(0),v=m||_||r.host&&t.pathname,y=v,E=r.pathname&&r.pathname.split("/")||[],g=(d=t.pathname&&t.pathname.split("/")||[],r.protocol&&!re[r.protocol]);if(g&&(r.hostname="",r.port=null,r.host&&(""===E[0]?E[0]=r.host:E.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),v=v&&(""===d[0]||""===E[0])),m)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,E=d;else if(d.length)E||(E=[]),E.pop(),E=E.concat(d),r.search=t.search,r.query=t.query;else if(!Lt.isNullOrUndefined(t.search)){if(g)r.hostname=r.host=E.shift(),(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.host=r.hostname=A.shift());return r.search=t.search,r.query=t.query,Lt.isNull(r.pathname)&&Lt.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!E.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var T=E.slice(-1)[0],b=(r.host||t.host||E.length>1)&&("."===T||".."===T)||""===T,R=0,x=E.length;x>=0;x--)"."===(T=E[x])?E.splice(x,1):".."===T?(E.splice(x,1),R++):R&&(E.splice(x,1),R--);if(!v&&!y)for(;R--;R)E.unshift("..");!v||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),b&&"/"!==E.join("/").substr(-1)&&E.push("");var A,S=""===E[0]||E[0]&&"/"===E[0].charAt(0);g&&(r.hostname=r.host=S?"":E.length?E.shift():"",(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.host=r.hostname=A.shift()));return(v=v||r.host&&E.length)&&!S&&E.unshift(""),E.length?r.pathname=E.join("/"):(r.pathname=null,r.path=null),Lt.isNull(r.pathname)&&Lt.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},jt.prototype.parseHost=function(){var t=this.host,e=Wt.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(t.ENV||(t.ENV={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(t.RENDERER_TYPE||(t.RENDERER_TYPE={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(t.BUFFER_BITS||(t.BUFFER_BITS={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(t.BLEND_MODES||(t.BLEND_MODES={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(t.DRAW_MODES||(t.DRAW_MODES={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(t.FORMATS||(t.FORMATS={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(t.TARGETS||(t.TARGETS={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(t.TYPES||(t.TYPES={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(t.SAMPLER_TYPES||(t.SAMPLER_TYPES={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(t.SCALE_MODES||(t.SCALE_MODES={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(t.WRAP_MODES||(t.WRAP_MODES={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(t.MIPMAP_MODES||(t.MIPMAP_MODES={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(t.ALPHA_MODES||(t.ALPHA_MODES={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(t.CLEAR_MODES||(t.CLEAR_MODES={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(t.GC_MODES||(t.GC_MODES={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(t.PRECISION||(t.PRECISION={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(t.MASK_TYPES||(t.MASK_TYPES={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(t.MSAA_QUALITY||(t.MSAA_QUALITY={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(t.BUFFER_TYPE||(t.BUFFER_TYPE={}));var ne={parse:kt,format:Yt,resolve:Ht};rt.RETINA_PREFIX=/@([0-9\.]+)x/,rt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var oe,se=!1,ae="6.1.0";function he(t){var e;if(!se){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var r=["\n %c %c %c PixiJS "+ae+" - ✰ "+t+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=self.console).log.apply(e,r)}else self.console&&self.console.log("PixiJS "+ae+" - "+t+" - http://www.pixijs.com/");se=!0}}function ue(){return void 0===oe&&(oe=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:rt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),i=!(!r||!r.getContextAttributes().stencil);if(r){var n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,i}catch(t){return!1}}()),oe}var le={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function ce(t,e){return void 0===e&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function de(t){var e=t.toString(16);return"#"+("000000".substr(0,6-e.length)+e)}function fe(t){return"string"==typeof t&&"#"===(t=le[t.toLowerCase()]||t)[0]&&(t=t.substr(1)),parseInt(t,16)}var pe=function(){for(var e=[],r=[],i=0;i<32;i++)e[i]=i,r[i]=i;e[t.BLEND_MODES.NORMAL_NPM]=t.BLEND_MODES.NORMAL,e[t.BLEND_MODES.ADD_NPM]=t.BLEND_MODES.ADD,e[t.BLEND_MODES.SCREEN_NPM]=t.BLEND_MODES.SCREEN,r[t.BLEND_MODES.NORMAL]=t.BLEND_MODES.NORMAL_NPM,r[t.BLEND_MODES.ADD]=t.BLEND_MODES.ADD_NPM,r[t.BLEND_MODES.SCREEN]=t.BLEND_MODES.SCREEN_NPM;var n=[];return n.push(r),n.push(e),n}();function _e(t,e){return pe[e?1:0][t]}function me(t,e,r,i){return r=r||new Float32Array(4),i||void 0===i?(r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e):(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r[3]=e,r}function ve(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var r=t>>16&255,i=t>>8&255,n=255&t;return(255*e<<24)+((r=r*e+.5|0)<<16)+((i=i*e+.5|0)<<8)+(n*e+.5|0)}function ye(t,e,r,i){return(r=r||new Float32Array(4))[0]=(t>>16&255)/255,r[1]=(t>>8&255)/255,r[2]=(255&t)/255,(i||void 0===i)&&(r[0]*=e,r[1]*=e,r[2]*=e),r[3]=e,r}function Ee(t,e){void 0===e&&(e=null);var r=6*t;if((e=e||new Uint16Array(r)).length!==r)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+r);for(var i=0,n=0;i<r;i+=6,n+=4)e[i+0]=n+0,e[i+1]=n+1,e[i+2]=n+2,e[i+3]=n+0,e[i+4]=n+2,e[i+5]=n+3;return e}function ge(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var Te={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function be(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}function Re(t){return!(t&t-1||!t)}function xe(t){var e=(t>65535?1:0)<<4,r=((t>>>=e)>255?1:0)<<3;return e|=r,e|=r=((t>>>=r)>15?1:0)<<2,(e|=r=((t>>>=r)>3?1:0)<<1)|(t>>>=r)>>1}function Ae(t,e,r){var i,n=t.length;if(!(e>=n||0===r)){var o=n-(r=e+r>n?n-e:r);for(i=e;i<o;++i)t[i]=t[i+r];t.length=o}}function Se(t){return 0===t?0:t<0?-1:1}var Oe=0;function Ie(){return++Oe}var Pe={};var Me={},De=Object.create(null),Ne=Object.create(null);var we=function(){function t(t,e,r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=r||rt.RESOLUTION,this.resize(t,e)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=Math.round(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=Math.round(t)},enumerable:!1,configurable:!0}),t}();function Ce(t){var e,r,i,n=t.width,o=t.height,s=t.getContext("2d"),a=s.getImageData(0,0,n,o).data,h=a.length,u={top:null,left:null,right:null,bottom:null},l=null;for(e=0;e<h;e+=4)0!==a[e+3]&&(r=e/4%n,i=~~(e/4/n),null===u.top&&(u.top=i),null===u.left?u.left=r:r<u.left&&(u.left=r),null===u.right?u.right=r+1:u.right<r&&(u.right=r+1),null===u.bottom?u.bottom=i:u.bottom<i&&(u.bottom=i));return null!==u.top&&(n=u.right-u.left,o=u.bottom-u.top+1,l=s.getImageData(u.left,u.top,n,o)),{height:o,width:n,data:l}}var Le,Fe=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function Ue(t,e){if(void 0===e&&(e=self.location),0===t.indexOf("data:"))return"";e=e||self.location,Le||(Le=document.createElement("a")),Le.href=t;var r=ne.parse(Le.href),i=!r.port&&""===e.port||r.port===e.port;return r.hostname===e.hostname&&i&&r.protocol===e.protocol?"":"anonymous"}function Be(t,e){var r=rt.RETINA_PREFIX.exec(t);return r?parseFloat(r[1]):void 0!==e?e:1}var Ge={__proto__:null,BaseTextureCache:Ne,CanvasRenderTarget:we,DATA_URI:Fe,ProgramCache:Me,TextureCache:De,clearTextureCache:function(){var t;for(t in De)delete De[t];for(t in Ne)delete Ne[t]},correctBlendMode:_e,createIndicesForQuads:Ee,decomposeDataUri:function(t){var e=Fe.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}},deprecation:function(t,e,r){if(void 0===r&&(r=3),!Pe[e]){var i=(new Error).stack;void 0===i?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(i=i.split("\n").splice(r).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(i))),Pe[e]=!0}},destroyTextureCache:function(){var t;for(t in De)De[t].destroy();for(t in Ne)Ne[t].destroy()},determineCrossOrigin:Ue,getBufferType:ge,getResolutionOfUrl:Be,hex2rgb:ce,hex2string:de,interleaveTypedArrays:function(t,e){for(var r=0,i=0,n={},o=0;o<t.length;o++)i+=e[o],r+=t[o].length;var s=new ArrayBuffer(4*r),a=null,h=0;for(o=0;o<t.length;o++){var u=e[o],l=t[o],c=ge(l);n[c]||(n[c]=new Te[c](s)),a=n[c];for(var d=0;d<l.length;d++)a[(d/u|0)*i+h+d%u]=l[d];h+=u}return new Float32Array(s)},isPow2:Re,isWebGLSupported:ue,log2:xe,nextPow2:be,premultiplyBlendMode:pe,premultiplyRgba:me,premultiplyTint:ve,premultiplyTintToRgba:ye,removeItems:Ae,rgb2hex:function(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)},sayHello:he,sign:Se,skipHello:function(){se=!0},string2hex:fe,trimCanvas:Ce,uid:Ie,url:ne,isMobile:et,EventEmitter:ot,earcut:st},Xe=2*Math.PI,ke=180/Math.PI,He=Math.PI/180;!function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"}(t.SHAPES||(t.SHAPES={}));var Ye=function(){function e(e,r,i,n){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=Number(e),this.y=Number(r),this.width=Number(i),this.height=Number(n),this.type=t.SHAPES.RECT}return Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(e,"EMPTY",{get:function(){return new e(0,0,0,0)},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},e.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},e.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},e.prototype.fit=function(t){var e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=i,this.height=Math.max(n-i,0),this},e.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var r=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=i-this.y,this},e.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=i,this.height=n-i,this},e}(),je=function(){function e(e,r,i){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),this.x=e,this.y=r,this.radius=i,this.type=t.SHAPES.CIRC}return e.prototype.clone=function(){return new e(this.x,this.y,this.radius)},e.prototype.contains=function(t,e){if(this.radius<=0)return!1;var r=this.radius*this.radius,i=this.x-t,n=this.y-e;return(i*=i)+(n*=n)<=r},e.prototype.getBounds=function(){return new Ye(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},e}(),Ve=function(){function e(e,r,i,n){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=e,this.y=r,this.width=i,this.height=n,this.type=t.SHAPES.ELIP}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var r=(t-this.x)/this.width,i=(e-this.y)/this.height;return(r*=r)+(i*=i)<=1},e.prototype.getBounds=function(){return new Ye(this.x-this.width,this.y-this.height,this.width,this.height)},e}(),We=function(){function e(){for(var e=arguments,r=[],i=0;i<arguments.length;i++)r[i]=e[i];var n=Array.isArray(r[0])?r[0]:r;if("number"!=typeof n[0]){for(var o=[],s=0,a=n.length;s<a;s++)o.push(n[s].x,n[s].y);n=o}this.points=n,this.type=t.SHAPES.POLY,this.closeStroke=!0}return e.prototype.clone=function(){var t=new e(this.points.slice());return t.closeStroke=this.closeStroke,t},e.prototype.contains=function(t,e){for(var r=!1,i=this.points.length/2,n=0,o=i-1;n<i;o=n++){var s=this.points[2*n],a=this.points[2*n+1],h=this.points[2*o],u=this.points[2*o+1];a>e!=u>e&&t<(e-a)/(u-a)*(h-s)+s&&(r=!r)}return r},e}(),ze=function(){function e(e,r,i,n,o){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=20),this.x=e,this.y=r,this.width=i,this.height=n,this.radius=o,this.type=t.SHAPES.RREC}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height,this.radius)},e.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var r=t-(this.x+this.radius),i=e-(this.y+this.radius),n=this.radius*this.radius;if(r*r+i*i<=n)return!0;if((r=t-(this.x+this.width-this.radius))*r+i*i<=n)return!0;if(r*r+(i=e-(this.y+this.height-this.radius))*i<=n)return!0;if((r=t-(this.x+this.radius))*r+i*i<=n)return!0}return!1},e}(),qe=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t}(),Ke=function(){function t(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this._x=r,this._y=i,this.cb=t,this.scope=e}return t.prototype.clone=function(e,r){return void 0===e&&(e=this.cb),void 0===r&&(r=this.scope),new t(e,r,this._x,this._y)},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),t}(),Ze=function(){function t(t,e,r,i,n,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===o&&(o=0),this.array=null,this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=o}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,r,i,n,o){return this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=o,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},t.prototype.apply=function(t,e){e=e||new qe;var r=t.x,i=t.y;return e.x=this.a*r+this.c*i+this.tx,e.y=this.b*r+this.d*i+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new qe;var r=1/(this.a*this.d+this.c*-this.b),i=t.x,n=t.y;return e.x=this.d*r*i+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*n+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),i=this.a,n=this.c,o=this.tx;return this.a=i*e-this.b*r,this.b=i*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this},t.prototype.append=function(t){var e=this.a,r=this.b,i=this.c,n=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this},t.prototype.setTransform=function(t,e,r,i,n,o,s,a,h){return this.a=Math.cos(s+h)*n,this.b=Math.sin(s+h)*n,this.c=-Math.sin(s-a)*o,this.d=Math.cos(s-a)*o,this.tx=t-(r*this.a+i*this.c),this.ty=e-(r*this.b+i*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var r=this.a,i=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,r=this.b,i=this.c,n=this.d,o=t.pivot,s=-Math.atan2(-i,n),a=Math.atan2(r,e),h=Math.abs(s+a);return h<1e-5||Math.abs(Xe-h)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=s,t.skew.y=a),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(i*i+n*n),t.position.x=this.tx+(o.x*e+o.y*i),t.position.y=this.ty+(o.x*r+o.y*n),t},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,i=this.d,n=this.tx,o=t*i-e*r;return this.a=i/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-i*n)/o,this.ty=-(t*this.ty-e*n)/o,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!1,configurable:!0}),t}(),Qe=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Je=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],$e=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],tr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],er=[],rr=[],ir=Math.sign;!function(){for(var t=0;t<16;t++){var e=[];er.push(e);for(var r=0;r<16;r++)for(var i=ir(Qe[t]*Qe[r]+$e[t]*Je[r]),n=ir(Je[t]*Qe[r]+tr[t]*Je[r]),o=ir(Qe[t]*$e[r]+$e[t]*tr[r]),s=ir(Je[t]*$e[r]+tr[t]*tr[r]),a=0;a<16;a++)if(Qe[a]===i&&Je[a]===n&&$e[a]===o&&tr[a]===s){e.push(a);break}}for(t=0;t<16;t++){var h=new Ze;h.set(Qe[t],Je[t],$e[t],tr[t],0,0),rr.push(h)}}();var nr={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return Qe[t]},uY:function(t){return Je[t]},vX:function(t){return $e[t]},vY:function(t){return tr[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return er[t][e]},sub:function(t,e){return er[t][nr.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?nr.S:nr.N:2*Math.abs(e)<=Math.abs(t)?t>0?nr.E:nr.W:e>0?t>0?nr.SE:nr.SW:t>0?nr.NE:nr.NW},matrixAppendRotationInv:function(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=rr[nr.inv(e)];n.tx=r,n.ty=i,t.append(n)}},or=function(){function t(){this.worldTransform=new Ze,this.localTransform=new Ze,this.position=new Ke(this.onChange,this,0,0),this.scale=new Ke(this.onChange,this,1,1),this.pivot=new Ke(this.onChange,this,0,0),this.skew=new Ke(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var r=t.worldTransform,i=this.worldTransform;i.a=e.a*r.a+e.b*r.c,i.b=e.a*r.b+e.b*r.d,i.c=e.c*r.a+e.d*r.c,i.d=e.c*r.b+e.d*r.d,i.tx=e.tx*r.a+e.ty*r.c+r.tx,i.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),t.IDENTITY=new t,t}();rt.SORTABLE_CHILDREN=!1;var sr=function(){function t(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?Ye.EMPTY:((t=t||new Ye(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},t.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},t.prototype.addPointMatrix=function(t,e){var r=t.a,i=t.b,n=t.c,o=t.d,s=t.tx,a=t.ty,h=r*e.x+n*e.y+s,u=i*e.x+o*e.y+a;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)},t.prototype.addQuad=function(t){var e=this.minX,r=this.minY,i=this.maxX,n=this.maxY,o=t[0],s=t[1];e=o<e?o:e,r=s<r?s:r,i=o>i?o:i,n=s>n?s:n,e=(o=t[2])<e?o:e,r=(s=t[3])<r?s:r,i=o>i?o:i,n=s>n?s:n,e=(o=t[4])<e?o:e,r=(s=t[5])<r?s:r,i=o>i?o:i,n=s>n?s:n,e=(o=t[6])<e?o:e,r=(s=t[7])<r?s:r,i=o>i?o:i,n=s>n?s:n,this.minX=e,this.minY=r,this.maxX=i,this.maxY=n},t.prototype.addFrame=function(t,e,r,i,n){this.addFrameMatrix(t.worldTransform,e,r,i,n)},t.prototype.addFrameMatrix=function(t,e,r,i,n){var o=t.a,s=t.b,a=t.c,h=t.d,u=t.tx,l=t.ty,c=this.minX,d=this.minY,f=this.maxX,p=this.maxY,_=o*e+a*r+u,m=s*e+h*r+l;c=_<c?_:c,d=m<d?m:d,f=_>f?_:f,p=m>p?m:p,c=(_=o*i+a*r+u)<c?_:c,d=(m=s*i+h*r+l)<d?m:d,f=_>f?_:f,p=m>p?m:p,c=(_=o*e+a*n+u)<c?_:c,d=(m=s*e+h*n+l)<d?m:d,f=_>f?_:f,p=m>p?m:p,c=(_=o*i+a*n+u)<c?_:c,d=(m=s*i+h*n+l)<d?m:d,f=_>f?_:f,p=m>p?m:p,this.minX=c,this.minY=d,this.maxX=f,this.maxY=p},t.prototype.addVertexData=function(t,e,r){for(var i=this.minX,n=this.minY,o=this.maxX,s=this.maxY,a=e;a<r;a+=2){var h=t[a],u=t[a+1];i=h<i?h:i,n=u<n?u:n,o=h>o?h:o,s=u>s?u:s}this.minX=i,this.minY=n,this.maxX=o,this.maxY=s},t.prototype.addVertices=function(t,e,r,i){this.addVerticesMatrix(t.worldTransform,e,r,i)},t.prototype.addVerticesMatrix=function(t,e,r,i,n,o){void 0===n&&(n=0),void 0===o&&(o=n);for(var s=t.a,a=t.b,h=t.c,u=t.d,l=t.tx,c=t.ty,d=this.minX,f=this.minY,p=this.maxX,_=this.maxY,m=r;m<i;m+=2){var v=e[m],y=e[m+1],E=s*v+h*y+l,g=u*y+a*v+c;d=Math.min(d,E-n),p=Math.max(p,E+n),f=Math.min(f,g-o),_=Math.max(_,g+o)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=_},t.prototype.addBounds=function(t){var e=this.minX,r=this.minY,i=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>i?t.maxX:i,this.maxY=t.maxY>n?t.maxY:n},t.prototype.addBoundsMask=function(t,e){var r=t.minX>e.minX?t.minX:e.minX,i=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=n&&i<=o){var s=this.minX,a=this.minY,h=this.maxX,u=this.maxY;this.minX=r<s?r:s,this.minY=i<a?i:a,this.maxX=n>h?n:h,this.maxY=o>u?o:u}},t.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},t.prototype.addBoundsArea=function(t,e){var r=t.minX>e.x?t.minX:e.x,i=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=n&&i<=o){var s=this.minX,a=this.minY,h=this.maxX,u=this.maxY;this.minX=r<s?r:s,this.minY=i<a?i:a,this.maxX=n>h?n:h,this.maxY=o>u?o:u}},t.prototype.pad=function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},t.prototype.addFramePad=function(t,e,r,i,n,o){t-=n,e-=o,r+=n,i+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>i?this.maxY:i},t}(),ar=function(t,e){return(ar=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function hr(t,e){function r(){this.constructor=t}ar(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var ur=function(t){function e(){var e=t.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new or,e.alpha=1,e.visible=!0,e.renderable=!0,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new sr,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return hr(e,t),e.mixin=function(t){for(var r=Object.keys(t),i=0;i<r.length;++i){var n=r[i];Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t,n))}},Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Ye),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new Ye),t=this._localBoundsRect),this._localBounds||(this._localBounds=new sr);var e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var i=this._bounds,n=this._boundsID;this._bounds=this._localBounds;var o=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=i,this._bounds.updateID+=this._boundsID-n,o},e.prototype.toGlobal=function(t,e,r){return void 0===r&&(r=!1),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,r,i){return e&&(t=e.toGlobal(t,r,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,r,i,n,o,s,a,h){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===i&&(i=1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===h&&(h=0),this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=i||1,this.rotation=n,this.skew.x=o,this.skew.y=s,this.pivot.x=a,this.pivot.y=h,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this.emit("destroyed"),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new lr),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*ke},set:function(t){this.transform.rotation=t*He},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){var e;this._mask&&((e=this._mask.maskObject||this._mask).renderable=!0,e.isMask=!1),this._mask=t,this._mask&&((e=this._mask.maskObject||this._mask).renderable=!1,e.isMask=!0)},enumerable:!1,configurable:!0}),e}(ot),lr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sortDirty=null,e}return hr(e,t),e}(ur);function cr(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}ur.prototype.displayObjectUpdateTransform=ur.prototype.updateTransform;var dr=function(t){function e(){var e=t.call(this)||this;return e.children=[],e.sortableChildren=rt.SORTABLE_CHILDREN,e.sortDirty=!1,e}return hr(e,t),e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];if(e.length>1)for(var i=0;i<e.length;i++)this.addChild(e[i]);else{var n=e[0];n.parent&&n.parent.removeChild(n),n.parent=this,this.sortDirty=!0,n.transform._parentID=-1,this.children.push(n),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",n,this,this.children.length-1),n.emit("added",this)}return e[0]},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var r=this.getChildIndex(t),i=this.getChildIndex(e);this.children[r]=e,this.children[i]=t,this.onChildrenChange(r<i?r:i)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var r=this.getChildIndex(t);Ae(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];if(e.length>1)for(var i=0;i<e.length;i++)this.removeChild(e[i]);else{var n=e[0],o=this.children.indexOf(n);if(-1===o)return null;n.parent=null,n.transform._parentID=-1,Ae(this.children,o,1),this._boundsID++,this.onChildrenChange(o),n.emit("removed",this),this.emit("childRemoved",n,this,o)}return e[0]},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Ae(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var r,i=t,n=e-i;if(n>0&&n<=e){r=this.children.splice(i,n);for(var o=0;o<r.length;++o)r[o].parent=null,r[o].transform&&(r[o].transform._parentID=-1);for(this._boundsID++,this.onChildrenChange(t),o=0;o<r.length;++o)r[o].emit("removed",this),this.emit("childRemoved",r[o],this,o);return r}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,r=this.children.length;e<r;++e){var i=this.children[e];i._lastSortedIndex=e,t||0===i.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(cr),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var r=this.children[t];r.visible&&r.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var r=e._mask.maskObject||e._mask;r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(e,r){void 0===r&&(r=!1);var i=t.prototype.getLocalBounds.call(this,e);if(!r)for(var n=0,o=this.children.length;n<o;++n){var s=this.children[n];s.visible&&s.updateTransform()}return i},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var i=0;i<e.length;i++)e[i].enabled&&this._enabledFilters.push(e[i]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}r&&t.mask.push(this,this._mask),this._render(t),i=0;for(var n=this.children.length;i<n;i++)this.children[i].render(t);t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var r="boolean"==typeof e?e:e&&e.children,i=this.removeChildren(0,this.children.length);if(r)for(var n=0;n<i.length;++n)i[n].destroy(e)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},enumerable:!1,configurable:!0}),e}(ur);dr.prototype.containerUpdateTransform=dr.prototype.updateTransform;var fr={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};ur.mixin(fr);var pr=100,_r=0,mr=0,vr=2,yr=function(){function t(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(et.tablet||et.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width=pr+"px",e.style.height=pr+"px",e.style.position="absolute",e.style.top=_r+"px",e.style.left=mr+"px",e.style.zIndex=vr.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),self.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),t.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",function(){t._isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e},t.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},t.prototype.activate=function(){var t;this._isActive||(this._isActive=!0,self.document.addEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null===(t=this.renderer.view.parentNode)||void 0===t||t.appendChild(this.div))},t.prototype.deactivate=function(){var t;this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null===(t=this.div.parentNode)||void 0===t||t.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}},t.prototype.update=function(){var t=performance.now();if(!(et.android.device&&t<this.androidUpdateCount)&&(this.androidUpdateCount=t+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),r=e.left,i=e.top,n=e.width,o=e.height,s=this.renderer,a=s.width,h=s.height,u=s.resolution,l=n/a*u,c=o/h*u,d=this.div;d.style.left=r+"px",d.style.top=i+"px",d.style.width=a+"px",d.style.height=h+"px";for(var f=0;f<this.children.length;f++){var p=this.children[f];if(p.renderId!==this.renderId)p._accessibleActive=!1,Ae(this.children,f,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,f--;else{d=p._accessibleDiv;var _=p.hitArea,m=p.worldTransform;p.hitArea?(d.style.left=(m.tx+_.x*m.a)*l+"px",d.style.top=(m.ty+_.y*m.d)*c+"px",d.style.width=_.width*m.a*l+"px",d.style.height=_.height*m.d*c+"px"):(_=p.getBounds(),this.capHitArea(_),d.style.left=_.x*l+"px",d.style.top=_.y*c+"px",d.style.width=_.width*l+"px",d.style.height=_.height*c+"px",d.title!==p.accessibleTitle&&null!==p.accessibleTitle&&(d.title=p.accessibleTitle),d.getAttribute("aria-label")!==p.accessibleHint&&null!==p.accessibleHint&&d.setAttribute("aria-label",p.accessibleHint)),p.accessibleTitle===d.title&&p.tabIndex===d.tabIndex||(d.title=p.accessibleTitle,d.tabIndex=p.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}},t.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},t.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);var e=this.renderer,r=e.width,i=e.height;t.x+t.width>r&&(t.width=r-t.x),t.y+t.height>i&&(t.height=i-t.y)},t.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width=pr+"px",e.style.height=pr+"px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=vr.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},t.prototype._onClick=function(t){var e=this.renderer.plugins.interaction,r=t.target.displayObject,i=e.eventData;e.dispatchEvent(r,"click",i),e.dispatchEvent(r,"pointertap",i),e.dispatchEvent(r,"tap",i)},t.prototype._onFocus=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction,r=t.target.displayObject,i=e.eventData;e.dispatchEvent(r,"mouseover",i)},t.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction,r=t.target.displayObject,i=e.eventData;e.dispatchEvent(r,"mouseout",i)},t.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},t.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},t.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t}();rt.TARGET_FPMS=.06,function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"}(t.UPDATE_PRIORITY||(t.UPDATE_PRIORITY={}));var Er=function(){function t(t,e,r,i){void 0===e&&(e=null),void 0===r&&(r=0),void 0===i&&(i=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=i}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),gr=function(){function e(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Er(null,null,1/0),this.deltaMS=1/rt.TARGET_FPMS,this.elapsedMS=1/rt.TARGET_FPMS,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return e.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},e.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},e.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},e.prototype.add=function(e,r,i){return void 0===i&&(i=t.UPDATE_PRIORITY.NORMAL),this._addListener(new Er(e,r,i))},e.prototype.addOnce=function(e,r,i){return void 0===i&&(i=t.UPDATE_PRIORITY.NORMAL),this._addListener(new Er(e,r,i,!0))},e.prototype._addListener=function(t){var e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this},e.prototype.remove=function(t,e){for(var r=this._head.next;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(e.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},e.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},e.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},e.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*rt.TARGET_FPMS;for(var i=this._head,n=i.next;n;)n=n.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(e.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,rt.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"shared",{get:function(){if(!e._shared){var t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared},enumerable:!1,configurable:!0}),Object.defineProperty(e,"system",{get:function(){if(!e._system){var t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system},enumerable:!1,configurable:!0}),e}(),Tr=function(){function e(){}return e.init=function(e){var r=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,t.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){r._ticker.stop()},this.start=function(){r._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?gr.shared:new gr,e.autoStart&&this.start()},e.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},e}(),br=function(){function t(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new qe,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(t.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),t.prototype.getLocalPosition=function(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)},t.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},t}(),Rr=function(t,e){return(Rr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},xr=function(){function t(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},t.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},t}(),Ar=function(){function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},Object.defineProperty(t.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return this._flags===t.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"over",{get:function(){return 0!=(this._flags&t.FLAGS.OVER)},set:function(e){this._doSet(t.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightDown",{get:function(){return 0!=(this._flags&t.FLAGS.RIGHT_DOWN)},set:function(e){this._doSet(t.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftDown",{get:function(){return 0!=(this._flags&t.FLAGS.LEFT_DOWN)},set:function(e){this._doSet(t.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),t.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),t}(),Sr=function(){function t(){this._tempPoint=new qe}return t.prototype.recursiveFindHit=function(t,e,r,i,n){if(!e||!e.visible)return!1;var o=t.data.global,s=!1,a=n=e.interactive||n,h=!0;if(e.hitArea?(i&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?s=!0:(i=!1,h=!1)),a=!1):e._mask&&i&&(e._mask.containsPoint&&e._mask.containsPoint(o)||(i=!1)),h&&e.interactiveChildren&&e.children)for(var u=e.children,l=u.length-1;l>=0;l--){var c=u[l],d=this.recursiveFindHit(t,c,r,i,a);if(d){if(!c.parent)continue;a=!1,d&&(t.target&&(i=!1),s=!0)}}return n&&(i&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(s=!0),e.interactive&&(s&&!t.target&&(t.target=e),r&&r(t,e,!!s))),s},t.prototype.findHit=function(t,e,r,i){this.recursiveFindHit(t,e,r,i,!1)},t}(),Or={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};ur.mixin(Or);var Ir=1,Pr={target:null,data:{global:null}},Mr=function(e){function r(t,r){var i=e.call(this)||this;return r=r||{},i.renderer=t,i.autoPreventDefault=void 0===r.autoPreventDefault||r.autoPreventDefault,i.interactionFrequency=r.interactionFrequency||10,i.mouse=new br,i.mouse.identifier=Ir,i.mouse.global.set(-999999),i.activeInteractionData={},i.activeInteractionData[Ir]=i.mouse,i.interactionDataPool=[],i.eventData=new xr,i.interactionDOMElement=null,i.moveWhenInside=!1,i.eventsAdded=!1,i.tickerAdded=!1,i.mouseOverRenderer=!("PointerEvent"in self),i.supportsTouchEvents="ontouchstart"in self,i.supportsPointerEvents=!!self.PointerEvent,i.onPointerUp=i.onPointerUp.bind(i),i.processPointerUp=i.processPointerUp.bind(i),i.onPointerCancel=i.onPointerCancel.bind(i),i.processPointerCancel=i.processPointerCancel.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.processPointerDown=i.processPointerDown.bind(i),i.onPointerMove=i.onPointerMove.bind(i),i.processPointerMove=i.processPointerMove.bind(i),i.onPointerOut=i.onPointerOut.bind(i),i.processPointerOverOut=i.processPointerOverOut.bind(i),i.onPointerOver=i.onPointerOver.bind(i),i.cursorStyles={default:"inherit",pointer:"pointer"},i.currentCursorMode=null,i.cursor=null,i.resolution=1,i.delayedEvents=[],i.search=new Sr,i._tempDisplayObject=new lr,i._eventListenerOptions={capture:!0,passive:!1},i._useSystemTicker=void 0===r.useSystemTicker||r.useSystemTicker,i.setTargetElement(i.renderer.view,i.renderer.resolution),i}return function(t,e){function r(){this.constructor=t}Rr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,e),Object.defineProperty(r.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),r.prototype.hitTest=function(t,e){return Pr.target=null,Pr.data.global=t,e||(e=this.lastObjectRendered),this.processInteractive(Pr,e,null,!0),Pr.target},r.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents(),this.addTickerListener()},r.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(gr.system.add(this.tickerUpdate,this,t.UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},r.prototype.removeTickerListener=function(){this.tickerAdded&&(gr.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},r.prototype.addEvents=function(){if(!this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(self.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},r.prototype.removeEvents=function(){if(this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(self.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},r.prototype.tickerUpdate=function(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},r.prototype.update=function(){if(this.interactionDOMElement)if(this._didMove)this._didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var e=this.activeInteractionData[t];if(e.originalEvent&&"touch"!==e.pointerType){var r=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e);this.processInteractive(r,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},r.prototype.setCursorMode=function(t){t=t||"default";var e=!0;if(self.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(e=!1),this.currentCursorMode!==t){this.currentCursorMode=t;var r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.interactionDOMElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.interactionDOMElement.style,r)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.interactionDOMElement.style.cursor=t)}},r.prototype.dispatchEvent=function(t,e,r){r.stopPropagationHint&&t!==r.stopsPropagatingAt||(r.currentTarget=t,r.type=e,t.emit(e,r),t[e]&&t[e](r))},r.prototype.delayDispatchEvent=function(t,e,r){this.delayedEvents.push({displayObject:t,eventString:e,eventData:r})},r.prototype.mapPositionToPoint=function(t,e,r){var i;i=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var n=1/this.resolution;t.x=(e-i.left)*(this.interactionDOMElement.width/i.width)*n,t.y=(r-i.top)*(this.interactionDOMElement.height/i.height)*n},r.prototype.processInteractive=function(t,e,r,i){var n=this.search.findHit(t,e,r,i),o=this.delayedEvents;if(!o.length)return n;t.stopPropagationHint=!1;var s=o.length;this.delayedEvents=[];for(var a=0;a<s;a++){var h=o[a],u=h.displayObject,l=h.eventString,c=h.eventData;c.stopsPropagatingAt===u&&(c.stopPropagationHint=!0),this.dispatchEvent(u,l,c)}return n},r.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var r=e.length,i=0;i<r;i++){var n=e[i],o=this.getInteractionDataForPointerId(n),s=this.configureInteractionEventForDOMEvent(this.eventData,n,o);if(s.data.originalEvent=t,this.processInteractive(s,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",s),"touch"===n.pointerType)this.emit("touchstart",s);else if("mouse"===n.pointerType||"pen"===n.pointerType){var a=2===n.button;this.emit(a?"rightdown":"mousedown",this.eventData)}}}},r.prototype.processPointerDown=function(t,e,r){var i=t.data,n=t.data.identifier;if(r)if(e.trackedPointers[n]||(e.trackedPointers[n]=new Ar(n)),this.dispatchEvent(e,"pointerdown",t),"touch"===i.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===i.pointerType||"pen"===i.pointerType){var o=2===i.button;o?e.trackedPointers[n].rightDown=!0:e.trackedPointers[n].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},r.prototype.onPointerComplete=function(t,e,r){for(var i=this.normalizeToPointerData(t),n=i.length,o=t.target!==this.interactionDOMElement?"outside":"",s=0;s<n;s++){var a=i[s],h=this.getInteractionDataForPointerId(a),u=this.configureInteractionEventForDOMEvent(this.eventData,a,h);if(u.data.originalEvent=t,this.processInteractive(u,this.lastObjectRendered,r,e||!o),this.emit(e?"pointercancel":"pointerup"+o,u),"mouse"===a.pointerType||"pen"===a.pointerType){var l=2===a.button;this.emit(l?"rightup"+o:"mouseup"+o,u)}else"touch"===a.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,u),this.releaseInteractionDataForPointerId(a.pointerId))}},r.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},r.prototype.processPointerCancel=function(t,e){var r=t.data,i=t.data.identifier;void 0!==e.trackedPointers[i]&&(delete e.trackedPointers[i],this.dispatchEvent(e,"pointercancel",t),"touch"===r.pointerType&&this.dispatchEvent(e,"touchcancel",t))},r.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},r.prototype.processPointerUp=function(t,e,r){var i=t.data,n=t.data.identifier,o=e.trackedPointers[n],s="touch"===i.pointerType,a="mouse"===i.pointerType||"pen"===i.pointerType,h=!1;if(a){var u=2===i.button,l=Ar.FLAGS,c=u?l.RIGHT_DOWN:l.LEFT_DOWN,d=void 0!==o&&o.flags&c;r?(this.dispatchEvent(e,u?"rightup":"mouseup",t),d&&(this.dispatchEvent(e,u?"rightclick":"click",t),h=!0)):d&&this.dispatchEvent(e,u?"rightupoutside":"mouseupoutside",t),o&&(u?o.rightDown=!1:o.leftDown=!1)}r?(this.dispatchEvent(e,"pointerup",t),s&&this.dispatchEvent(e,"touchend",t),o&&(a&&!h||this.dispatchEvent(e,"pointertap",t),s&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),s&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[n]},r.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this._didMove=!0,this.cursor=null);for(var r=e.length,i=0;i<r;i++){var n=e[i],o=this.getInteractionDataForPointerId(n),s=this.configureInteractionEventForDOMEvent(this.eventData,n,o);s.data.originalEvent=t,this.processInteractive(s,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",s),"touch"===n.pointerType&&this.emit("touchmove",s),"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.emit("mousemove",s)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},r.prototype.processPointerMove=function(t,e,r){var i=t.data,n="touch"===i.pointerType,o="mouse"===i.pointerType||"pen"===i.pointerType;o&&this.processPointerOverOut(t,e,r),this.moveWhenInside&&!r||(this.dispatchEvent(e,"pointermove",t),n&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},r.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var r=this.getInteractionDataForPointerId(e),i=this.configureInteractionEventForDOMEvent(this.eventData,e,r);i.data.originalEvent=e,this.processInteractive(i,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",i),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",i):this.releaseInteractionDataForPointerId(r.identifier)}},r.prototype.processPointerOverOut=function(t,e,r){var i=t.data,n=t.data.identifier,o="mouse"===i.pointerType||"pen"===i.pointerType,s=e.trackedPointers[n];r&&!s&&(s=e.trackedPointers[n]=new Ar(n)),void 0!==s&&(r&&this.mouseOverRenderer?(s.over||(s.over=!0,this.delayDispatchEvent(e,"pointerover",t),o&&this.delayDispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):s.over&&(s.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),s.none&&delete e.trackedPointers[n]))},r.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],r=this.getInteractionDataForPointerId(e),i=this.configureInteractionEventForDOMEvent(this.eventData,e,r);i.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",i),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",i)},r.prototype.getInteractionDataForPointerId=function(t){var e,r=t.pointerId;return r===Ir||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[r]?e=this.activeInteractionData[r]:((e=this.interactionDataPool.pop()||new br).identifier=r,this.activeInteractionData[r]=e),e.copyEvent(t),e},r.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},r.prototype.configureInteractionEventForDOMEvent=function(t,e,r){return t.data=r,this.mapPositionToPoint(r.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=r.global.x,e.globalY=r.global.y),r.originalEvent=e,t.reset(),t},r.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var r=0,i=t.changedTouches.length;r<i;r++){var n=t.changedTouches[r];void 0===n.button&&(n.button=t.touches.length?1:0),void 0===n.buttons&&(n.buttons=t.touches.length?1:0),void 0===n.isPrimary&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===n.width&&(n.width=n.radiusX||1),void 0===n.height&&(n.height=n.radiusY||1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="touch"),void 0===n.pointerId&&(n.pointerId=n.identifier||0),void 0===n.pressure&&(n.pressure=n.force||.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),void 0===n.layerX&&(n.layerX=n.offsetX=n.clientX),void 0===n.layerY&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,e.push(n)}else if(!self.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof self.PointerEvent)){var o=t;void 0===o.isPrimary&&(o.isPrimary=!0),void 0===o.width&&(o.width=1),void 0===o.height&&(o.height=1),void 0===o.tiltX&&(o.tiltX=0),void 0===o.tiltY&&(o.tiltY=0),void 0===o.pointerType&&(o.pointerType="mouse"),void 0===o.pointerId&&(o.pointerId=Ir),void 0===o.pressure&&(o.pressure=.5),void 0===o.twist&&(o.twist=0),void 0===o.tangentialPressure&&(o.tangentialPressure=0),o.isNormalized=!0,e.push(o)}else e.push(t);return e},r.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},r}(ot),Dr=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,r,i,n,o,s,a){if(arguments.length>8)throw new Error("max arguments reached");var h=this.name,u=this.items;this._aliasCount++;for(var l=0,c=u.length;l<c;l++)u[l][h](t,e,r,i,n,o,s,a);return u===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}();Object.defineProperties(Dr.prototype,{dispatch:{value:Dr.prototype.emit},run:{value:Dr.prototype.emit}}),rt.PREFER_ENV=et.any?t.ENV.WEBGL:t.ENV.WEBGL2,rt.STRICT_TEXTURE_CACHE=!1;var Nr=[];function wr(t,e){if(!t)return null;var r="";if("string"==typeof t){var i=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);i&&(r=i[1].toLowerCase())}for(var n=Nr.length-1;n>=0;--n){var o=Nr[n];if(o.test&&o.test(t,r))return new o(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var Cr=function(t,e){return(Cr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Lr(t,e){function r(){this.constructor=t}Cr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Fr=function(){return(Fr=Object.assign||function(t){for(var e,r=arguments,i=1,n=arguments.length;i<n;i++)for(var o in e=r[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Ur=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Dr("setRealSize"),this.onUpdate=new Dr("update"),this.onError=new Dr("onError")}return t.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},t.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},t.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(t.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.destroyed||this.onUpdate.emit()},t.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t.prototype.style=function(t,e,r){return!1},t.prototype.dispose=function(){},t.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},t.test=function(t,e){return!1},t}(),Br=function(e){function r(t,r){var i=this,n=r||{},o=n.width,s=n.height;if(!o||!s)throw new Error("BufferResource width or height invalid");return(i=e.call(this,o,s)||this).data=t,i}return Lr(r,e),r.prototype.upload=function(e,r,i){var n=e.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===t.ALPHA_MODES.UNPACK);var o=r.realWidth,s=r.realHeight;return i.width===o&&i.height===s?n.texSubImage2D(r.target,0,0,0,o,s,r.format,i.type,this.data):(i.width=o,i.height=s,n.texImage2D(r.target,0,i.internalFormat,o,s,0,r.format,i.type,this.data)),!0},r.prototype.dispose=function(){this.data=null},r.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},r}(Ur),Gr={scaleMode:t.SCALE_MODES.NEAREST,format:t.FORMATS.RGBA,alphaMode:t.ALPHA_MODES.NPM},Xr=function(e){function r(r,i){void 0===r&&(r=null),void 0===i&&(i=null);var n=e.call(this)||this,o=(i=i||{}).alphaMode,s=i.mipmap,a=i.anisotropicLevel,h=i.scaleMode,u=i.width,l=i.height,c=i.wrapMode,d=i.format,f=i.type,p=i.target,_=i.resolution,m=i.resourceOptions;return!r||r instanceof Ur||((r=wr(r,m)).internal=!0),n.resolution=_||rt.RESOLUTION,n.width=Math.round((u||0)*n.resolution)/n.resolution,n.height=Math.round((l||0)*n.resolution)/n.resolution,n._mipmap=void 0!==s?s:rt.MIPMAP_TEXTURES,n.anisotropicLevel=void 0!==a?a:rt.ANISOTROPIC_LEVEL,n._wrapMode=c||rt.WRAP_MODE,n._scaleMode=void 0!==h?h:rt.SCALE_MODE,n.format=d||t.FORMATS.RGBA,n.type=f||t.TYPES.UNSIGNED_BYTE,n.target=p||t.TARGETS.TEXTURE_2D,n.alphaMode=void 0!==o?o:t.ALPHA_MODES.UNPACK,n.uid=Ie(),n.touched=0,n.isPowerOfTwo=!1,n._refreshPOT(),n._glTextures={},n.dirtyId=0,n.dirtyStyleId=0,n.cacheId=null,n.valid=u>0&&l>0,n.textureCacheIds=[],n.destroyed=!1,n.resource=null,n._batchEnabled=0,n._batchLocation=0,n.parentTextureArray=null,n.setResource(r),n}return Lr(r,e),Object.defineProperty(r.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"mipmap",{get:function(){return this._mipmap},set:function(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),r.prototype.setStyle=function(t,e){var r;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this},r.prototype.setSize=function(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)},r.prototype.setRealSize=function(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this},r.prototype._refreshPOT=function(){this.isPowerOfTwo=Re(this.realWidth)&&Re(this.realHeight)},r.prototype.setResolution=function(t){var e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)},r.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},r.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},r.prototype.onError=function(t){this.emit("error",this,t)},r.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ne[this.cacheId],delete De[this.cacheId],this.cacheId=null),this.dispose(),r.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},r.prototype.dispose=function(){this.emit("dispose",this)},r.prototype.castToBaseTexture=function(){return this},r.from=function(t,e,i){void 0===i&&(i=rt.STRICT_TEXTURE_CACHE);var n="string"==typeof t,o=null;if(n)o=t;else{if(!t._pixiId){var s=e&&e.pixiIdPrefix||"pixiid";t._pixiId=s+"_"+Ie()}o=t._pixiId}var a=Ne[o];if(n&&i&&!a)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return a||((a=new r(t,e)).cacheId=o,r.addToCache(a,o)),a},r.fromBuffer=function(e,i,n,o){e=e||new Float32Array(i*n*4);var s=new Br(e,{width:i,height:n}),a=e instanceof Float32Array?t.TYPES.FLOAT:t.TYPES.UNSIGNED_BYTE;return new r(s,Object.assign(Gr,o||{width:i,height:n,type:a}))},r.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Ne[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),Ne[e]=t)},r.removeFromCache=function(t){if("string"==typeof t){var e=Ne[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Ne[t],e}}else if(t&&t.textureCacheIds){for(var i=0;i<t.textureCacheIds.length;++i)delete Ne[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null},r._globalBatch=0,r}(ot),kr=function(t){function e(e,r){var i=this,n=r||{},o=n.width,s=n.height;(i=t.call(this,o,s)||this).items=[],i.itemDirtyIds=[];for(var a=0;a<e;a++){var h=new Xr;i.items.push(h),i.itemDirtyIds.push(-2)}return i.length=e,i._load=null,i.baseTexture=null,i}return Lr(e,t),e.prototype.initFromArray=function(t,e){for(var r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Ur?this.addResourceAt(t[r],r):this.addResourceAt(wr(t[r],e),r))},e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");t.prototype.bind.call(this,e);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=e,this.items[r].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map(function(t){return t.resource}).filter(function(t){return t}).map(function(t){return t.load()});return this._load=Promise.all(e).then(function(){var e=t.items[0],r=e.realWidth,i=e.realHeight;return t.resize(r,i),Promise.resolve(t)}),this._load},e}(Ur),Hr=function(e){function r(t,r){var i,n,o=this,s=r||{},a=s.width,h=s.height;return Array.isArray(t)?(i=t,n=t.length):n=t,o=e.call(this,n,{width:a,height:h})||this,i&&o.initFromArray(i,r),o}return Lr(r,e),r.prototype.addBaseTextureAt=function(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this},r.prototype.bind=function(r){e.prototype.bind.call(this,r),r.target=t.TARGETS.TEXTURE_2D_ARRAY},r.prototype.upload=function(t,e,r){var i=this.length,n=this.itemDirtyIds,o=this.items,s=t.gl;r.dirtyId<0&&s.texImage3D(s.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,i,0,e.format,r.type,null);for(var a=0;a<i;a++){var h=o[a];n[a]<h.dirtyId&&(n[a]=h.dirtyId,h.valid&&s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,a,h.resource.width,h.resource.height,1,e.format,r.type,h.resource.source))}return!0},r}(kr),Yr=function(e){function r(t){var r=this,i=t,n=i.naturalWidth||i.videoWidth||i.width,o=i.naturalHeight||i.videoHeight||i.height;return(r=e.call(this,n,o)||this).source=t,r.noSubImage=!1,r}return Lr(r,e),r.crossOrigin=function(t,e,r){void 0===r&&0!==e.indexOf("data:")?t.crossOrigin=Ue(e):!1!==r&&(t.crossOrigin="string"==typeof r?r:"anonymous")},r.prototype.upload=function(e,r,i,n){var o=e.gl,s=r.realWidth,a=r.realHeight;return n=n||this.source,o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===t.ALPHA_MODES.UNPACK),this.noSubImage||r.target!==o.TEXTURE_2D||i.width!==s||i.height!==a?(i.width=s,i.height=a,o.texImage2D(r.target,0,i.internalFormat,r.format,i.type,n)):o.texSubImage2D(o.TEXTURE_2D,0,0,0,r.format,i.type,n),!0},r.prototype.update=function(){if(!this.destroyed){var t=this.source,r=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(r,i),e.prototype.update.call(this)}},r.prototype.dispose=function(){this.source=null},r}(Ur),jr=function(t){function e(e){return t.call(this,e)||this}return Lr(e,t),e.test=function(t){var e=self.OffscreenCanvas;return!!(e&&t instanceof e)||self.HTMLCanvasElement&&t instanceof HTMLCanvasElement},e}(Yr),Vr=function(e){function r(i,n){var o=this,s=n||{},a=s.width,h=s.height,u=s.autoLoad,l=s.linkBaseTexture;if(i&&i.length!==r.SIDES)throw new Error("Invalid length. Got "+i.length+", expected 6");o=e.call(this,6,{width:a,height:h})||this;for(var c=0;c<r.SIDES;c++)o.items[c].target=t.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+c;return o.linkBaseTexture=!1!==l,i&&o.initFromArray(i,n),!1!==u&&o.load(),o}return Lr(r,e),r.prototype.bind=function(r){e.prototype.bind.call(this,r),r.target=t.TARGETS.TEXTURE_CUBE_MAP},r.prototype.addBaseTextureAt=function(e,r,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[r])throw new Error("Index "+r+" is out of bounds");if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0){if(!e.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(e.resource,r)}else e.target=t.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+r,e.parentTextureArray=this.baseTexture,this.items[r]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[r]=e,this},r.prototype.upload=function(t,e,i){for(var n=this.itemDirtyIds,o=0;o<r.SIDES;o++){var s=this.items[o];n[o]<s.dirtyId&&(s.valid&&s.resource?(s.resource.upload(t,s,i),n[o]=s.dirtyId):n[o]<-1&&(t.gl.texImage2D(s.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),n[o]=-1))}return!0},r.test=function(t){return Array.isArray(t)&&t.length===r.SIDES},r.SIDES=6,r}(kr),Wr=function(e){function r(t,r){var i=this;if(r=r||{},!(t instanceof HTMLImageElement)){var n=new Image;Yr.crossOrigin(n,t,r.crossorigin),n.src=t,t=n}return i=e.call(this,t)||this,!t.complete&&i._width&&i._height&&(i._width=0,i._height=0),i.url=t.src,i._process=null,i.preserveBitmap=!1,i.createBitmap=(void 0!==r.createBitmap?r.createBitmap:rt.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,i.alphaMode="number"==typeof r.alphaMode?r.alphaMode:null,i.bitmap=null,i._load=null,!1!==r.autoLoad&&i.load(),i}return Lr(r,e),r.prototype.load=function(t){var e=this;return this._load?this._load:(void 0!==t&&(this.createBitmap=t),this._load=new Promise(function(t,r){var i=e.source;e.url=i.src;var n=function(){e.destroyed||(i.onload=null,i.onerror=null,e.resize(i.width,i.height),e._load=null,e.createBitmap?t(e.process()):t(e))};i.complete&&i.src?n():(i.onload=n,i.onerror=function(t){r(t),e.onError.emit(t)})}),this._load)},r.prototype.process=function(){var e=this,r=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!self.createImageBitmap)return Promise.resolve(this);var i=self.createImageBitmap,n=!r.crossOrigin||"anonymous"===r.crossOrigin;return this._process=fetch(r.src,{mode:n?"cors":"no-cors"}).then(function(t){return t.blob()}).then(function(n){return i(n,0,0,r.width,r.height,{premultiplyAlpha:e.alphaMode===t.ALPHA_MODES.UNPACK?"premultiply":"none"})}).then(function(t){return e.destroyed?Promise.reject():(e.bitmap=t,e.update(),e._process=null,Promise.resolve(e))}),this._process},r.prototype.upload=function(t,r,i){if("number"==typeof this.alphaMode&&(r.alphaMode=this.alphaMode),!this.createBitmap)return e.prototype.upload.call(this,t,r,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(e.prototype.upload.call(this,t,r,i,this.bitmap),!this.preserveBitmap){var n=!0,o=r._glTextures;for(var s in o){var a=o[s];if(a!==i&&a.dirtyId!==r.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},r.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,e.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},r.test=function(t){return"string"==typeof t||t instanceof HTMLImageElement},r}(Yr),zr=function(t){function e(e,r){var i=this;return r=r||{},(i=t.call(this,document.createElement("canvas"))||this)._width=0,i._height=0,i.svg=e,i.scale=r.scale||1,i._overrideWidth=r.width,i._overrideHeight=r.height,i._resolve=null,i._crossorigin=r.crossorigin,i._load=null,!1!==r.autoLoad&&i.load(),i}return Lr(e,t),e.prototype.load=function(){var t=this;return this._load?this._load:(this._load=new Promise(function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}),this._load)},e.prototype._loadSvg=function(){var t=this,e=new Image;Yr.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=function(r){t._resolve&&(e.onerror=null,t.onError.emit(r))},e.onload=function(){if(t._resolve){var r=e.width,i=e.height;if(!r||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var n=r*t.scale,o=i*t.scale;(t._overrideWidth||t._overrideHeight)&&(n=t._overrideWidth||t._overrideHeight/i*r,o=t._overrideHeight||t._overrideWidth/r*i),n=Math.round(n),o=Math.round(o);var s=t.source;s.width=n,s.height=o,s._pixiId="canvas_"+Ie(),s.getContext("2d").drawImage(e,0,0,r,i,0,0,n,o),t._resolve(),t._resolve=null}}},e.getSize=function(t){var r=e.SVG_SIZE.exec(t),i={};return r&&(i[r[1]]=Math.round(parseFloat(r[3])),i[r[5]]=Math.round(parseFloat(r[7]))),i},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,r){return"svg"===r||"string"==typeof t&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(t)||"string"==typeof t&&e.SVG_XML.test(t)},e.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(Yr),qr=function(t){function e(r,i){var n=this;if(i=i||{},!(r instanceof HTMLVideoElement)){var o=document.createElement("video");o.setAttribute("preload","auto"),o.setAttribute("webkit-playsinline",""),o.setAttribute("playsinline",""),"string"==typeof r&&(r=[r]);var s=r[0].src||r[0];Yr.crossOrigin(o,s,i.crossorigin);for(var a=0;a<r.length;++a){var h=document.createElement("source"),u=r[a],l=u.src,c=u.mime,d=(l=l||r[a]).split("?").shift().toLowerCase(),f=d.substr(d.lastIndexOf(".")+1);c=c||e.MIME_TYPES[f]||"video/"+f,h.src=l,h.type=c,o.appendChild(h)}r=o}return(n=t.call(this,r)||this).noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=i.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=!1!==i.autoPlay,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),!1!==i.autoLoad&&n.load(),n}return Lr(e,t),e.prototype.update=function(e){if(!this.destroyed){var r=gr.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(function(r){t.valid?r(t):(t._resolve=r,e.load())}),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){var t=this.source;return 3===t.readyState||4===t.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(gr.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(gr.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&(gr.shared.remove(this.update,this),this._isConnectedToTicker=!1);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(gr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(gr.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,r){return self.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.indexOf(r)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(Yr),Kr=function(t){function e(e){return t.call(this,e)||this}return Lr(e,t),e.test=function(t){return!!self.createImageBitmap&&t instanceof ImageBitmap},e}(Yr);Nr.push(Wr,Kr,jr,qr,zr,Br,Vr,Hr);var Zr={__proto__:null,Resource:Ur,BaseImageResource:Yr,INSTALLED:Nr,autoDetectResource:wr,AbstractMultiResource:kr,ArrayResource:Hr,BufferResource:Br,CanvasResource:jr,CubeResource:Vr,ImageResource:Wr,SVGResource:zr,VideoResource:qr,ImageBitmapResource:Kr},Qr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Lr(r,e),r.prototype.upload=function(e,r,i){var n=e.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===t.ALPHA_MODES.UNPACK);var o=r.realWidth,s=r.realHeight;return i.width===o&&i.height===s?n.texSubImage2D(r.target,0,0,0,o,s,r.format,i.type,this.data):(i.width=o,i.height=s,n.texImage2D(r.target,0,i.internalFormat,o,s,0,r.format,i.type,this.data)),!0},r}(Br),Jr=function(){function e(e,r){this.width=Math.round(e||100),this.height=Math.round(r||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Dr("disposeFramebuffer"),this.multisample=t.MSAA_QUALITY.NONE}return Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),e.prototype.addColorTexture=function(e,r){return void 0===e&&(e=0),this.colorTextures[e]=r||new Xr(null,{scaleMode:t.SCALE_MODES.NEAREST,resolution:1,mipmap:t.MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},e.prototype.addDepthTexture=function(e){return this.depthTexture=e||new Xr(new Qr(null,{width:this.width,height:this.height}),{scaleMode:t.SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:t.MIPMAP_MODES.OFF,format:t.FORMATS.DEPTH_COMPONENT,type:t.TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},e.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},e.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},e.prototype.resize=function(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var i=this.colorTextures[r],n=i.resolution;i.setSize(t/n,e/n)}this.depthTexture&&(n=this.depthTexture.resolution,this.depthTexture.setSize(t/n,e/n))}},e.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},e.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},e}(),$r=function(e){function r(r){var i=this;return"number"==typeof r&&(r={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),r.width=r.width||100,r.height=r.height||100,r.multisample=void 0!==r.multisample?r.multisample:t.MSAA_QUALITY.NONE,(i=e.call(this,null,r)||this).mipmap=t.MIPMAP_MODES.OFF,i.valid=!0,i.clearColor=[0,0,0,0],i.framebuffer=new Jr(i.realWidth,i.realHeight).addColorTexture(0,i),i.framebuffer.multisample=r.multisample,i.maskStack=[],i.filterStack=[{}],i}return Lr(r,e),r.prototype.resize=function(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},r.prototype.dispose=function(){this.framebuffer.dispose(),e.prototype.dispose.call(this)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},r}(Xr),ti=function(){function t(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return t.prototype.set=function(t,e,r){var i=e.width,n=e.height;if(r){var o=t.width/2/i,s=t.height/2/n,a=t.x/i+o,h=t.y/n+s;r=nr.add(r,nr.NW),this.x0=a+o*nr.uX(r),this.y0=h+s*nr.uY(r),r=nr.add(r,2),this.x1=a+o*nr.uX(r),this.y1=h+s*nr.uY(r),r=nr.add(r,2),this.x2=a+o*nr.uX(r),this.y2=h+s*nr.uY(r),r=nr.add(r,2),this.x3=a+o*nr.uX(r),this.y3=h+s*nr.uY(r)}else this.x0=t.x/i,this.y0=t.y/n,this.x1=(t.x+t.width)/i,this.y1=t.y/n,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/n,this.x3=t.x/i,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},t}(),ei=new ti,ri=function(t){function e(r,i,n,o,s,a){var h=t.call(this)||this;if(h.noFrame=!1,i||(h.noFrame=!0,i=new Ye(0,0,1,1)),r instanceof e&&(r=r.baseTexture),h.baseTexture=r,h._frame=i,h.trim=o,h.valid=!1,h._uvs=ei,h.uvMatrix=null,h.orig=n||i,h._rotate=Number(s||0),!0===s)h._rotate=2;else if(h._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return h.defaultAnchor=a?new qe(a.x,a.y):new qe(0,0),h._updateID=0,h.textureCacheIds=[],r.valid?h.noFrame?r.valid&&h.onBaseTextureUpdated(r):h.frame=i:r.once("loaded",h.onBaseTextureUpdated,h),h.noFrame&&r.on("update",h.onBaseTextureUpdated,h),h}return Lr(e,t),e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var r=this.baseTexture.resource;r&&r.url&&De[r.url]&&e.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){var t=this._frame.clone(),r=this._frame===this.orig?t:this.orig.clone(),i=new e(this.baseTexture,!this.noFrame&&t,r,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i},e.prototype.updateUvs=function(){this._uvs===ei&&(this._uvs=new ti),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,r,i){void 0===r&&(r={}),void 0===i&&(i=rt.STRICT_TEXTURE_CACHE);var n="string"==typeof t,o=null;if(n)o=t;else{if(!t._pixiId){var s=r&&r.pixiIdPrefix||"pixiid";t._pixiId=s+"_"+Ie()}o=t._pixiId}var a=De[o];if(n&&i&&!a)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return a||(r.resolution||(r.resolution=Be(t)),(a=new e(new Xr(t,r))).baseTexture.cacheId=o,Xr.addToCache(a.baseTexture,o),e.addToCache(a,o)),a},e.fromURL=function(t,r){var i=Object.assign({autoLoad:!1},null==r?void 0:r.resourceOptions),n=e.from(t,Object.assign({resourceOptions:i},r),!1),o=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):o.load().then(function(){return Promise.resolve(n)})},e.fromBuffer=function(t,r,i,n){return new e(Xr.fromBuffer(t,r,i,n))},e.fromLoader=function(t,r,i,n){var o=new Xr(t,Object.assign({scaleMode:rt.SCALE_MODE,resolution:Be(r)},n)),s=o.resource;s instanceof Wr&&(s.url=r);var a=new e(o);return i||(i=r),Xr.addToCache(a.baseTexture,i),e.addToCache(a,i),i!==r&&(Xr.addToCache(a.baseTexture,r),e.addToCache(a,r)),a.baseTexture.valid?Promise.resolve(a):new Promise(function(t){a.baseTexture.once("loaded",function(){return t(a)})})},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),De[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),De[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=De[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete De[t],e}}else if(t&&t.textureCacheIds){for(var i=0;i<t.textureCacheIds.length;++i)De[t.textureCacheIds[i]]===t&&delete De[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,r=t.y,i=t.width,n=t.height,o=e+i>this.baseTexture.width,s=r+n>this.baseTexture.height;if(o||s){var a=o&&s?"and":"or",h="X: "+e+" + "+i+" = "+(e+i)+" > "+this.baseTexture.width,u="Y: "+r+" + "+n+" = "+(r+n)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+h+" "+a+" "+u)}this.valid=i&&n&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},e}(ot);function ii(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}ri.EMPTY=new ri(new Xr),ii(ri.EMPTY),ii(ri.EMPTY.baseTexture),ri.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new ri(new Xr(new jr(t)))}(),ii(ri.WHITE),ii(ri.WHITE.baseTexture);var ni=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.valid=!0,i.filterFrame=null,i.filterPoolKey=null,i.updateUvs(),i}return Lr(e,t),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(t){this.framebuffer.multisample=t},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e,r){void 0===r&&(r=!0);var i=this.baseTexture.resolution,n=Math.round(t*i)/i,o=Math.round(e*i)/i;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(n,o),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){for(var r=arguments,i=[],n=1;n<arguments.length;n++)i[n-1]=r[n];return"number"==typeof t&&(t={width:t,height:i[0],scaleMode:i[1],resolution:i[2]}),new e(new $r(t))},e}(ri),oi=function(){function e(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return e.prototype.createTexture=function(e,r,i){void 0===i&&(i=t.MSAA_QUALITY.NONE);var n=new $r(Object.assign({width:e,height:r,resolution:1,multisample:i},this.textureOptions));return new ni(n)},e.prototype.getOptimalTexture=function(e,r,i,n){var o;void 0===i&&(i=1),void 0===n&&(n=t.MSAA_QUALITY.NONE),e=Math.ceil(e*i),r=Math.ceil(r*i),this.enableFullScreen&&e===this._pixelsWidth&&r===this._pixelsHeight?o=n>1?-n:-1:(o=((65535&(e=be(e)))<<16|65535&(r=be(r)))>>>0,n>1&&(o+=4294967296*n)),this.texturePool[o]||(this.texturePool[o]=[]);var s=this.texturePool[o].pop();return s||(s=this.createTexture(e,r,n)),s.filterPoolKey=o,s.setResolution(i),s},e.prototype.getFilterTexture=function(e,r,i){var n=this.getOptimalTexture(e.width,e.height,r||e.resolution,i||t.MSAA_QUALITY.NONE);return n.filterFrame=e.filterFrame,n},e.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},e.prototype.returnFilterTexture=function(t){this.returnTexture(t)},e.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var r=this.texturePool[e];if(r)for(var i=0;i<r.length;i++)r[i].destroy(!0)}this.texturePool={}},e.prototype.setScreenSize=function(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){for(var e in this.enableFullScreen=t.width>0&&t.height>0,this.texturePool)if(Number(e)<0){var r=this.texturePool[e];if(r)for(var i=0;i<r.length;i++)r[i].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}},e.SCREEN_KEY=-1,e}(),si=function(){function e(e,r,i,n,o,s,a){void 0===r&&(r=0),void 0===i&&(i=!1),void 0===n&&(n=t.TYPES.FLOAT),this.buffer=e,this.size=r,this.normalized=i,this.type=n,this.stride=o,this.start=s,this.instance=a}return e.prototype.destroy=function(){this.buffer=null},e.from=function(t,r,i,n,o){return new e(t,r,i,n,o)},e}(),ai=0,hi=function(){function e(t,e,r){void 0===e&&(e=!0),void 0===r&&(r=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=ai++,this.disposeRunner=new Dr("disposeBuffer")}return e.prototype.update=function(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++},e.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},e.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(e.prototype,"index",{get:function(){return this.type===t.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER},set:function(e){this.type=e?t.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:t.BUFFER_TYPE.ARRAY_BUFFER},enumerable:!1,configurable:!0}),e.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new e(t)},e}(),ui={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array},li={5126:4,5123:2,5121:1},ci=0,di={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},fi=function(){function e(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=ci++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Dr("disposeGeometry"),this.refCount=0}return e.prototype.addAttribute=function(t,e,r,i,n,o,s,a){if(void 0===r&&(r=0),void 0===i&&(i=!1),void 0===a&&(a=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof hi||(e instanceof Array&&(e=new Float32Array(e)),e=new hi(e));var h=t.split("|");if(h.length>1){for(var u=0;u<h.length;u++)this.addAttribute(h[u],e,r,i,n);return this}var l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new si(l,r,i,n,o,s,a),this.instanced=this.instanced||a,this},e.prototype.getAttribute=function(t){return this.attributes[t]},e.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},e.prototype.addIndex=function(e){return e instanceof hi||(e instanceof Array&&(e=new Uint16Array(e)),e=new hi(e)),e.type=t.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,-1===this.buffers.indexOf(e)&&this.buffers.push(e),this},e.prototype.getIndex=function(){return this.indexBuffer},e.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],r=[],i=new hi;for(t in this.attributes){var n=this.attributes[t],o=this.buffers[n.buffer];e.push(o.data),r.push(n.size*li[n.type]/4),n.buffer=0}for(i.data=function(t,e){for(var r=0,i=0,n={},o=0;o<t.length;o++)i+=e[o],r+=t[o].length;var s=new ArrayBuffer(4*r),a=null,h=0;for(o=0;o<t.length;o++){var u=e[o],l=t[o],c=ge(l);n[c]||(n[c]=new ui[c](s)),a=n[c];for(var d=0;d<l.length;d++)a[(d/u|0)*i+h+d%u]=l[d];h+=u}return new Float32Array(s)}(e,r),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},e.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},e.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},e.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},e.prototype.clone=function(){for(var r=new e,i=0;i<this.buffers.length;i++)r.buffers[i]=new hi(this.buffers[i].data.slice(0));for(var i in this.attributes){var n=this.attributes[i];r.attributes[i]=new si(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(r.indexBuffer=r.buffers[this.buffers.indexOf(this.indexBuffer)],r.indexBuffer.type=t.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),r},e.merge=function(r){for(var i,n=new e,o=[],s=[],a=[],h=0;h<r.length;h++){i=r[h];for(var u=0;u<i.buffers.length;u++)s[u]=s[u]||0,s[u]+=i.buffers[u].data.length,a[u]=0}for(h=0;h<i.buffers.length;h++)o[h]=new di[ge(i.buffers[h].data)](s[h]),n.buffers[h]=new hi(o[h]);for(h=0;h<r.length;h++)for(i=r[h],u=0;u<i.buffers.length;u++)o[u].set(i.buffers[u].data,a[u]),a[u]+=i.buffers[u].data.length;if(n.attributes=i.attributes,i.indexBuffer){n.indexBuffer=n.buffers[i.buffers.indexOf(i.indexBuffer)],n.indexBuffer.type=t.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;var l=0,c=0,d=0,f=0;for(h=0;h<i.buffers.length;h++)if(i.buffers[h]!==i.indexBuffer){f=h;break}for(var h in i.attributes){var p=i.attributes[h];(0|p.buffer)===f&&(c+=p.size*li[p.type]/4)}for(h=0;h<r.length;h++){var _=r[h].indexBuffer.data;for(u=0;u<_.length;u++)n.indexBuffer.data[u+d]+=l;l+=r[h].buffers[f].data.length/c,d+=_.length}}return n},e}(),pi=function(t){function e(){var e=t.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return Lr(e,t),e}(fi),_i=function(t){function e(){var e=t.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new hi(e.vertices),e.uvBuffer=new hi(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return Lr(e,t),e.prototype.map=function(t,e){var r=0,i=0;return this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+e.width/t.width,this.uvs[3]=i,this.uvs[4]=r+e.width/t.width,this.uvs[5]=i+e.height/t.height,this.uvs[6]=r,this.uvs[7]=i+e.height/t.height,r=e.x,i=e.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+e.width,this.vertices[3]=i,this.vertices[4]=r+e.width,this.vertices[5]=i+e.height,this.vertices[6]=r,this.vertices[7]=i+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(fi),mi=0,vi=function(){function e(e,r,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=mi++,this.static=!!r,this.ubo=!!i,e instanceof hi?(this.buffer=e,this.buffer.type=t.BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new hi(new Float32Array(1)),this.buffer.type=t.BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}return e.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},e.prototype.add=function(t,r,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new e(r,i)},e.from=function(t,r,i){return new e(t,r,i)},e.uboFrom=function(t,r){return new e(t,null==r||r,!0)},e}(),yi=function(){function e(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=t.MSAA_QUALITY.NONE,this.sourceFrame=new Ye,this.destinationFrame=new Ye,this.bindingSourceFrame=new Ye,this.bindingDestinationFrame=new Ye,this.filters=[],this.transform=null}return e.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},e}(),Ei=[new qe,new qe,new qe,new qe],gi=new Ze,Ti=function(){function e(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new oi,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new pi,this.quadUv=new _i,this.tempRect=new Ye,this.activeState={},this.globalUniforms=new vi({outputFrame:new Ye,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return e.prototype.push=function(t,e){for(var r=this.renderer,i=this.defaultFilterStack,n=this.statePool.pop()||new yi,o=this.renderer.renderTexture,s=e[0].resolution,a=e[0].multisample,h=e[0].padding,u=e[0].autoFit,l=e[0].legacy,c=1;c<e.length;c++){var d=e[c];s=Math.min(s,d.resolution),a=Math.min(a,d.multisample),h=this.useMaxPadding?Math.max(h,d.padding):h+d.padding,u=u&&d.autoFit,l=l||d.legacy}if(1===i.length&&(this.defaultFilterStack[0].renderTexture=o.current),i.push(n),n.resolution=s,n.multisample=a,n.legacy=l,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(h),u){var f=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(gi.copyFrom(r.projection.transform).invert(),f),n.sourceFrame.fit(f)}this.roundFrame(n.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,s,a),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;var p=this.tempRect;p.x=0,p.y=0,p.width=n.sourceFrame.width,p.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,p),r.framebuffer.clear(0,0,0,0)},e.prototype.pop=function(){var e=this.defaultFilterStack,r=e.pop(),i=r.filters;this.activeState=r;var n=this.globalUniforms.uniforms;n.outputFrame=r.sourceFrame,n.resolution=r.resolution;var o=n.inputSize,s=n.inputPixel,a=n.inputClamp;if(o[0]=r.destinationFrame.width,o[1]=r.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],s[0]=Math.round(o[0]*r.resolution),s[1]=Math.round(o[1]*r.resolution),s[2]=1/s[0],s[3]=1/s[1],a[0]=.5*s[2],a[1]=.5*s[3],a[2]=r.sourceFrame.width*o[2]-.5*s[2],a[3]=r.sourceFrame.height*o[3]-.5*s[3],r.legacy){var h=n.filterArea;h[0]=r.destinationFrame.width,h[1]=r.destinationFrame.height,h[2]=r.sourceFrame.x,h[3]=r.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var u=e[e.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,r.renderTexture,u.renderTexture,t.CLEAR_MODES.BLEND,r),this.returnFilterTexture(r.renderTexture);else{var l=r.renderTexture,c=this.getOptimalFilterTexture(l.width,l.height,r.resolution);c.filterFrame=l.filterFrame;var d=0;for(d=0;d<i.length-1;++d){1===d&&r.multisample>1&&((c=this.getOptimalFilterTexture(l.width,l.height,r.resolution)).filterFrame=l.filterFrame),i[d].apply(this,l,c,t.CLEAR_MODES.CLEAR,r);var f=l;l=c,c=f}i[d].apply(this,l,u.renderTexture,t.CLEAR_MODES.BLEND,r),d>1&&r.multisample>1&&this.returnFilterTexture(r.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(c)}r.clear(),this.statePool.push(r)},e.prototype.bindAndClear=function(e,r){void 0===r&&(r=t.CLEAR_MODES.CLEAR);var i=this.renderer,n=i.renderTexture,o=i.state;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e&&e.filterFrame){var s=this.tempRect;s.x=0,s.y=0,s.width=e.filterFrame.width,s.height=e.filterFrame.height,n.bind(e,e.filterFrame,s)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var a=1&o.stateId||this.forceClear;(r===t.CLEAR_MODES.CLEAR||r===t.CLEAR_MODES.BLIT&&a)&&this.renderer.framebuffer.clear(0,0,0,0)},e.prototype.applyFilter=function(e,r,i,n){var o=this.renderer;o.state.set(e.state),this.bindAndClear(i,n),e.uniforms.uSampler=r,e.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(r._frame,r.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(t.DRAW_MODES.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(t.DRAW_MODES.TRIANGLE_STRIP))},e.prototype.calculateSpriteMatrix=function(t,e){var r=this.activeState,i=r.sourceFrame,n=r.destinationFrame,o=e._texture.orig,s=t.set(n.width,0,0,n.height,i.x,i.y),a=e.worldTransform.copyTo(Ze.TEMP_MATRIX);return a.invert(),s.prepend(a),s.scale(1/o.width,1/o.height),s.translate(e.anchor.x,e.anchor.y),s},e.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},e.prototype.getOptimalFilterTexture=function(e,r,i,n){return void 0===i&&(i=1),void 0===n&&(n=t.MSAA_QUALITY.NONE),this.texturePool.getOptimalTexture(e,r,i,n)},e.prototype.getFilterTexture=function(e,r,i){if("number"==typeof e){var n=e;e=r,r=n}e=e||this.activeState.renderTexture;var o=this.texturePool.getOptimalTexture(e.width,e.height,r||e.resolution,i||t.MSAA_QUALITY.NONE);return o.filterFrame=e.filterFrame,o},e.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},e.prototype.emptyPool=function(){this.texturePool.clear(!0)},e.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},e.prototype.transformAABB=function(t,e){var r=Ei[0],i=Ei[1],n=Ei[2],o=Ei[3];r.set(e.left,e.top),i.set(e.left,e.bottom),n.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(r,r),t.apply(i,i),t.apply(n,n),t.apply(o,o);var s=Math.min(r.x,i.x,n.x,o.x),a=Math.min(r.y,i.y,n.y,o.y),h=Math.max(r.x,i.x,n.x,o.x),u=Math.max(r.y,i.y,n.y,o.y);e.x=s,e.y=a,e.width=h-s,e.height=u-a},e.prototype.roundFrame=function(t,e,r,i,n){if(n){var o=n.a,s=n.b,a=n.c,h=n.d;if((Math.abs(s)>1e-4||Math.abs(a)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(h)>1e-4))return}(n=n?gi.copyFrom(n):gi.identity()).translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)},e}(),bi=function(){function t(t){this.renderer=t}return t.prototype.flush=function(){},t.prototype.destroy=function(){this.renderer=null},t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.render=function(t){},t}(),Ri=function(){function t(t){this.renderer=t,this.emptyRenderer=new bi(t),this.currentRenderer=this.emptyRenderer}return t.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},t.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.copyBoundTextures=function(t,e){for(var r=this.renderer.texture.boundTextures,i=e-1;i>=0;--i)t[i]=r[i]||null,t[i]&&(t[i]._batchLocation=i)},t.prototype.boundArray=function(t,e,r,i){for(var n=t.elements,o=t.ids,s=t.count,a=0,h=0;h<s;h++){var u=n[h],l=u._batchLocation;if(l>=0&&l<i&&e[l]===u)o[h]=l;else for(;a<i;){var c=e[a];if(!c||c._batchEnabled!==r||c._batchLocation!==a){o[h]=a,u._batchLocation=a,e[a]=u;break}a++}}},t.prototype.destroy=function(){this.renderer=null},t}(),xi=0,Ai=function(){function e(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(e.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),e.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=xi++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},e.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=xi++,this.renderer.runners.contextChange.emit(t)},e.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},e.prototype.createContext=function(e,r){var i;if(rt.PREFER_ENV>=t.ENV.WEBGL2&&(i=e.getContext("webgl2",r)),i)this.webGLVersion=2;else if(this.webGLVersion=1,!(i=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},e.prototype.getExtensions=function(){var t=this.gl,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},e.prototype.destroy=function(){var t=this.renderer.view;this.renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},e.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},e.prototype.validateContext=function(t){var e=t.getContextAttributes(),r="WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext;r&&(this.webGLVersion=2),e.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var i=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},e}(),Si=function(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=t.MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0},Oi=new Ye,Ii=function(){function e(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Jr(10,10),this.msaaSamples=null}return e.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Ye,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var r=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;rt.PREFER_ENV===t.ENV.WEBGL_LEGACY&&(r=null,i=null),r?e.drawBuffers=function(t){return r.drawBuffersWEBGL(t)}:(this.hasMRT=!1,e.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)},e.prototype.bind=function(t,e,r){void 0===r&&(r=0);var i=this.gl;if(t){var n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=r),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var o=0;o<t.colorTextures.length;o++){var s=t.colorTextures[o];this.renderer.texture.unbind(s.parentTextureArray||s)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){var a=e.width>>r,h=e.height>>r,u=a/e.width;this.setViewport(e.x*u,e.y*u,a,h)}else a=t.width>>r,h=t.height>>r,this.setViewport(0,0,a,h)}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},e.prototype.setViewport=function(t,e,r,i){var n=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),i=Math.round(i),n.width===r&&n.height===i&&n.x===t&&n.y===e||(n.x=t,n.y=e,n.width=r,n.height=i,this.gl.viewport(t,e,r,i))},Object.defineProperty(e.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),e.prototype.clear=function(e,r,i,n,o){void 0===o&&(o=t.BUFFER_BITS.COLOR|t.BUFFER_BITS.DEPTH);var s=this.gl;s.clearColor(e,r,i,n),s.clear(o)},e.prototype.initFramebuffer=function(t){var e=this.gl,r=new Si(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r},e.prototype.resizeFramebuffer=function(t){var e=this.gl,r=t.glFramebuffers[this.CONTEXT_UID];r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,e.RGBA8,t.width,t.height)),r.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));var i=t.colorTextures,n=i.length;e.drawBuffers||(n=Math.min(n,1));for(var o=0;o<n;o++){var s=i[o],a=s.parentTextureArray||s;this.renderer.texture.bind(a,0)}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)},e.prototype.updateFramebuffer=function(t,e){var r=this.gl,i=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures,o=n.length;r.drawBuffers||(o=Math.min(o,1)),i.multisample>1&&this.canMultisampleFramebuffer(t)?(i.msaaBuffer=i.msaaBuffer||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,r.RGBA8,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,i.msaaBuffer)):i.msaaBuffer&&(r.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null);for(var s=[],a=0;a<o;a++){var h=n[a],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),0===a&&i.msaaBuffer||(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+a,h.target,u._glTextures[this.CONTEXT_UID].texture,e),s.push(r.COLOR_ATTACHMENT0+a))}if(s.length>1&&r.drawBuffers(s),t.depthTexture&&this.writeDepthTexture){var l=t.depthTexture;this.renderer.texture.bind(l,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?i.stencil&&(r.deleteRenderbuffer(i.stencil),i.stencil=null):(i.stencil=i.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,i.stencil))},e.prototype.canMultisampleFramebuffer=function(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture},e.prototype.detectSamples=function(e){var r=this.msaaSamples,i=t.MSAA_QUALITY.NONE;if(e<=1||null===r)return i;for(var n=0;n<r.length;n++)if(r[n]<=e){i=r[n];break}return 1===i&&(i=t.MSAA_QUALITY.NONE),i},e.prototype.blit=function(t,e,r){var i=this.current,n=this.renderer,o=this.gl,s=this.CONTEXT_UID;if(2===n.context.webGLVersion&&i){var a=i.glFramebuffers[s];if(a){if(!t){if(!a.msaaBuffer)return;a.blitFramebuffer||(a.blitFramebuffer=new Jr(i.width,i.height),a.blitFramebuffer.addColorTexture(0,i.colorTextures[0])),(t=a.blitFramebuffer).width=i.width,t.height=i.height}e||((e=Oi).width=i.width,e.height=i.height),r||(r=e);var h=e.width===r.width&&e.height===r.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,a.framebuffer),o.blitFramebuffer(e.x,e.y,e.width,e.height,r.x,r.y,r.width,r.height,o.COLOR_BUFFER_BIT,h?o.NEAREST:o.LINEAR)}}},e.prototype.disposeFramebuffer=function(t,e){var r=t.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(r){delete t.glFramebuffers[this.CONTEXT_UID];var n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(i.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&i.deleteRenderbuffer(r.msaaBuffer),r.stencil&&i.deleteRenderbuffer(r.stencil))}},e.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)},e.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.stencil=!0;var r=t.width,i=t.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,n.DEPTH24_STENCIL8,r,i):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,r,i),e.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}}},e.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Ye},e.prototype.destroy=function(){this.renderer=null},e}(),Pi={5126:4,5123:2,5121:1},Mi=function(){function e(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return e.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==r.webGLVersion){var i=this.renderer.context.extensions.vertexArrayObject;rt.PREFER_ENV===t.ENV.WEBGL_LEGACY&&(i=null),i?(e.createVertexArray=function(){return i.createVertexArrayOES()},e.bindVertexArray=function(t){return i.bindVertexArrayOES(t)},e.deleteVertexArray=function(t){return i.deleteVertexArrayOES(t)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})}if(2!==r.webGLVersion){var n=e.getExtension("ANGLE_instanced_arrays");n?(e.vertexAttribDivisor=function(t,e){return n.vertexAttribDivisorANGLE(t,e)},e.drawElementsInstanced=function(t,e,r,i,o){return n.drawElementsInstancedANGLE(t,e,r,i,o)},e.drawArraysInstanced=function(t,e,r,i){return n.drawArraysInstancedANGLE(t,e,r,i)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===r.webGLVersion||!!r.extensions.uint32ElementIndex},e.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var r=this.gl,i=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;i||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=i={},n=!0);var o=i[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()},e.prototype.reset=function(){this.unbind()},e.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.renderer.buffer,r=0;r<t.buffers.length;r++){var i=t.buffers[r];e.update(i)}},e.prototype.checkCompatibility=function(t,e){var r=t.attributes,i=e.attributeData;for(var n in i)if(!r[n])throw new Error('shader and geometry incompatible, geometry missing the "'+n+'" attribute')},e.prototype.getSignature=function(t,e){var r=t.attributes,i=e.attributeData,n=["g",t.id];for(var o in r)i[o]&&n.push(o);return n.join("-")},e.prototype.initGeometryVao=function(t,e,r){void 0===r&&(r=!0);var i=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,s=e.program;s.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,s);var a=this.getSignature(t,s),h=t.glVertexArrayObjects[this.CONTEXT_UID],u=h[a];if(u)return h[s.id]=u,u;var l=t.buffers,c=t.attributes,d={},f={};for(var p in l)d[p]=0,f[p]=0;for(var p in c)!c[p].size&&s.attributeData[p]?c[p].size=s.attributeData[p].size:c[p].size||console.warn("PIXI Geometry attribute '"+p+"' size cannot be determined (likely the bound shader does not have the attribute)"),d[c[p].buffer]+=c[p].size*Pi[c[p].type];for(var p in c){var _=c[p],m=_.size;void 0===_.stride&&(d[_.buffer]===m*Pi[_.type]?_.stride=0:_.stride=d[_.buffer]),void 0===_.start&&(_.start=f[_.buffer],f[_.buffer]+=m*Pi[_.type])}u=i.createVertexArray(),i.bindVertexArray(u);for(var v=0;v<l.length;v++){var y=l[v];o.bind(y),r&&y._glBuffers[n].refCount++}return this.activateVao(t,s),this._activeVao=u,h[s.id]=u,h[a]=u,u},e.prototype.disposeGeometry=function(t,e){var r;if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,o=t.buffers,s=null===(r=this.renderer)||void 0===r?void 0:r.buffer;if(t.disposeRunner.remove(this),i){if(s)for(var a=0;a<o.length;a++){var h=o[a]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,0!==h.refCount||e||s.dispose(o[a],e))}if(!e)for(var u in i)if("g"===u[0]){var l=i[u];this._activeVao===l&&this.unbind(),n.deleteVertexArray(l)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},e.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)},e.prototype.activateVao=function(t,e){var r=this.gl,i=this.CONTEXT_UID,n=this.renderer.buffer,o=t.buffers,s=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);var a=null;for(var h in s){var u=s[h],l=o[u.buffer],c=l._glBuffers[i];if(e.attributeData[h]){a!==c&&(n.bind(l),a=c);var d=e.attributeData[h].location;if(r.enableVertexAttribArray(d),r.vertexAttribPointer(d,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(d,1)}}}},e.prototype.draw=function(t,e,r,i){var n=this.gl,o=this._activeGeometry;if(o.indexBuffer){var s=o.indexBuffer.data.BYTES_PER_ELEMENT,a=2===s?n.UNSIGNED_SHORT:n.UNSIGNED_INT;2===s||4===s&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,e||o.indexBuffer.data.length,a,(r||0)*s,i||1):n.drawElements(t,e||o.indexBuffer.data.length,a,(r||0)*s):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,r,e||o.getSize(),i||1):n.drawArrays(t,r,e||o.getSize());return this},e.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},e.prototype.destroy=function(){this.renderer=null},e}(),Di=function(){function e(e){void 0===e&&(e=null),this.type=t.MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=rt.FILTER_MULTISAMPLE,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return e.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=t.MASK_TYPES.NONE,this.autoDetect=!0),this._target=null},e.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},e}();function Ni(t,e,r){var i=t.createShader(e);return t.shaderSource(i,r),t.compileShader(i),i}function wi(t,e){var r=t.getShaderSource(e).split("\n").map(function(t,e){return e+": "+t}),i=t.getShaderInfoLog(e),n=i.split("\n"),o={},s=n.map(function(t){return parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(t){return!(!t||o[t]||(o[t]=!0,0))}),a=[""];s.forEach(function(t){r[t-1]="%c"+r[t-1]+"%c",a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var h=r.join("\n");a[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,a),console.groupEnd()}function Ci(t){for(var e=new Array(t),r=0;r<e.length;r++)e[r]=!1;return e}function Li(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Ci(2*e);case"bvec3":return Ci(3*e);case"bvec4":return Ci(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Fi,Ui={},Bi=Ui;function Gi(){if(Bi===Ui||Bi&&Bi.isContextLost()){var e=document.createElement("canvas"),r=void 0;rt.PREFER_ENV>=t.ENV.WEBGL2&&(r=e.getContext("webgl2",{})),r||((r=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}))?r.getExtension("WEBGL_draw_buffers"):r=null),Bi=r}return Bi}function Xi(e,r,i){if("precision"!==e.substring(0,9)){var n=r;return r===t.PRECISION.HIGH&&i!==t.PRECISION.HIGH&&(n=t.PRECISION.MEDIUM),"precision "+n+" float;\n"+e}return i!==t.PRECISION.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}var ki={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Hi(t){return ki[t]}var Yi=null,ji={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Vi(t,e){if(!Yi){var r=Object.keys(ji);Yi={};for(var i=0;i<r.length;++i){var n=r[i];Yi[t[n]]=ji[n]}}return Yi[e]}var Wi,zi=[{test:function(t){return"float"===t.type&&1===t.size},code:function(t){return'\n            if(uv["'+t+'"] !== ud["'+t+'"].value)\n            {\n                ud["'+t+'"].value = uv["'+t+'"]\n                gl.uniform1f(ud["'+t+'"].location, uv["'+t+'"])\n            }\n            '}},{test:function(t){return("sampler2D"===t.type||"samplerCube"===t.type||"sampler2DArray"===t.type)&&1===t.size&&!t.isArray},code:function(t){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+t+'"], t);\n\n            if(ud["'+t+'"].value !== t)\n            {\n                ud["'+t+'"].value = t;\n                gl.uniform1i(ud["'+t+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(t,e){return"mat3"===t.type&&1===t.size&&void 0!==e.a},code:function(t){return'\n            gl.uniformMatrix3fv(ud["'+t+'"].location, false, uv["'+t+'"].toArray(true));\n            '},codeUbo:function(t){return"\n                var "+t+"_matrix = uv."+t+".toArray(true);\n\n                data[offset] = "+t+"_matrix[0];\n                data[offset+1] = "+t+"_matrix[1];\n                data[offset+2] = "+t+"_matrix[2];\n        \n                data[offset + 4] = "+t+"_matrix[3];\n                data[offset + 5] = "+t+"_matrix[4];\n                data[offset + 6] = "+t+"_matrix[5];\n        \n                data[offset + 8] = "+t+"_matrix[6];\n                data[offset + 9] = "+t+"_matrix[7];\n                data[offset + 10] = "+t+"_matrix[8];\n            "}},{test:function(t,e){return"vec2"===t.type&&1===t.size&&void 0!==e.x},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+t+'"].location, v.x, v.y);\n                }'},codeUbo:function(t){return"\n                v = uv."+t+";\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            "}},{test:function(t){return"vec2"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+t+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(t,e){return"vec4"===t.type&&1===t.size&&void 0!==e.width},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+t+'"].location, v.x, v.y, v.width, v.height)\n                }'},codeUbo:function(t){return"\n                    v = uv."+t+";\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                "}},{test:function(t){return"vec4"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+t+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],qi={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",uint:"gl.uniform1ui(location, v)",uvec2:"gl.uniform2ui(location, v[0], v[1])",uvec3:"gl.uniform3ui(location, v[0], v[1], v[2])",uvec4:"gl.uniform4ui(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},Ki={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},Zi=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Qi(t){for(var e="",r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+="if(test == "+r+".0){}");return e}function Ji(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var r=e.createShader(e.FRAGMENT_SHADER);;){var i=Zi.replace(/%forloop%/gi,Qi(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}var $i=0,tn={},en=function(){function e(r,i,n){void 0===n&&(n="pixi-shader"),this.id=$i++,this.vertexSrc=r||e.defaultVertexSrc,this.fragmentSrc=i||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),tn[n]?(tn[n]++,n+="-"+tn[n]):tn[n]=1,this.vertexSrc="#define SHADER_NAME "+n+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+n+"\n"+this.fragmentSrc,this.vertexSrc=Xi(this.vertexSrc,rt.PRECISION_VERTEX,t.PRECISION.HIGH),this.fragmentSrc=Xi(this.fragmentSrc,rt.PRECISION_FRAGMENT,function(){if(!Fi){Fi=t.PRECISION.MEDIUM;var e=Gi();if(e&&e.getShaderPrecisionFormat){var r=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);Fi=r.precision?t.PRECISION.HIGH:t.PRECISION.MEDIUM}}return Fi}())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(e,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),e.from=function(t,r,i){var n=t+r,o=Me[n];return o||(Me[n]=o=new e(t,r,i)),o},e}(),rn=function(){function t(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof vi?e:new vi(e):new vi({})}return t.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var r in e.uniforms){var i=e.uniforms[r];if(i.group&&this.checkUniformExists(t,i))return!0}return!1},t.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(t.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),t.from=function(e,r,i){return new t(en.from(e,r),i)},t}(),nn=function(){function e(){this.data=0,this.blendMode=t.BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(e.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(t){!!(1&this.data)!==t&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(t){!!(2&this.data)!==t&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(t){!!(4&this.data)!==t&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(t){!!(8&this.data)!==t&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return!!(32&this.data)},set:function(t){!!(32&this.data)!==t&&(this.data^=32)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(t){!!(16&this.data)!==t&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==t.BLEND_MODES.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),e.for2d=function(){var t=new e;return t.depthTest=!1,t.blend=!0,t},e}(),on=function(t){function e(r,i,n){var o=this,s=en.from(r||e.defaultVertexSrc,i||e.defaultFragmentSrc);return(o=t.call(this,s,n)||this).padding=0,o.resolution=rt.FILTER_RESOLUTION,o.multisample=rt.FILTER_MULTISAMPLE,o.enabled=!0,o.autoFit=!0,o.state=new nn,o}return Lr(e,t),e.prototype.apply=function(t,e,r,i,n){t.applyFilter(this,e,r,i)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),e}(rn),sn="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",an="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",hn=new Ze,un=function(){function t(t,e){this._texture=t,this.mapCoord=new Ze,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var r=this.mapCoord,i=0;i<t.length;i+=2){var n=t[i],o=t[i+1];e[i]=n*r.a+o*r.c+r.tx,e[i+1]=n*r.b+o*r.d+r.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var i=e.orig,n=e.trim;n&&(hn.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(hn));var o=e.baseTexture,s=this.uClampFrame,a=this.clampMargin/o.resolution,h=this.clampOffset;return s[0]=(e._frame.x+a+h)/o.width,s[1]=(e._frame.y+a+h)/o.height,s[2]=(e._frame.x+e._frame.width-a+h)/o.width,s[3]=(e._frame.y+e._frame.height-a+h)/o.height,this.uClampOffset[0]=h/o.realWidth,this.uClampOffset[1]=h/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&0===e.rotate,!0},t}(),ln=function(t){function e(e){var r=this,i=new Ze;return r=t.call(this,sn,an)||this,e.renderable=!1,r.maskSprite=e,r.maskMatrix=i,r}return Lr(e,t),e.prototype.apply=function(t,e,r,i){var n=this.maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new un(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,r,i))},e}(on),cn=function(){function e(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return e.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},e.prototype.push=function(e,r){var i=r;if(!i.isMaskData){var n=this.maskDataPool.pop()||new Di;n.pooled=!0,n.maskObject=r,i=n}switch(i.autoDetect&&this.detect(i),i.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),i._target=e,i.type){case t.MASK_TYPES.SCISSOR:this.maskStack.push(i),this.renderer.scissor.push(i);break;case t.MASK_TYPES.STENCIL:this.maskStack.push(i),this.renderer.stencil.push(i);break;case t.MASK_TYPES.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i),this.maskStack.push(i)}},e.prototype.pop=function(e){var r=this.maskStack.pop();if(r&&r._target===e){switch(r.type){case t.MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case t.MASK_TYPES.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case t.MASK_TYPES.SPRITE:this.popSpriteMask()}r.reset(),r.pooled&&this.maskDataPool.push(r)}},e.prototype.detect=function(e){var r=e.maskObject;if(r.isSprite)e.type=t.MASK_TYPES.SPRITE;else if(e.type=t.MASK_TYPES.STENCIL,this.enableScissor&&r.isFastRect&&r.isFastRect()){var i=r.worldTransform,n=Math.atan2(i.b,i.a),o=Math.atan2(i.d,i.c);n=Math.round(n*(180/Math.PI)*100),o=((o=Math.round(o*(180/Math.PI)*100)-n)%18e3+18e3)%18e3,0==(n=(n%9e3+9e3)%9e3)&&9e3===o&&(e.type=t.MASK_TYPES.SCISSOR)}},e.prototype.pushSpriteMask=function(t){var e,r,i=t.maskObject,n=t._target,o=this.alphaMaskPool[this.alphaMaskIndex];o||(o=this.alphaMaskPool[this.alphaMaskIndex]=[new ln(i)]);var s,a,h=this.renderer,u=h.renderTexture;if(u.current){var l=u.current;s=t.resolution||l.resolution,a=null!==(e=t.multisample)&&void 0!==e?e:l.multisample}else s=t.resolution||h.resolution,a=null!==(r=t.multisample)&&void 0!==r?r:h.multisample;o[0].resolution=s,o[0].multisample=a,o[0].maskSprite=i;var c=n.filterArea;n.filterArea=i.getBounds(!0),h.filter.push(n,o),n.filterArea=c,this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},e.prototype.destroy=function(){this.renderer=null},e}(),dn=function(){function t(t){this.renderer=t,this.maskStack=[],this.glConst=0}return t.prototype.getStackLength=function(){return this.maskStack.length},t.prototype.setMaskStack=function(t){var e=this.renderer.gl,r=this.getStackLength();this.maskStack=t;var i=this.getStackLength();i!==r&&(0===i?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},t.prototype._useCurrent=function(){},t.prototype.destroy=function(){this.renderer=null,this.maskStack=null},t}(),fn=function(t){function e(e){var r=t.call(this,e)||this;return r.glConst=WebGLRenderingContext.SCISSOR_TEST,r}return Lr(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var e=t.maskObject;e.renderable=!0;var r=t._scissorRect,i=e.getBounds(!0),n=this.renderer.gl;e.renderable=!1,r?i.fit(r):n.enable(n.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=i,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,e=this.renderer.renderTexture.current,r=this.renderer.projection,i=r.transform,n=r.sourceFrame,o=r.destinationFrame,s=e?e.resolution:this.renderer.resolution,a=o.width/n.width,h=o.height/n.height,u=((t.x-n.x)*a+o.x)*s,l=((t.y-n.y)*h+o.y)*s,c=t.width*a*s,d=t.height*h*s;i&&(u+=i.tx*s,l+=i.ty*s),e||(l=this.renderer.height-d-l),u=Math.round(u),l=Math.round(l),c=Math.round(c),d=Math.round(d),this.renderer.gl.scissor(u,l,c,d)},e}(dn),pn=function(t){function e(e){var r=t.call(this,e)||this;return r.glConst=WebGLRenderingContext.STENCIL_TEST,r}return Lr(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,r=this.renderer.gl,i=t._stencilCounter;0===i&&(this.renderer.framebuffer.forceStencil(),r.enable(r.STENCIL_TEST)),t._stencilCounter++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,i,this._getBitwiseMask()),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},e}(dn),_n=function(){function t(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Ze,this.transform=null}return t.prototype.update=function(t,e,r,i){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);var n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)},t.prototype.calculateProjection=function(t,e,r,i){var n=this.projectionMatrix,o=i?-1:1;n.identity(),n.a=1/e.width*2,n.d=o*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-o-e.y*n.d},t.prototype.setTransform=function(t){},t.prototype.destroy=function(){this.renderer=null},t}(),mn=new Ye,vn=new Ye,yn=function(){function t(t){this.renderer=t,this.clearColor=t._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Ye,this.destinationFrame=new Ye,this.viewportFrame=new Ye}return t.prototype.bind=function(t,e,r){void 0===t&&(t=null);var i,n,o,s=this.renderer;this.current=t,t?(o=(i=t.baseTexture).resolution,e||(mn.width=t.frame.width,mn.height=t.frame.height,e=mn),r||(vn.x=t.frame.x,vn.y=t.frame.y,vn.width=e.width,vn.height=e.height,r=vn),n=i.framebuffer):(o=s.resolution,e||(mn.width=s.screen.width,mn.height=s.screen.height,e=mn),r||((r=mn).width=e.width,r.height=e.height));var a=this.viewportFrame;a.x=r.x*o,a.y=r.y*o,a.width=r.width*o,a.height=r.height*o,t||(a.y=s.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(n,a),this.renderer.projection.update(r,e,o,!n),t?this.renderer.mask.setMaskStack(i.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)},t.prototype.clear=function(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor;var r=this.destinationFrame,i=this.current?this.current.baseTexture:this.renderer.screen,n=r.width!==i.width||r.height!==i.height;if(n){var o=this.viewportFrame,s=o.x,a=o.y,h=o.width,u=o.height;s=Math.round(s),a=Math.round(a),h=Math.round(h),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(s,a,h,u)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),n&&this.renderer.scissor.pop()},t.prototype.resize=function(){this.bind(null)},t.prototype.reset=function(){this.bind(null)},t.prototype.destroy=function(){this.renderer=null},t}();function En(t,e,r,i,n){r.buffer.update(n)}var gn={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},Tn={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function bn(t){for(var e=t.map(function(t){return{data:t,offset:0,dataLen:0,dirty:0}}),r=0,i=0,n=0,o=0;o<e.length;o++){var s=e[o];if(r=Tn[s.data.type],s.data.size>1&&(r=Math.max(r,16)*s.data.size),s.dataLen=r,i%r!=0&&i<16){var a=i%r%16;i+=a,n+=a}i+r>16?(n=16*Math.ceil(n/16),s.offset=n,n+=r,i=r):(s.offset=n,i+=r,n+=r)}return{uboElements:e,size:n=16*Math.ceil(n/16)}}function Rn(t,e){var r=[];for(var i in t)e[i]&&r.push(e[i]);return r.sort(function(t,e){return t.index-e.index}),r}function xn(t,e){if(!t.autoManage)return{size:0,syncFunc:En};for(var r=bn(Rn(t.uniforms,e)),i=r.uboElements,n=r.size,o=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "],s=0;s<i.length;s++){for(var a=i[s],h=t.uniforms[a.data.name],u=a.data.name,l=!1,c=0;c<zi.length;c++){var d=zi[c];if(d.codeUbo&&d.test(a.data,h)){o.push("offset = "+a.offset/4+";",zi[c].codeUbo(a.data.name,h)),l=!0;break}}if(!l)if(a.data.size>1){var f=Hi(a.data.type),p=Math.max(Tn[a.data.type]/16,1),_=f/p,m=(4-_%4)%4;o.push("\n                cv = ud."+u+".value;\n                v = uv."+u+";\n                offset = "+a.offset/4+";\n\n                t = 0;\n\n                for(var i=0; i < "+a.data.size*p+"; i++)\n                {\n                    for(var j = 0; j < "+_+"; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += "+m+";\n                }\n\n                ")}else{var v=gn[a.data.type];o.push("\n                cv = ud."+u+".value;\n                v = uv."+u+";\n                offset = "+a.offset/4+";\n                "+v+";\n                ")}}return o.push("\n       renderer.buffer.update(buffer);\n    "),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join("\n"))}}var An=function(){},Sn=function(){function t(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return t.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},t}();function On(t,e){var r=Ni(t,t.VERTEX_SHADER,e.vertexSrc),i=Ni(t,t.FRAGMENT_SHADER,e.fragmentSrc),n=t.createProgram();t.attachShader(n,r),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||function(t,e,r,i){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(r,t.COMPILE_STATUS)||wi(t,r),t.getShaderParameter(i,t.COMPILE_STATUS)||wi(t,i),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,n,r,i),e.attributeData=function(t,e){for(var r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var o=e.getActiveAttrib(t,n);if(!o.name.startsWith("gl_")){var s=Vi(e,o.type),a={type:s,name:o.name,size:Hi(s),location:n};r[o.name]=a}}return r}(n,t),e.uniformData=function(t,e){for(var r={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<i;n++){var o=e.getActiveUniform(t,n),s=o.name.replace(/\[.*?\]$/,""),a=!!o.name.match(/\[.*?\]$/),h=Vi(e,o.type);r[s]={name:s,index:n,type:h,size:o.size,isArray:a,value:Li(h,o.size)}}return r}(n,t);var o=Object.keys(e.attributeData);o.sort(function(t,e){return t>e?1:-1});for(var s=0;s<o.length;s++)e.attributeData[o[s]].location=s,t.bindAttribLocation(n,s,o[s]);t.linkProgram(n),t.deleteShader(r),t.deleteShader(i);var a={};for(var s in e.uniformData){var h=e.uniformData[s];a[s]={location:t.getUniformLocation(n,s),value:Li(h.type,h.size)}}return new Sn(n,a)}var In=0,Pn={textureCount:0,uboCount:0},Mn=function(){function t(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=In++}return t.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof Wi)return Wi;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");Wi=!0===t({a:"b"},"a","b")}catch(t){Wi=!1}return Wi}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},t.prototype.contextChange=function(t){this.gl=t,this.reset()},t.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var r=t.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),e||(Pn.textureCount=0,Pn.uboCount=0,this.syncUniformGroup(t.uniformGroup,Pn)),i},t.prototype.setUniforms=function(t){var e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)},t.prototype.syncUniformGroup=function(t,e){var r=this.getGlProgram();t.static&&t.dirtyId===r.uniformDirtyGroups[t.id]||(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))},t.prototype.syncUniforms=function(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)},t.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){var r=["\n        var v = null;\n        var cv = null\n        var t = 0;\n        var gl = renderer.gl\n    "];for(var i in t.uniforms){var n=e[i];if(n){for(var o=t.uniforms[i],s=!1,a=0;a<zi.length;a++)if(zi[a].test(n,o)){r.push(zi[a].code(i,o)),s=!0;break}if(!s){var h=(1===n.size?qi:Ki)[n.type].replace("location",'ud["'+i+'"].location');r.push('\n            cv = ud["'+i+'"].value;\n            v = uv["'+i+'"];\n            '+h+";")}}else t.uniforms[i].group&&(t.uniforms[i].ubo?r.push("\n                        renderer.shader.syncUniformBufferGroup(uv."+i+", '"+i+"');\n                    "):r.push("\n                        renderer.shader.syncUniformGroup(uv."+i+", syncData);\n                    "))}return new Function("ud","uv","renderer","syncData",r.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},t.prototype.syncUniformBufferGroup=function(t,e){var r=this.getGlProgram();if(!t.static||0!==t.dirtyId||!r.uniformGroups[t.id]){t.dirtyId=0;var i=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),i(r.uniformData,t.uniforms,this.renderer,Pn,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])},t.prototype.createSyncBufferGroup=function(t,e,r){var i=this.renderer.gl;this.renderer.buffer.bind(t.buffer);var n=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,i.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;var o=this.getSignature(t,this.shader.program.uniformData,"ubo"),s=this._uboCache[o];if(s||(s=this._uboCache[o]=xn(t,this.shader.program.uniformData)),t.autoManage){var a=new Float32Array(s.size/4);t.buffer.update(a)}return e.uniformGroups[t.id]=s.syncFunc,e.uniformGroups[t.id]},t.prototype.getSignature=function(t,e,r){var i=t.uniforms,n=[r+"-"];for(var o in i)n.push(o),e[o]&&n.push(e[o].type);return n.join("-")},t.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},t.prototype.generateProgram=function(t){var e=this.gl,r=t.program,i=On(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=i,i},t.prototype.reset=function(){this.program=null,this.shader=null},t.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},t}(),Dn=0,Nn=1,wn=2,Cn=3,Ln=4,Fn=5,Un=function(){function e(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=t.BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[Dn]=this.setBlend,this.map[Nn]=this.setOffset,this.map[wn]=this.setCullFace,this.map[Cn]=this.setDepthTest,this.map[Ln]=this.setFrontFace,this.map[Fn]=this.setDepthMask,this.checks=[],this.defaultState=new nn,this.defaultState.blend=!0}return e.prototype.contextChange=function(e){this.gl=e,this.blendModes=function(e,r){return void 0===r&&(r=[]),r[t.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.ADD]=[e.ONE,e.ONE],r[t.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.NONE]=[0,0],r[t.BLEND_MODES.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],r[t.BLEND_MODES.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SRC_IN]=[e.DST_ALPHA,e.ZERO],r[t.BLEND_MODES.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],r[t.BLEND_MODES.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],r[t.BLEND_MODES.DST_IN]=[e.ZERO,e.SRC_ALPHA],r[t.BLEND_MODES.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],r[t.BLEND_MODES.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],r}(e),this.set(this.defaultState),this.reset()},e.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,r=0;e;)1&e&&this.map[r].call(this,!!(t.data&1<<r)),e>>=1,r++;this.stateId=t.data}for(r=0;r<this.checks.length;r++)this.checks[r](this,t)},e.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},e.prototype.setBlend=function(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},e.prototype.setOffset=function(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},e.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},e.prototype.setDepthMask=function(t){this.gl.depthMask(t)},e.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},e.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},e.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],r=this.gl;2===e.length?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}},e.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},e.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},e.prototype.updateCheck=function(t,e){var r=this.checks.indexOf(t);e&&-1===r?this.checks.push(t):e||-1===r||this.checks.splice(r,1)},e.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},e.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},e.prototype.destroy=function(){this.gl=null},e}(),Bn=function(){function e(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=rt.GC_MAX_IDLE,this.checkCountMax=rt.GC_MAX_CHECK_COUNT,this.mode=rt.GC_MODE}return e.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==t.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},e.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,r=!1,i=0;i<e.length;i++){var n=e[i];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[i]=null,r=!0)}if(r){var o=0;for(i=0;i<e.length;i++)null!==e[i]&&(e[o++]=e[i]);e.length=o}},e.prototype.unload=function(t){var e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(var i=t.children.length-1;i>=0;i--)this.unload(t.children[i])},e.prototype.destroy=function(){this.renderer=null},e}(),Gn=function(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=t.TYPES.UNSIGNED_BYTE,this.internalFormat=t.FORMATS.RGBA,this.samplerType=0},Xn=function(){function e(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Xr,this.hasIntegerTextures=!1}return e.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(e){var r,i,n,o,s,a,h,u,l,c,d,f,p,_,m,v,y,E,g,T,b,R,x;return"WebGL2RenderingContext"in self&&e instanceof self.WebGL2RenderingContext?((r={})[t.TYPES.UNSIGNED_BYTE]=((i={})[t.FORMATS.RGBA]=e.RGBA8,i[t.FORMATS.RGB]=e.RGB8,i[t.FORMATS.RG]=e.RG8,i[t.FORMATS.RED]=e.R8,i[t.FORMATS.RGBA_INTEGER]=e.RGBA8UI,i[t.FORMATS.RGB_INTEGER]=e.RGB8UI,i[t.FORMATS.RG_INTEGER]=e.RG8UI,i[t.FORMATS.RED_INTEGER]=e.R8UI,i[t.FORMATS.ALPHA]=e.ALPHA,i[t.FORMATS.LUMINANCE]=e.LUMINANCE,i[t.FORMATS.LUMINANCE_ALPHA]=e.LUMINANCE_ALPHA,i),r[t.TYPES.BYTE]=((n={})[t.FORMATS.RGBA]=e.RGBA8_SNORM,n[t.FORMATS.RGB]=e.RGB8_SNORM,n[t.FORMATS.RG]=e.RG8_SNORM,n[t.FORMATS.RED]=e.R8_SNORM,n[t.FORMATS.RGBA_INTEGER]=e.RGBA8I,n[t.FORMATS.RGB_INTEGER]=e.RGB8I,n[t.FORMATS.RG_INTEGER]=e.RG8I,n[t.FORMATS.RED_INTEGER]=e.R8I,n),r[t.TYPES.UNSIGNED_SHORT]=((o={})[t.FORMATS.RGBA_INTEGER]=e.RGBA16UI,o[t.FORMATS.RGB_INTEGER]=e.RGB16UI,o[t.FORMATS.RG_INTEGER]=e.RG16UI,o[t.FORMATS.RED_INTEGER]=e.R16UI,o[t.FORMATS.DEPTH_COMPONENT]=e.DEPTH_COMPONENT16,o),r[t.TYPES.SHORT]=((s={})[t.FORMATS.RGBA_INTEGER]=e.RGBA16I,s[t.FORMATS.RGB_INTEGER]=e.RGB16I,s[t.FORMATS.RG_INTEGER]=e.RG16I,s[t.FORMATS.RED_INTEGER]=e.R16I,s),r[t.TYPES.UNSIGNED_INT]=((a={})[t.FORMATS.RGBA_INTEGER]=e.RGBA32UI,a[t.FORMATS.RGB_INTEGER]=e.RGB32UI,a[t.FORMATS.RG_INTEGER]=e.RG32UI,a[t.FORMATS.RED_INTEGER]=e.R32UI,a[t.FORMATS.DEPTH_COMPONENT]=e.DEPTH_COMPONENT24,a),r[t.TYPES.INT]=((h={})[t.FORMATS.RGBA_INTEGER]=e.RGBA32I,h[t.FORMATS.RGB_INTEGER]=e.RGB32I,h[t.FORMATS.RG_INTEGER]=e.RG32I,h[t.FORMATS.RED_INTEGER]=e.R32I,h),r[t.TYPES.FLOAT]=((u={})[t.FORMATS.RGBA]=e.RGBA32F,u[t.FORMATS.RGB]=e.RGB32F,u[t.FORMATS.RG]=e.RG32F,u[t.FORMATS.RED]=e.R32F,u[t.FORMATS.DEPTH_COMPONENT]=e.DEPTH_COMPONENT32F,u),r[t.TYPES.HALF_FLOAT]=((l={})[t.FORMATS.RGBA]=e.RGBA16F,l[t.FORMATS.RGB]=e.RGB16F,l[t.FORMATS.RG]=e.RG16F,l[t.FORMATS.RED]=e.R16F,l),r[t.TYPES.UNSIGNED_SHORT_5_6_5]=((c={})[t.FORMATS.RGB]=e.RGB565,c),r[t.TYPES.UNSIGNED_SHORT_4_4_4_4]=((d={})[t.FORMATS.RGBA]=e.RGBA4,d),r[t.TYPES.UNSIGNED_SHORT_5_5_5_1]=((f={})[t.FORMATS.RGBA]=e.RGB5_A1,f),r[t.TYPES.UNSIGNED_INT_2_10_10_10_REV]=((p={})[t.FORMATS.RGBA]=e.RGB10_A2,p[t.FORMATS.RGBA_INTEGER]=e.RGB10_A2UI,p),r[t.TYPES.UNSIGNED_INT_10F_11F_11F_REV]=((_={})[t.FORMATS.RGB]=e.R11F_G11F_B10F,_),r[t.TYPES.UNSIGNED_INT_5_9_9_9_REV]=((m={})[t.FORMATS.RGB]=e.RGB9_E5,m),r[t.TYPES.UNSIGNED_INT_24_8]=((v={})[t.FORMATS.DEPTH_STENCIL]=e.DEPTH24_STENCIL8,v),r[t.TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]=((y={})[t.FORMATS.DEPTH_STENCIL]=e.DEPTH32F_STENCIL8,y),x=r):((E={})[t.TYPES.UNSIGNED_BYTE]=((g={})[t.FORMATS.RGBA]=e.RGBA,g[t.FORMATS.RGB]=e.RGB,g[t.FORMATS.ALPHA]=e.ALPHA,g[t.FORMATS.LUMINANCE]=e.LUMINANCE,g[t.FORMATS.LUMINANCE_ALPHA]=e.LUMINANCE_ALPHA,g),E[t.TYPES.UNSIGNED_SHORT_5_6_5]=((T={})[t.FORMATS.RGB]=e.RGB,T),E[t.TYPES.UNSIGNED_SHORT_4_4_4_4]=((b={})[t.FORMATS.RGBA]=e.RGBA,b),E[t.TYPES.UNSIGNED_SHORT_5_5_5_1]=((R={})[t.FORMATS.RGBA]=e.RGBA,R),x=E),x}(e);var r=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=r;for(var i=0;i<r;i++)this.boundTextures[i]=null;this.emptyTextures={};var n=new Gn(e.createTexture());for(e.bindTexture(e.TEXTURE_2D,n.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=n,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new Gn(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture),i=0;i<6;i++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);for(e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),i=0;i<this.boundTextures.length;i++)this.bind(null,i)},e.prototype.bind=function(t,e){void 0===e&&(e=0);var r=this.gl;if((t=null==t?void 0:t.castToBaseTexture())&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;var i=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,i.texture)),i.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null},e.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},e.prototype.unbind=function(t){var e=this.gl,r=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var i=0;i<r.length;i++)r[i]===this.unknownTexture&&this.bind(null,i)}for(i=0;i<r.length;i++)r[i]===t&&(this.currentLocation!==i&&(e.activeTexture(e.TEXTURE0+i),this.currentLocation=i),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[i]=null)},e.prototype.ensureSamplerType=function(e){var r=this.boundTextures,i=this.hasIntegerTextures,n=this.CONTEXT_UID;if(i)for(var o=e-1;o>=0;--o){var s=r[o];s&&s._glTextures[n].samplerType!==t.SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(s)}},e.prototype.initTexture=function(t){var e=new Gn(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},e.prototype.initTextureType=function(e,r){var i,n;r.internalFormat=null!==(n=null===(i=this.internalFormats[e.type])||void 0===i?void 0:i[e.format])&&void 0!==n?n:e.format,2===this.webGLVersion&&e.type===t.TYPES.HALF_FLOAT?r.type=this.gl.HALF_FLOAT:r.type=e.type},e.prototype.updateTexture=function(e){var r=e._glTextures[this.CONTEXT_UID];if(r){var i=this.renderer;if(this.initTextureType(e,r),e.resource&&e.resource.upload(i,e,r))r.samplerType!==t.SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{var n=e.realWidth,o=e.realHeight,s=i.gl;(r.width!==n||r.height!==o||r.dirtyId<0)&&(r.width=n,r.height=o,s.texImage2D(e.target,0,r.internalFormat,n,o,0,e.format,r.type,null))}e.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(e),r.dirtyId=e.dirtyId}},e.prototype.destroyTexture=function(t,e){var r=this.gl;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var i=this.managedTextures.indexOf(t);-1!==i&&Ae(this.managedTextures,i,1)}},e.prototype.updateTextureStyle=function(e){var r=e._glTextures[this.CONTEXT_UID];r&&(e.mipmap!==t.MIPMAP_MODES.POW2&&2===this.webGLVersion||e.isPowerOfTwo?r.mipmap=e.mipmap>=1:r.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?r.wrapMode=e.wrapMode:r.wrapMode=t.WRAP_MODES.CLAMP,e.resource&&e.resource.style(this.renderer,e,r)||this.setStyle(e,r),r.dirtyStyleId=e.dirtyStyleId)},e.prototype.setStyle=function(e,r){var i=this.gl;if(r.mipmap&&e.mipmap!==t.MIPMAP_MODES.ON_MANUAL&&i.generateMipmap(e.target),i.texParameteri(e.target,i.TEXTURE_WRAP_S,r.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===t.SCALE_MODES.LINEAR){var o=Math.min(e.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?i.LINEAR:i.NEAREST)},e.prototype.destroy=function(){this.renderer=null},e}(),kn={__proto__:null,FilterSystem:Ti,BatchSystem:Ri,ContextSystem:Ai,FramebufferSystem:Ii,GeometrySystem:Mi,MaskSystem:cn,ScissorSystem:fn,StencilSystem:pn,ProjectionSystem:_n,RenderTextureSystem:yn,ShaderSystem:Mn,StateSystem:Un,TextureGCSystem:Bn,TextureSystem:Xn},Hn=new Ze,Yn=function(e){function r(r,i){void 0===r&&(r=t.RENDERER_TYPE.UNKNOWN);var n=e.call(this)||this;return i=Object.assign({},rt.RENDER_OPTIONS,i),n.options=i,n.type=r,n.screen=new Ye(0,0,i.width,i.height),n.view=i.view||document.createElement("canvas"),n.resolution=i.resolution||rt.RESOLUTION,n.useContextAlpha=i.useContextAlpha,n.autoDensity=!!i.autoDensity,n.preserveDrawingBuffer=i.preserveDrawingBuffer,n.clearBeforeRender=i.clearBeforeRender,n._backgroundColor=0,n._backgroundColorRgba=[0,0,0,1],n._backgroundColorString="#000000",n.backgroundColor=i.backgroundColor||n._backgroundColor,n.backgroundAlpha=i.backgroundAlpha,void 0!==i.transparent&&(n.useContextAlpha=i.transparent,n.backgroundAlpha=i.transparent?0:1),n._lastObjectRendered=null,n.plugins={},n}return Lr(r,e),r.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},Object.defineProperty(r.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),r.prototype.resize=function(t,e){this.view.width=Math.round(t*this.resolution),this.view.height=Math.round(e*this.resolution);var r=this.view.width/this.resolution,i=this.view.height/this.resolution;this.screen.width=r,this.screen.height=i,this.autoDensity&&(this.view.style.width=r+"px",this.view.style.height=i+"px"),this.emit("resize",r,i)},r.prototype.generateTexture=function(t,e,r,i){void 0===e&&(e={}),"number"==typeof e&&(e={scaleMode:e,resolution:r,region:i});var n=e.region,o=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&(r[i[n]]=t[i[n]])}return r}(e,["region"]);0===(i=n||t.getLocalBounds(null,!0)).width&&(i.width=1),0===i.height&&(i.height=1);var s=ni.create(Fr({width:i.width,height:i.height},o));return Hn.tx=-i.x,Hn.ty=-i.y,this.render(t,{renderTexture:s,clear:!1,transform:Hn,skipUpdateTransform:!!t.parent}),s},r.prototype.destroy=function(e){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.plugins=null,this.type=t.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this._tempDisplayObjectParent=null,this.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(r.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=de(t),ce(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(t){this._backgroundColorRgba[3]=t},enumerable:!1,configurable:!0}),r}(ot),jn=function(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},Vn=function(){function t(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}return t.prototype.destroy=function(){this.renderer=null},t.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},t.prototype.bind=function(t){var e=this.gl,r=this.CONTEXT_UID,i=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,i.buffer)},t.prototype.bindBufferBase=function(t,e){var r=this.gl,i=this.CONTEXT_UID;if(this.boundBufferBases[e]!==t){var n=t._glBuffers[i]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,n.buffer)}},t.prototype.bindBufferRange=function(t,e,r){var i=this.gl,n=this.CONTEXT_UID;r=r||0;var o=t._glBuffers[n]||this.createGLBuffer(t);i.bindBufferRange(i.UNIFORM_BUFFER,e||0,o.buffer,256*r,256)},t.prototype.update=function(t){var e=this.gl,r=this.CONTEXT_UID,i=t._glBuffers[r];if(t._updateID!==i.updateID)if(i.updateID=t._updateID,e.bindBuffer(t.type,i.buffer),i.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{var n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;i.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}},t.prototype.dispose=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var r=t._glBuffers[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this),r&&(e||i.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}},t.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedBuffers),r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)},t.prototype.createGLBuffer=function(t){var e=this.CONTEXT_UID,r=this.gl;return t._glBuffers[e]=new jn(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]},t}(),Wn=function(e){function r(i){var n=e.call(this,t.RENDERER_TYPE.WEBGL,i)||this;return i=n.options,n.gl=null,n.CONTEXT_UID=0,n.runners={destroy:new Dr("destroy"),contextChange:new Dr("contextChange"),reset:new Dr("reset"),update:new Dr("update"),postrender:new Dr("postrender"),prerender:new Dr("prerender"),resize:new Dr("resize")},n.runners.contextChange.add(n),n.globalUniforms=new vi({projectionMatrix:new Ze},!0),n.addSystem(cn,"mask").addSystem(Ai,"context").addSystem(Un,"state").addSystem(Mn,"shader").addSystem(Xn,"texture").addSystem(Vn,"buffer").addSystem(Mi,"geometry").addSystem(Ii,"framebuffer").addSystem(fn,"scissor").addSystem(pn,"stencil").addSystem(_n,"projection").addSystem(Bn,"textureGC").addSystem(Ti,"filter").addSystem(yn,"renderTexture").addSystem(Ri,"batch"),n.initPlugins(r.__plugins),n.multisample=void 0,i.context?n.context.initFromContext(i.context):n.context.initFromOptions({alpha:!!n.useContextAlpha,antialias:i.antialias,premultipliedAlpha:n.useContextAlpha&&"notMultiplied"!==n.useContextAlpha,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,powerPreference:n.options.powerPreference}),n.renderingToScreen=!0,he(2===n.context.webGLVersion?"WebGL 2":"WebGL 1"),n.resize(n.options.width,n.options.height),n}return Lr(r,e),r.create=function(t){if(ue())return new r(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},r.prototype.contextChange=function(){var e,r=this.gl;if(1===this.context.webGLVersion){var i=r.getParameter(r.FRAMEBUFFER_BINDING);r.bindFramebuffer(r.FRAMEBUFFER,null),e=r.getParameter(r.SAMPLES),r.bindFramebuffer(r.FRAMEBUFFER,i)}else i=r.getParameter(r.DRAW_FRAMEBUFFER_BINDING),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),e=r.getParameter(r.SAMPLES),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,i);e>=t.MSAA_QUALITY.HIGH?this.multisample=t.MSAA_QUALITY.HIGH:e>=t.MSAA_QUALITY.MEDIUM?this.multisample=t.MSAA_QUALITY.MEDIUM:e>=t.MSAA_QUALITY.LOW?this.multisample=t.MSAA_QUALITY.LOW:this.multisample=t.MSAA_QUALITY.NONE},r.prototype.addSystem=function(t,e){var r=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var i in this[e]=r,this.runners)this.runners[i].add(r);return this},r.prototype.render=function(t,e){var r,i,n,o;if(e&&(e instanceof ni?(r=e,i=arguments[2],n=arguments[3],o=arguments[4]):(r=e.renderTexture,i=e.clear,n=e.transform,o=e.skipUpdateTransform)),this.renderingToScreen=!r,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=n,!this.context.isLost){if(r||(this._lastObjectRendered=t),!o){var s=t.enableTempParent();t.updateTransform(),t.disableTempParent(s)}this.renderTexture.bind(r),this.batch.currentRenderer.start(),(void 0!==i?i:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),r&&r.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},r.prototype.generateTexture=function(t,r,i,n){void 0===r&&(r={});var o=e.prototype.generateTexture.call(this,t,r,i,n);return this.framebuffer.blit(),o},r.prototype.resize=function(t,r){e.prototype.resize.call(this,t,r),this.runners.resize.emit(this.screen.height,this.screen.width)},r.prototype.reset=function(){return this.runners.reset.emit(),this},r.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},r.prototype.destroy=function(t){for(var r in this.runners.destroy.emit(),this.runners)this.runners[r].destroy();e.prototype.destroy.call(this,t),this.gl=null},Object.defineProperty(r.prototype,"extract",{get:function(){return this.plugins.extract},enumerable:!1,configurable:!0}),r.registerPlugin=function(t,e){r.__plugins=r.__plugins||{},r.__plugins[t]=e},r}(Yn);function zn(t){return Wn.create(t)}var qn="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Kn="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",Zn=function(){function t(t){this.renderer=t}return t.prototype.destroy=function(){this.renderer=null},t}(),Qn=function(){this.texArray=null,this.blend=0,this.type=t.DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null},Jn=function(){function t(){this.elements=[],this.ids=[],this.count=0}return t.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},t}(),$n=function(){function t(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(t.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),t.prototype.view=function(t){return this[t+"View"]},t.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},t.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},t}(),to=function(e){function r(t){var r=e.call(this,t)||this;return r.shaderGenerator=null,r.geometryClass=null,r.vertexSize=null,r.state=nn.for2d(),r.size=4*rt.SPRITE_BATCH_SIZE,r._vertexCount=0,r._indexCount=0,r._bufferedElements=[],r._bufferedTextures=[],r._bufferSize=0,r._shader=null,r._packedGeometries=[],r._packedGeometryPoolSize=2,r._flushId=0,r._aBuffers={},r._iBuffers={},r.MAX_TEXTURES=1,r.renderer.on("prerender",r.onPrerender,r),t.runners.contextChange.add(r),r._dcIndex=0,r._aIndex=0,r._iIndex=0,r._attributeBuffer=null,r._indexBuffer=null,r._tempBoundTextures=[],r}return Lr(r,e),r.prototype.contextChange=function(){var e=this.renderer.gl;rt.PREFER_ENV===t.ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),rt.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=Ji(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},r.prototype.initFlushBuffers=function(){for(var t=r._drawCallPool,e=r._textureArrayPool,i=this.size/4,n=Math.floor(i/this.MAX_TEXTURES)+1;t.length<i;)t.push(new Qn);for(;e.length<n;)e.push(new Jn);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},r.prototype.onPrerender=function(){this._flushId=0},r.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},r.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,e=this.MAX_TEXTURES,i=r._textureArrayPool,n=this.renderer.batch,o=this._tempBoundTextures,s=this.renderer.textureGC.count,a=++Xr._globalBatch,h=0,u=i[0],l=0;n.copyBoundTextures(o,e);for(var c=0;c<this._bufferSize;++c){var d=t[c];t[c]=null,d._batchEnabled!==a&&(u.count>=e&&(n.boundArray(u,o,a,e),this.buildDrawCalls(u,l,c),l=c,u=i[++h],++a),d._batchEnabled=a,d.touched=s,u.elements[u.count++]=d)}for(u.count>0&&(n.boundArray(u,o,a,e),this.buildDrawCalls(u,l,this._bufferSize),++h,++a),c=0;c<o.length;c++)o[c]=null;Xr._globalBatch=a},r.prototype.buildDrawCalls=function(t,e,i){var n=this._bufferedElements,o=this._attributeBuffer,s=this._indexBuffer,a=this.vertexSize,h=r._drawCallPool,u=this._dcIndex,l=this._aIndex,c=this._iIndex,d=h[u];d.start=this._iIndex,d.texArray=t;for(var f=e;f<i;++f){var p=n[f],_=p._texture.baseTexture,m=pe[_.alphaMode?1:0][p.blendMode];n[f]=null,e<f&&d.blend!==m&&(d.size=c-d.start,e=f,(d=h[++u]).texArray=t,d.start=c),this.packInterleavedGeometry(p,o,s,l,c),l+=p.vertexData.length/2*a,c+=p.indices.length,d.blend=m}e<i&&(d.size=c-d.start,++u),this._dcIndex=u,this._aIndex=l,this._iIndex=c},r.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0},r.prototype.updateGeometry=function(){var t=this._packedGeometries,e=this._attributeBuffer,r=this._indexBuffer;rt.CAN_UPLOAD_SAME_BUFFER?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},r.prototype.drawBatches=function(){for(var t=this._dcIndex,e=this.renderer,i=e.gl,n=e.state,o=r._drawCallPool,s=null,a=0;a<t;a++){var h=o[a],u=h.texArray,l=h.type,c=h.size,d=h.start,f=h.blend;s!==u&&(s=u,this.bindAndClearTexArray(u)),this.state.blendMode=f,n.set(this.state),i.drawElements(l,c,i.UNSIGNED_SHORT,2*d)}},r.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},r.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),rt.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},r.prototype.stop=function(){this.flush()},r.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),e.prototype.destroy.call(this)},r.prototype.getAttributeBuffer=function(t){var e=be(Math.ceil(t/8)),r=xe(e),i=8*e;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);var n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new $n(i*this.vertexSize*4)),n},r.prototype.getIndexBuffer=function(t){var e=be(Math.ceil(t/12)),r=xe(e),i=12*e;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);var n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(i)),n},r.prototype.packInterleavedGeometry=function(t,e,r,i,n){for(var o=e.uint32View,s=e.float32View,a=i/this.vertexSize,h=t.uvs,u=t.indices,l=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=d<1&&t._texture.baseTexture.alphaMode?ve(t._tintRGB,d):t._tintRGB+(255*d<<24),p=0;p<l.length;p+=2)s[i++]=l[p],s[i++]=l[p+1],s[i++]=h[p],s[i++]=h[p+1],o[i++]=f,s[i++]=c;for(p=0;p<u.length;p++)r[n++]=a+u[p]},r._drawCallPool=[],r._textureArrayPool=[],r}(bi),eo=function(){function t(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return t.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=vi.from({uSamplers:e},!0);var i=this.fragTemplate;i=(i=i.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new en(this.vertexSrc,i)}var n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ze,default:this.defaultGroupCache[t]};return new rn(this.programCache[t],n)},t.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+="if(vTextureId < "+r+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+r+"], vTextureCoord);",e+="\n}";return(e+="\n")+"\n"},t}(),ro=function(e){function r(r){void 0===r&&(r=!1);var i=e.call(this)||this;return i._buffer=new hi(null,r,!1),i._indexBuffer=new hi(null,r,!0),i.addAttribute("aVertexPosition",i._buffer,2,!1,t.TYPES.FLOAT).addAttribute("aTextureCoord",i._buffer,2,!1,t.TYPES.FLOAT).addAttribute("aColor",i._buffer,4,!0,t.TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",i._buffer,1,!0,t.TYPES.FLOAT).addIndex(i._indexBuffer),i}return Lr(r,e),r}(fi),io="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",no="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",oo=function(){function t(){}return t.create=function(t){var e=Object.assign({vertex:io,fragment:no,geometryClass:ro,vertexSize:6},t),r=e.vertex,i=e.fragment,n=e.vertexSize,o=e.geometryClass;return function(t){function e(e){var s=t.call(this,e)||this;return s.shaderGenerator=new eo(r,i),s.geometryClass=o,s.vertexSize=n,s}return Lr(e,t),e}(to)},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return io},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentTemplate",{get:function(){return no},enumerable:!1,configurable:!0}),t}(),so=oo.create(),ao={},ho=function(t){Object.defineProperty(ao,t,{get:function(){return Zr[t]}})};for(var uo in Zr)ho(uo);var lo={},co=function(t){Object.defineProperty(lo,t,{get:function(){return kn[t]}})};for(var uo in kn)co(uo);var fo=function(){function t(e){var r=this;this.stage=new dr,e=Object.assign({forceCanvas:!1},e),this.renderer=zn(e),t._plugins.forEach(function(t){t.init.call(r,e)})}return t.registerPlugin=function(e){t._plugins.push(e)},t.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(t.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),t.prototype.destroy=function(e,r){var i=this,n=t._plugins.slice(0);n.reverse(),n.forEach(function(t){t.destroy.call(i)}),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null},t._plugins=[],t}(),po=function(){function t(){}return t.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){self.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(self.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){e._resizeTo&&(e.cancelResize(),e._resizeId=requestAnimationFrame(function(){return e.resize()}))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(e._resizeTo){var t,r;if(e.cancelResize(),e._resizeTo===self)t=self.innerWidth,r=self.innerHeight;else{var i=e._resizeTo;t=i.clientWidth,r=i.clientHeight}e.renderer.resize(t,r)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},t.destroy=function(){self.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},t}();fo.registerPlugin(po);var _o=new Ye,mo=function(){function t(t){this.renderer=t}return t.prototype.image=function(t,e,r){var i=new Image;return i.src=this.base64(t,e,r),i},t.prototype.base64=function(t,e,r){return this.canvas(t).toDataURL(e,r)},t.prototype.canvas=function(e){var r,i,n,o=this.renderer,s=!1,a=!1;e&&(e instanceof ni?n=e:(n=this.renderer.generateTexture(e),a=!0)),n?(r=n.baseTexture.resolution,i=n.frame,s=!1,o.renderTexture.bind(n)):(r=this.renderer.resolution,s=!0,(i=_o).width=this.renderer.width,i.height=this.renderer.height,o.renderTexture.bind(null));var h=Math.floor(i.width*r+1e-4),u=Math.floor(i.height*r+1e-4),l=new we(h,u,1),c=new Uint8Array(4*h*u),d=o.gl;d.readPixels(i.x*r,i.y*r,h,u,d.RGBA,d.UNSIGNED_BYTE,c);var f=l.context.getImageData(0,0,h,u);if(t.arrayPostDivide(c,f.data),l.context.putImageData(f,0,0),s){var p=new we(l.width,l.height,1);p.context.scale(1,-1),p.context.drawImage(l.canvas,0,-u),l.destroy(),l=p}return a&&n.destroy(!0),l.canvas},t.prototype.pixels=function(e){var r,i,n,o=this.renderer,s=!1;e&&(e instanceof ni?n=e:(n=this.renderer.generateTexture(e),s=!0)),n?(r=n.baseTexture.resolution,i=n.frame,o.renderTexture.bind(n)):(r=o.resolution,(i=_o).width=o.width,i.height=o.height,o.renderTexture.bind(null));var a=i.width*r,h=i.height*r,u=new Uint8Array(4*a*h),l=o.gl;return l.readPixels(i.x*r,i.y*r,a,h,l.RGBA,l.UNSIGNED_BYTE,u),s&&n.destroy(!0),t.arrayPostDivide(u,u),u},t.prototype.destroy=function(){this.renderer=null},t.arrayPostDivide=function(t,e){for(var r=0;r<t.length;r+=4){var i=e[r+3]=t[r+3];0!==i?(e[r]=Math.round(Math.min(255*t[r]/i,255)),e[r+1]=Math.round(Math.min(255*t[r+1]/i,255)),e[r+2]=Math.round(Math.min(255*t[r+2]/i,255))):(e[r]=t[r],e[r+1]=t[r+1],e[r+2]=t[r+2])}},t}(),vo=function(){function t(t,e,r){void 0===e&&(e=!1),this._fn=t,this._once=e,this._thisArg=r,this._next=this._prev=this._owner=null}return t.prototype.detach=function(){return null!==this._owner&&(this._owner.detach(this),!0)},t}();function yo(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var Eo=function(){function t(){this._head=this._tail=void 0}return t.prototype.handlers=function(t){void 0===t&&(t=!1);var e=this._head;if(t)return!!e;for(var r=[];e;)r.push(e),e=e._next;return r},t.prototype.has=function(t){if(!(t instanceof vo))throw new Error("MiniSignal#has(): First arg must be a SignalBinding object.");return t._owner===this},t.prototype.dispatch=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];var i=this._head;if(!i)return!1;for(;i;)i._once&&this.detach(i),i._fn.apply(i._thisArg,e),i=i._next;return!0},t.prototype.add=function(t,e){if(void 0===e&&(e=null),"function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return yo(this,new vo(t,!1,e))},t.prototype.once=function(t,e){if(void 0===e&&(e=null),"function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return yo(this,new vo(t,!0,e))},t.prototype.detach=function(t){if(!(t instanceof vo))throw new Error("MiniSignal#detach(): First arg must be a SignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)},t.prototype.detachAll=function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this},t}();function go(t,e){e=e||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},i=r.parser[e.strictMode?"strict":"loose"].exec(t),n={},o=14;o--;)n[r.key[o]]=i[o]||"";return n[r.q.name]={},n[r.key[12]].replace(r.q.parser,function(t,e,i){e&&(n[r.q.name][e]=i)}),n}var To=!(!self.XDomainRequest||"withCredentials"in new XMLHttpRequest),bo=null;function Ro(){}function xo(t,e,r){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=r)}function Ao(t){return t.toString().replace("object ","")}function So(){}function Oo(t){return function(){for(var e=arguments,r=[],i=0;i<arguments.length;i++)r[i]=e[i];if(null===t)throw new Error("Callback was already called.");var n=t;t=null,n.apply(this,r)}}t.LoaderResource=function(){function t(e,r,i){if(this._dequeue=Ro,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=null,this._boundOnError=null,this._boundOnProgress=null,this._boundOnTimeout=null,this._boundXhrOnError=null,this._boundXhrOnTimeout=null,this._boundXhrOnAbort=null,this._boundXhrOnLoad=null,"string"!=typeof e||"string"!=typeof r)throw new Error("Both name and url are required for constructing a resource.");i=i||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===r.indexOf("data:")),this.name=e,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===i.crossOrigin?"anonymous":i.crossOrigin,this.timeout=i.timeout||0,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=Ro,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Eo,this.onProgress=new Eo,this.onComplete=new Eo,this.onAfterMiddleware=new Eo}return t.setExtensionLoadType=function(e,r){xo(t._loadTypeMap,e,r)},t.setExtensionXhrType=function(e,r){xo(t._xhrTypeMap,e,r)},Object.defineProperty(t.prototype,"isDataUrl",{get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isComplete",{get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)},enumerable:!1,configurable:!0}),t.prototype.complete=function(){this._clearEvents(),this._finish()},t.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},t.prototype.load=function(e){var r=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout(function(){return e(r)},1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:To&&this.crossOrigin?this._loadXdr():this._loadXhr()}},t.prototype._hasFlag=function(t){return 0!=(this._flags&t)},t.prototype._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},t.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},t.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t.prototype._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==self.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t.prototype._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==self.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(t,this.url[r],Array.isArray(e)?e[r]:e));else e=this.metadata.mimeType,this.data.appendChild(this._createSource(t,this.url,Array.isArray(e)?e[0]:e));this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},t.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},t.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new self.XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){return t.send()},1)},t.prototype._createSource=function(t,e,r){r||(r=t+"/"+this._getExtension(e));var i=document.createElement("source");return i.src=e,i.type=r,i},t.prototype._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},t.prototype._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},t.prototype._onTimeout=function(){this.abort("Load timed out.")},t.prototype._xhrOnError=function(){var t=this.xhr;this.abort(Ao(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},t.prototype._xhrOnTimeout=function(){var t=this.xhr;this.abort(Ao(t)+" Request timed out.")},t.prototype._xhrOnAbort=function(){var t=this.xhr;this.abort(Ao(t)+" Request was aborted by the user.")},t.prototype._xhrOnLoad=function(){var e=this.xhr,r="",i=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(r=e.responseText),0===i&&(r.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?i=200:1223===i&&(i=204),2==(i/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=r,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(r),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(self.DOMParser){var n=new DOMParser;this.data=n.parseFromString(r,"text/xml")}else{var o=document.createElement("div");o.innerHTML=r,this.data=o}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||r;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},t.prototype._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(self.origin!==self.location.origin)return"anonymous";e=e||self.location,bo||(bo=document.createElement("a")),bo.href=t;var r=go(bo.href,{strictMode:!0}),i=!r.port&&""===e.port||r.port===e.port,n=r.protocol?r.protocol+":":"";return r.host===e.hostname&&i&&n===e.protocol?"":"anonymous"},t.prototype._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},t.prototype._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},t.prototype._getExtension=function(t){void 0===t&&(t=this.url);var e="";if(this.isDataUrl){var r=t.indexOf("/");e=t.substring(r+1,t.indexOf(";",r))}else{var i=t.indexOf("?"),n=t.indexOf("#"),o=Math.min(i>-1?i:t.length,n>-1?n:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},t.prototype._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},t}(),function(t){!function(t){t[t.NONE=0]="NONE",t[t.DATA_URL=1]="DATA_URL",t[t.COMPLETE=2]="COMPLETE",t[t.LOADING=4]="LOADING"}(t.STATUS_FLAGS||(t.STATUS_FLAGS={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.JSON=1]="JSON",t[t.XML=2]="XML",t[t.IMAGE=3]="IMAGE",t[t.AUDIO=4]="AUDIO",t[t.VIDEO=5]="VIDEO",t[t.TEXT=6]="TEXT"}(t.TYPE||(t.TYPE={})),function(t){t[t.XHR=1]="XHR",t[t.IMAGE=2]="IMAGE",t[t.AUDIO=3]="AUDIO",t[t.VIDEO=4]="VIDEO"}(t.LOAD_TYPE||(t.LOAD_TYPE={})),function(t){t.DEFAULT="text",t.BUFFER="arraybuffer",t.BLOB="blob",t.DOCUMENT="document",t.JSON="json",t.TEXT="text"}(t.XHR_RESPONSE_TYPE||(t.XHR_RESPONSE_TYPE={})),t._loadTypeMap={gif:t.LOAD_TYPE.IMAGE,png:t.LOAD_TYPE.IMAGE,bmp:t.LOAD_TYPE.IMAGE,jpg:t.LOAD_TYPE.IMAGE,jpeg:t.LOAD_TYPE.IMAGE,tif:t.LOAD_TYPE.IMAGE,tiff:t.LOAD_TYPE.IMAGE,webp:t.LOAD_TYPE.IMAGE,tga:t.LOAD_TYPE.IMAGE,svg:t.LOAD_TYPE.IMAGE,"svg+xml":t.LOAD_TYPE.IMAGE,mp3:t.LOAD_TYPE.AUDIO,ogg:t.LOAD_TYPE.AUDIO,wav:t.LOAD_TYPE.AUDIO,mp4:t.LOAD_TYPE.VIDEO,webm:t.LOAD_TYPE.VIDEO},t._xhrTypeMap={xhtml:t.XHR_RESPONSE_TYPE.DOCUMENT,html:t.XHR_RESPONSE_TYPE.DOCUMENT,htm:t.XHR_RESPONSE_TYPE.DOCUMENT,xml:t.XHR_RESPONSE_TYPE.DOCUMENT,tmx:t.XHR_RESPONSE_TYPE.DOCUMENT,svg:t.XHR_RESPONSE_TYPE.DOCUMENT,tsx:t.XHR_RESPONSE_TYPE.DOCUMENT,gif:t.XHR_RESPONSE_TYPE.BLOB,png:t.XHR_RESPONSE_TYPE.BLOB,bmp:t.XHR_RESPONSE_TYPE.BLOB,jpg:t.XHR_RESPONSE_TYPE.BLOB,jpeg:t.XHR_RESPONSE_TYPE.BLOB,tif:t.XHR_RESPONSE_TYPE.BLOB,tiff:t.XHR_RESPONSE_TYPE.BLOB,webp:t.XHR_RESPONSE_TYPE.BLOB,tga:t.XHR_RESPONSE_TYPE.BLOB,json:t.XHR_RESPONSE_TYPE.JSON,text:t.XHR_RESPONSE_TYPE.TEXT,txt:t.XHR_RESPONSE_TYPE.TEXT,ttf:t.XHR_RESPONSE_TYPE.BUFFER,otf:t.XHR_RESPONSE_TYPE.BUFFER},t.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="}(t.LoaderResource||(t.LoaderResource={}));var Io=function(t,e){this.data=t,this.callback=e},Po=function(){function t(t,e){var r=this;if(void 0===e&&(e=1),this.workers=0,this.saturated=So,this.unsaturated=So,this.empty=So,this.drain=So,this.error=So,this.started=!1,this.paused=!1,this._tasks=[],this._insert=function(t,e,i){if(i&&"function"!=typeof i)throw new Error("task callback must be a function");if(r.started=!0,null==t&&r.idle())setTimeout(function(){return r.drain()},1);else{var n=new Io(t,"function"==typeof i?i:So);e?r._tasks.unshift(n):r._tasks.push(n),setTimeout(r.process,1)}},this.process=function(){for(;!r.paused&&r.workers<r.concurrency&&r._tasks.length;){var t=r._tasks.shift();0===r._tasks.length&&r.empty(),r.workers+=1,r.workers===r.concurrency&&r.saturated(),r._worker(t.data,Oo(r._next(t)))}},this._worker=t,0===e)throw new Error("Concurrency must not be zero");this.concurrency=e,this.buffer=e/4}return t.prototype._next=function(t){var e=this;return function(){for(var r=arguments,i=[],n=0;n<arguments.length;n++)i[n]=r[n];e.workers-=1,t.callback.apply(t,i),null!=i[0]&&e.error(i[0],t.data),e.workers<=e.concurrency-e.buffer&&e.unsaturated(),e.idle()&&e.drain(),e.process()}},t.prototype.push=function(t,e){this._insert(t,!1,e)},t.prototype.kill=function(){this.workers=0,this.drain=So,this.started=!1,this._tasks=[]},t.prototype.unshift=function(t,e){this._insert(t,!0,e)},t.prototype.length=function(){return this._tasks.length},t.prototype.running=function(){return this.workers},t.prototype.idle=function(){return this._tasks.length+this.workers===0},t.prototype.pause=function(){!0!==this.paused&&(this.paused=!0)},t.prototype.resume=function(){if(!1!==this.paused){this.paused=!1;for(var t=1;t<=this.concurrency;t++)this.process()}},t.eachSeries=function(t,e,r,i){var n=0,o=t.length;!function s(a){a||n===o?r&&r(a):i?setTimeout(function(){e(t[n++],s)},1):e(t[n++],s)}()},t.queue=function(e,r){return new t(e,r)},t}(),Mo=/(#[\w-]+)?$/,Do=function(){function e(t,r){var i=this;void 0===t&&(t=""),void 0===r&&(r=10),this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return i._loadResource(t,e)},this.resources={},this.baseUrl=t,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return i._loadResource(t,e)},this._queue=Po.queue(this._boundLoadResource,r),this._queue.pause(),this.resources={},this.onProgress=new Eo,this.onError=new Eo,this.onLoad=new Eo,this.onStart=new Eo,this.onComplete=new Eo;for(var n=0;n<e._plugins.length;++n){var o=e._plugins[n],s=o.pre,a=o.use;s&&this.pre(s),a&&this.use(a)}this._protected=!1}return e.prototype._add=function(e,r,i,n){if(this.loading&&(!i||!i.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[e])throw new Error('Resource named "'+e+'" already exists.');if(r=this._prepareUrl(r),this.resources[e]=new t.LoaderResource(e,r,i),"function"==typeof n&&this.resources[e].onAfterMiddleware.once(n),this.loading){for(var o=i.parentResource,s=[],a=0;a<o.children.length;++a)o.children[a].isComplete||s.push(o.children[a]);var h=o.progressChunk*(s.length+1)/(s.length+2);for(o.children.push(this.resources[e]),o.progressChunk=h,a=0;a<s.length;++a)s[a].progressChunk=h;this.resources[e].progressChunk=h}return this._queue.push(this.resources[e]),this},e.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},e.prototype.use=function(t){return this._afterMiddleware.push(t),this},e.prototype.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort("loader reset")}return this.resources={},this},e.prototype.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,r=0;r<this._queue._tasks.length;++r)this._queue._tasks[r].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},Object.defineProperty(e.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t},enumerable:!1,configurable:!0}),e.prototype._prepareUrl=function(t){var e,r=go(t,{strictMode:!0});if(e=r.protocol||!r.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var i=Mo.exec(e)[0];-1!==(e=e.substr(0,e.length-i.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=i}return e},e.prototype._loadResource=function(t,e){var r=this;t._dequeue=e,Po.eachSeries(this._beforeMiddleware,function(e,i){e.call(r,t,function(){i(t.isComplete?{}:null)})},function(){t.isComplete?r._onLoad(t):(t._onLoadBinding=t.onComplete.once(r._onLoad,r),t.load())},!0)},e.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e.prototype._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),Po.eachSeries(this._afterMiddleware,function(r,i){r.call(e,t,i)},function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()},!0)},e.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(e,"shared",{get:function(){var t=e._shared;return t||((t=new e)._protected=!0,e._shared=t),t},enumerable:!1,configurable:!0}),e.registerPlugin=function(t){return e._plugins.push(t),t.add&&t.add(),e},e._plugins=[],e}();Do.prototype.add=function(t,e,r,i){if(Array.isArray(t)){for(var n=0;n<t.length;++n)this.add(t[n]);return this}if("object"==typeof t&&(r=t,i=e||r.callback||r.onComplete,e=r.url,t=r.name||r.key||r.url),"string"!=typeof e&&(i=r,r=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");return"function"==typeof r&&(i=r,r=null),this._add(t,e,r,i)};var No,wo=function(){function t(){}return t.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?Do.shared:new Do},t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t}(),Co=function(){function e(){}return e.add=function(){t.LoaderResource.setExtensionLoadType("svg",t.LoaderResource.LOAD_TYPE.XHR),t.LoaderResource.setExtensionXhrType("svg",t.LoaderResource.XHR_RESPONSE_TYPE.TEXT)},e.use=function(e,r){if(!e.data||e.type!==t.LoaderResource.TYPE.IMAGE&&"svg"!==e.extension)r();else{var i=e.data,n=e.url,o=e.name,s=e.metadata;ri.fromLoader(i,n,o,s).then(function(t){e.texture=t,r()}).catch(r)}},e}(),Lo=self.URL||self.webkitURL;Do.registerPlugin({use:function(e,r){if(e.data){if(e.xhr&&e.xhrType===t.LoaderResource.XHR_RESPONSE_TYPE.BLOB)if(self.Blob&&"string"!=typeof e.data){if(0===e.data.type.indexOf("image")){var i=Lo.createObjectURL(e.data);return e.blob=e.data,e.data=new Image,e.data.src=i,e.type=t.LoaderResource.TYPE.IMAGE,void(e.data.onload=function(){Lo.revokeObjectURL(i),e.data.onload=null,r()})}}else{var n=e.xhr.getResponseHeader("content-type");if(n&&0===n.indexOf("image"))return e.data=new Image,e.data.src="data:"+n+";base64,"+function(t){for(var e="",r=0;r<t.length;){for(var i=[0,0,0],n=[0,0,0,0],o=0;o<i.length;++o)r<t.length?i[o]=255&t.charCodeAt(r++):i[o]=0;switch(n[0]=i[0]>>2,n[1]=(3&i[0])<<4|i[1]>>4,n[2]=(15&i[1])<<2|i[2]>>6,n[3]=63&i[2],r-(t.length-1)){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64}for(o=0;o<n.length;++o)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n[o])}return e}(e.xhr.responseText),e.type=t.LoaderResource.TYPE.IMAGE,void(e.data.onload=function(){e.data.onload=null,r()})}r()}else r()}}),Do.registerPlugin(Co),function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"}(t.INTERNAL_FORMATS||(t.INTERNAL_FORMATS={}));var Fo=((No={})[t.INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,No[t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,No[t.INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,No[t.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,No[t.INTERNAL_FORMATS.COMPRESSED_R11_EAC]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_RG11_EAC]=1,No[t.INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]=1,No[t.INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]=1,No[t.INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,No[t.INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,No[t.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,No[t.INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]=.5,No[t.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,No[t.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,No),Uo=function(t,e){return(Uo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Bo(t,e){function r(){this.constructor=t}Uo(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Go,Xo,ko=function(t){function e(e,r){void 0===r&&(r={width:1,height:1,autoLoad:!0});var i,n,o=this;return"string"==typeof e?(i=e,n=new Uint8Array):(i=null,n=e),(o=t.call(this,n,r)||this).origin=i,o.buffer=n?new $n(n):null,o.origin&&!1!==r.autoLoad&&o.load(),n&&n.length&&(o.loaded=!0,o.onBlobLoaded(o.buffer.rawBinaryData)),o}return Bo(e,t),e.prototype.onBlobLoaded=function(t){},e.prototype.load=function(){return t=this,void 0,e=Promise,r=function(){var t;return function(t,e){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,function(e){switch(e.label){case 0:return[4,fetch(this.origin)];case 1:return[4,e.sent().blob()];case 2:return[4,e.sent().arrayBuffer()];case 3:return t=e.sent(),this.data=new Uint32Array(t),this.buffer=new $n(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),[2,this]}})},new(e||(e=Promise))(function(i,n){function o(t){try{a(r.next(t))}catch(t){n(t)}}function s(t){try{a(r.throw(t))}catch(t){n(t)}}function a(t){t.done?i(t.value):new e(function(e){e(t.value)}).then(o,s)}a((r=r.apply(t,[])).next())});var t,e,r},e}(Br),Ho=function(t){function e(r,i){var n=t.call(this,r,i)||this;return n.format=i.format,n.levels=i.levels||1,n._width=i.width,n._height=i.height,n._extension=e._formatToExtension(n.format),(i.levelBuffers||n.buffer)&&(n._levelBuffers=i.levelBuffers||e._createLevelBuffers(r instanceof Uint8Array?r:n.buffer.uint8View,n.format,n.levels,4,4,n.width,n.height)),n}return Bo(e,t),e.prototype.upload=function(t,e,r){var i=t.gl;if(!t.context.extensions[this._extension])throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var n=0,o=this.levels;n<o;n++){var s=this._levelBuffers[n],a=s.levelID,h=s.levelWidth,u=s.levelHeight,l=s.levelBuffer;i.compressedTexImage2D(i.TEXTURE_2D,a,this.format,h,u,0,l)}return!0},e.prototype.onBlobLoaded=function(){this._levelBuffers=e._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},e._formatToExtension=function(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},e._createLevelBuffers=function(t,e,r,i,n,o,s){for(var a=new Array(r),h=t.byteOffset,u=o,l=s,c=u+i-1&~(i-1),d=l+n-1&~(n-1),f=c*d*Fo[e],p=0;p<r;p++)a[p]={levelID:p,levelWidth:r>1?u:c,levelHeight:r>1?l:d,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,f=(c=(u=u>>1||1)+i-1&~(i-1))*(d=(l=l>>1||1)+n-1&~(n-1))*Fo[e];return a},e}(ko),Yo=function(){function e(){}return e.use=function(r,i){var n=r.data;if(r.type===t.LoaderResource.TYPE.JSON&&n&&n.cacheID&&n.textures){for(var o=n.textures,s=void 0,a=void 0,h=0,u=o.length;h<u;h++){var l=o[h],c=l.src,d=l.format;if(d||(a=c),e.textureFormats[d]){s=c;break}}if(!(s=s||a))return void i(new Error("Cannot load compressed-textures in "+r.url+", make sure you provide a fallback"));if(s===r.url)return void i(new Error("URL of compressed texture cannot be the same as the manifest's URL"));var f={crossOrigin:r.crossOrigin,metadata:r.metadata.imageMetadata,parentResource:r},p=ne.resolve(r.url.replace(this.baseUrl,""),s),_=n.cacheID;this.add(_,p,f,function(t){if(t.error)i(t.error);else{var e=t.texture,n=void 0===e?null:e,o=t.textures,s=void 0===o?{}:o;Object.assign(r,{texture:n,textures:s}),i()}})}else i()},e.add=function(){var t=document.createElement("canvas").getContext("webgl");if(t){var r={s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};for(var i in e.textureExtensions=r,e.textureFormats={},r){var n=r[i];n&&Object.assign(e.textureFormats,Object.getPrototypeOf(n))}}},e}();function jo(e,r,i){var n={textures:{},texture:null};return r?(r.map(function(e){return new ri(new Xr(e,Object.assign({mipmap:t.MIPMAP_MODES.OFF,alphaMode:t.ALPHA_MODES.NO_PREMULTIPLIED_ALPHA},i)))}).forEach(function(t,r){var i=t.baseTexture,o=e+"-"+(r+1);Xr.addToCache(i,o),ri.addToCache(t,o),0===r&&(Xr.addToCache(i,e),ri.addToCache(t,e),n.texture=t),n.textures[o]=t}),n):n}t.LoaderResource.setExtensionXhrType("dds",t.LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var Vo,Wo;!function(t){t[t.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",t[t.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",t[t.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",t[t.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",t[t.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",t[t.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",t[t.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",t[t.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",t[t.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",t[t.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",t[t.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",t[t.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",t[t.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",t[t.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",t[t.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",t[t.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",t[t.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",t[t.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",t[t.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",t[t.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",t[t.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",t[t.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",t[t.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",t[t.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",t[t.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",t[t.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",t[t.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",t[t.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",t[t.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",t[t.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",t[t.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",t[t.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",t[t.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",t[t.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",t[t.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",t[t.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",t[t.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",t[t.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",t[t.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",t[t.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",t[t.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",t[t.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",t[t.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",t[t.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",t[t.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",t[t.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",t[t.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",t[t.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",t[t.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",t[t.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",t[t.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",t[t.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",t[t.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",t[t.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",t[t.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",t[t.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",t[t.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",t[t.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",t[t.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",t[t.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",t[t.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",t[t.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",t[t.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",t[t.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",t[t.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",t[t.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",t[t.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",t[t.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",t[t.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",t[t.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",t[t.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",t[t.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",t[t.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",t[t.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",t[t.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",t[t.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",t[t.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",t[t.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",t[t.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",t[t.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",t[t.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",t[t.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",t[t.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",t[t.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",t[t.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",t[t.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",t[t.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",t[t.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",t[t.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",t[t.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",t[t.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",t[t.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",t[t.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",t[t.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",t[t.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",t[t.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",t[t.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",t[t.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",t[t.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",t[t.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",t[t.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",t[t.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",t[t.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",t[t.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",t[t.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",t[t.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",t[t.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",t[t.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",t[t.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",t[t.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",t[t.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",t[t.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"}(Vo||(Vo={})),function(t){t[t.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",t[t.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",t[t.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"}(Wo||(Wo={}));var zo,qo,Ko,Zo=((Go={})[827611204]=t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,Go[861165636]=t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,Go[894720068]=t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,Go),Qo=((Xo={})[Vo.DXGI_FORMAT_BC1_TYPELESS]=t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,Xo[Vo.DXGI_FORMAT_BC1_UNORM]=t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,Xo[Vo.DXGI_FORMAT_BC2_TYPELESS]=t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,Xo[Vo.DXGI_FORMAT_BC2_UNORM]=t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,Xo[Vo.DXGI_FORMAT_BC3_TYPELESS]=t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,Xo[Vo.DXGI_FORMAT_BC3_UNORM]=t.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,Xo[Vo.DXGI_FORMAT_BC1_UNORM_SRGB]=t.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,Xo[Vo.DXGI_FORMAT_BC2_UNORM_SRGB]=t.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,Xo[Vo.DXGI_FORMAT_BC3_UNORM_SRGB]=t.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,Xo),Jo=function(){function t(){}return t.use=function(e,r){if("dds"===e.extension&&e.data)try{Object.assign(e,jo(e.name||e.url,t.parse(e.data),e.metadata))}catch(t){return void r(t)}r()},t.parse=function(t){var e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");var r=new Uint32Array(t,0,124/Uint32Array.BYTES_PER_ELEMENT),i=r[3],n=r[4],o=r[7],s=new Uint32Array(t,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=s[1];if(4&a){var h=s[2];if(808540228!==h){var u=Zo[h],l=new Uint8Array(t,128);return[new Ho(l,{format:u,width:n,height:i,levels:o})]}var c=new Uint32Array(e.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),d=c[0],f=c[1],p=c[2],_=c[3],m=Qo[d];if(void 0===m)throw new Error("DDSLoader cannot parse texture data with DXGI format "+d);if(4===p)throw new Error("DDSLoader does not support cubemap textures");if(f===Wo.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSLoader does not supported 3D texture data");var v=new Array;if(1===_)v.push(new Uint8Array(t,148));else{for(var y=Fo[m],E=0,g=n,T=i,b=0;b<o;b++)E+=Math.max(1,g+3&-4)*Math.max(1,T+3&-4)*y,g>>>=1,T>>>=1;var R=148;for(b=0;b<_;b++)v.push(new Uint8Array(t,R,E)),R+=E}return v.map(function(t){return new Ho(t,{format:m,width:n,height:i,levels:o})})}if(64&a)throw new Error("DDSLoader does not support uncompressed texture data.");if(512&a)throw new Error("DDSLoader does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSLoader does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSLoader does not support single-channel (alpha) texture data!");throw new Error("DDSLoader failed to load a texture file due to an unknown reason!")},t}();t.LoaderResource.setExtensionXhrType("ktx",t.LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var $o=[171,75,84,88,32,49,49,187,13,10,26,10],ts=((zo={})[t.TYPES.UNSIGNED_BYTE]=1,zo[t.TYPES.UNSIGNED_SHORT]=2,zo[t.TYPES.FLOAT]=4,zo[t.TYPES.HALF_FLOAT]=8,zo),es=((qo={})[t.FORMATS.RGBA]=4,qo[t.FORMATS.RGB]=3,qo[t.FORMATS.LUMINANCE]=1,qo[t.FORMATS.LUMINANCE_ALPHA]=2,qo[t.FORMATS.ALPHA]=1,qo),rs=((Ko={})[t.TYPES.UNSIGNED_SHORT_4_4_4_4]=2,Ko[t.TYPES.UNSIGNED_SHORT_5_5_5_1]=2,Ko[t.TYPES.UNSIGNED_SHORT_5_6_5]=2,Ko),is=function(){function t(){}return t.use=function(e,r){if("ktx"===e.extension&&e.data)try{var i=e.name||e.url;Object.assign(e,jo(i,t.parse(i,e.data),e.metadata))}catch(t){return void r(t)}r()},t.parse=function(e,r){var i=new DataView(r);if(!t.validate(e,i))return null;var n=67305985===i.getUint32(12,!0),o=i.getUint32(16,n),s=i.getUint32(24,n),a=i.getUint32(28,n),h=i.getUint32(36,n),u=i.getUint32(40,n)||1,l=i.getUint32(44,n)||1,c=i.getUint32(48,n)||1,d=i.getUint32(52,n),f=i.getUint32(56,n),p=i.getUint32(60,n);if(0===u||1!==l)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==c)throw new Error("WebGL does not support array textures");var _,m=h+3&-4,v=u+3&-4,y=new Array(c),E=h*u;if(0===o&&(E=m*v),void 0===(_=0!==o?ts[o]?ts[o]*es[s]:rs[o]:Fo[a]))throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var g=E*_,T=h,b=u,R=m,x=v,A=64+p,S=0;S<f;S++){for(var O=i.getUint32(A,n),I=A+4,P=0;P<c;P++){var M=y[P];M||(M=y[P]=new Array(f)),M[S]={levelID:S,levelWidth:f>1?T:R,levelHeight:f>1?b:x,levelBuffer:new Uint8Array(r,I,g)},I+=g}A=(A+=O+4)%4!=0?A+4-A%4:A,g=(R=(T=T>>1||1)+4-1&-4)*(x=(b=b>>1||1)+4-1&-4)*_}if(0!==o)throw new Error("TODO: Uncompressed");return y.map(function(t){return new Ho(null,{format:a,width:h,height:u,levels:f,levelBuffers:t})})},t.validate=function(t,e){for(var r=0;r<$o.length;r++)if(e.getUint8(r)!==$o[r])return!1;return!0},t}(),ns=function(t,e){return(ns=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function os(t,e){function r(){this.constructor=t}ns(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var ss=function(e){function r(r,i,n,o){void 0===r&&(r=1500),void 0===n&&(n=16384),void 0===o&&(o=!1);var s=e.call(this)||this;return n>16384&&(n=16384),s._properties=[!1,!0,!1,!1,!1],s._maxSize=r,s._batchSize=n,s._buffers=null,s._bufferUpdateIDs=[],s._updateID=0,s.interactiveChildren=!1,s.blendMode=t.BLEND_MODES.NORMAL,s.autoResize=o,s.roundPixels=!0,s.baseTexture=null,s.setProperties(i),s._tint=0,s.tintRgb=new Float32Array(4),s.tint=16777215,s}return os(r,e),r.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},r.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(r.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,ce(t,this.tintRgb)},enumerable:!1,configurable:!0}),r.prototype.render=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return e.onChildrenChange(0)})),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},r.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},r.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},r}(dr),as=function(){function e(e,r,i){this.geometry=new fi,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<e.length;++n){var o=e[n];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||t.TYPES.FLOAT,offset:o.offset},r[n]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return e.prototype.initBuffers=function(){var e=this.geometry,r=0;this.indexBuffer=new hi(Ee(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i)(a=this.dynamicProperties[i]).offset=r,r+=a.size,this.dynamicStride+=a.size;var n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new hi(this.dynamicData,!1,!1);var o=0;for(this.staticStride=0,i=0;i<this.staticProperties.length;++i)(a=this.staticProperties[i]).offset=o,o+=a.size,this.staticStride+=a.size;var s=new ArrayBuffer(this.size*this.staticStride*4*4);for(this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new hi(this.staticData,!0,!1),i=0;i<this.dynamicProperties.length;++i){var a=this.dynamicProperties[i];e.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===t.TYPES.UNSIGNED_BYTE,a.type,4*this.dynamicStride,4*a.offset)}for(i=0;i<this.staticProperties.length;++i)a=this.staticProperties[i],e.addAttribute(a.attributeName,this.staticBuffer,0,a.type===t.TYPES.UNSIGNED_BYTE,a.type,4*this.staticStride,4*a.offset)},e.prototype.uploadDynamic=function(e,r,i){for(var n=0;n<this.dynamicProperties.length;n++){var o=this.dynamicProperties[n];o.uploadFunction(e,r,i,o.type===t.TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++},e.prototype.uploadStatic=function(e,r,i){for(var n=0;n<this.staticProperties.length;n++){var o=this.staticProperties[n];o.uploadFunction(e,r,i,o.type===t.TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++},e.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},e}(),hs="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",us="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n",ls=function(e){function r(r){var i=e.call(this,r)||this;return i.shader=null,i.properties=null,i.tempMatrix=new Ze,i.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:i.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:i.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:i.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:i.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:t.TYPES.UNSIGNED_BYTE,uploadFunction:i.uploadTint,offset:0}],i.shader=rn.from(us,hs,{}),i.state=nn.for2d(),i}return os(r,e),r.prototype.render=function(t){var e=t.children,r=t._maxSize,i=t._batchSize,n=this.renderer,o=e.length;if(0!==o){o>r&&!t.autoResize&&(o=r);var s=t._buffers;s||(s=t._buffers=this.generateBuffers(t));var a=e[0]._texture.baseTexture;this.state.blendMode=_e(t.blendMode,a.alphaMode),n.state.set(this.state);var h=n.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=me(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,a.alphaMode),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);for(var l=!1,c=0,d=0;c<o;c+=i,d+=1){var f=o-c;f>i&&(f=i),d>=s.length&&s.push(this._generateOneMoreBuffer(t));var p=s[d];p.uploadDynamic(e,c,f);var _=t._bufferUpdateIDs[d]||0;(l=l||p._updateID<_)&&(p._updateID=t._updateID,p.uploadStatic(e,c,f)),n.geometry.bind(p.geometry),h.drawElements(h.TRIANGLES,6*f,h.UNSIGNED_SHORT,0)}}},r.prototype.generateBuffers=function(t){for(var e=[],r=t._maxSize,i=t._batchSize,n=t._properties,o=0;o<r;o+=i)e.push(new as(this.properties,n,i));return e},r.prototype._generateOneMoreBuffer=function(t){var e=t._batchSize,r=t._properties;return new as(this.properties,r,e)},r.prototype.uploadVertices=function(t,e,r,i,n,o){for(var s=0,a=0,h=0,u=0,l=0;l<r;++l){var c=t[e+l],d=c._texture,f=c.scale.x,p=c.scale.y,_=d.trim,m=d.orig;_?(s=(a=_.x-c.anchor.x*m.width)+_.width,h=(u=_.y-c.anchor.y*m.height)+_.height):(s=m.width*(1-c.anchor.x),a=m.width*-c.anchor.x,h=m.height*(1-c.anchor.y),u=m.height*-c.anchor.y),i[o]=a*f,i[o+1]=u*p,i[o+n]=s*f,i[o+n+1]=u*p,i[o+2*n]=s*f,i[o+2*n+1]=h*p,i[o+3*n]=a*f,i[o+3*n+1]=h*p,o+=4*n}},r.prototype.uploadPosition=function(t,e,r,i,n,o){for(var s=0;s<r;s++){var a=t[e+s].position;i[o]=a.x,i[o+1]=a.y,i[o+n]=a.x,i[o+n+1]=a.y,i[o+2*n]=a.x,i[o+2*n+1]=a.y,i[o+3*n]=a.x,i[o+3*n+1]=a.y,o+=4*n}},r.prototype.uploadRotation=function(t,e,r,i,n,o){for(var s=0;s<r;s++){var a=t[e+s].rotation;i[o]=a,i[o+n]=a,i[o+2*n]=a,i[o+3*n]=a,o+=4*n}},r.prototype.uploadUvs=function(t,e,r,i,n,o){for(var s=0;s<r;++s){var a=t[e+s]._texture._uvs;a?(i[o]=a.x0,i[o+1]=a.y0,i[o+n]=a.x1,i[o+n+1]=a.y1,i[o+2*n]=a.x2,i[o+2*n+1]=a.y2,i[o+3*n]=a.x3,i[o+3*n+1]=a.y3,o+=4*n):(i[o]=0,i[o+1]=0,i[o+n]=0,i[o+n+1]=0,i[o+2*n]=0,i[o+2*n+1]=0,i[o+3*n]=0,i[o+3*n+1]=0,o+=4*n)}},r.prototype.uploadTint=function(t,e,r,i,n,o){for(var s=0;s<r;++s){var a=t[e+s],h=a._texture.baseTexture.alphaMode>0,u=a.alpha,l=u<1&&h?ve(a._tintRGB,u):a._tintRGB+(255*u<<24);i[o]=l,i[o+n]=l,i[o+2*n]=l,i[o+3*n]=l,o+=4*n}},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},r}(bi);!function(t){t.MITER="miter",t.BEVEL="bevel",t.ROUND="round"}(t.LINE_JOIN||(t.LINE_JOIN={})),function(t){t.BUTT="butt",t.ROUND="round",t.SQUARE="square"}(t.LINE_CAP||(t.LINE_CAP={}));var cs={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive||!t||isNaN(t))return e;var r=Math.ceil(t/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}},ds=function(){function t(){this.color=16777215,this.alpha=1,this.texture=ri.WHITE,this.matrix=null,this.visible=!1,this.reset()}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},t.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=ri.WHITE,this.matrix=null,this.visible=!1},t.prototype.destroy=function(){this.texture=null,this.matrix=null},t}(),fs=function(t,e){return(fs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function ps(t,e){function r(){this.constructor=t}fs(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var _s={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var r=t.points,i=t.holes,n=e.points,o=e.indices;if(r.length>=6){for(var s=[],a=0;a<i.length;a++){var h=i[a];s.push(r.length/2),r=r.concat(h.points)}var u=st(r,s,2);if(!u)return;var l=n.length/2;for(a=0;a<u.length;a+=3)o.push(u[a]+l),o.push(u[a+1]+l),o.push(u[a+2]+l);for(a=0;a<r.length;a++)n.push(r[a])}}},ms={build:function(e){var r,i,n=e.shape,o=e.points,s=n.x,a=n.y;if(o.length=0,e.type===t.SHAPES.CIRC)r=n.radius,i=n.radius;else{var h=e.shape;r=h.width,i=h.height}if(0!==r&&0!==i){var u=Math.floor(30*Math.sqrt(n.radius))||Math.floor(15*Math.sqrt(r+i));u/=2.3;for(var l=2*Math.PI/u,c=0;c<u-.5;c++)o.push(s+Math.sin(-l*c)*r,a+Math.cos(-l*c)*i);o.push(o[0],o[1])}},triangulate:function(t,e){var r=t.points,i=e.points,n=e.indices,o=i.length/2,s=o,a=t.shape,h=t.matrix,u=a.x,l=a.y;i.push(t.matrix?h.a*u+h.c*l+h.tx:u,t.matrix?h.b*u+h.d*l+h.ty:l);for(var c=0;c<r.length;c+=2)i.push(r[c],r[c+1]),n.push(o++,s,o)}},vs={build:function(t){var e=t.shape,r=e.x,i=e.y,n=e.width,o=e.height,s=t.points;s.length=0,s.push(r,i,r+n,i,r+n,i+o,r,i+o)},triangulate:function(t,e){var r=t.points,i=e.points,n=i.length/2;i.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}};function ys(t,e,r){return t+(e-t)*r}function Es(t,e,r,i,n,o,s){void 0===s&&(s=[]);for(var a=s,h=0,u=0,l=0,c=0,d=0,f=0,p=0,_=0;p<=20;++p)h=ys(t,r,_=p/20),u=ys(e,i,_),l=ys(r,n,_),c=ys(i,o,_),d=ys(h,l,_),f=ys(u,c,_),0===p&&a[a.length-2]===d&&a[a.length-1]===f||a.push(d,f);return a}var gs={build:function(t){var e=t.shape,r=t.points,i=e.x,n=e.y,o=e.width,s=e.height,a=Math.max(0,Math.min(e.radius,Math.min(o,s)/2));r.length=0,a?(Es(i,n+a,i,n,i+a,n,r),Es(i+o-a,n,i+o,n,i+o,n+a,r),Es(i+o,n+s-a,i+o,n+s,i+o-a,n+s,r),Es(i+a,n+s,i,n+s,i,n+s-a,r)):r.push(i,n,i+o,n,i+o,n+s,i,n+s)},triangulate:function(t,e){for(var r=t.points,i=e.points,n=e.indices,o=i.length/2,s=st(r,null,2),a=0,h=s.length;a<h;a+=3)n.push(s[a]+o),n.push(s[a+1]+o),n.push(s[a+2]+o);for(a=0,h=r.length;a<h;a++)i.push(r[a],r[++a])}};function Ts(t,e,r,i,n,o,s,a){var h,u;s?(h=i,u=-r):(h=-i,u=r);var l=t-r*n+h,c=e-i*n+u,d=t+r*o+h,f=e+i*o+u;return a.push(l,c),a.push(d,f),2}function bs(t,e,r,i,n,o,s,a){var h=r-t,u=i-e,l=Math.atan2(h,u),c=Math.atan2(n-t,o-e);a&&l<c?l+=2*Math.PI:!a&&l>c&&(c+=2*Math.PI);var d=l,f=c-l,p=Math.abs(f),_=Math.sqrt(h*h+u*u),m=1+(15*p*Math.sqrt(_)/Math.PI>>0),v=f/m;if(d+=v,a){s.push(t,e),s.push(r,i);for(var y=1,E=d;y<m;y++,E+=v)s.push(t,e),s.push(t+Math.sin(E)*_,e+Math.cos(E)*_);s.push(t,e),s.push(n,o)}else{for(s.push(r,i),s.push(t,e),y=1,E=d;y<m;y++,E+=v)s.push(t+Math.sin(E)*_,e+Math.cos(E)*_),s.push(t,e);s.push(n,o),s.push(t,e)}return 2*m}function Rs(e,r){e.lineStyle.native?function(e,r){var i=0,n=e.shape,o=e.points||n.points,s=n.type!==t.SHAPES.POLY||n.closeStroke;if(0!==o.length){var a=r.points,h=r.indices,u=o.length/2,l=a.length/2,c=l;for(a.push(o[0],o[1]),i=1;i<u;i++)a.push(o[2*i],o[2*i+1]),h.push(c,c+1),c++;s&&h.push(c,l)}}(e,r):function(e,r){var i=e.shape,n=e.points||i.points.slice(),o=r.closePointEps;if(0!==n.length){var s=e.lineStyle,a=new qe(n[0],n[1]),h=new qe(n[n.length-2],n[n.length-1]),u=i.type!==t.SHAPES.POLY||i.closeStroke,l=Math.abs(a.x-h.x)<o&&Math.abs(a.y-h.y)<o;if(u){n=n.slice(),l&&(n.pop(),n.pop(),h.set(n[n.length-2],n[n.length-1]));var c=.5*(a.x+h.x),d=.5*(h.y+a.y);n.unshift(c,d),n.push(c,d)}var f=r.points,p=n.length/2,_=n.length,m=f.length/2,v=s.width/2,y=v*v,E=s.miterLimit*s.miterLimit,g=n[0],T=n[1],b=n[2],R=n[3],x=0,A=0,S=-(T-R),O=g-b,I=0,P=0,M=Math.sqrt(S*S+O*O);S/=M,O/=M,S*=v,O*=v;var D=s.alignment,N=2*(1-D),w=2*D;u||(s.cap===t.LINE_CAP.ROUND?_+=bs(g-S*(N-w)*.5,T-O*(N-w)*.5,g-S*N,T-O*N,g+S*w,T+O*w,f,!0)+2:s.cap===t.LINE_CAP.SQUARE&&(_+=Ts(g,T,S,O,N,w,!0,f))),f.push(g-S*N,T-O*N),f.push(g+S*w,T+O*w);for(var C=1;C<p-1;++C){g=n[2*(C-1)],T=n[2*(C-1)+1],b=n[2*C],R=n[2*C+1],x=n[2*(C+1)],A=n[2*(C+1)+1],S=-(T-R),O=g-b,S/=M=Math.sqrt(S*S+O*O),O/=M,S*=v,O*=v,I=-(R-A),P=b-x,I/=M=Math.sqrt(I*I+P*P),P/=M,I*=v,P*=v;var L=b-g,F=T-R,U=b-x,B=A-R,G=F*U-B*L,X=G<0;if(Math.abs(G)<.1)f.push(b-S*N,R-O*N),f.push(b+S*w,R+O*w);else{var k=(-S+g)*(-O+R)-(-S+b)*(-O+T),H=(-I+x)*(-P+R)-(-I+b)*(-P+A),Y=(L*H-U*k)/G,j=(B*k-F*H)/G,V=(Y-b)*(Y-b)+(j-R)*(j-R),W=b+(Y-b)*N,z=R+(j-R)*N,q=b-(Y-b)*w,K=R-(j-R)*w,Z=X?N:w;V<=Math.min(L*L+F*F,U*U+B*B)+Z*Z*y?s.join===t.LINE_JOIN.BEVEL||V/y>E?(X?(f.push(W,z),f.push(b+S*w,R+O*w),f.push(W,z),f.push(b+I*w,R+P*w)):(f.push(b-S*N,R-O*N),f.push(q,K),f.push(b-I*N,R-P*N),f.push(q,K)),_+=2):s.join===t.LINE_JOIN.ROUND?X?(f.push(W,z),f.push(b+S*w,R+O*w),_+=bs(b,R,b+S*w,R+O*w,b+I*w,R+P*w,f,!0)+4,f.push(W,z),f.push(b+I*w,R+P*w)):(f.push(b-S*N,R-O*N),f.push(q,K),_+=bs(b,R,b-S*N,R-O*N,b-I*N,R-P*N,f,!1)+4,f.push(b-I*N,R-P*N),f.push(q,K)):(f.push(W,z),f.push(q,K)):(f.push(b-S*N,R-O*N),f.push(b+S*w,R+O*w),s.join===t.LINE_JOIN.BEVEL||V/y>E||(s.join===t.LINE_JOIN.ROUND?_+=X?bs(b,R,b+S*w,R+O*w,b+I*w,R+P*w,f,!0)+2:bs(b,R,b-S*N,R-O*N,b-I*N,R-P*N,f,!1)+2:(X?(f.push(q,K),f.push(q,K)):(f.push(W,z),f.push(W,z)),_+=2)),f.push(b-I*N,R-P*N),f.push(b+I*w,R+P*w),_+=2)}}g=n[2*(p-2)],T=n[2*(p-2)+1],b=n[2*(p-1)],S=-(T-(R=n[2*(p-1)+1])),O=g-b,S/=M=Math.sqrt(S*S+O*O),O/=M,S*=v,O*=v,f.push(b-S*N,R-O*N),f.push(b+S*w,R+O*w),u||(s.cap===t.LINE_CAP.ROUND?_+=bs(b-S*(N-w)*.5,R-O*(N-w)*.5,b-S*N,R-O*N,b+S*w,R+O*w,f,!1)+2:s.cap===t.LINE_CAP.SQUARE&&(_+=Ts(b,R,S,O,N,w,!1,f)));var Q=r.indices,J=cs.epsilon*cs.epsilon;for(C=m;C<_+m-2;++C)g=f[2*C],T=f[2*C+1],b=f[2*(C+1)],R=f[2*(C+1)+1],x=f[2*(C+2)],A=f[2*(C+2)+1],Math.abs(g*(R-A)+b*(A-T)+x*(T-R))<J||Q.push(C,C+1,C+2)}}(e,r)}var xs,As=function(){function t(){}return t.curveTo=function(t,e,r,i,n,o){var s=o[o.length-2],a=o[o.length-1]-e,h=s-t,u=i-e,l=r-t,c=Math.abs(a*l-h*u);if(c<1e-8||0===n)return o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e),null;var d=a*a+h*h,f=u*u+l*l,p=a*u+h*l,_=n*Math.sqrt(d)/c,m=n*Math.sqrt(f)/c,v=_*p/d,y=m*p/f,E=_*l+m*h,g=_*u+m*a,T=h*(m+v),b=a*(m+v),R=l*(_+y),x=u*(_+y);return{cx:E+t,cy:g+e,radius:n,startAngle:Math.atan2(b-g,T-E),endAngle:Math.atan2(x-g,R-E),anticlockwise:h*u>l*a}},t.arc=function(t,e,r,i,n,o,s,a,h){for(var u=s-o,l=cs._segmentsCount(Math.abs(u)*n,40*Math.ceil(Math.abs(u)/Xe)),c=u/(2*l),d=2*c,f=Math.cos(c),p=Math.sin(c),_=l-1,m=_%1/_,v=0;v<=_;++v){var y=c+o+d*(v+m*v),E=Math.cos(y),g=-Math.sin(y);h.push((f*E+p*g)*n+r,(f*-g+p*E)*n+i)}},t}(),Ss=function(){function t(){}return t.curveLength=function(t,e,r,i,n,o,s,a){for(var h=0,u=0,l=0,c=0,d=0,f=0,p=0,_=0,m=0,v=0,y=0,E=t,g=e,T=1;T<=10;++T)v=E-(_=(p=(f=(d=1-(u=T/10))*d)*d)*t+3*f*u*r+3*d*(l=u*u)*n+(c=l*u)*s),y=g-(m=p*e+3*f*u*i+3*d*l*o+c*a),E=_,g=m,h+=Math.sqrt(v*v+y*y);return h},t.curveTo=function(e,r,i,n,o,s,a){var h=a[a.length-2],u=a[a.length-1];a.length-=2;var l=cs._segmentsCount(t.curveLength(h,u,e,r,i,n,o,s)),c=0,d=0,f=0,p=0,_=0;a.push(h,u);for(var m=1,v=0;m<=l;++m)f=(d=(c=1-(v=m/l))*c)*c,_=(p=v*v)*v,a.push(f*h+3*d*v*e+3*c*p*i+_*o,f*u+3*d*v*r+3*c*p*n+_*s)},t}(),Os=function(){function t(){}return t.curveLength=function(t,e,r,i,n,o){var s=t-2*r+n,a=e-2*i+o,h=2*r-2*t,u=2*i-2*e,l=4*(s*s+a*a),c=4*(s*h+a*u),d=h*h+u*u,f=2*Math.sqrt(l+c+d),p=Math.sqrt(l),_=2*l*p,m=2*Math.sqrt(d),v=c/p;return(_*f+p*c*(f-m)+(4*d*l-c*c)*Math.log((2*p+v+f)/(v+m)))/(4*_)},t.curveTo=function(e,r,i,n,o){for(var s=o[o.length-2],a=o[o.length-1],h=cs._segmentsCount(t.curveLength(s,a,e,r,i,n)),u=0,l=0,c=1;c<=h;++c){var d=c/h;u=s+(e-s)*d,l=a+(r-a)*d,o.push(u+(e+(i-e)*d-u)*d,l+(r+(n-r)*d-l)*d)}},t}(),Is=function(){function t(){this.reset()}return t.prototype.begin=function(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r},t.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},t.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},t}(),Ps=((xs={})[t.SHAPES.POLY]=_s,xs[t.SHAPES.CIRC]=ms,xs[t.SHAPES.ELIP]=ms,xs[t.SHAPES.RECT]=vs,xs[t.SHAPES.RREC]=gs,xs),Ms=[],Ds=[];function Ns(t){for(var e=t.points,r=0,i=0;i<e.length-2;i+=2)r+=(e[i+2]-e[i])*(e[i+3]+e[i+1]);return r>0}var ws=function(){function t(t,e,r,i){void 0===e&&(e=null),void 0===r&&(r=null),void 0===i&&(i=null),this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=i,this.type=t.type}return t.prototype.clone=function(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)},t.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},t}(),Cs=new qe,Ls=new sr,Fs=function(e){function r(){var t=e.call(this)||this;return t.closePointEps=1e-4,t.boundsPadding=0,t.uvsFloat32=null,t.indicesUint16=null,t.batchable=!1,t.points=[],t.colors=[],t.uvs=[],t.indices=[],t.textureIds=[],t.graphicsData=[],t.drawCalls=[],t.batchDirty=-1,t.batches=[],t.dirty=0,t.cacheDirty=-1,t.clearDirty=0,t.shapeIndex=0,t._bounds=new sr,t.boundsDirty=-1,t}return ps(r,e),Object.defineProperty(r.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),r.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Ds.push(this.drawCalls[t]);for(this.drawCalls.length=0,t=0;t<this.batches.length;t++){var e=this.batches[t];e.reset(),Ms.push(e)}this.batches.length=0},r.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},r.prototype.drawShape=function(t,e,r,i){void 0===e&&(e=null),void 0===r&&(r=null),void 0===i&&(i=null);var n=new ws(t,e,r,i);return this.graphicsData.push(n),this.dirty++,this},r.prototype.drawHole=function(t,e){if(void 0===e&&(e=null),!this.graphicsData.length)return null;var r=new ws(t,null,null,e),i=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=i.lineStyle,i.holes.push(r),this.dirty++,this},r.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},r.prototype.containsPoint=function(t){for(var e=this.graphicsData,r=0;r<e.length;++r){var i=e[r];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(t,Cs):Cs.copyFrom(t),i.shape.contains(Cs.x,Cs.y))){var n=!1;if(i.holes)for(var o=0;o<i.holes.length;o++)if(i.holes[o].shape.contains(Cs.x,Cs.y)){n=!0;break}if(!n)return!0}}return!1},r.prototype.updateBatches=function(e){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var r=this.uvs,i=this.graphicsData,n=null,o=null;this.batches.length>0&&(o=(n=this.batches[this.batches.length-1]).style);for(var s=this.shapeIndex;s<i.length;s++){this.shapeIndex++;var a=i[s],h=a.fillStyle,u=a.lineStyle;Ps[a.type].build(a),a.matrix&&this.transformPoints(a.points,a.matrix);for(var l=0;l<2;l++){var c=0===l?h:u;if(c.visible){var d=c.texture.baseTexture,f=this.indices.length,p=this.points.length/2;d.wrapMode=t.WRAP_MODES.REPEAT,0===l?this.processFill(a):this.processLine(a);var _=this.points.length/2-p;0!==_&&(n&&!this._compareStyles(o,c)&&(n.end(f,p),n=null),n||((n=Ms.pop()||new Is).begin(c,f,p),this.batches.push(n),o=c),this.addUvs(this.points,r,c.texture,p,_,c.matrix))}}}var m=this.indices.length,v=this.points.length/2;if(n&&n.end(m,v),0!==this.batches.length){if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var y=v>65535&&e;this.indicesUint16=y?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}else this.batchable=!0}}else this.batchable=!0},r.prototype._compareStyles=function(t,e){return!(!t||!e)&&t.texture.baseTexture===e.texture.baseTexture&&t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native},r.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var r=this.graphicsData[t],i=r.fillStyle,n=r.lineStyle;if(i&&!i.texture.baseTexture.valid)return!1;if(n&&!n.texture.baseTexture.valid)return!1}return!0},r.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,r=t.length;e<r;e++)for(var i=t[e],n=0;n<i.size;n++){var o=i.start+n;this.indicesUint16[o]=this.indicesUint16[o]-i.attribStart}},r.prototype.isBatchable=function(){if(this.points.length>131070)return!1;for(var t=this.batches,e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*r.BATCHABLE_SIZE},r.prototype.buildDrawCalls=function(){for(var e=++Xr._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),Ds.push(this.drawCalls[r]);this.drawCalls.length=0;var i=this.colors,n=this.textureIds,o=Ds.pop();o||((o=new Qn).texArray=new Jn),o.texArray.count=0,o.start=0,o.size=0,o.type=t.DRAW_MODES.TRIANGLES;var s=0,a=null,h=0,u=!1,l=t.DRAW_MODES.TRIANGLES,c=0;for(this.drawCalls.push(o),r=0;r<this.batches.length;r++){var d=this.batches[r],f=d.style,p=f.texture.baseTexture;u!==!!f.native&&(l=(u=!!f.native)?t.DRAW_MODES.LINES:t.DRAW_MODES.TRIANGLES,a=null,s=8,e++),a!==p&&(a=p,p._batchEnabled!==e&&(8===s&&(e++,s=0,o.size>0&&((o=Ds.pop())||((o=new Qn).texArray=new Jn),this.drawCalls.push(o)),o.start=c,o.size=0,o.texArray.count=0,o.type=l),p.touched=1,p._batchEnabled=e,p._batchLocation=s,p.wrapMode=t.WRAP_MODES.REPEAT,o.texArray.elements[o.texArray.count++]=p,s++)),o.size+=d.size,c+=d.size,h=p._batchLocation,this.addColors(i,f.color,f.alpha,d.attribSize,d.attribStart),this.addTextureIds(n,h,d.attribSize,d.attribStart)}Xr._globalBatch=e,this.packAttributes()},r.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,r=this.colors,i=this.textureIds,n=new ArrayBuffer(3*t.length*4),o=new Float32Array(n),s=new Uint32Array(n),a=0,h=0;h<t.length/2;h++)o[a++]=t[2*h],o[a++]=t[2*h+1],o[a++]=e[2*h],o[a++]=e[2*h+1],s[a++]=r[h],o[a++]=i[h];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)},r.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),_s.triangulate(t,this)):Ps[t.type].triangulate(t,this)},r.prototype.processLine=function(t){Rs(t,this);for(var e=0;e<t.holes.length;e++)Rs(t.holes[e],this)},r.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var r=t[e];Ps[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}},r.prototype.calculateBounds=function(){var e=this._bounds,r=Ls,i=Ze.IDENTITY;this._bounds.clear(),r.clear();for(var n=0;n<this.graphicsData.length;n++){var o=this.graphicsData[n],s=o.shape,a=o.type,h=o.lineStyle,u=o.matrix||Ze.IDENTITY,l=0;if(h&&h.visible){var c=h.alignment;l=h.width,a===t.SHAPES.POLY?Ns(s)?l*=1-c:l*=c:l*=Math.max(0,c)}if(i!==u&&(r.isEmpty()||(e.addBoundsMatrix(r,i),r.clear()),i=u),a===t.SHAPES.RECT||a===t.SHAPES.RREC){var d=s;r.addFramePad(d.x,d.y,d.x+d.width,d.y+d.height,l,l)}else if(a===t.SHAPES.CIRC){var f=s;r.addFramePad(f.x,f.y,f.x,f.y,f.radius+l,f.radius+l)}else if(a===t.SHAPES.ELIP){var p=s;r.addFramePad(p.x,p.y,p.x,p.y,p.width+l,p.height+l)}else{var _=s;e.addVerticesMatrix(i,_.points,0,_.points.length,l,l)}}r.isEmpty()||e.addBoundsMatrix(r,i),e.pad(this.boundsPadding,this.boundsPadding)},r.prototype.transformPoints=function(t,e){for(var r=0;r<t.length/2;r++){var i=t[2*r],n=t[2*r+1];t[2*r]=e.a*i+e.c*n+e.tx,t[2*r+1]=e.b*i+e.d*n+e.ty}},r.prototype.addColors=function(t,e,r,i,n){void 0===n&&(n=0);var o=ve((e>>16)+(65280&e)+((255&e)<<16),r);t.length=Math.max(t.length,n+i);for(var s=0;s<i;s++)t[n+s]=o},r.prototype.addTextureIds=function(t,e,r,i){void 0===i&&(i=0),t.length=Math.max(t.length,i+r);for(var n=0;n<r;n++)t[i+n]=e},r.prototype.addUvs=function(t,e,r,i,n,o){void 0===o&&(o=null);for(var s=0,a=e.length,h=r.frame;s<n;){var u=t[2*(i+s)],l=t[2*(i+s)+1];if(o){var c=o.a*u+o.c*l+o.tx;l=o.b*u+o.d*l+o.ty,u=c}s++,e.push(u/h.width,l/h.height)}var d=r.baseTexture;(h.width<d.width||h.height<d.height)&&this.adjustUvs(e,r,a,n)},r.prototype.adjustUvs=function(t,e,r,i){for(var n=e.baseTexture,o=r+2*i,s=e.frame,a=s.width/n.width,h=s.height/n.height,u=s.x/s.width,l=s.y/s.height,c=Math.floor(t[r]+1e-6),d=Math.floor(t[r+1]+1e-6),f=r+2;f<o;f+=2)c=Math.min(c,Math.floor(t[f]+1e-6)),d=Math.min(d,Math.floor(t[f+1]+1e-6));for(u-=c,l-=d,f=r;f<o;f+=2)t[f]=(t[f]+u)*a,t[f+1]=(t[f+1]+l)*h},r.BATCHABLE_SIZE=100,r}(ro),Us=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.width=0,r.alignment=.5,r.native=!1,r.cap=t.LINE_CAP.BUTT,r.join=t.LINE_JOIN.MITER,r.miterLimit=10,r}return ps(r,e),r.prototype.clone=function(){var t=new r;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},r.prototype.reset=function(){e.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},r}(ds),Bs=new Float32Array(3),Gs={},Xs=function(e){function r(r){void 0===r&&(r=null);var i=e.call(this)||this;return i.shader=null,i.pluginName="batch",i.currentPath=null,i.batches=[],i.batchTint=-1,i.batchDirty=-1,i.vertexData=null,i._fillStyle=new ds,i._lineStyle=new Us,i._matrix=null,i._holeMode=!1,i.state=nn.for2d(),i._geometry=r||new Fs,i._geometry.refCount++,i._transformID=-1,i.tint=16777215,i.blendMode=t.BLEND_MODES.NORMAL,i}return ps(r,e),Object.defineProperty(r.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),r.prototype.clone=function(){return this.finishPoly(),new r(this._geometry)},Object.defineProperty(r.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),r.prototype.lineStyle=function(t,e,r,i,n){return void 0===t&&(t=null),void 0===e&&(e=0),void 0===r&&(r=1),void 0===i&&(i=.5),void 0===n&&(n=!1),"number"==typeof t&&(t={width:t,color:e,alpha:r,alignment:i,native:n}),this.lineTextureStyle(t)},r.prototype.lineTextureStyle=function(e){e=Object.assign({width:0,texture:ri.WHITE,color:e&&e.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:t.LINE_CAP.BUTT,join:t.LINE_JOIN.MITER,miterLimit:10},e),this.currentPath&&this.startPoly();var r=e.width>0&&e.alpha>0;return r?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:r},e)):this._lineStyle.reset(),this},r.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new We,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new We,this.currentPath.closeStroke=!1},r.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},r.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},r.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var r=this.currentPath.points,i=r[r.length-2],n=r[r.length-1];return i===t&&n===e||r.push(t,e),this},r.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},r.prototype.quadraticCurveTo=function(t,e,r,i){this._initCurve();var n=this.currentPath.points;return 0===n.length&&this.moveTo(0,0),Os.curveTo(t,e,r,i,n),this},r.prototype.bezierCurveTo=function(t,e,r,i,n,o){return this._initCurve(),Ss.curveTo(t,e,r,i,n,o,this.currentPath.points),this},r.prototype.arcTo=function(t,e,r,i,n){this._initCurve(t,e);var o=this.currentPath.points,s=As.curveTo(t,e,r,i,n,o);if(s){var a=s.cx,h=s.cy,u=s.radius,l=s.startAngle,c=s.endAngle,d=s.anticlockwise;this.arc(a,h,u,l,c,d)}return this},r.prototype.arc=function(t,e,r,i,n,o){if(void 0===o&&(o=!1),i===n)return this;if(!o&&n<=i?n+=Xe:o&&i<=n&&(i+=Xe),0==n-i)return this;var s=t+Math.cos(i)*r,a=e+Math.sin(i)*r,h=this._geometry.closePointEps,u=this.currentPath?this.currentPath.points:null;if(u){var l=Math.abs(u[u.length-2]-s),c=Math.abs(u[u.length-1]-a);l<h&&c<h||u.push(s,a)}else this.moveTo(s,a),u=this.currentPath.points;return As.arc(s,a,t,e,r,i,n,o,u),this},r.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:ri.WHITE,color:t,alpha:e})},r.prototype.beginTextureFill=function(t){t=Object.assign({texture:ri.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var e=t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:e},t)):this._fillStyle.reset(),this},r.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},r.prototype.drawRect=function(t,e,r,i){return this.drawShape(new Ye(t,e,r,i))},r.prototype.drawRoundedRect=function(t,e,r,i,n){return this.drawShape(new ze(t,e,r,i,n))},r.prototype.drawCircle=function(t,e,r){return this.drawShape(new je(t,e,r))},r.prototype.drawEllipse=function(t,e,r,i){return this.drawShape(new Ve(t,e,r,i))},r.prototype.drawPolygon=function(){for(var t,e=arguments,r=[],i=0;i<arguments.length;i++)r[i]=e[i];var n=!0,o=r[0];o.points?(n=o.closeStroke,t=o.points):t=Array.isArray(r[0])?r[0]:r;var s=new We(t);return s.closeStroke=n,this.drawShape(s),this},r.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},r.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},r.prototype.isFastRect=function(){var e=this._geometry.graphicsData;return!(1!==e.length||e[0].shape.type!==t.SHAPES.RECT||e[0].holes.length||e[0].lineStyle.visible&&e[0].lineStyle.width)},r.prototype._render=function(t){this.finishPoly();var e=this._geometry,r=t.context.supports.uint32Indices;e.updateBatches(r),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},r.prototype._populateBatches=function(){var t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(var i=0;i<r;i++){var n=t.batches[i],o=n.style.color,s=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),a=new Float32Array(t.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),h={vertexData:s,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*n.start,n.size),uvs:a,_batchRGB:ce(o),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[i]=h}},r.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,r=this.batches.length;e<r;e++){var i=this.batches[e];i.worldAlpha=this.worldAlpha*i.alpha,t.plugins[this.pluginName].render(i)}}},r.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),r=this._geometry,i=this.tint,n=this.worldAlpha,o=e.uniforms,s=r.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(i>>16&255)/255*n,o.tint[1]=(i>>8&255)/255*n,o.tint[2]=(255&i)/255*n,o.tint[3]=n,t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(var a=0,h=s.length;a<h;a++)this._renderDrawCallDirect(t,r.drawCalls[a])},r.prototype._renderDrawCallDirect=function(t,e){for(var r=e.texArray,i=e.type,n=e.size,o=e.start,s=r.count,a=0;a<s;a++)t.texture.bind(r.elements[a],a);t.geometry.draw(i,n,o)},r.prototype._resolveDirectShader=function(t){var e=this.shader,r=this.pluginName;if(!e){if(!Gs[r]){for(var i=t.plugins.batch.MAX_TEXTURES,n=new Int32Array(i),o=0;o<i;o++)n[o]=o;var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ze,default:vi.from({uSamplers:n},!0)},a=t.plugins[r]._shader.program;Gs[r]=new rn(a,s)}e=Gs[r]}return e},r.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var e=t.bounds,r=e.minX,i=e.minY,n=e.maxX,o=e.maxY;this._bounds.addFrame(this.transform,r,i,n,o)}},r.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,r._TEMP_POINT),this._geometry.containsPoint(r._TEMP_POINT)},r.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=ce(this.tint,Bs),e=0;e<this.batches.length;e++){var r=this.batches[e],i=r._batchRGB,n=(t[0]*i[0]*255<<16)+(t[1]*i[1]*255<<8)+(0|t[2]*i[2]*255);r._tintRGB=(n>>16)+(65280&n)+((255&n)<<16)}}},r.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var e=this.transform.worldTransform,r=e.a,i=e.b,n=e.c,o=e.d,s=e.tx,a=e.ty,h=this._geometry.points,u=this.vertexData,l=0,c=0;c<h.length;c+=2){var d=h[c],f=h[c+1];u[l++]=r*d+n*f+s,u[l++]=o*f+i*d+a}}},r.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this},r.prototype.setMatrix=function(t){return this._matrix=t,this},r.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},r.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},r.prototype.destroy=function(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,e.prototype.destroy.call(this,t)},r._TEMP_POINT=new qe,r}(dr),ks={buildPoly:_s,buildCircle:ms,buildRectangle:vs,buildRoundedRectangle:gs,buildLine:Rs,ArcUtils:As,BezierUtils:Ss,QuadraticUtils:Os,BatchPart:Is,FILL_COMMANDS:Ps,BATCH_POOL:Ms,DRAW_CALL_POOL:Ds},Hs=function(t,e){return(Hs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},Ys=new qe,js=new Uint16Array([0,1,2,0,2,3]),Vs=function(e){function r(r){var i=e.call(this)||this;return i._anchor=new Ke(i._onAnchorUpdate,i,r?r.defaultAnchor.x:0,r?r.defaultAnchor.y:0),i._texture=null,i._width=0,i._height=0,i._tint=null,i._tintRGB=null,i.tint=16777215,i.blendMode=t.BLEND_MODES.NORMAL,i._cachedTint=16777215,i.uvs=null,i.texture=r||ri.EMPTY,i.vertexData=new Float32Array(8),i.vertexTrimmedData=null,i._transformID=-1,i._textureID=-1,i._transformTrimmedID=-1,i._textureTrimmedID=-1,i.indices=js,i.pluginName="batch",i.isSprite=!0,i._roundPixels=rt.ROUND_PIXELS,i}return function(t,e){function r(){this.constructor=t}Hs(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,e),r.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Se(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Se(this.scale.y)*this._height/this._texture.orig.height)},r.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},r.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,r=e.a,i=e.b,n=e.c,o=e.d,s=e.tx,a=e.ty,h=this.vertexData,u=t.trim,l=t.orig,c=this._anchor,d=0,f=0,p=0,_=0;if(u?(d=(f=u.x-c._x*l.width)+u.width,p=(_=u.y-c._y*l.height)+u.height):(d=(f=-c._x*l.width)+l.width,p=(_=-c._y*l.height)+l.height),h[0]=r*f+n*_+s,h[1]=o*_+i*f+a,h[2]=r*d+n*_+s,h[3]=o*_+i*d+a,h[4]=r*d+n*p+s,h[5]=o*p+i*d+a,h[6]=r*f+n*p+s,h[7]=o*p+i*f+a,this._roundPixels)for(var m=rt.RESOLUTION,v=0;v<h.length;++v)h[v]=Math.round((h[v]*m|0)/m)}},r.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,r=t.orig,i=this._anchor,n=this.transform.worldTransform,o=n.a,s=n.b,a=n.c,h=n.d,u=n.tx,l=n.ty,c=-i._x*r.width,d=c+r.width,f=-i._y*r.height,p=f+r.height;e[0]=o*c+a*f+u,e[1]=h*f+s*c+l,e[2]=o*d+a*f+u,e[3]=h*f+s*d+l,e[4]=o*d+a*p+u,e[5]=h*p+s*d+l,e[6]=o*c+a*p+u,e[7]=h*p+s*c+l},r.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},r.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},r.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Ye),t=this._localBoundsRect),this._bounds.getRectangle(t)):e.prototype.getLocalBounds.call(this,t)},r.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Ys);var e=this._texture.orig.width,r=this._texture.orig.height,i=-e*this.anchor.x,n=0;return Ys.x>=i&&Ys.x<i+e&&(n=-r*this.anchor.y,Ys.y>=n&&Ys.y<n+r)},r.prototype.destroy=function(t){if(e.prototype.destroy.call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t&&t.texture){var r="boolean"==typeof t?t:t&&t.baseTexture;this._texture.destroy(!!r)}this._texture=null},r.from=function(t,e){return new r(t instanceof ri?t:ri.from(t,e))},Object.defineProperty(r.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=Se(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=Se(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||ri.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),r}(dr),Ws=function(t,e){return(Ws=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};!function(t){t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"}(t.TEXT_GRADIENT||(t.TEXT_GRADIENT={}));var zs={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:t.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},qs=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ks=function(){function t(t){this.styleID=0,this.reset(),Js(this,t,t)}return t.prototype.clone=function(){var e={};return Js(e,this,zs),new t(e)},t.prototype.reset=function(){Js(this,zs,zs)},Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var e=Qs(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fill},set:function(t){var e=Qs(t);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var e=Qs(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),t.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var r=e.length-1;r>=0;r--){var i=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&qs.indexOf(i)<0&&(i='"'+i+'"'),e[r]=i}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},t}();function Zs(t){return"number"==typeof t?de(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function Qs(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=Zs(t[e]);return t}return Zs(t)}function Js(t,e,r){for(var i in r)Array.isArray(e[i])?t[i]=e[i].slice():t[i]=e[i]}var $s=function(){function t(t,e,r,i,n,o,s,a,h){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=n,this.lineWidths=o,this.lineHeight=s,this.maxLineWidth=a,this.fontProperties=h}return t.measureText=function(e,r,i,n){void 0===n&&(n=t._canvas),i=null==i?r.wordWrap:i;var o=r.toFontString(),s=t.measureFont(o);0===s.fontSize&&(s.fontSize=r.fontSize,s.ascent=r.fontSize);var a=n.getContext("2d");a.font=o;for(var h=(i?t.wordWrap(e,r,n):e).split(/(?:\r\n|\r|\n)/),u=new Array(h.length),l=0,c=0;c<h.length;c++){var d=a.measureText(h[c]).width+(h[c].length-1)*r.letterSpacing;u[c]=d,l=Math.max(l,d)}var f=l+r.strokeThickness;r.dropShadow&&(f+=r.dropShadowDistance);var p=r.lineHeight||s.fontSize+r.strokeThickness,_=Math.max(p,s.fontSize+r.strokeThickness)+(h.length-1)*(p+r.leading);return r.dropShadow&&(_+=r.dropShadowDistance),new t(e,r,f,_,h,u,p+r.leading,l,s)},t.wordWrap=function(e,r,i){void 0===i&&(i=t._canvas);for(var n=i.getContext("2d"),o=0,s="",a="",h=Object.create(null),u=r.letterSpacing,l=r.whiteSpace,c=t.collapseSpaces(l),d=t.collapseNewlines(l),f=!c,p=r.wordWrapWidth+u,_=t.tokenize(e),m=0;m<_.length;m++){var v=_[m];if(t.isNewline(v)){if(!d){a+=t.addLine(s),f=!c,s="",o=0;continue}v=" "}if(c){var y=t.isBreakingSpace(v),E=t.isBreakingSpace(s[s.length-1]);if(y&&E)continue}var g=t.getFromCache(v,u,h,n);if(g>p)if(""!==s&&(a+=t.addLine(s),s="",o=0),t.canBreakWords(v,r.breakWords))for(var T=t.wordWrapSplit(v),b=0;b<T.length;b++){for(var R=T[b],x=1;T[b+x];){var A=T[b+x],S=R[R.length-1];if(t.canBreakChars(S,A,v,b,r.breakWords))break;R+=A,x++}b+=R.length-1;var O=t.getFromCache(R,u,h,n);O+o>p&&(a+=t.addLine(s),f=!1,s="",o=0),s+=R,o+=O}else{s.length>0&&(a+=t.addLine(s),s="",o=0);var I=m===_.length-1;a+=t.addLine(v,!I),f=!1,s="",o=0}else g+o>p&&(f=!1,a+=t.addLine(s),s="",o=0),(s.length>0||!t.isBreakingSpace(v)||f)&&(s+=v,o+=g)}return a+t.addLine(s,!1)},t.addLine=function(e,r){return void 0===r&&(r=!0),e=t.trimRight(e),r?e+"\n":e},t.getFromCache=function(t,e,r,i){var n=r[t];if("number"!=typeof n){var o=t.length*e;n=i.measureText(t).width+o,r[t]=n}return n},t.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},t.collapseNewlines=function(t){return"normal"===t},t.trimRight=function(e){if("string"!=typeof e)return"";for(var r=e.length-1;r>=0;r--){var i=e[r];if(!t.isBreakingSpace(i))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return"string"==typeof e&&t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e,r){return"string"==typeof e&&t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var r=[],i="";if("string"!=typeof e)return r;for(var n=0;n<e.length;n++){var o=e[n],s=e[n+1];t.isBreakingSpace(o,s)||t.isNewline(o)?(""!==i&&(r.push(i),i=""),r.push(o)):i+=o}return""!==i&&r.push(i),r},t.canBreakWords=function(t,e){return e},t.canBreakChars=function(t,e,r,i,n){return!0},t.wordWrapSplit=function(t){return t.split("")},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var r={ascent:0,descent:0,fontSize:0},i=t._canvas,n=t._context;n.font=e;var o=t.METRICS_STRING+t.BASELINE_SYMBOL,s=Math.ceil(n.measureText(o).width),a=Math.ceil(n.measureText(t.BASELINE_SYMBOL).width),h=Math.ceil(t.HEIGHT_MULTIPLIER*a);a=a*t.BASELINE_MULTIPLIER|0,i.width=s,i.height=h,n.fillStyle="#f00",n.fillRect(0,0,s,h),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(o,0,a);var u=n.getImageData(0,0,s,h).data,l=u.length,c=4*s,d=0,f=0,p=!1;for(d=0;d<a;++d){for(var _=0;_<c;_+=4)if(255!==u[f+_]){p=!0;break}if(p)break;f+=c}for(r.ascent=a-d,f=l-c,p=!1,d=h;d>a;--d){for(_=0;_<c;_+=4)if(255!==u[f+_]){p=!0;break}if(p)break;f-=c}return r.descent=d-a,r.fontSize=r.ascent+r.descent,t._fonts[e]=r,r},t.clearMetrics=function(e){void 0===e&&(e=""),e?delete t._fonts[e]:t._fonts={}},t}(),ta=function(){try{var t=new OffscreenCanvas(0,0),e=t.getContext("2d");return e&&e.measureText?t:document.createElement("canvas")}catch(t){return document.createElement("canvas")}}();ta.width=ta.height=10,$s._canvas=ta,$s._context=ta.getContext("2d"),$s._fonts={},$s.METRICS_STRING="|ÉqÅ",$s.BASELINE_SYMBOL="M",$s.BASELINE_MULTIPLIER=1.4,$s.HEIGHT_MULTIPLIER=2,$s._newlines=[10,13],$s._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var ea={texture:!0,children:!1,baseTexture:!0},ra=function(e){function r(t,r,i){var n=this,o=!1;i||(i=document.createElement("canvas"),o=!0),i.width=3,i.height=3;var s=ri.from(i);return s.orig=new Ye,s.trim=new Ye,(n=e.call(this,s)||this)._ownCanvas=o,n.canvas=i,n.context=n.canvas.getContext("2d"),n._resolution=rt.RESOLUTION,n._autoResolution=!0,n._text=null,n._style=null,n._styleListener=null,n._font="",n.text=t,n.style=r,n.localStyleID=-1,n}return function(t,e){function r(){this.constructor=t}Ws(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,e),r.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var i,n,o=this.context,s=$s.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),a=s.width,h=s.height,u=s.lines,l=s.lineHeight,c=s.lineWidths,d=s.maxLineWidth,f=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,a)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,h)+2*e.padding)*this._resolution),o.scale(this._resolution,this._resolution),o.clearRect(0,0,this.canvas.width,this.canvas.height),o.font=this._font,o.lineWidth=e.strokeThickness,o.textBaseline=e.textBaseline,o.lineJoin=e.lineJoin,o.miterLimit=e.miterLimit;for(var p=e.dropShadow?2:1,_=0;_<p;++_){var m=e.dropShadow&&0===_,v=m?Math.ceil(Math.max(1,h)+2*e.padding):0,y=v*this._resolution;if(m){o.fillStyle="black",o.strokeStyle="black";var E=e.dropShadowColor,g=ce("number"==typeof E?E:fe(E));o.shadowColor="rgba("+255*g[0]+","+255*g[1]+","+255*g[2]+","+e.dropShadowAlpha+")",o.shadowBlur=e.dropShadowBlur,o.shadowOffsetX=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,o.shadowOffsetY=Math.sin(e.dropShadowAngle)*e.dropShadowDistance+y}else o.fillStyle=this._generateFillStyle(e,u,s),o.strokeStyle=e.stroke,o.shadowColor="black",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0;var T=(l-f.fontSize)/2;(!r.nextLineHeightBehavior||l-f.fontSize<0)&&(T=0);for(var b=0;b<u.length;b++)i=e.strokeThickness/2,n=e.strokeThickness/2+b*l+f.ascent+T,"right"===e.align?i+=d-c[b]:"center"===e.align&&(i+=(d-c[b])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(u[b],i+e.padding,n+e.padding-v,!0),e.fill&&this.drawLetterSpacing(u[b],i+e.padding,n+e.padding-v)}this.updateTexture()}},r.prototype.drawLetterSpacing=function(t,e,r,i){void 0===i&&(i=!1);var n=this._style.letterSpacing;if(0!==n)for(var o=e,s=Array.from?Array.from(t):t.split(""),a=this.context.measureText(t).width,h=0,u=0;u<s.length;++u){var l=s[u];i?this.context.strokeText(l,o,r):this.context.fillText(l,o,r),o+=a-(h=this.context.measureText(t.substring(u+1)).width)+n,a=h}else i?this.context.strokeText(t,e,r):this.context.fillText(t,e,r)},r.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=Ce(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var r=this._texture,i=this._style,n=i.trim?0:i.padding,o=r.baseTexture;r.trim.width=r._frame.width=t.width/this._resolution,r.trim.height=r._frame.height=t.height/this._resolution,r.trim.x=-n,r.trim.y=-n,r.orig.width=r._frame.width-2*n,r.orig.height=r._frame.height-2*n,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),r.updateUvs(),this._recursivePostUpdateTransform(),this.dirty=!1},r.prototype._render=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),e.prototype._render.call(this,t)},r.prototype.getLocalBounds=function(t){return this.updateText(!0),e.prototype.getLocalBounds.call(this,t)},r.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},r.prototype._generateFillStyle=function(e,r,i){var n,o=e.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];var s=e.dropShadow?e.dropShadowDistance:0,a=e.padding||0,h=this.canvas.width/this._resolution-s-2*a,u=this.canvas.height/this._resolution-s-2*a,l=o.slice(),c=e.fillGradientStops.slice();if(!c.length)for(var d=l.length+1,f=1;f<d;++f)c.push(f/d);if(l.unshift(o[0]),c.unshift(0),l.push(o[o.length-1]),c.push(1),e.fillGradientType===t.TEXT_GRADIENT.LINEAR_VERTICAL){n=this.context.createLinearGradient(h/2,a,h/2,u+a);var p=i.fontProperties.fontSize+e.strokeThickness;for(f=0;f<r.length;f++){var _=i.lineHeight*(f-1)+p,m=i.lineHeight*f,v=m;f>0&&_>m&&(v=(m+_)/2);var y=m+p,E=i.lineHeight*(f+1),g=y;f+1<r.length&&E<y&&(g=(y+E)/2);for(var T=(g-v)/u,b=0;b<l.length;b++){var R;R="number"==typeof c[b]?c[b]:b/l.length;var x=Math.min(1,Math.max(0,v/u+R*T));x=Number(x.toFixed(5)),n.addColorStop(x,l[b])}}}else{n=this.context.createLinearGradient(a,u/2,h+a,u/2);var A=l.length+1,S=1;for(f=0;f<l.length;f++){var O;O="number"==typeof c[f]?c[f]:S/A,n.addColorStop(O,l[f]),S++}}return n},r.prototype.destroy=function(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},ea,t),e.prototype.destroy.call(this,t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(r.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=Se(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=Se(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},this._style=t instanceof Ks?t:new Ks(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),r.nextLineHeightBehavior=!1,r}(Vs);rt.UPLOADS_PER_FRAME=4;var ia=function(t,e){return(ia=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},na=function(){function t(t){this.maxItemsPerFrame=t,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();function oa(t,e){var r=!1;if(t&&t._textures&&t._textures.length)for(var i=0;i<t._textures.length;i++)if(t._textures[i]instanceof ri){var n=t._textures[i].baseTexture;-1===e.indexOf(n)&&(e.push(n),r=!0)}return r}function sa(t,e){if(t.baseTexture instanceof Xr){var r=t.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function aa(t,e){if(t._texture&&t._texture instanceof ri){var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function ha(t,e){return e instanceof ra&&(e.updateText(!0),!0)}function ua(t,e){if(e instanceof Ks){var r=e.toFontString();return $s.measureFont(r),!0}return!1}function la(t,e){if(t instanceof ra){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function ca(t,e){return t instanceof Ks&&(-1===e.indexOf(t)&&e.push(t),!0)}var da=function(){function e(t){var e=this;this.limiter=new na(rt.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(la),this.registerFindHook(ca),this.registerFindHook(oa),this.registerFindHook(sa),this.registerFindHook(aa),this.registerUploadHook(ha),this.registerUploadHook(ua)}return e.prototype.upload=function(e,r){"function"==typeof e&&(r=e,e=null),e&&this.add(e),this.queue.length?(r&&this.completes.push(r),this.ticking||(this.ticking=!0,gr.system.addOnce(this.tick,this,t.UPDATE_PRIORITY.UTILITY))):r&&r()},e.prototype.tick=function(){setTimeout(this.delayedTick,0)},e.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],r=!1;if(e&&!e._destroyed)for(var i=0,n=this.uploadHooks.length;i<n;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),r=!0;break}r||this.queue.shift()}if(this.queue.length)gr.system.addOnce(this.tick,this,t.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var o=this.completes.slice(0);for(this.completes.length=0,i=0,n=o.length;i<n;i++)o[i]()}},e.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},e.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},e.prototype.add=function(t){for(var e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof dr)for(e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this},e.prototype.destroy=function(){this.ticking&&gr.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},e}();function fa(t,e){return e instanceof Xr&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function pa(t,e){if(!(e instanceof Xs))return!1;var r=e.geometry;e.finishPoly(),r.updateBatches();for(var i=r.batches,n=0;n<i.length;n++){var o=i[n].style.texture;o&&fa(t,o.baseTexture)}return r.batchable||t.geometry.bind(r,e._resolveDirectShader(t)),!0}function _a(t,e){return t instanceof Xs&&(e.push(t),!0)}var ma=function(t){function e(e){var r=t.call(this,e)||this;return r.uploadHookHelper=r.renderer,r.registerFindHook(_a),r.registerUploadHook(fa),r.registerUploadHook(pa),r}return function(t,e){function r(){this.constructor=t}ia(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(da),va=function(){function t(t){this.maxMilliseconds=t,this.frameStart=0}return t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t}(),ya=function(){function t(t,e,r){void 0===r&&(r=null),this._texture=t instanceof ri?t:null,this.baseTexture=t instanceof Xr?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var i=this.baseTexture.resource;this.resolution=this._updateResolution(r||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t.prototype._updateResolution=function(t){void 0===t&&(t=null);var e=this.data.meta.scale,r=Be(t,null);return null===r&&(r=void 0!==e?parseFloat(e):1),1!==r&&this.baseTexture.setResolution(r),r},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(e){for(var r=e,i=t.BATCH_SIZE;r-e<i&&r<this._frameKeys.length;){var n=this._frameKeys[r],o=this._frames[n],s=o.frame;if(s){var a,h=null,u=!1!==o.trimmed&&o.sourceSize?o.sourceSize:o.frame,l=new Ye(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);a=o.rotated?new Ye(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):new Ye(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),!1!==o.trimmed&&o.spriteSourceSize&&(h=new Ye(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[n]=new ri(this.baseTexture,a,l,h,o.rotated?2:0,o.anchor),ri.addToCache(this.textures[n],n)}r++}},t.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var r=0;r<t[e].length;r++){var i=t[e][r];this.animations[e].push(this.textures[i])}}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())},0)},t.prototype.destroy=function(t){var e;for(var r in void 0===t&&(t=!1),this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null===(e=this._texture)||void 0===e||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},t.BATCH_SIZE=1e3,t}(),Ea=function(){function e(){}return e.use=function(r,i){var n,o,s=this,a=r.name+"_image";if(r.data&&r.type===t.LoaderResource.TYPE.JSON&&r.data.frames&&!s.resources[a]){var h=null===(o=null===(n=r.data)||void 0===n?void 0:n.meta)||void 0===o?void 0:o.related_multi_packs;if(Array.isArray(h))for(var u=function(e){if("string"!=typeof e)return"continue";var i=e.replace(".json",""),n=ne.resolve(r.url.replace(s.baseUrl,""),e);if(s.resources[i]||Object.values(s.resources).some(function(t){return ne.format(ne.parse(t.url))===n}))return"continue";var o={crossOrigin:r.crossOrigin,loadType:t.LoaderResource.LOAD_TYPE.XHR,xhrType:t.LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:r};s.add(i,n,o)},l=0,c=h;l<c.length;l++)u(c[l]);var d={crossOrigin:r.crossOrigin,metadata:r.metadata.imageMetadata,parentResource:r},f=e.getResourcePath(r,s.baseUrl);s.add(a,f,d,function(t){if(t.error)i(t.error);else{var e=new ya(t.texture,r.data,r.url);e.parse(function(){r.spritesheet=e,r.textures=e.textures,i()})}})}else i()},e.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:ne.resolve(t.url.replace(e,""),t.data.meta.image)},e}(),ga=function(t,e){return(ga=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Ta(t,e){function r(){this.constructor=t}ga(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var ba=new qe,Ra=function(t){function e(e,r,i){void 0===r&&(r=100),void 0===i&&(i=100);var n=t.call(this,e)||this;return n.tileTransform=new or,n._width=r,n._height=i,n.uvMatrix=n.texture.uvMatrix||new un(e),n.pluginName="tilingSprite",n.uvRespectAnchor=!1,n}return Ta(e,t),Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),i=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,r,i)},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Ye),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,ba);var e=this._width,r=this._height,i=-e*this.anchor._x;if(ba.x>=i&&ba.x<i+e){var n=-r*this.anchor._y;if(ba.y>=n&&ba.y<n+r)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,r){return new e(t instanceof ri?t:ri.from(t,r),r.width,r.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),e}(Vs),xa="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",Aa="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",Sa="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",Oa=new Ze,Ia=function(e){function r(t){var r=e.call(this,t)||this,i={globals:r.renderer.globalUniforms};return r.shader=rn.from(xa,Aa,i),r.simpleShader=rn.from(xa,Sa,i),r.quad=new _i,r.state=nn.for2d(),r}return Ta(r,e),r.prototype.render=function(e){var r=this.renderer,i=this.quad,n=i.vertices;n[0]=n[6]=e._width*-e.anchor.x,n[1]=n[3]=e._height*-e.anchor.y,n[2]=n[4]=e._width*(1-e.anchor.x),n[5]=n[7]=e._height*(1-e.anchor.y);var o=e.uvRespectAnchor?e.anchor.x:0,s=e.uvRespectAnchor?e.anchor.y:0;(n=i.uvs)[0]=n[6]=-o,n[1]=n[3]=-s,n[2]=n[4]=1-o,n[5]=n[7]=1-s,i.invalidate();var a=e._texture,h=a.baseTexture,u=e.tileTransform.localTransform,l=e.uvMatrix,c=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;c&&(h._glTextures[r.CONTEXT_UID]?c=h.wrapMode!==t.WRAP_MODES.CLAMP:h.wrapMode===t.WRAP_MODES.CLAMP&&(h.wrapMode=t.WRAP_MODES.REPEAT));var d=c?this.simpleShader:this.shader,f=a.width,p=a.height,_=e._width,m=e._height;Oa.set(u.a*f/_,u.b*f/m,u.c*p/_,u.d*p/m,u.tx/_,u.ty/m),Oa.invert(),c?Oa.prepend(l.mapCoord):(d.uniforms.uMapCoord=l.mapCoord.toArray(!0),d.uniforms.uClampFrame=l.uClampFrame,d.uniforms.uClampOffset=l.uClampOffset),d.uniforms.uTransform=Oa.toArray(!0),d.uniforms.uColor=ye(e.tint,e.worldAlpha,d.uniforms.uColor,h.alphaMode),d.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),d.uniforms.uSampler=a,r.shader.bind(d),r.geometry.bind(i),this.state.blendMode=_e(e.blendMode,h.alphaMode),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},r}(bi),Pa=function(t,e){return(Pa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Ma(t,e){function r(){this.constructor=t}Pa(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Da=function(){function t(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},t}(),Na=new qe,wa=new We,Ca=function(e){function r(r,i,n,o){void 0===o&&(o=t.DRAW_MODES.TRIANGLES);var s=e.call(this)||this;return s.geometry=r,r.refCount++,s.shader=i,s.state=n||nn.for2d(),s.drawMode=o,s.start=0,s.size=0,s.uvs=null,s.indices=null,s.vertexData=new Float32Array(1),s.vertexDirty=-1,s._transformID=-1,s._roundPixels=rt.ROUND_PIXELS,s.batchUvs=null,s}return Ma(r,e),Object.defineProperty(r.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),r.prototype._render=function(e){var i=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===t.DRAW_MODES.TRIANGLES&&i.length<2*r.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)},r.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},r.prototype._renderToBatch=function(t){var e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;var i=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[i]),t.plugins[i].render(this)},r.prototype.calculateVertices=function(){var t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var i=this.transform.worldTransform,n=i.a,o=i.b,s=i.c,a=i.d,h=i.tx,u=i.ty,l=this.vertexData,c=0;c<l.length/2;c++){var d=e[2*c],f=e[2*c+1];l[2*c]=n*d+s*f+h,l[2*c+1]=o*d+a*f+u}if(this._roundPixels){var p=rt.RESOLUTION;for(c=0;c<l.length;++c)l[c]=Math.round((l[c]*p|0)/p)}this.vertexDirty=r}},r.prototype.calculateUvs=function(){var t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Da(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},r.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},r.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Na);for(var e=this.geometry.getBuffer("aVertexPosition").data,r=wa.points,i=this.geometry.getIndex().data,n=i.length,o=4===this.drawMode?3:1,s=0;s+2<n;s+=o){var a=2*i[s],h=2*i[s+1],u=2*i[s+2];if(r[0]=e[a],r[1]=e[a+1],r[2]=e[h],r[3]=e[h+1],r[4]=e[u],r[5]=e[u+1],wa.contains(Na.x,Na.y))return!0}return!1},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},r.BATCHABLE_SIZE=100,r}(dr),La="varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n",Fa="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n",Ua=function(t){function e(e,r){var i=this,n={uSampler:e,alpha:1,uTextureMatrix:Ze.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r)).uniforms&&Object.assign(n,r.uniforms),(i=t.call(this,r.program||en.from(Fa,La),n)||this)._colorDirty=!1,i.uvMatrix=new un(e),i.batchable=void 0===r.program,i.pluginName=r.pluginName,i.tint=r.tint,i.alpha=r.alpha,i}return Ma(e,t),Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;ye(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(rn),Ba=function(e){function r(r,i,n){var o=e.call(this)||this,s=new hi(r),a=new hi(i,!0),h=new hi(n,!0,!0);return o.addAttribute("aVertexPosition",s,2,!1,t.TYPES.FLOAT).addAttribute("aTextureCoord",a,2,!1,t.TYPES.FLOAT).addIndex(h),o._updateId=-1,o}return Ma(r,e),Object.defineProperty(r.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),r}(fi),Ga=function(t,e){return(Ga=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},Xa=function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]},ka=function(){function t(){}return t.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},t.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var i in e){var n=e[i].match(/^[a-z]+/gm)[0],o=e[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(var a in o){var h=o[a].split("="),u=h[0],l=h[1].replace(/"/gm,""),c=parseFloat(l),d=isNaN(c)?l:c;s[u]=d}r[n].push(s)}var f=new Xa;return r.info.forEach(function(t){return f.info.push({face:t.face,size:parseInt(t.size,10)})}),r.common.forEach(function(t){return f.common.push({lineHeight:parseInt(t.lineHeight,10)})}),r.page.forEach(function(t){return f.page.push({id:parseInt(t.id,10),file:t.file})}),r.char.forEach(function(t){return f.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})}),r.kerning.forEach(function(t){return f.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})}),f},t}(),Ha=function(){function t(){}return t.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},t.parse=function(t){for(var e=new Xa,r=t.getElementsByTagName("info"),i=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),s=t.getElementsByTagName("kerning"),a=0;a<r.length;a++)e.info.push({face:r[a].getAttribute("face"),size:parseInt(r[a].getAttribute("size"),10)});for(a=0;a<i.length;a++)e.common.push({lineHeight:parseInt(i[a].getAttribute("lineHeight"),10)});for(a=0;a<n.length;a++)e.page.push({id:parseInt(n[a].getAttribute("id"),10)||0,file:n[a].getAttribute("file")});for(a=0;a<o.length;a++){var h=o[a];e.char.push({id:parseInt(h.getAttribute("id"),10),page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xoffset:parseInt(h.getAttribute("xoffset"),10),yoffset:parseInt(h.getAttribute("yoffset"),10),xadvance:parseInt(h.getAttribute("xadvance"),10)})}for(a=0;a<s.length;a++)e.kerning.push({first:parseInt(s[a].getAttribute("first"),10),second:parseInt(s[a].getAttribute("second"),10),amount:parseInt(s[a].getAttribute("amount"),10)});return e},t}(),Ya=function(){function t(){}return t.test=function(t){if("string"==typeof t&&t.indexOf("<font>")>-1){var e=(new self.DOMParser).parseFromString(t,"text/xml");return Ha.test(e)}return!1},t.parse=function(t){var e=(new self.DOMParser).parseFromString(t,"text/xml");return Ha.parse(e)},t}(),ja=[ka,Ha,Ya];function Va(t){for(var e=0;e<ja.length;e++)if(ja[e].test(t))return ja[e];return null}function Wa(e,r,i,n,o,s,a){var h=i.text,u=i.fontProperties;r.translate(n,o),r.scale(s,s);var l=a.strokeThickness/2,c=-a.strokeThickness/2;r.font=a.toFontString(),r.lineWidth=a.strokeThickness,r.textBaseline=a.textBaseline,r.lineJoin=a.lineJoin,r.miterLimit=a.miterLimit,r.fillStyle=function(e,r,i,n,o,s){var a,h=i.fill;if(!Array.isArray(h))return h;if(1===h.length)return h[0];var u=i.dropShadow?i.dropShadowDistance:0,l=i.padding||0,c=e.width/n-u-2*l,d=e.height/n-u-2*l,f=h.slice(),p=i.fillGradientStops.slice();if(!p.length)for(var _=f.length+1,m=1;m<_;++m)p.push(m/_);if(f.unshift(h[0]),p.unshift(0),f.push(h[h.length-1]),p.push(1),i.fillGradientType===t.TEXT_GRADIENT.LINEAR_VERTICAL){a=r.createLinearGradient(c/2,l,c/2,d+l);var v=0,y=(s.fontProperties.fontSize+i.strokeThickness)/d;for(m=0;m<o.length;m++)for(var E=s.lineHeight*m,g=0;g<f.length;g++){var T=E/d+("number"==typeof p[g]?p[g]:g/f.length)*y,b=Math.max(v,T);b=Math.min(b,1),a.addColorStop(b,f[g]),v=b}}else{a=r.createLinearGradient(l,d/2,c+l,d/2);var R=f.length+1,x=1;for(m=0;m<f.length;m++){var A;A="number"==typeof p[m]?p[m]:x/R,a.addColorStop(A,f[m]),x++}}return a}(e,r,a,s,[h],i),r.strokeStyle=a.stroke;var d=a.dropShadowColor,f=ce("number"==typeof d?d:fe(d));a.dropShadow?(r.shadowColor="rgba("+255*f[0]+","+255*f[1]+","+255*f[2]+","+a.dropShadowAlpha+")",r.shadowBlur=a.dropShadowBlur,r.shadowOffsetX=Math.cos(a.dropShadowAngle)*a.dropShadowDistance,r.shadowOffsetY=Math.sin(a.dropShadowAngle)*a.dropShadowDistance):(r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0),a.stroke&&a.strokeThickness&&r.strokeText(h,l,c+i.lineHeight-u.descent),a.fill&&r.fillText(h,l,c+i.lineHeight-u.descent),r.setTransform(1,0,0,1,0,0),r.fillStyle="rgba(0, 0, 0, 0)"}var za=function(){function t(t,e,r){var i=t.info[0],n=t.common[0],o=Be(t.page[0].file),s={};this._ownsTextures=r,this.font=i.face,this.size=i.size,this.lineHeight=n.lineHeight/o,this.chars={},this.pageTextures=s;for(var a=0;a<t.page.length;a++){var h=t.page[a],u=h.id,l=h.file;s[u]=e instanceof Array?e[a]:e[l]}for(a=0;a<t.char.length;a++){var c=t.char[a],d=(u=c.id,c.page),f=t.char[a],p=f.x,_=f.y,m=f.width,v=f.height,y=f.xoffset,E=f.yoffset,g=f.xadvance;_/=o,m/=o,v/=o,y/=o,E/=o,g/=o;var T=new Ye((p/=o)+s[d].frame.x/o,_+s[d].frame.y/o,m,v);this.chars[u]={xOffset:y,yOffset:E,xAdvance:g,kerning:{},texture:new ri(s[d].baseTexture,T),page:d}}for(a=0;a<t.kerning.length;a++){var b=t.kerning[a],R=b.first,x=b.second,A=b.amount;R/=o,x/=o,A/=o,this.chars[x]&&(this.chars[x].kerning[R]=A)}}return t.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},t.install=function(e,r,i){var n;if(e instanceof Xa)n=e;else{var o=Va(e);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(e)}r instanceof ri&&(r=[r]);var s=new t(n,r,i);return t.available[s.font]=s,s},t.uninstall=function(e){var r=t.available[e];if(!r)throw new Error("No font found named '"+e+"'");r.destroy(),delete t.available[e]},t.from=function(e,r,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},t.defaultOptions,i),o=n.chars,s=n.padding,a=n.resolution,h=n.textureWidth,u=n.textureHeight,l=function(t){"string"==typeof t&&(t=[t]);for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r];if(Array.isArray(n)){if(2!==n.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var o=n[0].charCodeAt(0),s=n[1].charCodeAt(0);if(s<o)throw new Error("[BitmapFont]: Invalid character range.");for(var a=o,h=s;a<=h;a++)e.push(String.fromCharCode(a))}else e.push.apply(e,n.split(""))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(o),c=r instanceof Ks?r:new Ks(r),d=h,f=new Xa;f.info[0]={face:c.fontFamily,size:c.fontSize},f.common[0]={lineHeight:c.fontSize};for(var p,_,m,v=0,y=0,E=0,g=[],T=0;T<l.length;T++){p||((p=document.createElement("canvas")).width=h,p.height=u,_=p.getContext("2d"),m=new Xr(p,{resolution:a}),g.push(new ri(m)),f.page.push({id:g.length-1,file:""}));var b=$s.measureText(l[T],c,!1,p),R=b.width,x=Math.ceil(b.height),A=Math.ceil(("italic"===c.fontStyle?2:1)*R);if(y>=u-x*a){if(0===y)throw new Error("[BitmapFont] textureHeight "+u+"px is too small for "+c.fontSize+"px fonts");--T,p=null,_=null,m=null,y=0,v=0,E=0}else if(E=Math.max(x+b.fontProperties.descent,E),A*a+v>=d)--T,y+=E*a,y=Math.ceil(y),v=0,E=0;else{Wa(p,_,b,v,y,a,c);var S=b.text.charCodeAt(0);f.char.push({id:S,page:g.length-1,x:v/a,y:y/a,width:A,height:x,xoffset:0,yoffset:0,xadvance:Math.ceil(R-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0))}),v+=(A+2*s)*a,v=Math.ceil(v)}}T=0;for(var O=l.length;T<O;T++)for(var I=l[T],P=0;P<O;P++){var M=l[P],D=_.measureText(I).width,N=_.measureText(M).width,w=_.measureText(I+M).width-(D+N);w&&f.kerning.push({first:I.charCodeAt(0),second:M.charCodeAt(0),amount:w})}var C=new t(f,g,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=C,C},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),qa=[],Ka=[],Za=function(t){function e(r,i){void 0===i&&(i={});var n=t.call(this)||this;n._tint=16777215;var o=Object.assign({},e.styleDefaults,i),s=o.align,a=o.tint,h=o.maxWidth,u=o.letterSpacing,l=o.fontName,c=o.fontSize;if(!za.available[l])throw new Error('Missing BitmapFont "'+l+'"');return n._activePagesMeshData=[],n._textWidth=0,n._textHeight=0,n._align=s,n._tint=a,n._fontName=l,n._fontSize=c||za.available[l].size,n._text=r,n._maxWidth=h,n._maxLineHeight=0,n._letterSpacing=u,n._anchor=new Ke(function(){n.dirty=!0},n,0,0),n._roundPixels=rt.ROUND_PIXELS,n.dirty=!0,n._textureCache={},n}return function(t,e){function r(){this.constructor=t}Ga(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.updateText=function(){for(var t,e=za.available[this._fontName],r=this._fontSize/e.size,i=new qe,n=[],o=[],s=[],a=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",h=a.length,u=this._maxWidth*e.size/this._fontSize,l=null,c=0,d=0,f=0,p=-1,_=0,m=0,v=0,y=0,E=0;E<h;E++){var g=a.charCodeAt(E),T=a.charAt(E);if(/(?:\s)/.test(T)&&(p=E,_=c,y++),"\r"!==T&&"\n"!==T){var b=e.chars[g];if(b){l&&b.kerning[l]&&(i.x+=b.kerning[l]);var R=Ka.pop()||{texture:ri.EMPTY,line:0,charCode:0,prevSpaces:0,position:new qe};R.texture=b.texture,R.line=f,R.charCode=g,R.position.x=i.x+b.xOffset+this._letterSpacing/2,R.position.y=i.y+b.yOffset,R.prevSpaces=y,n.push(R),c=R.position.x+b.texture.orig.width,i.x+=b.xAdvance+this._letterSpacing,v=Math.max(v,b.yOffset+b.texture.height),l=g,-1!==p&&u>0&&i.x>u&&(Ae(n,1+p-++m,1+E-p),E=p,p=-1,o.push(_),s.push(n.length>0?n[n.length-1].prevSpaces:0),d=Math.max(d,_),f++,i.x=0,i.y+=e.lineHeight,l=null,y=0)}}else o.push(c),s.push(-1),d=Math.max(d,c),++f,++m,i.x=0,i.y+=e.lineHeight,l=null,y=0}var x=a.charAt(a.length-1);"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(c=_),o.push(c),d=Math.max(d,c),s.push(-1));var A=[];for(E=0;E<=f;E++){var S=0;"right"===this._align?S=d-o[E]:"center"===this._align?S=(d-o[E])/2:"justify"===this._align&&(S=s[E]<0?0:(d-o[E])/s[E]),A.push(S)}var O=n.length,I={},P=[],M=this._activePagesMeshData;for(E=0;E<M.length;E++)qa.push(M[E]);for(E=0;E<O;E++){var D=(X=n[E].texture).baseTexture.uid;if(!I[D]){if(!(z=qa.pop())){var N=new Ba,w=new Ua(ri.EMPTY);z={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new Ca(N,w),vertices:null,uvs:null,indices:null}}z.index=0,z.indexCount=0,z.vertexCount=0,z.uvsCount=0,z.total=0;var C=this._textureCache;C[D]=C[D]||new ri(X.baseTexture),z.mesh.texture=C[D],z.mesh.tint=this._tint,P.push(z),I[D]=z}I[D].total++}for(E=0;E<M.length;E++)-1===P.indexOf(M[E])&&this.removeChild(M[E].mesh);for(E=0;E<P.length;E++)P[E].mesh.parent!==this&&this.addChild(P[E].mesh);for(var E in this._activePagesMeshData=P,I){var L=(z=I[E]).total;if(!((null===(t=z.indices)||void 0===t?void 0:t.length)>6*L)||z.vertices.length<2*Ca.BATCHABLE_SIZE)z.vertices=new Float32Array(8*L),z.uvs=new Float32Array(8*L),z.indices=new Uint16Array(6*L);else for(var F=z.total,U=z.vertices,B=4*F*2;B<U.length;B++)U[B]=0;z.mesh.size=6*L}for(E=0;E<O;E++){var G=(T=n[E]).position.x+A[T.line]*("justify"===this._align?T.prevSpaces:1);this._roundPixels&&(G=Math.round(G));var X,k=G*r,H=T.position.y*r,Y=I[(X=T.texture).baseTexture.uid],j=X.frame,V=X._uvs,W=Y.index++;Y.indices[6*W+0]=0+4*W,Y.indices[6*W+1]=1+4*W,Y.indices[6*W+2]=2+4*W,Y.indices[6*W+3]=0+4*W,Y.indices[6*W+4]=2+4*W,Y.indices[6*W+5]=3+4*W,Y.vertices[8*W+0]=k,Y.vertices[8*W+1]=H,Y.vertices[8*W+2]=k+j.width*r,Y.vertices[8*W+3]=H,Y.vertices[8*W+4]=k+j.width*r,Y.vertices[8*W+5]=H+j.height*r,Y.vertices[8*W+6]=k,Y.vertices[8*W+7]=H+j.height*r,Y.uvs[8*W+0]=V.x0,Y.uvs[8*W+1]=V.y0,Y.uvs[8*W+2]=V.x1,Y.uvs[8*W+3]=V.y1,Y.uvs[8*W+4]=V.x2,Y.uvs[8*W+5]=V.y2,Y.uvs[8*W+6]=V.x3,Y.uvs[8*W+7]=V.y3}for(var E in this._textWidth=d*r,this._textHeight=(i.y+e.lineHeight)*r,I){var z=I[E];if(0!==this.anchor.x||0!==this.anchor.y)for(var q=0,K=this._textWidth*this.anchor.x,Z=this._textHeight*this.anchor.y,Q=0;Q<z.total;Q++)z.vertices[q++]-=K,z.vertices[q++]-=Z,z.vertices[q++]-=K,z.vertices[q++]-=Z,z.vertices[q++]-=K,z.vertices[q++]-=Z,z.vertices[q++]-=K,z.vertices[q++]-=Z;this._maxLineHeight=v*r;var J=z.mesh.geometry.getBuffer("aVertexPosition"),$=z.mesh.geometry.getBuffer("aTextureCoord"),tt=z.mesh.geometry.getIndex();J.data=z.vertices,$.data=z.uvs,tt.data=z.indices,J.update(),$.update(),tt.update()}for(E=0;E<n.length;E++)Ka.push(n[E])},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!za.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),e.prototype.destroy=function(e){var r=this._textureCache;for(var i in r)r[i].destroy(),delete r[i];this._textureCache=null,t.prototype.destroy.call(this,e)},e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e}(dr),Qa=function(){function e(){}return e.add=function(){t.LoaderResource.setExtensionXhrType("fnt",t.LoaderResource.XHR_RESPONSE_TYPE.TEXT)},e.use=function(r,i){var n=Va(r.data);if(n)for(var o=e.getBaseUrl(this,r),s=n.parse(r.data),a={},h=function(t){a[t.metadata.pageFile]=t.texture,Object.keys(a).length===s.page.length&&(r.bitmapFont=za.install(s,a,!0),i())},u=0;u<s.page.length;++u){var l=s.page[u].file,c=o+l,d=!1;for(var f in this.resources){var p=this.resources[f];if(p.url===c){p.metadata.pageFile=l,p.texture?h(p):p.onAfterMiddleware.add(h),d=!0;break}}if(!d){var _={crossOrigin:r.crossOrigin,loadType:t.LoaderResource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:l},r.metadata.imageMetadata),parentResource:r};this.add(c,_,h)}}else i()},e.getBaseUrl=function(t,r){var i=r.isDataUrl?"":e.dirname(r.url);return r.isDataUrl&&("."===i&&(i=""),t.baseUrl&&i&&"/"===t.baseUrl.charAt(t.baseUrl.length-1)&&(i+="/")),(i=i.replace(t.baseUrl,""))&&"/"!==i.charAt(i.length-1)&&(i+="/"),i},e.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},e}(),Ja=function(t,e){return(Ja=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},$a="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",th=function(t){function e(e){void 0===e&&(e=1);var r=t.call(this,qn,$a,{uAlpha:1})||this;return r.alpha=e,r}return function(t,e){function r(){this.constructor=t}Ja(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(on),eh=function(t,e){return(eh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function rh(t,e){function r(){this.constructor=t}eh(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var ih,nh,oh,sh,ah,hh,uh,lh,ch,dh,fh,ph,_h,mh,vh,yh,Eh,gh,Th,bh="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",Rh={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},xh=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(ih||(ih={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(nh||(nh={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(oh||(oh={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(sh||(sh={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(ah||(ah={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(hh||(hh={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(uh||(uh={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(lh||(lh={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(ch||(ch={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(dh||(dh={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(fh||(fh={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(ph||(ph={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(_h||(_h={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(mh||(mh={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(vh||(vh={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(yh||(yh={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(Eh||(Eh={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(gh||(gh={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(Th||(Th={}));var Ah=function(t){function e(e,r,i,n,o){void 0===r&&(r=8),void 0===i&&(i=4),void 0===n&&(n=rt.FILTER_RESOLUTION),void 0===o&&(o=5);var s=this,a=function(t,e){var r,i=Math.ceil(t/2),n=bh,o="";r=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var s=0;s<t;s++){var a=r.replace("%index%",s.toString());o+=a=a.replace("%sampleIndex%",s-(i-1)+".0"),o+="\n"}return(n=n.replace("%blur%",o)).replace("%size%",t.toString())}(o,e),h=function(t){for(var e,r=Rh[t],i=r.length,n=xh,o="",s=0;s<t;s++){var a="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s.toString());e=s,s>=i&&(e=t-s-1),o+=a=a.replace("%value%",r[e].toString()),o+="\n"}return(n=n.replace("%blur%",o)).replace("%size%",t.toString())}(o);return(s=t.call(this,a,h)||this).horizontal=e,s.resolution=n,s._quality=0,s.quality=i,s.blur=r,s}return rh(e,t),e.prototype.apply=function(t,e,r,i){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,i);else{var n=t.getFilterTexture(),o=t.renderer,s=e,a=n;this.state.blend=!1,t.applyFilter(this,s,a,mh.CLEAR);for(var h=1;h<this.passes-1;h++){t.bindAndClear(s,mh.BLIT),this.uniforms.uSampler=a;var u=a;a=s,s=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,r,i),t.returnFilterTexture(n)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+2*Math.abs(t),this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),e}(on),Sh=function(t){function e(e,r,i,n){void 0===e&&(e=8),void 0===r&&(r=4),void 0===i&&(i=rt.FILTER_RESOLUTION),void 0===n&&(n=5);var o=t.call(this)||this;return o.blurXFilter=new Ah(!0,e,r,i,n),o.blurYFilter=new Ah(!1,e,r,i,n),o.resolution=i,o.quality=r,o.blur=e,o.repeatEdgePixels=!1,o}return rh(e,t),e.prototype.apply=function(t,e,r,i){var n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){var s=t.getFilterTexture();this.blurXFilter.apply(t,e,s,mh.CLEAR),this.blurYFilter.apply(t,s,r,i),t.returnFilterTexture(s)}else o?this.blurYFilter.apply(t,e,r,i):this.blurXFilter.apply(t,e,r,i)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0}),e}(on),Oh=function(t,e){return(Oh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},Ih="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",Ph=function(t){function e(){var e=this,r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return(e=t.call(this,Kn,Ih,r)||this).alpha=1,e}return function(t,e){function r(){this.constructor=t}Oh(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r},e.prototype._multiply=function(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){var r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.tint=function(t,e){var r=[(t>>16&255)/255,0,0,0,0,0,(t>>8&255)/255,0,0,0,0,0,(255&t)/255,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.greyscale=function(t,e){var r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var r=Math.cos(t),i=Math.sin(t),n=1/3,o=(0,Math.sqrt)(n),s=[r+(1-r)*n,n*(1-r)-o*i,n*(1-r)+o*i,0,0,n*(1-r)+o*i,r+n*(1-r),n*(1-r)-o*i,0,0,n*(1-r)-o*i,n*(1-r)+o*i,r+n*(1-r),0,0,0,0,0,1,0];this._loadMatrix(s,e)},e.prototype.contrast=function(t,e){var r=(t||0)+1,i=-.5*(r-1),n=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var r=2*t/3+1,i=-.5*(r-1),n=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,r,i,n){var o=((r=r||16770432)>>16&255)/255,s=(r>>8&255)/255,a=(255&r)/255,h=((i=i||3375104)>>16&255)/255,u=(i>>8&255)/255,l=(255&i)/255,c=[.3,.59,.11,0,0,o,s,a,t=t||.2,0,h,u,l,e=e||.15,0,o-h,s-u,a-l,0,0];this._loadMatrix(c,n)},e.prototype.night=function(t,e){var r=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.predator=function(t,e){var r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(on);Ph.prototype.grayscale=Ph.prototype.greyscale;var Mh,Dh,Nh,wh,Ch,Lh,Fh,Uh,Bh,Gh,Xh,kh,Hh,Yh,jh,Vh,Wh,zh,qh,Kh=function(t,e){return(Kh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},Zh="varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",Qh="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n",Jh=function(t){function e(e,r){var i=this,n=new Ze;return e.renderable=!1,(i=t.call(this,Qh,Zh,{mapSampler:e._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this).maskSprite=e,i.maskMatrix=n,null==r&&(r=20),i.scale=new qe(r,r),i}return function(t,e){function r(){this.constructor=t}Kh(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.apply=function(t,e,r,i){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),s=Math.sqrt(n.c*n.c+n.d*n.d);0!==o&&0!==s&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/s,this.uniforms.rotation[3]=n.d/s),t.applyFilter(this,e,r,i)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0}),e}(on),$h=function(t,e){return($h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},tu="\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",eu='varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n',ru=function(t){function e(){return t.call(this,tu,eu)||this}return function(t,e){function r(){this.constructor=t}$h(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(on),iu=function(t,e){return(iu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},nu="precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",ou=function(t){function e(e,r){void 0===e&&(e=.5),void 0===r&&(r=Math.random());var i=t.call(this,Kn,nu,{uNoise:0,uSeed:0})||this;return i.noise=e,i.seed=r,i}return function(t,e){function r(){this.constructor=t}iu(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0}),e}(on);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(Mh||(Mh={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(Dh||(Dh={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(Nh||(Nh={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(wh||(wh={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ch||(Ch={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Lh||(Lh={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(Fh||(Fh={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(Uh||(Uh={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(Bh||(Bh={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(Gh||(Gh={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Xh||(Xh={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(kh||(kh={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(Hh||(Hh={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(Yh||(Yh={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(jh||(jh={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(Vh||(Vh={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(Wh||(Wh={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(zh||(zh={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(qh||(qh={}));var su=new Ze;ur.prototype._cacheAsBitmap=!1,ur.prototype._cacheData=null,ur.prototype._cacheAsBitmapResolution=null,ur.prototype._cacheAsBitmapMultisample=zh.NONE;var au=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null};Object.defineProperties(ur.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get:function(){return this._cacheAsBitmapMultisample},set:function(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new au),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),ur.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},ur.prototype._initCachedDisplayObject=function(t){var e;if(!this._cacheData||!this._cacheData.sprite){var r=this.alpha;this.alpha=1,t.batch.flush();var i=this.getLocalBounds(null,!0).clone();if(this.filters){var n=this.filters[0].padding;i.pad(n)}i.ceil(rt.RESOLUTION);var o=t.renderTexture.current,s=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),h=t.projection.transform,u=ni.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:null!==(e=this.cacheAsBitmapMultisample)&&void 0!==e?e:t.multisample}),l="cacheAsBitmap_"+Ie();this._cacheData.textureCacheId=l,Xr.addToCache(u.baseTexture,l),ri.addToCache(u,l);var c=this.transform.localTransform.copyTo(su).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:u,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=h,t.renderTexture.bind(o,s,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;var d=new Vs(u);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-i.x/i.width,d.anchor.y=-i.y/i.height,d.alpha=r,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=d.containsPoint.bind(d)}},ur.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},ur.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;var i=t.context,n=t._projTransform;e.ceil(rt.RESOLUTION);var o=ni.create({width:e.width,height:e.height}),s="cacheAsBitmap_"+Ie();this._cacheData.textureCacheId=s,Xr.addToCache(o.baseTexture,s),ri.addToCache(o,s);var a=su;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:a,skipUpdateTransform:!1}),t.context=i,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;var h=new Vs(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=r,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)}},ur.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},ur.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},ur.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Xr.removeFromCache(this._cacheData.textureCacheId),ri.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},ur.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},ur.prototype.name=null,dr.prototype.getChildByName=function(t,e){for(var r=0,i=this.children.length;r<i;r++)if(this.children[r].name===t)return this.children[r];if(e)for(r=0,i=this.children.length;r<i;r++)if(this.children[r].getChildByName){var n=this.children[r].getChildByName(t,!0);if(n)return n}return null},ur.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new qe),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var hu=function(t,e){return(hu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function uu(t,e){function r(){this.constructor=t}hu(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var lu=function(t){function e(e,r,i,n){void 0===e&&(e=100),void 0===r&&(r=100),void 0===i&&(i=10),void 0===n&&(n=10);var o=t.call(this)||this;return o.segWidth=i,o.segHeight=n,o.width=e,o.height=r,o.build(),o}return uu(e,t),e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,e=[],r=[],i=[],n=this.segWidth-1,o=this.segHeight-1,s=this.width/n,a=this.height/o,h=0;h<t;h++){var u=h%this.segWidth,l=h/this.segWidth|0;e.push(u*s,l*a),r.push(u/n,l/o)}var c=n*o;for(h=0;h<c;h++){var d=h%n,f=h/n|0,p=f*this.segWidth+d,_=f*this.segWidth+d+1,m=(f+1)*this.segWidth+d,v=(f+1)*this.segWidth+d+1;i.push(p,_,m,_,v,m)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(i),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(Ba),cu=function(t){function e(e,r,i){void 0===e&&(e=200),void 0===i&&(i=0);var n=t.call(this,new Float32Array(4*r.length),new Float32Array(4*r.length),new Uint16Array(6*(r.length-1)))||this;return n.points=r,n._width=e,n.textureScale=i,n.build(),n}return uu(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var t=this.points;if(t){var e=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),i=this.getIndex();if(!(t.length<1)){e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),r.data=new Float32Array(4*t.length),i.data=new Uint16Array(6*(t.length-1)));var n=r.data,o=i.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;for(var s=0,a=t[0],h=this._width*this.textureScale,u=t.length,l=0;l<u;l++){var c=4*l;if(this.textureScale>0){var d=a.x-t[l].x,f=a.y-t[l].y,p=Math.sqrt(d*d+f*f);a=t[l],s+=p/h}else s=l/(u-1);n[c]=s,n[c+1]=0,n[c+2]=s,n[c+3]=1}var _=0;for(l=0;l<u-1;l++)c=2*l,o[_++]=c,o[_++]=c+1,o[_++]=c+2,o[_++]=c+2,o[_++]=c+1,o[_++]=c+3;r.update(),i.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var e,r=t[0],i=0,n=0,o=this.buffers[0].data,s=t.length,a=0;a<s;a++){var h=t[a],u=4*a;n=-((e=a<t.length-1?t[a+1]:h).x-r.x),i=e.y-r.y;var l=Math.sqrt(i*i+n*n),c=this.textureScale>0?this.textureScale*this._width/2:this._width/2;i/=l,n/=l,i*=c,n*=c,o[u]=h.x+i,o[u+1]=h.y+n,o[u+2]=h.x-i,o[u+3]=h.y-n,r=h}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(Ba),du=function(e){function r(r,i,n){void 0===n&&(n=0);var o=this,s=new cu(r.height,i,n),a=new Ua(r);return n>0&&(r.baseTexture.wrapMode=t.WRAP_MODES.REPEAT),(o=e.call(this,s,a)||this).autoUpdate=!0,o}return uu(r,e),r.prototype._render=function(t){var r=this.geometry;(this.autoUpdate||r._width!==this.shader.texture.height)&&(r._width=this.shader.texture.height,r.update()),e.prototype._render.call(this,t)},r}(Ca),fu=function(t){function e(e,r,i){var n=this,o=new lu(e.width,e.height,r,i),s=new Ua(ri.WHITE);return(n=t.call(this,o,s)||this).texture=e,n.autoResize=!0,n}return uu(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry,e=this.shader.texture,r=e.width,i=e.height;!this.autoResize||t.width===r&&t.height===i||(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,e)},e.prototype.destroy=function(e){this.shader.texture.off("update",this.textureUpdated,this),t.prototype.destroy.call(this,e)},e}(Ca),pu=function(t){function e(e,r,i,n,o){void 0===e&&(e=ri.EMPTY);var s=this,a=new Ba(r,i,n);a.getBuffer("aVertexPosition").static=!1;var h=new Ua(e);return(s=t.call(this,a,h,null,o)||this).autoUpdate=!0,s}return uu(e,t),Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,e)},e}(Ca),_u=10,mu=function(t){function e(e,r,i,n,o){void 0===r&&(r=_u),void 0===i&&(i=_u),void 0===n&&(n=_u),void 0===o&&(o=_u);var s=t.call(this,ri.WHITE,4,4)||this;return s._origWidth=e.orig.width,s._origHeight=e.orig.height,s._width=s._origWidth,s._height=s._origHeight,s._leftWidth=r,s._rightWidth=n,s._topHeight=i,s._bottomHeight=o,s.texture=e,s}return uu(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,r=this._topHeight+this._bottomHeight,i=this._height>r?1:this._height/r;return Math.min(e,i)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var r=1/this._origWidth,i=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=i*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-i*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e}(fu),vu=function(t,e){return(vu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},yu=function(e){function r(t,r){void 0===r&&(r=!0);var i=e.call(this,t[0]instanceof ri?t[0]:t[0].texture)||this;return i._textures=null,i._durations=null,i._autoUpdate=r,i._isConnectedToTicker=!1,i.animationSpeed=1,i.loop=!0,i.updateAnchor=!1,i.onComplete=null,i.onFrameChange=null,i.onLoop=null,i._currentTime=0,i._playing=!1,i._previousFrame=null,i.textures=t,i}return function(t,e){function r(){this.constructor=t}vu(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,e),r.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(gr.shared.remove(this.update,this),this._isConnectedToTicker=!1))},r.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(gr.shared.add(this.update,this,t.UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},r.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},r.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},r.prototype.update=function(t){if(this._playing){var e=this.animationSpeed*t,r=this.currentFrame;if(null!==this._durations){var i=this._currentTime%1*this._durations[this.currentFrame];for(i+=e/60*1e3;i<0;)this._currentTime--,i+=this._durations[this.currentFrame];var n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);i>=this._durations[this.currentFrame];)i-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=i/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r?this.onLoop():this.animationSpeed<0&&this.currentFrame>r&&this.onLoop()),this.updateTexture())}},r.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},r.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},r.fromFrames=function(t){for(var e=[],i=0;i<t.length;++i)e.push(ri.from(t[i]));return new r(e)},r.fromImages=function(t){for(var e=[],i=0;i<t.length;++i)e.push(ri.from(t[i]));return new r(e)},Object.defineProperty(r.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof ri)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(gr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(gr.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),r}(Vs);Wn.registerPlugin("accessibility",yr),Wn.registerPlugin("extract",mo),Wn.registerPlugin("interaction",Mr),Wn.registerPlugin("particle",ls),Wn.registerPlugin("prepare",ma),Wn.registerPlugin("batch",so),Wn.registerPlugin("tilingSprite",Ia),Do.registerPlugin(Qa),Do.registerPlugin(Yo),Do.registerPlugin(Jo),Do.registerPlugin(is),Do.registerPlugin(Ea),fo.registerPlugin(Tr),fo.registerPlugin(wo);var Eu={AlphaFilter:th,BlurFilter:Sh,BlurFilterPass:Ah,ColorMatrixFilter:Ph,DisplacementFilter:Jh,FXAAFilter:ru,NoiseFilter:ou};return t.AbstractBatchRenderer=to,t.AbstractMultiResource=kr,t.AbstractRenderer=Yn,t.AccessibilityManager=yr,t.AnimatedSprite=yu,t.AppLoaderPlugin=wo,t.Application=fo,t.ArrayResource=Hr,t.Attribute=si,t.BaseImageResource=Yr,t.BasePrepare=da,t.BaseRenderTexture=$r,t.BaseTexture=Xr,t.BatchDrawCall=Qn,t.BatchGeometry=ro,t.BatchPluginFactory=oo,t.BatchRenderer=so,t.BatchShaderGenerator=eo,t.BatchSystem=Ri,t.BatchTextureArray=Jn,t.BitmapFont=za,t.BitmapFontData=Xa,t.BitmapFontLoader=Qa,t.BitmapText=Za,t.BlobResource=ko,t.Bounds=sr,t.Buffer=hi,t.BufferResource=Br,t.CanvasResource=jr,t.Circle=je,t.CompressedTextureLoader=Yo,t.CompressedTextureResource=Ho,t.Container=dr,t.ContextSystem=Ai,t.CountLimiter=na,t.CubeResource=Vr,t.DDSLoader=Jo,t.DEG_TO_RAD=He,t.DisplayObject=ur,t.Ellipse=Ve,t.Extract=mo,t.FORMATS_TO_COMPONENTS=es,t.FillStyle=ds,t.Filter=on,t.FilterState=yi,t.FilterSystem=Ti,t.Framebuffer=Jr,t.FramebufferSystem=Ii,t.GLFramebuffer=Si,t.GLProgram=Sn,t.GLTexture=Gn,t.GRAPHICS_CURVES=cs,t.Geometry=fi,t.GeometrySystem=Mi,t.Graphics=Xs,t.GraphicsData=ws,t.GraphicsGeometry=Fs,t.IGLUniformData=An,t.INSTALLED=Nr,t.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=Fo,t.ImageBitmapResource=Kr,t.ImageResource=Wr,t.InteractionData=br,t.InteractionEvent=xr,t.InteractionManager=Mr,t.InteractionTrackingData=Ar,t.KTXLoader=is,t.LineStyle=Us,t.Loader=Do,t.MaskData=Di,t.MaskSystem=cn,t.Matrix=Ze,t.Mesh=Ca,t.MeshBatchUvs=Da,t.MeshGeometry=Ba,t.MeshMaterial=Ua,t.NineSlicePlane=mu,t.ObjectRenderer=bi,t.ObservablePoint=Ke,t.PI_2=Xe,t.ParticleContainer=ss,t.ParticleRenderer=ls,t.PlaneGeometry=lu,t.Point=qe,t.Polygon=We,t.Prepare=ma,t.Program=en,t.ProjectionSystem=_n,t.Quad=pi,t.QuadUv=_i,t.RAD_TO_DEG=ke,t.Rectangle=Ye,t.RenderTexture=ni,t.RenderTexturePool=oi,t.RenderTextureSystem=yn,t.Renderer=Wn,t.Resource=Ur,t.RopeGeometry=cu,t.RoundedRectangle=ze,t.Runner=Dr,t.SVGResource=zr,t.ScissorSystem=fn,t.Shader=rn,t.ShaderSystem=Mn,t.SimpleMesh=pu,t.SimplePlane=fu,t.SimpleRope=du,t.Sprite=Vs,t.SpriteMaskFilter=ln,t.Spritesheet=ya,t.SpritesheetLoader=Ea,t.State=nn,t.StateSystem=Un,t.StencilSystem=pn,t.System=Zn,t.TYPES_TO_BYTES_PER_COMPONENT=ts,t.TYPES_TO_BYTES_PER_PIXEL=rs,t.TemporaryDisplayObject=lr,t.Text=ra,t.TextMetrics=$s,t.TextStyle=Ks,t.Texture=ri,t.TextureGCSystem=Bn,t.TextureLoader=Co,t.TextureMatrix=un,t.TextureSystem=Xn,t.TextureUvs=ti,t.Ticker=gr,t.TickerPlugin=Tr,t.TilingSprite=Ra,t.TilingSpriteRenderer=Ia,t.TimeLimiter=va,t.Transform=or,t.UniformGroup=vi,t.VERSION="6.1.0",t.VideoResource=qr,t.ViewableBuffer=$n,t.accessibleTarget=fr,t.autoDetectRenderer=zn,t.autoDetectResource=wr,t.checkMaxIfStatementsInShader=Ji,t.createUBOElements=bn,t.defaultFilterVertex=Kn,t.defaultVertex=qn,t.filters=Eu,t.generateProgram=On,t.generateUniformBufferSync=xn,t.getTestContext=Gi,t.getUBOData=Rn,t.graphicsUtils=ks,t.groupD8=nr,t.interactiveTarget=Or,t.isMobile=et,t.resources=ao,t.settings=rt,t.systems=lo,t.uniformParsers=zi,t.utils=Ge,t}({});this.PIXI=this.PIXI||{};this.PIXI.spine=this.PIXI.spine||{};(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("@pixi/loaders"),require("@pixi/core"),require("@pixi/constants"),require("@pixi/math"),require("@pixi/display"),require("@pixi/sprite"),require("@pixi/mesh-extras"),require("@pixi/graphics"),require("@pixi/utils")):typeof define==="function"&&define.amd?define(["exports","@pixi/loaders","@pixi/core","@pixi/constants","@pixi/math","@pixi/display","@pixi/sprite","@pixi/mesh-extras","@pixi/graphics","@pixi/utils"],factory):(global=typeof globalThis!=="undefined"?globalThis:global||self,factory(global.pixi_spine={},global.PIXI,global.PIXI,global.PIXI,global.PIXI,global.PIXI,global.PIXI,global.PIXI,global.PIXI,global.PIXI.utils))})(this,function(exports,loaders,core,constants,math,display,sprite,meshExtras,graphics,utils){"use strict";exports.AttachmentType=void 0;(function(AttachmentType){AttachmentType[AttachmentType["Region"]=0]="Region";AttachmentType[AttachmentType["BoundingBox"]=1]="BoundingBox";AttachmentType[AttachmentType["Mesh"]=2]="Mesh";AttachmentType[AttachmentType["LinkedMesh"]=3]="LinkedMesh";AttachmentType[AttachmentType["Path"]=4]="Path";AttachmentType[AttachmentType["Point"]=5]="Point";AttachmentType[AttachmentType["Clipping"]=6]="Clipping"})(exports.AttachmentType||(exports.AttachmentType={}));var BinaryInput=function(){function BinaryInput(data,strings,index,buffer){if(strings===void 0){strings=new Array}if(index===void 0){index=0}if(buffer===void 0){buffer=new DataView(data.buffer)}this.strings=strings;this.index=index;this.buffer=buffer}BinaryInput.prototype.readByte=function(){return this.buffer.getInt8(this.index++)};BinaryInput.prototype.readUnsignedByte=function(){return this.buffer.getUint8(this.index++)};BinaryInput.prototype.readShort=function(){var value=this.buffer.getInt16(this.index);this.index+=2;return value};BinaryInput.prototype.readInt32=function(){var value=this.buffer.getInt32(this.index);this.index+=4;return value};BinaryInput.prototype.readInt=function(optimizePositive){var b=this.readByte();var result=b&127;if((b&128)!=0){b=this.readByte();result|=(b&127)<<7;if((b&128)!=0){b=this.readByte();result|=(b&127)<<14;if((b&128)!=0){b=this.readByte();result|=(b&127)<<21;if((b&128)!=0){b=this.readByte();result|=(b&127)<<28}}}}return optimizePositive?result:result>>>1^-(result&1)};BinaryInput.prototype.readStringRef=function(){var index=this.readInt(true);return index==0?null:this.strings[index-1]};BinaryInput.prototype.readString=function(){var byteCount=this.readInt(true);switch(byteCount){case 0:return null;case 1:return""}byteCount--;var chars="";for(var i=0;i<byteCount;){var b=this.readByte();switch(b>>4){case 12:case 13:chars+=String.fromCharCode((b&31)<<6|this.readByte()&63);i+=2;break;case 14:chars+=String.fromCharCode((b&15)<<12|(this.readByte()&63)<<6|this.readByte()&63);i+=3;break;default:chars+=String.fromCharCode(b);i++}}return chars};BinaryInput.prototype.readFloat=function(){var value=this.buffer.getFloat32(this.index);this.index+=4;return value};BinaryInput.prototype.readBoolean=function(){return this.readByte()!=0};return BinaryInput}();var extendStatics$4=function(d,b){extendStatics$4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics$4(d,b)};function __extends$4(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics$4(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}function filterFromString(text){switch(text.toLowerCase()){case"nearest":return exports.TextureFilter.Nearest;case"linear":return exports.TextureFilter.Linear;case"mipmap":return exports.TextureFilter.MipMap;case"mipmapnearestnearest":return exports.TextureFilter.MipMapNearestNearest;case"mipmaplinearnearest":return exports.TextureFilter.MipMapLinearNearest;case"mipmapnearestlinear":return exports.TextureFilter.MipMapNearestLinear;case"mipmaplinearlinear":return exports.TextureFilter.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+text)}}function wrapFromString(text){switch(text.toLowerCase()){case"mirroredtepeat":return exports.TextureWrap.MirroredRepeat;case"clamptoedge":return exports.TextureWrap.ClampToEdge;case"repeat":return exports.TextureWrap.Repeat;default:throw new Error("Unknown texture wrap "+text)}}exports.TextureFilter=void 0;(function(TextureFilter){TextureFilter[TextureFilter["Nearest"]=9728]="Nearest";TextureFilter[TextureFilter["Linear"]=9729]="Linear";TextureFilter[TextureFilter["MipMap"]=9987]="MipMap";TextureFilter[TextureFilter["MipMapNearestNearest"]=9984]="MipMapNearestNearest";TextureFilter[TextureFilter["MipMapLinearNearest"]=9985]="MipMapLinearNearest";TextureFilter[TextureFilter["MipMapNearestLinear"]=9986]="MipMapNearestLinear";TextureFilter[TextureFilter["MipMapLinearLinear"]=9987]="MipMapLinearLinear"})(exports.TextureFilter||(exports.TextureFilter={}));exports.TextureWrap=void 0;(function(TextureWrap){TextureWrap[TextureWrap["MirroredRepeat"]=33648]="MirroredRepeat";TextureWrap[TextureWrap["ClampToEdge"]=33071]="ClampToEdge";TextureWrap[TextureWrap["Repeat"]=10497]="Repeat"})(exports.TextureWrap||(exports.TextureWrap={}));var TextureRegion=function(){function TextureRegion(){this.size=null;this.names=null;this.values=null}Object.defineProperty(TextureRegion.prototype,"width",{get:function(){var tex=this.texture;if(tex.trim){return tex.trim.width}return tex.orig.width},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"height",{get:function(){var tex=this.texture;if(tex.trim){return tex.trim.height}return tex.orig.height},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"u",{get:function(){return this.texture._uvs.x0},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"v",{get:function(){return this.texture._uvs.y0},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"u2",{get:function(){return this.texture._uvs.x2},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"v2",{get:function(){return this.texture._uvs.y2},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"offsetX",{get:function(){var tex=this.texture;return tex.trim?tex.trim.x:0},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"offsetY",{get:function(){return this.spineOffsetY},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"pixiOffsetY",{get:function(){var tex=this.texture;return tex.trim?tex.trim.y:0},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"spineOffsetY",{get:function(){var tex=this.texture;return this.originalHeight-this.height-(tex.trim?tex.trim.y:0)},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"originalWidth",{get:function(){return this.texture.orig.width},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"originalHeight",{get:function(){return this.texture.orig.height},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"x",{get:function(){return this.texture.frame.x},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"y",{get:function(){return this.texture.frame.y},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"rotate",{get:function(){return this.texture.rotate!==0},enumerable:false,configurable:true});Object.defineProperty(TextureRegion.prototype,"degrees",{get:function(){return(360-this.texture.rotate*45)%360},enumerable:false,configurable:true});return TextureRegion}();var RegionFields=function(){function RegionFields(){this.x=0;this.y=0;this.width=0;this.height=0;this.offsetX=0;this.offsetY=0;this.originalWidth=0;this.originalHeight=0;this.rotate=0;this.index=0}return RegionFields}();var TextureAtlas=function(){function TextureAtlas(atlasText,textureLoader,callback){this.pages=new Array;this.regions=new Array;if(atlasText){this.addSpineAtlas(atlasText,textureLoader,callback)}}TextureAtlas.prototype.addTexture=function(name,texture){var pages=this.pages;var page=null;for(var i=0;i<pages.length;i++){if(pages[i].baseTexture===texture.baseTexture){page=pages[i];break}}if(page===null){page=new TextureAtlasPage;page.name="texturePage";var baseTexture=texture.baseTexture;page.width=baseTexture.realWidth;page.height=baseTexture.realHeight;page.baseTexture=baseTexture;page.minFilter=page.magFilter=exports.TextureFilter.Nearest;page.uWrap=exports.TextureWrap.ClampToEdge;page.vWrap=exports.TextureWrap.ClampToEdge;pages.push(page)}var region=new TextureAtlasRegion;region.name=name;region.page=page;region.texture=texture;region.index=-1;this.regions.push(region);return region};TextureAtlas.prototype.addTextureHash=function(textures,stripExtension){for(var key in textures){if(textures.hasOwnProperty(key)){this.addTexture(stripExtension&&key.indexOf(".")!==-1?key.substr(0,key.lastIndexOf(".")):key,textures[key])}}};TextureAtlas.prototype.addSpineAtlas=function(atlasText,textureLoader,callback){return this.load(atlasText,textureLoader,callback)};TextureAtlas.prototype.load=function(atlasText,textureLoader,callback){var _this=this;if(textureLoader==null)throw new Error("textureLoader cannot be null.");var reader=new TextureAtlasReader(atlasText);var entry=new Array(4);var page=null;var pageFields={};var region=null;pageFields["size"]=function(){page.width=parseInt(entry[1]);page.height=parseInt(entry[2])};pageFields["format"]=function(){};pageFields["filter"]=function(){page.minFilter=filterFromString(entry[1]);page.magFilter=filterFromString(entry[2])};pageFields["repeat"]=function(){if(entry[1].indexOf("x")!=-1)page.uWrap=exports.TextureWrap.Repeat;if(entry[1].indexOf("y")!=-1)page.vWrap=exports.TextureWrap.Repeat};pageFields["pma"]=function(){page.pma=entry[1]=="true"};var regionFields={};regionFields["xy"]=function(){region.x=parseInt(entry[1]);region.y=parseInt(entry[2])};regionFields["size"]=function(){region.width=parseInt(entry[1]);region.height=parseInt(entry[2])};regionFields["bounds"]=function(){region.x=parseInt(entry[1]);region.y=parseInt(entry[2]);region.width=parseInt(entry[3]);region.height=parseInt(entry[4])};regionFields["offset"]=function(){region.offsetX=parseInt(entry[1]);region.offsetY=parseInt(entry[2])};regionFields["orig"]=function(){region.originalWidth=parseInt(entry[1]);region.originalHeight=parseInt(entry[2])};regionFields["offsets"]=function(){region.offsetX=parseInt(entry[1]);region.offsetY=parseInt(entry[2]);region.originalWidth=parseInt(entry[3]);region.originalHeight=parseInt(entry[4])};regionFields["rotate"]=function(){var rotateValue=entry[1];var rotate=0;if(rotateValue.toLocaleLowerCase()=="true"){rotate=6}else if(rotateValue.toLocaleLowerCase()=="false"){rotate=0}else{rotate=(720-parseFloat(rotateValue))%360/45}region.rotate=rotate};regionFields["index"]=function(){region.index=parseInt(entry[1])};var line=reader.readLine();while(line!=null&&line.trim().length==0)line=reader.readLine();while(true){if(line==null||line.trim().length==0)break;if(reader.readEntry(entry,line)==0)break;line=reader.readLine()}var iterateParser=function(){while(true){if(line==null){return callback&&callback(_this)}if(line.trim().length==0){page=null;line=reader.readLine()}else if(page===null){page=new TextureAtlasPage;page.name=line.trim();while(true){if(reader.readEntry(entry,line=reader.readLine())==0)break;var field=pageFields[entry[0]];if(field)field()}_this.pages.push(page);textureLoader(page.name,function(texture){if(texture===null){_this.pages.splice(_this.pages.indexOf(page),1);return callback&&callback(null)}page.baseTexture=texture;if(page.pma){texture.alphaMode=constants.ALPHA_MODES.PMA}if(!texture.valid){texture.setSize(page.width,page.height)}_this.pages.push(page);page.setFilters();if(!page.width||!page.height){page.width=texture.realWidth;page.height=texture.realHeight;if(!page.width||!page.height){console.log("ERROR spine atlas page "+page.name+": meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)")}}iterateParser()});_this.pages.push(page);break}else{region=new RegionFields;var atlasRegion=new TextureAtlasRegion;atlasRegion.name=line;atlasRegion.page=page;var names=null;var values=null;while(true){var count=reader.readEntry(entry,line=reader.readLine());if(count==0)break;var field=regionFields[entry[0]];if(field)field();else{if(names==null){names=[];values=[]}names.push(entry[0]);var entryValues=[];for(var i=0;i<count;i++)entryValues.push(parseInt(entry[i+1]));values.push(entryValues)}}if(region.originalWidth==0&&region.originalHeight==0){region.originalWidth=region.width;region.originalHeight=region.height}var resolution=page.baseTexture.resolution;region.x/=resolution;region.y/=resolution;region.width/=resolution;region.height/=resolution;region.originalWidth/=resolution;region.originalHeight/=resolution;region.offsetX/=resolution;region.offsetY/=resolution;var swapWH=region.rotate%4!==0;var frame=new math.Rectangle(region.x,region.y,swapWH?region.height:region.width,swapWH?region.width:region.height);var orig=new math.Rectangle(0,0,region.originalWidth,region.originalHeight);var trim=new math.Rectangle(region.offsetX,region.originalHeight-region.height-region.offsetY,region.width,region.height);atlasRegion.texture=new core.Texture(atlasRegion.page.baseTexture,frame,orig,trim,region.rotate);atlasRegion.index=region.index;atlasRegion.texture.updateUvs();_this.regions.push(atlasRegion)}}};iterateParser()};TextureAtlas.prototype.findRegion=function(name){for(var i=0;i<this.regions.length;i++){if(this.regions[i].name==name){return this.regions[i]}}return null};TextureAtlas.prototype.dispose=function(){for(var i=0;i<this.pages.length;i++){this.pages[i].baseTexture.dispose()}};return TextureAtlas}();var TextureAtlasReader=function(){function TextureAtlasReader(text){this.index=0;this.lines=text.split(/\r\n|\r|\n/)}TextureAtlasReader.prototype.readLine=function(){if(this.index>=this.lines.length)return null;return this.lines[this.index++]};TextureAtlasReader.prototype.readEntry=function(entry,line){if(line==null)return 0;line=line.trim();if(line.length==0)return 0;var colon=line.indexOf(":");if(colon==-1)return 0;entry[0]=line.substr(0,colon).trim();for(var i=1,lastMatch=colon+1;;i++){var comma=line.indexOf(",",lastMatch);if(comma==-1){entry[i]=line.substr(lastMatch).trim();return i}entry[i]=line.substr(lastMatch,comma-lastMatch).trim();lastMatch=comma+1;if(i==4)return 4}};return TextureAtlasReader}();var TextureAtlasPage=function(){function TextureAtlasPage(){this.minFilter=exports.TextureFilter.Nearest;this.magFilter=exports.TextureFilter.Nearest;this.uWrap=exports.TextureWrap.ClampToEdge;this.vWrap=exports.TextureWrap.ClampToEdge}TextureAtlasPage.prototype.setFilters=function(){var tex=this.baseTexture;var filter=this.minFilter;if(filter==exports.TextureFilter.Linear){tex.scaleMode=constants.SCALE_MODES.LINEAR}else if(this.minFilter==exports.TextureFilter.Nearest){tex.scaleMode=constants.SCALE_MODES.NEAREST}else{tex.mipmap=constants.MIPMAP_MODES.POW2;if(filter==exports.TextureFilter.MipMapNearestNearest){tex.scaleMode=constants.SCALE_MODES.NEAREST}else{tex.scaleMode=constants.SCALE_MODES.LINEAR}}};return TextureAtlasPage}();var TextureAtlasRegion=function(_super){__extends$4(TextureAtlasRegion,_super);function TextureAtlasRegion(){return _super!==null&&_super.apply(this,arguments)||this}return TextureAtlasRegion}(TextureRegion);var fround_polyfill=function(array){return function(x){return array[0]=x,array[0]}}(new Float32Array(1));var fround=Math.fround||fround_polyfill;var IntSet=function(){function IntSet(){this.array=new Array}IntSet.prototype.add=function(value){var contains=this.contains(value);this.array[value|0]=value|0;return!contains};IntSet.prototype.contains=function(value){return this.array[value|0]!=undefined};IntSet.prototype.remove=function(value){this.array[value|0]=undefined};IntSet.prototype.clear=function(){this.array.length=0};return IntSet}();var StringSet=function(){function StringSet(){this.entries={};this.size=0}StringSet.prototype.add=function(value){var contains=this.entries[value];this.entries[value]=true;if(!contains){this.size++;return true}return false};StringSet.prototype.addAll=function(values){var oldSize=this.size;for(var i=0,n=values.length;i<n;i++)this.add(values[i]);return oldSize!=this.size};StringSet.prototype.contains=function(value){return this.entries[value]};StringSet.prototype.clear=function(){this.entries={};this.size=0};return StringSet}();var Color=function(){function Color(r,g,b,a){if(r===void 0){r=0}if(g===void 0){g=0}if(b===void 0){b=0}if(a===void 0){a=0}this.r=r;this.g=g;this.b=b;this.a=a}Color.prototype.set=function(r,g,b,a){this.r=r;this.g=g;this.b=b;this.a=a;return this.clamp()};Color.prototype.setFromColor=function(c){this.r=c.r;this.g=c.g;this.b=c.b;this.a=c.a;return this};Color.prototype.setFromString=function(hex){hex=hex.charAt(0)=="#"?hex.substr(1):hex;this.r=parseInt(hex.substr(0,2),16)/255;this.g=parseInt(hex.substr(2,2),16)/255;this.b=parseInt(hex.substr(4,2),16)/255;this.a=hex.length!=8?1:parseInt(hex.substr(6,2),16)/255;return this};Color.prototype.add=function(r,g,b,a){this.r+=r;this.g+=g;this.b+=b;this.a+=a;return this.clamp()};Color.prototype.clamp=function(){if(this.r<0)this.r=0;else if(this.r>1)this.r=1;if(this.g<0)this.g=0;else if(this.g>1)this.g=1;if(this.b<0)this.b=0;else if(this.b>1)this.b=1;if(this.a<0)this.a=0;else if(this.a>1)this.a=1;return this};Color.rgba8888ToColor=function(color,value){color.r=((value&4278190080)>>>24)/255;color.g=((value&16711680)>>>16)/255;color.b=((value&65280)>>>8)/255;color.a=(value&255)/255};Color.rgb888ToColor=function(color,value){color.r=((value&16711680)>>>16)/255;color.g=((value&65280)>>>8)/255;color.b=(value&255)/255};Color.fromString=function(hex){return(new Color).setFromString(hex)};Color.WHITE=new Color(1,1,1,1);Color.RED=new Color(1,0,0,1);Color.GREEN=new Color(0,1,0,1);Color.BLUE=new Color(0,0,1,1);Color.MAGENTA=new Color(1,0,1,1);return Color}();var MathUtils=function(){function MathUtils(){}MathUtils.clamp=function(value,min,max){if(value<min)return min;if(value>max)return max;return value};MathUtils.cosDeg=function(degrees){return Math.cos(degrees*MathUtils.degRad)};MathUtils.sinDeg=function(degrees){return Math.sin(degrees*MathUtils.degRad)};MathUtils.signum=function(value){return value>0?1:value<0?-1:0};MathUtils.toInt=function(x){return x>0?Math.floor(x):Math.ceil(x)};MathUtils.cbrt=function(x){var y=Math.pow(Math.abs(x),1/3);return x<0?-y:y};MathUtils.randomTriangular=function(min,max){return MathUtils.randomTriangularWith(min,max,(min+max)*.5)};MathUtils.randomTriangularWith=function(min,max,mode){var u=Math.random();var d=max-min;if(u<=(mode-min)/d)return min+Math.sqrt(u*d*(mode-min));return max-Math.sqrt((1-u)*d*(max-mode))};MathUtils.PI=3.1415927;MathUtils.PI2=MathUtils.PI*2;MathUtils.radiansToDegrees=180/MathUtils.PI;MathUtils.radDeg=MathUtils.radiansToDegrees;MathUtils.degreesToRadians=MathUtils.PI/180;MathUtils.degRad=MathUtils.degreesToRadians;return MathUtils}();var Interpolation=function(){function Interpolation(){}Interpolation.prototype.apply=function(start,end,a){return start+(end-start)*this.applyInternal(a)};return Interpolation}();var Pow=function(_super){__extends$4(Pow,_super);function Pow(power){var _this=_super.call(this)||this;_this.power=2;_this.power=power;return _this}Pow.prototype.applyInternal=function(a){if(a<=.5)return Math.pow(a*2,this.power)/2;return Math.pow((a-1)*2,this.power)/(this.power%2==0?-2:2)+1};return Pow}(Interpolation);var PowOut=function(_super){__extends$4(PowOut,_super);function PowOut(power){return _super.call(this,power)||this}PowOut.prototype.applyInternal=function(a){return Math.pow(a-1,this.power)*(this.power%2==0?-1:1)+1};return PowOut}(Pow);var Utils=function(){function Utils(){}Utils.arrayCopy=function(source,sourceStart,dest,destStart,numElements){for(var i=sourceStart,j=destStart;i<sourceStart+numElements;i++,j++){dest[j]=source[i]}};Utils.arrayFill=function(array,fromIndex,toIndex,value){for(var i=fromIndex;i<toIndex;i++)array[i]=value};Utils.setArraySize=function(array,size,value){if(value===void 0){value=0}var oldSize=array.length;if(oldSize==size)return array;array.length=size;if(oldSize<size){for(var i=oldSize;i<size;i++)array[i]=value}return array};Utils.ensureArrayCapacity=function(array,size,value){if(value===void 0){value=0}if(array.length>=size)return array;return Utils.setArraySize(array,size,value)};Utils.newArray=function(size,defaultValue){var array=new Array(size);for(var i=0;i<size;i++)array[i]=defaultValue;return array};Utils.newFloatArray=function(size){if(Utils.SUPPORTS_TYPED_ARRAYS)return new Float32Array(size);else{var array=new Array(size);for(var i=0;i<array.length;i++)array[i]=0;return array}};Utils.newShortArray=function(size){if(Utils.SUPPORTS_TYPED_ARRAYS)return new Int16Array(size);else{var array=new Array(size);for(var i=0;i<array.length;i++)array[i]=0;return array}};Utils.toFloatArray=function(array){return Utils.SUPPORTS_TYPED_ARRAYS?new Float32Array(array):array};Utils.toSinglePrecision=function(value){return Utils.SUPPORTS_TYPED_ARRAYS?fround(value):value};Utils.webkit602BugfixHelper=function(alpha,blend){};Utils.contains=function(array,element,identity){for(var i=0;i<array.length;i++)if(array[i]==element)return true;return false};Utils.enumValue=function(type,name){return type[name[0].toUpperCase()+name.slice(1)]};Utils.SUPPORTS_TYPED_ARRAYS=typeof Float32Array!=="undefined";return Utils}();var DebugUtils=function(){function DebugUtils(){}DebugUtils.logBones=function(skeleton){for(var i=0;i<skeleton.bones.length;i++){var bone=skeleton.bones[i];var mat=bone.matrix;console.log(bone.data.name+", "+mat.a+", "+mat.b+", "+mat.c+", "+mat.d+", "+mat.tx+", "+mat.ty)}};return DebugUtils}();var Pool=function(){function Pool(instantiator){this.items=new Array;this.instantiator=instantiator}Pool.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()};Pool.prototype.free=function(item){if(item.reset)item.reset();this.items.push(item)};Pool.prototype.freeAll=function(items){for(var i=0;i<items.length;i++)this.free(items[i])};Pool.prototype.clear=function(){this.items.length=0};return Pool}();var Vector2=function(){function Vector2(x,y){if(x===void 0){x=0}if(y===void 0){y=0}this.x=x;this.y=y}Vector2.prototype.set=function(x,y){this.x=x;this.y=y;return this};Vector2.prototype.length=function(){var x=this.x;var y=this.y;return Math.sqrt(x*x+y*y)};Vector2.prototype.normalize=function(){var len=this.length();if(len!=0){this.x/=len;this.y/=len}return this};return Vector2}();var TimeKeeper=function(){function TimeKeeper(){this.maxDelta=.064;this.framesPerSecond=0;this.delta=0;this.totalTime=0;this.lastTime=Date.now()/1e3;this.frameCount=0;this.frameTime=0}TimeKeeper.prototype.update=function(){var now=Date.now()/1e3;this.delta=now-this.lastTime;this.frameTime+=this.delta;this.totalTime+=this.delta;if(this.delta>this.maxDelta)this.delta=this.maxDelta;this.lastTime=now;this.frameCount++;if(this.frameTime>1){this.framesPerSecond=this.frameCount/this.frameTime;this.frameTime=0;this.frameCount=0}};return TimeKeeper}();var WindowedMean=function(){function WindowedMean(windowSize){if(windowSize===void 0){windowSize=32}this.addedValues=0;this.lastValue=0;this.mean=0;this.dirty=true;this.values=new Array(windowSize)}WindowedMean.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length};WindowedMean.prototype.addValue=function(value){if(this.addedValues<this.values.length)this.addedValues++;this.values[this.lastValue++]=value;if(this.lastValue>this.values.length-1)this.lastValue=0;this.dirty=true};WindowedMean.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){var mean=0;for(var i=0;i<this.values.length;i++)mean+=this.values[i];this.mean=mean/this.values.length;this.dirty=false}return this.mean}return 0};return WindowedMean}();var settings={yDown:true,FAIL_ON_NON_EXISTING_SKIN:false,GLOBAL_AUTO_UPDATE:true,GLOBAL_DELAY_LIMIT:0};var tempRgb=[0,0,0];var SpineSprite=function(_super){__extends$4(SpineSprite,_super);function SpineSprite(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.region=null;_this.attachment=null;return _this}return SpineSprite}(sprite.Sprite);var SpineMesh=function(_super){__extends$4(SpineMesh,_super);function SpineMesh(texture,vertices,uvs,indices,drawMode){var _this=_super.call(this,texture,vertices,uvs,indices,drawMode)||this;_this.region=null;_this.attachment=null;return _this}return SpineMesh}(meshExtras.SimpleMesh);var SpineBase=function(_super){__extends$4(SpineBase,_super);function SpineBase(spineData){var _this=_super.call(this)||this;if(!spineData){throw new Error("The spineData param is required.")}if(typeof spineData==="string"){throw new Error('spineData param cant be string. Please use spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.')}_this.spineData=spineData;_this.createSkeleton(spineData);_this.slotContainers=[];_this.tempClipContainers=[];for(var i=0,n=_this.skeleton.slots.length;i<n;i++){var slot=_this.skeleton.slots[i];var attachment=slot.getAttachment();var slotContainer=_this.newContainer();_this.slotContainers.push(slotContainer);_this.addChild(slotContainer);_this.tempClipContainers.push(null);if(!attachment){continue}if(attachment.type===exports.AttachmentType.Region){var spriteName=attachment.region.name;var sprite=_this.createSprite(slot,attachment,spriteName);slot.currentSprite=sprite;slot.currentSpriteName=spriteName;slotContainer.addChild(sprite)}else if(attachment.type===exports.AttachmentType.Mesh){var mesh=_this.createMesh(slot,attachment);slot.currentMesh=mesh;slot.currentMeshId=attachment.id;slot.currentMeshName=attachment.name;slotContainer.addChild(mesh)}else if(attachment.type===exports.AttachmentType.Clipping){_this.createGraphics(slot,attachment);slotContainer.addChild(slot.clippingContainer);slotContainer.addChild(slot.currentGraphics)}}_this.tintRgb=new Float32Array([1,1,1]);_this.autoUpdate=true;_this.visible=true;return _this}Object.defineProperty(SpineBase.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(value){if(value!==this._autoUpdate){this._autoUpdate=value;this.updateTransform=value?SpineBase.prototype.autoUpdateTransform:display.Container.prototype.updateTransform}},enumerable:false,configurable:true});Object.defineProperty(SpineBase.prototype,"tint",{get:function(){return utils.rgb2hex(this.tintRgb)},set:function(value){this.tintRgb=utils.hex2rgb(value,this.tintRgb)},enumerable:false,configurable:true});Object.defineProperty(SpineBase.prototype,"delayLimit",{get:function(){var limit=typeof this.localDelayLimit!=="undefined"?this.localDelayLimit:settings.GLOBAL_DELAY_LIMIT;return limit||Number.MAX_VALUE},enumerable:false,configurable:true});SpineBase.prototype.update=function(dt){var delayLimit=this.delayLimit;if(dt>delayLimit)dt=delayLimit;this.state.update(dt);this.state.apply(this.skeleton);if(!this.skeleton)return;this.skeleton.updateWorldTransform();var slots=this.skeleton.slots;var globalClr=this.color;var light=null,dark=null;if(globalClr){light=globalClr.light;dark=globalClr.dark}else{light=this.tintRgb}for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];var attachment=slot.getAttachment();var slotContainer=this.slotContainers[i];if(!attachment){slotContainer.visible=false;continue}var spriteColor=null;var attColor=attachment.color;switch(attachment.type){case exports.AttachmentType.Region:var region=attachment.region;if(region){if(slot.currentMesh){slot.currentMesh.visible=false;slot.currentMesh=null;slot.currentMeshId=undefined;slot.currentMeshName=undefined}var ar=region;if(!slot.currentSpriteName||slot.currentSpriteName!==ar.name){var spriteName=ar.name;if(slot.currentSprite){slot.currentSprite.visible=false}slot.sprites=slot.sprites||{};if(slot.sprites[spriteName]!==undefined){slot.sprites[spriteName].visible=true}else{var sprite=this.createSprite(slot,attachment,spriteName);slotContainer.addChild(sprite)}slot.currentSprite=slot.sprites[spriteName];slot.currentSpriteName=spriteName}else if(slot.currentSpriteName===ar.name&&!slot.hackRegion){this.setSpriteRegion(attachment,slot.currentSprite,region)}}var transform=slotContainer.transform;transform.setFromMatrix(slot.bone.matrix);if(slot.currentSprite.color){spriteColor=slot.currentSprite.color}else{tempRgb[0]=light[0]*slot.color.r*attColor.r;tempRgb[1]=light[1]*slot.color.g*attColor.g;tempRgb[2]=light[2]*slot.color.b*attColor.b;slot.currentSprite.tint=utils.rgb2hex(tempRgb)}slot.currentSprite.blendMode=slot.blendMode;break;case exports.AttachmentType.Mesh:if(slot.currentSprite){slot.currentSprite.visible=false;slot.currentSprite=null;slot.currentSpriteName=undefined;var transform_1=new math.Transform;transform_1._parentID=-1;transform_1._worldID=slotContainer.transform._worldID;slotContainer.transform=transform_1}var id=attachment.id;if(!slot.currentMeshId||slot.currentMeshId!==id){var meshId=id;if(slot.currentMesh){slot.currentMesh.visible=false}slot.meshes=slot.meshes||{};if(slot.meshes[meshId]!==undefined){slot.meshes[meshId].visible=true}else{var mesh=this.createMesh(slot,attachment);slotContainer.addChild(mesh)}slot.currentMesh=slot.meshes[meshId];slot.currentMeshName=attachment.name;slot.currentMeshId=meshId}attachment.computeWorldVerticesOld(slot,slot.currentMesh.vertices);if(slot.currentMesh.color){spriteColor=slot.currentMesh.color}else{tempRgb[0]=light[0]*slot.color.r*attColor.r;tempRgb[1]=light[1]*slot.color.g*attColor.g;tempRgb[2]=light[2]*slot.color.b*attColor.b;slot.currentMesh.tint=utils.rgb2hex(tempRgb)}slot.currentMesh.blendMode=slot.blendMode;break;case exports.AttachmentType.Clipping:if(!slot.currentGraphics){this.createGraphics(slot,attachment);slotContainer.addChild(slot.clippingContainer);slotContainer.addChild(slot.currentGraphics)}this.updateGraphics(slot,attachment);slotContainer.alpha=1;slotContainer.visible=true;continue;default:slotContainer.visible=false;continue}slotContainer.visible=true;if(spriteColor){var r0=slot.color.r*attColor.r;var g0=slot.color.g*attColor.g;var b0=slot.color.b*attColor.b;spriteColor.setLight(light[0]*r0+dark[0]*(1-r0),light[1]*g0+dark[1]*(1-g0),light[2]*b0+dark[2]*(1-b0));if(slot.darkColor){r0=slot.darkColor.r;g0=slot.darkColor.g;b0=slot.darkColor.b}else{r0=0;g0=0;b0=0}spriteColor.setDark(light[0]*r0+dark[0]*(1-r0),light[1]*g0+dark[1]*(1-g0),light[2]*b0+dark[2]*(1-b0))}slotContainer.alpha=slot.color.a}var drawOrder=this.skeleton.drawOrder;var clippingAttachment=null;var clippingContainer=null;for(var i=0,n=drawOrder.length;i<n;i++){var slot=slots[drawOrder[i].data.index];var slotContainer=this.slotContainers[drawOrder[i].data.index];if(!clippingContainer){if(slotContainer.parent!==null&&slotContainer.parent!==this){slotContainer.parent.removeChild(slotContainer);slotContainer.parent=this}}if(slot.currentGraphics&&slot.getAttachment()){clippingContainer=slot.clippingContainer;clippingAttachment=slot.getAttachment();clippingContainer.children.length=0;this.children[i]=slotContainer;if(clippingAttachment.endSlot===slot.data){clippingAttachment.endSlot=null}}else{if(clippingContainer){var c=this.tempClipContainers[i];if(!c){c=this.tempClipContainers[i]=this.newContainer();c.visible=false}this.children[i]=c;slotContainer.parent=null;clippingContainer.addChild(slotContainer);if(clippingAttachment.endSlot==slot.data){clippingContainer.renderable=true;clippingContainer=null;clippingAttachment=null}}else{this.children[i]=slotContainer}}}};SpineBase.prototype.setSpriteRegion=function(attachment,sprite,region){if(sprite.attachment===attachment&&sprite.region===region){return}sprite.region=region;sprite.attachment=attachment;sprite.texture=region.texture;sprite.rotation=attachment.rotation*MathUtils.degRad;sprite.position.x=attachment.x;sprite.position.y=attachment.y;sprite.alpha=attachment.color.a;if(!region.size){sprite.scale.x=attachment.scaleX*attachment.width/region.originalWidth;sprite.scale.y=-attachment.scaleY*attachment.height/region.originalHeight}else{sprite.scale.x=region.size.width/region.originalWidth;sprite.scale.y=-region.size.height/region.originalHeight}};SpineBase.prototype.setMeshRegion=function(attachment,mesh,region){if(mesh.attachment===attachment&&mesh.region===region){return}mesh.region=region;mesh.attachment=attachment;mesh.texture=region.texture;region.texture.updateUvs();mesh.uvBuffer.update(attachment.regionUVs)};SpineBase.prototype.autoUpdateTransform=function(){if(settings.GLOBAL_AUTO_UPDATE){this.lastTime=this.lastTime||Date.now();var timeDelta=(Date.now()-this.lastTime)*.001;this.lastTime=Date.now();this.update(timeDelta)}else{this.lastTime=0}display.Container.prototype.updateTransform.call(this)};SpineBase.prototype.createSprite=function(slot,attachment,defName){var region=attachment.region;if(slot.hackAttachment===attachment){region=slot.hackRegion}var texture=region.texture;var sprite=this.newSprite(texture);sprite.anchor.set(.5);this.setSpriteRegion(attachment,sprite,attachment.region);slot.sprites=slot.sprites||{};slot.sprites[defName]=sprite;return sprite};SpineBase.prototype.createMesh=function(slot,attachment){var region=attachment.region;if(slot.hackAttachment===attachment){region=slot.hackRegion;slot.hackAttachment=null;slot.hackRegion=null}var strip=this.newMesh(region.texture,new Float32Array(attachment.regionUVs.length),attachment.regionUVs,new Uint16Array(attachment.triangles),constants.DRAW_MODES.TRIANGLES);if(typeof strip._canvasPadding!=="undefined"){strip._canvasPadding=1.5}strip.alpha=attachment.color.a;strip.region=attachment.region;this.setMeshRegion(attachment,strip,region);slot.meshes=slot.meshes||{};slot.meshes[attachment.id]=strip;return strip};SpineBase.prototype.createGraphics=function(slot,clip){var graphics=this.newGraphics();var poly=new math.Polygon([]);graphics.clear();graphics.beginFill(16777215,1);graphics.drawPolygon(poly);graphics.renderable=false;slot.currentGraphics=graphics;slot.clippingContainer=this.newContainer();slot.clippingContainer.mask=slot.currentGraphics;return graphics};SpineBase.prototype.updateGraphics=function(slot,clip){var geom=slot.currentGraphics.geometry;var vertices=geom.graphicsData[0].shape.points;var n=clip.worldVerticesLength;vertices.length=n;clip.computeWorldVertices(slot,0,n,vertices,0,2);geom.invalidate()};SpineBase.prototype.hackTextureBySlotIndex=function(slotIndex,texture,size){if(texture===void 0){texture=null}if(size===void 0){size=null}var slot=this.skeleton.slots[slotIndex];if(!slot){return false}var attachment=slot.getAttachment();var region=attachment.region;if(texture){region=new TextureRegion;region.texture=texture;region.size=size;slot.hackRegion=region;slot.hackAttachment=attachment}else{slot.hackRegion=null;slot.hackAttachment=null}if(slot.currentSprite&&slot.currentSprite.region!=region){this.setSpriteRegion(attachment,slot.currentSprite,region);slot.currentSprite.region=region}else if(slot.currentMesh&&slot.currentMesh.region!=region){this.setMeshRegion(attachment,slot.currentMesh,region)}return true};SpineBase.prototype.hackTextureBySlotName=function(slotName,texture,size){if(texture===void 0){texture=null}if(size===void 0){size=null}var index=this.skeleton.findSlotIndex(slotName);if(index==-1){return false}return this.hackTextureBySlotIndex(index,texture,size)};SpineBase.prototype.hackTextureAttachment=function(slotName,attachmentName,texture,size){if(size===void 0){size=null}var slotIndex=this.skeleton.findSlotIndex(slotName);var attachment=this.skeleton.getAttachmentByName(slotName,attachmentName);attachment.region.texture=texture;var slot=this.skeleton.slots[slotIndex];if(!slot){return false}var currentAttachment=slot.getAttachment();if(attachmentName===currentAttachment.name){var region=attachment.region;if(texture){region=new TextureRegion;region.texture=texture;region.size=size;slot.hackRegion=region;slot.hackAttachment=currentAttachment}else{slot.hackRegion=null;slot.hackAttachment=null}if(slot.currentSprite&&slot.currentSprite.region!=region){this.setSpriteRegion(currentAttachment,slot.currentSprite,region);slot.currentSprite.region=region}else if(slot.currentMesh&&slot.currentMesh.region!=region){this.setMeshRegion(currentAttachment,slot.currentMesh,region)}return true}return false};SpineBase.prototype.newContainer=function(){return new display.Container};SpineBase.prototype.newSprite=function(tex){return new SpineSprite(tex)};SpineBase.prototype.newGraphics=function(){return new graphics.Graphics};SpineBase.prototype.newMesh=function(texture,vertices,uvs,indices,drawMode){return new SpineMesh(texture,vertices,uvs,indices,drawMode)};SpineBase.prototype.transformHack=function(){return 1};SpineBase.prototype.hackAttachmentGroups=function(nameSuffix,group,outGroup){if(!nameSuffix){return undefined}var list_d=[],list_n=[];for(var i=0,len=this.skeleton.slots.length;i<len;i++){var slot=this.skeleton.slots[i];var name_1=slot.currentSpriteName||slot.currentMeshName||"";var target=slot.currentSprite||slot.currentMesh;if(name_1.endsWith(nameSuffix)){target.parentGroup=group;list_n.push(target)}else if(outGroup&&target){target.parentGroup=outGroup;list_d.push(target)}}return[list_d,list_n]};SpineBase.prototype.destroy=function(options){for(var i=0,n=this.skeleton.slots.length;i<n;i++){var slot=this.skeleton.slots[i];for(var name_2 in slot.meshes){slot.meshes[name_2].destroy(options)}slot.meshes=null;for(var name_3 in slot.sprites){slot.sprites[name_3].destroy(options)}slot.sprites=null}for(var i=0,n=this.slotContainers.length;i<n;i++){this.slotContainers[i].destroy(options)}this.spineData=null;this.skeleton=null;this.slotContainers=null;this.stateData=null;this.state=null;this.tempClipContainers=null;_super.prototype.destroy.call(this,options)};SpineBase.clippingPolygon=[];return SpineBase}(display.Container);Object.defineProperty(SpineBase.prototype,"visible",{get:function(){return this._visible},set:function(value){if(value!==this._visible){this._visible=value;if(value){this.lastTime=0}}}});function isJson(resource){return resource.type===loaders.LoaderResource.TYPE.JSON}function isBuffer(resource){return resource.xhrType===loaders.LoaderResource.XHR_RESPONSE_TYPE.BUFFER}loaders.LoaderResource.setExtensionXhrType("skel",loaders.LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var AbstractSpineParser=function(){function AbstractSpineParser(){}AbstractSpineParser.prototype.genMiddleware=function(){var self=this;return{use:function(resource,next){if(!resource.data){return next()}var isJsonSpineModel=isJson(resource)&&resource.data.bones;var isBinarySpineModel=isBuffer(resource)&&(resource.extension==="skel"||resource.metadata&&resource.metadata.spineMetadata);if(!isJsonSpineModel&&!isBinarySpineModel){return next()}var parser=null;var dataToParse=resource.data;if(isJsonSpineModel){parser=self.createJsonParser()}else{parser=self.createBinaryParser();if(resource.data instanceof ArrayBuffer){dataToParse=new Uint8Array(resource.data)}}var metadata=resource.metadata||{};var metadataSkeletonScale=metadata?metadata.spineSkeletonScale:null;if(metadataSkeletonScale){parser.scale=metadataSkeletonScale}var metadataAtlas=metadata.spineAtlas;if(metadataAtlas===false){return next()}if(metadataAtlas&&metadataAtlas.pages){self.parseData(resource,parser,metadataAtlas,dataToParse);return next()}var metadataAtlasSuffix=metadata.spineAtlasSuffix||".atlas";var atlasPath=resource.url;var queryStringPos=atlasPath.indexOf("?");if(queryStringPos>0){atlasPath=atlasPath.substr(0,queryStringPos)}atlasPath=atlasPath.substr(0,atlasPath.lastIndexOf("."))+metadataAtlasSuffix;if(metadata.spineAtlasFile){atlasPath=metadata.spineAtlasFile}atlasPath=atlasPath.replace(this.baseUrl,"");var atlasOptions={crossOrigin:resource.crossOrigin,xhrType:loaders.LoaderResource.XHR_RESPONSE_TYPE.TEXT,metadata:metadata.spineMetadata||null,parentResource:resource};var imageOptions={crossOrigin:resource.crossOrigin,metadata:metadata.imageMetadata||null,parentResource:resource};var baseUrl=resource.url.substr(0,resource.url.lastIndexOf("/")+1);baseUrl=baseUrl.replace(this.baseUrl,"");var namePrefix=metadata.imageNamePrefix||resource.name+"_atlas_page_";var adapter=metadata.images?staticImageLoader(metadata.images):metadata.image?staticImageLoader({default:metadata.image}):metadata.imageLoader?metadata.imageLoader(this,namePrefix,baseUrl,imageOptions):imageLoaderAdapter(this,namePrefix,baseUrl,imageOptions);function createSkeletonWithRawAtlas(rawData){new TextureAtlas(rawData,adapter,function(spineAtlas){if(spineAtlas){self.parseData(resource,parser,spineAtlas,dataToParse)}next()})}if(metadata.atlasRawData){createSkeletonWithRawAtlas(metadata.atlasRawData)}else{this.add(resource.name+"_atlas",atlasPath,atlasOptions,function(atlasResource){if(!atlasResource.error){createSkeletonWithRawAtlas(atlasResource.data)}else{next()}})}}}};return AbstractSpineParser}();function imageLoaderAdapter(loader,namePrefix,baseUrl,imageOptions){if(baseUrl&&baseUrl.lastIndexOf("/")!==baseUrl.length-1){baseUrl+="/"}return function(line,callback){var name=namePrefix+line;var url=baseUrl+line;var cachedResource=loader.resources[name];if(cachedResource){var done=function(){callback(cachedResource.texture.baseTexture)};if(cachedResource.texture){done()}else{cachedResource.onAfterMiddleware.add(done)}}else{loader.add(name,url,imageOptions,function(resource){if(!resource.error){if(line.indexOf("-pma.")>=0){resource.texture.baseTexture.alphaMode=constants.ALPHA_MODES.PMA}callback(resource.texture.baseTexture)}else{callback(null)}})}}}function syncImageLoaderAdapter(baseUrl,crossOrigin){if(baseUrl&&baseUrl.lastIndexOf("/")!==baseUrl.length-1){baseUrl+="/"}return function(line,callback){callback(core.BaseTexture.from(line,crossOrigin))}}function staticImageLoader(pages){return function(line,callback){var page=pages[line]||pages["default"];if(page&&page.baseTexture)callback(page.baseTexture);else callback(page)}}var extendStatics$3=function(d,b){extendStatics$3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics$3(d,b)};function __extends$3(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics$3(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var Attachment$2=function(){function Attachment(name){if(name==null)throw new Error("name cannot be null.");this.name=name}return Attachment}();var VertexAttachment$2=function(_super){__extends$3(VertexAttachment,_super);function VertexAttachment(name){var _this=_super.call(this,name)||this;_this.id=(VertexAttachment.nextID++&65535)<<11;_this.worldVerticesLength=0;_this.deformAttachment=_this;return _this}VertexAttachment.prototype.computeWorldVerticesOld=function(slot,worldVertices){this.computeWorldVertices(slot,0,this.worldVerticesLength,worldVertices,0,2)};VertexAttachment.prototype.computeWorldVertices=function(slot,start,count,worldVertices,offset,stride){count=offset+(count>>1)*stride;var skeleton=slot.bone.skeleton;var deformArray=slot.deform;var vertices=this.vertices;var bones=this.bones;if(bones==null){if(deformArray.length>0)vertices=deformArray;var mat=slot.bone.matrix;var x=mat.tx;var y=mat.ty;var a=mat.a,b=mat.c,c=mat.b,d=mat.d;for(var v_1=start,w=offset;w<count;v_1+=2,w+=stride){var vx=vertices[v_1],vy=vertices[v_1+1];worldVertices[w]=vx*a+vy*b+x;worldVertices[w+1]=vx*c+vy*d+y}return}var v=0,skip=0;for(var i=0;i<start;i+=2){var n=bones[v];v+=n+1;skip+=n}var skeletonBones=skeleton.bones;if(deformArray.length==0){for(var w=offset,b=skip*3;w<count;w+=stride){var wx=0,wy=0;var n=bones[v++];n+=v;for(;v<n;v++,b+=3){var mat=skeletonBones[bones[v]].matrix;var vx=vertices[b],vy=vertices[b+1],weight=vertices[b+2];wx+=(vx*mat.a+vy*mat.c+mat.tx)*weight;wy+=(vx*mat.b+vy*mat.d+mat.ty)*weight}worldVertices[w]=wx;worldVertices[w+1]=wy}}else{var deform=deformArray;for(var w=offset,b=skip*3,f=skip<<1;w<count;w+=stride){var wx=0,wy=0;var n=bones[v++];n+=v;for(;v<n;v++,b+=3,f+=2){var mat=skeletonBones[bones[v]].matrix;var vx=vertices[b]+deform[f],vy=vertices[b+1]+deform[f+1],weight=vertices[b+2];wx+=(vx*mat.a+vy*mat.c+mat.tx)*weight;wy+=(vx*mat.b+vy*mat.d+mat.ty)*weight}worldVertices[w]=wx;worldVertices[w+1]=wy}}};VertexAttachment.prototype.copyTo=function(attachment){if(this.bones!=null){attachment.bones=new Array(this.bones.length);Utils.arrayCopy(this.bones,0,attachment.bones,0,this.bones.length)}else attachment.bones=null;if(this.vertices!=null){attachment.vertices=Utils.newFloatArray(this.vertices.length);Utils.arrayCopy(this.vertices,0,attachment.vertices,0,this.vertices.length)}else attachment.vertices=null;attachment.worldVerticesLength=this.worldVerticesLength;attachment.deformAttachment=this.deformAttachment};VertexAttachment.nextID=0;return VertexAttachment}(Attachment$2);var BoundingBoxAttachment$2=function(_super){__extends$3(BoundingBoxAttachment,_super);function BoundingBoxAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.BoundingBox;_this.color=new Color(1,1,1,1);return _this}BoundingBoxAttachment.prototype.copy=function(){var copy=new BoundingBoxAttachment(this.name);this.copyTo(copy);copy.color.setFromColor(this.color);return copy};return BoundingBoxAttachment}(VertexAttachment$2);var ClippingAttachment$2=function(_super){__extends$3(ClippingAttachment,_super);function ClippingAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Clipping;_this.color=new Color(.2275,.2275,.8078,1);return _this}ClippingAttachment.prototype.copy=function(){var copy=new ClippingAttachment(this.name);this.copyTo(copy);copy.endSlot=this.endSlot;copy.color.setFromColor(this.color);return copy};return ClippingAttachment}(VertexAttachment$2);var MeshAttachment$2=function(_super){__extends$3(MeshAttachment,_super);function MeshAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Mesh;_this.color=new Color(1,1,1,1);_this.tempColor=new Color(0,0,0,0);return _this}MeshAttachment.prototype.getParentMesh=function(){return this.parentMesh};MeshAttachment.prototype.setParentMesh=function(parentMesh){this.parentMesh=parentMesh;if(parentMesh!=null){this.bones=parentMesh.bones;this.vertices=parentMesh.vertices;this.worldVerticesLength=parentMesh.worldVerticesLength;this.regionUVs=parentMesh.regionUVs;this.triangles=parentMesh.triangles;this.hullLength=parentMesh.hullLength;this.worldVerticesLength=parentMesh.worldVerticesLength}};MeshAttachment.prototype.copy=function(){if(this.parentMesh!=null)return this.newLinkedMesh();var copy=new MeshAttachment(this.name);copy.region=this.region;copy.path=this.path;copy.color.setFromColor(this.color);this.copyTo(copy);copy.regionUVs=new Float32Array(this.regionUVs.length);Utils.arrayCopy(this.regionUVs,0,copy.regionUVs,0,this.regionUVs.length);copy.triangles=new Array(this.triangles.length);Utils.arrayCopy(this.triangles,0,copy.triangles,0,this.triangles.length);copy.hullLength=this.hullLength;if(this.edges!=null){copy.edges=new Array(this.edges.length);Utils.arrayCopy(this.edges,0,copy.edges,0,this.edges.length)}copy.width=this.width;copy.height=this.height;return copy};MeshAttachment.prototype.newLinkedMesh=function(){var copy=new MeshAttachment(this.name);copy.region=this.region;copy.path=this.path;copy.color.setFromColor(this.color);copy.deformAttachment=this.deformAttachment;copy.setParentMesh(this.parentMesh!=null?this.parentMesh:this);return copy};return MeshAttachment}(VertexAttachment$2);var PathAttachment$2=function(_super){__extends$3(PathAttachment,_super);function PathAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Path;_this.closed=false;_this.constantSpeed=false;_this.color=new Color(1,1,1,1);return _this}PathAttachment.prototype.copy=function(){var copy=new PathAttachment(this.name);this.copyTo(copy);copy.lengths=new Array(this.lengths.length);Utils.arrayCopy(this.lengths,0,copy.lengths,0,this.lengths.length);copy.closed=closed;copy.constantSpeed=this.constantSpeed;copy.color.setFromColor(this.color);return copy};return PathAttachment}(VertexAttachment$2);var PointAttachment$2=function(_super){__extends$3(PointAttachment,_super);function PointAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Point;_this.color=new Color(.38,.94,0,1);return _this}PointAttachment.prototype.computeWorldPosition=function(bone,point){var mat=bone.matrix;point.x=this.x*mat.a+this.y*mat.c+bone.worldX;point.y=this.x*mat.b+this.y*mat.d+bone.worldY;return point};PointAttachment.prototype.computeWorldRotation=function(bone){var mat=bone.matrix;var cos=MathUtils.cosDeg(this.rotation),sin=MathUtils.sinDeg(this.rotation);var x=cos*mat.a+sin*mat.c;var y=cos*mat.b+sin*mat.d;return Math.atan2(y,x)*MathUtils.radDeg};PointAttachment.prototype.copy=function(){var copy=new PointAttachment(this.name);copy.x=this.x;copy.y=this.y;copy.rotation=this.rotation;copy.color.setFromColor(this.color);return copy};return PointAttachment}(VertexAttachment$2);var RegionAttachment$2=function(_super){__extends$3(RegionAttachment,_super);function RegionAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Region;_this.x=0;_this.y=0;_this.scaleX=1;_this.scaleY=1;_this.rotation=0;_this.width=0;_this.height=0;_this.color=new Color(1,1,1,1);_this.offset=Utils.newFloatArray(8);_this.uvs=Utils.newFloatArray(8);_this.tempColor=new Color(1,1,1,1);return _this}RegionAttachment.prototype.updateOffset=function(){var regionScaleX=this.width/this.region.originalWidth*this.scaleX;var regionScaleY=this.height/this.region.originalHeight*this.scaleY;var localX=-this.width/2*this.scaleX+this.region.offsetX*regionScaleX;var localY=-this.height/2*this.scaleY+this.region.offsetY*regionScaleY;var localX2=localX+this.region.width*regionScaleX;var localY2=localY+this.region.height*regionScaleY;var radians=this.rotation*Math.PI/180;var cos=Math.cos(radians);var sin=Math.sin(radians);var localXCos=localX*cos+this.x;var localXSin=localX*sin;var localYCos=localY*cos+this.y;var localYSin=localY*sin;var localX2Cos=localX2*cos+this.x;var localX2Sin=localX2*sin;var localY2Cos=localY2*cos+this.y;var localY2Sin=localY2*sin;var offset=this.offset;offset[RegionAttachment.OX1]=localXCos-localYSin;offset[RegionAttachment.OY1]=localYCos+localXSin;offset[RegionAttachment.OX2]=localXCos-localY2Sin;offset[RegionAttachment.OY2]=localY2Cos+localXSin;offset[RegionAttachment.OX3]=localX2Cos-localY2Sin;offset[RegionAttachment.OY3]=localY2Cos+localX2Sin;offset[RegionAttachment.OX4]=localX2Cos-localYSin;offset[RegionAttachment.OY4]=localYCos+localX2Sin};RegionAttachment.prototype.setRegion=function(region){this.region=region;var uvs=this.uvs;if(region.rotate){uvs[2]=region.u;uvs[3]=region.v2;uvs[4]=region.u;uvs[5]=region.v;uvs[6]=region.u2;uvs[7]=region.v;uvs[0]=region.u2;uvs[1]=region.v2}else{uvs[0]=region.u;uvs[1]=region.v2;uvs[2]=region.u;uvs[3]=region.v;uvs[4]=region.u2;uvs[5]=region.v;uvs[6]=region.u2;uvs[7]=region.v2}};RegionAttachment.prototype.computeWorldVertices=function(bone,worldVertices,offset,stride){var vertexOffset=this.offset;var mat=bone.matrix;var x=mat.tx,y=mat.ty;var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var offsetX=0,offsetY=0;offsetX=vertexOffset[RegionAttachment.OX1];offsetY=vertexOffset[RegionAttachment.OY1];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y;offset+=stride;offsetX=vertexOffset[RegionAttachment.OX2];offsetY=vertexOffset[RegionAttachment.OY2];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y;offset+=stride;offsetX=vertexOffset[RegionAttachment.OX3];offsetY=vertexOffset[RegionAttachment.OY3];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y;offset+=stride;offsetX=vertexOffset[RegionAttachment.OX4];offsetY=vertexOffset[RegionAttachment.OY4];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y};RegionAttachment.prototype.copy=function(){var copy=new RegionAttachment(this.name);copy.region=this.region;copy.rendererObject=this.rendererObject;copy.path=this.path;copy.x=this.x;copy.y=this.y;copy.scaleX=this.scaleX;copy.scaleY=this.scaleY;copy.rotation=this.rotation;copy.width=this.width;copy.height=this.height;Utils.arrayCopy(this.uvs,0,copy.uvs,0,8);Utils.arrayCopy(this.offset,0,copy.offset,0,8);copy.color.setFromColor(this.color);return copy};RegionAttachment.OX1=0;RegionAttachment.OY1=1;RegionAttachment.OX2=2;RegionAttachment.OY2=3;RegionAttachment.OX3=4;RegionAttachment.OY3=5;RegionAttachment.OX4=6;RegionAttachment.OY4=7;RegionAttachment.X1=0;RegionAttachment.Y1=1;RegionAttachment.C1R=2;RegionAttachment.C1G=3;RegionAttachment.C1B=4;RegionAttachment.C1A=5;RegionAttachment.U1=6;RegionAttachment.V1=7;RegionAttachment.X2=8;RegionAttachment.Y2=9;RegionAttachment.C2R=10;RegionAttachment.C2G=11;RegionAttachment.C2B=12;RegionAttachment.C2A=13;RegionAttachment.U2=14;RegionAttachment.V2=15;RegionAttachment.X3=16;RegionAttachment.Y3=17;RegionAttachment.C3R=18;RegionAttachment.C3G=19;RegionAttachment.C3B=20;RegionAttachment.C3A=21;RegionAttachment.U3=22;RegionAttachment.V3=23;RegionAttachment.X4=24;RegionAttachment.Y4=25;RegionAttachment.C4R=26;RegionAttachment.C4G=27;RegionAttachment.C4B=28;RegionAttachment.C4A=29;RegionAttachment.U4=30;RegionAttachment.V4=31;return RegionAttachment}(Attachment$2);var JitterEffect$2=function(){function JitterEffect(jitterX,jitterY){this.jitterX=0;this.jitterY=0;this.jitterX=jitterX;this.jitterY=jitterY}JitterEffect.prototype.begin=function(skeleton){};JitterEffect.prototype.transform=function(position,uv,light,dark){position.x+=MathUtils.randomTriangular(-this.jitterX,this.jitterY);position.y+=MathUtils.randomTriangular(-this.jitterX,this.jitterY)};JitterEffect.prototype.end=function(){};return JitterEffect}();var SwirlEffect$2=function(){function SwirlEffect(radius){this.centerX=0;this.centerY=0;this.radius=0;this.angle=0;this.worldX=0;this.worldY=0;this.radius=radius}SwirlEffect.prototype.begin=function(skeleton){this.worldX=skeleton.x+this.centerX;this.worldY=skeleton.y+this.centerY};SwirlEffect.prototype.transform=function(position,uv,light,dark){var radAngle=this.angle*MathUtils.degreesToRadians;var x=position.x-this.worldX;var y=position.y-this.worldY;var dist=Math.sqrt(x*x+y*y);if(dist<this.radius){var theta=SwirlEffect.interpolation.apply(0,radAngle,(this.radius-dist)/this.radius);var cos=Math.cos(theta);var sin=Math.sin(theta);position.x=cos*x-sin*y+this.worldX;position.y=sin*x+cos*y+this.worldY}};SwirlEffect.prototype.end=function(){};SwirlEffect.interpolation=new PowOut(2);return SwirlEffect}();var Animation$2=function(){function Animation(name,timelines,duration){if(name==null)throw new Error("name cannot be null.");if(timelines==null)throw new Error("timelines cannot be null.");this.name=name;this.timelines=timelines;this.timelineIds=[];for(var i=0;i<timelines.length;i++)this.timelineIds[timelines[i].getPropertyId()]=true;this.duration=duration}Animation.prototype.hasTimeline=function(id){return this.timelineIds[id]==true};Animation.prototype.apply=function(skeleton,lastTime,time,loop,events,alpha,blend,direction){if(skeleton==null)throw new Error("skeleton cannot be null.");if(loop&&this.duration!=0){time%=this.duration;if(lastTime>0)lastTime%=this.duration}var timelines=this.timelines;for(var i=0,n=timelines.length;i<n;i++)timelines[i].apply(skeleton,lastTime,time,events,alpha,blend,direction)};Animation.binarySearch=function(values,target,step){if(step===void 0){step=1}var low=0;var high=values.length/step-2;if(high==0)return step;var current=high>>>1;while(true){if(values[(current+1)*step]<=target)low=current+1;else high=current;if(low==high)return(low+1)*step;current=low+high>>>1}};Animation.linearSearch=function(values,target,step){for(var i=0,last=values.length-step;i<=last;i+=step)if(values[i]>target)return i;return-1};return Animation}();var MixBlend$2;(function(MixBlend){MixBlend[MixBlend["setup"]=0]="setup";MixBlend[MixBlend["first"]=1]="first";MixBlend[MixBlend["replace"]=2]="replace";MixBlend[MixBlend["add"]=3]="add"})(MixBlend$2||(MixBlend$2={}));var MixDirection$2;(function(MixDirection){MixDirection[MixDirection["mixIn"]=0]="mixIn";MixDirection[MixDirection["mixOut"]=1]="mixOut"})(MixDirection$2||(MixDirection$2={}));var TimelineType$1;(function(TimelineType){TimelineType[TimelineType["rotate"]=0]="rotate";TimelineType[TimelineType["translate"]=1]="translate";TimelineType[TimelineType["scale"]=2]="scale";TimelineType[TimelineType["shear"]=3]="shear";TimelineType[TimelineType["attachment"]=4]="attachment";TimelineType[TimelineType["color"]=5]="color";TimelineType[TimelineType["deform"]=6]="deform";TimelineType[TimelineType["event"]=7]="event";TimelineType[TimelineType["drawOrder"]=8]="drawOrder";TimelineType[TimelineType["ikConstraint"]=9]="ikConstraint";TimelineType[TimelineType["transformConstraint"]=10]="transformConstraint";TimelineType[TimelineType["pathConstraintPosition"]=11]="pathConstraintPosition";TimelineType[TimelineType["pathConstraintSpacing"]=12]="pathConstraintSpacing";TimelineType[TimelineType["pathConstraintMix"]=13]="pathConstraintMix";TimelineType[TimelineType["twoColor"]=14]="twoColor"})(TimelineType$1||(TimelineType$1={}));var CurveTimeline$2=function(){function CurveTimeline(frameCount){if(frameCount<=0)throw new Error("frameCount must be > 0: "+frameCount);this.curves=Utils.newFloatArray((frameCount-1)*CurveTimeline.BEZIER_SIZE)}CurveTimeline.prototype.getFrameCount=function(){return this.curves.length/CurveTimeline.BEZIER_SIZE+1};CurveTimeline.prototype.setLinear=function(frameIndex){this.curves[frameIndex*CurveTimeline.BEZIER_SIZE]=CurveTimeline.LINEAR};CurveTimeline.prototype.setStepped=function(frameIndex){this.curves[frameIndex*CurveTimeline.BEZIER_SIZE]=CurveTimeline.STEPPED};CurveTimeline.prototype.getCurveType=function(frameIndex){var index=frameIndex*CurveTimeline.BEZIER_SIZE;if(index==this.curves.length)return CurveTimeline.LINEAR;var type=this.curves[index];if(type==CurveTimeline.LINEAR)return CurveTimeline.LINEAR;if(type==CurveTimeline.STEPPED)return CurveTimeline.STEPPED;return CurveTimeline.BEZIER};CurveTimeline.prototype.setCurve=function(frameIndex,cx1,cy1,cx2,cy2){var tmpx=(-cx1*2+cx2)*.03,tmpy=(-cy1*2+cy2)*.03;var dddfx=((cx1-cx2)*3+1)*.006,dddfy=((cy1-cy2)*3+1)*.006;var ddfx=tmpx*2+dddfx,ddfy=tmpy*2+dddfy;var dfx=cx1*.3+tmpx+dddfx*.16666667,dfy=cy1*.3+tmpy+dddfy*.16666667;var i=frameIndex*CurveTimeline.BEZIER_SIZE;var curves=this.curves;curves[i++]=CurveTimeline.BEZIER;var x=dfx,y=dfy;for(var n=i+CurveTimeline.BEZIER_SIZE-1;i<n;i+=2){curves[i]=x;curves[i+1]=y;dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;x+=dfx;y+=dfy}};CurveTimeline.prototype.getCurvePercent=function(frameIndex,percent){percent=MathUtils.clamp(percent,0,1);var curves=this.curves;var i=frameIndex*CurveTimeline.BEZIER_SIZE;var type=curves[i];if(type==CurveTimeline.LINEAR)return percent;if(type==CurveTimeline.STEPPED)return 0;i++;var x=0;for(var start=i,n=i+CurveTimeline.BEZIER_SIZE-1;i<n;i+=2){x=curves[i];if(x>=percent){var prevX=void 0,prevY=void 0;if(i==start){prevX=0;prevY=0}else{prevX=curves[i-2];prevY=curves[i-1]}return prevY+(curves[i+1]-prevY)*(percent-prevX)/(x-prevX)}}var y=curves[i-1];return y+(1-y)*(percent-x)/(1-x)};CurveTimeline.LINEAR=0;CurveTimeline.STEPPED=1;CurveTimeline.BEZIER=2;CurveTimeline.BEZIER_SIZE=10*2-1;return CurveTimeline}();var RotateTimeline$2=function(_super){__extends$3(RotateTimeline,_super);function RotateTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount<<1);return _this}RotateTimeline.prototype.getPropertyId=function(){return(TimelineType$1.rotate<<24)+this.boneIndex};RotateTimeline.prototype.setFrame=function(frameIndex,time,degrees){frameIndex<<=1;this.frames[frameIndex]=time;this.frames[frameIndex+RotateTimeline.ROTATION]=degrees};RotateTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var frames=this.frames;var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;if(time<frames[0]){switch(blend){case MixBlend$2.setup:bone.rotation=bone.data.rotation;return;case MixBlend$2.first:var r_1=bone.data.rotation-bone.rotation;bone.rotation+=(r_1-(16384-(16384.499999999996-r_1/360|0))*360)*alpha}return}if(time>=frames[frames.length-RotateTimeline.ENTRIES]){var r_2=frames[frames.length+RotateTimeline.PREV_ROTATION];switch(blend){case MixBlend$2.setup:bone.rotation=bone.data.rotation+r_2*alpha;break;case MixBlend$2.first:case MixBlend$2.replace:r_2+=bone.data.rotation-bone.rotation;r_2-=(16384-(16384.499999999996-r_2/360|0))*360;case MixBlend$2.add:bone.rotation+=r_2*alpha}return}var frame=Animation$2.binarySearch(frames,time,RotateTimeline.ENTRIES);var prevRotation=frames[frame+RotateTimeline.PREV_ROTATION];var frameTime=frames[frame];var percent=this.getCurvePercent((frame>>1)-1,1-(time-frameTime)/(frames[frame+RotateTimeline.PREV_TIME]-frameTime));var r=frames[frame+RotateTimeline.ROTATION]-prevRotation;r=prevRotation+(r-(16384-(16384.499999999996-r/360|0))*360)*percent;switch(blend){case MixBlend$2.setup:bone.rotation=bone.data.rotation+(r-(16384-(16384.499999999996-r/360|0))*360)*alpha;break;case MixBlend$2.first:case MixBlend$2.replace:r+=bone.data.rotation-bone.rotation;case MixBlend$2.add:bone.rotation+=(r-(16384-(16384.499999999996-r/360|0))*360)*alpha}};RotateTimeline.ENTRIES=2;RotateTimeline.PREV_TIME=-2;RotateTimeline.PREV_ROTATION=-1;RotateTimeline.ROTATION=1;return RotateTimeline}(CurveTimeline$2);var TranslateTimeline$2=function(_super){__extends$3(TranslateTimeline,_super);function TranslateTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*TranslateTimeline.ENTRIES);return _this}TranslateTimeline.prototype.getPropertyId=function(){return(TimelineType$1.translate<<24)+this.boneIndex};TranslateTimeline.prototype.setFrame=function(frameIndex,time,x,y){frameIndex*=TranslateTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+TranslateTimeline.X]=x;this.frames[frameIndex+TranslateTimeline.Y]=y};TranslateTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var frames=this.frames;var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;if(time<frames[0]){switch(blend){case MixBlend$2.setup:bone.x=bone.data.x;bone.y=bone.data.y;return;case MixBlend$2.first:bone.x+=(bone.data.x-bone.x)*alpha;bone.y+=(bone.data.y-bone.y)*alpha}return}var x=0,y=0;if(time>=frames[frames.length-TranslateTimeline.ENTRIES]){x=frames[frames.length+TranslateTimeline.PREV_X];y=frames[frames.length+TranslateTimeline.PREV_Y]}else{var frame=Animation$2.binarySearch(frames,time,TranslateTimeline.ENTRIES);x=frames[frame+TranslateTimeline.PREV_X];y=frames[frame+TranslateTimeline.PREV_Y];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/TranslateTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+TranslateTimeline.PREV_TIME]-frameTime));x+=(frames[frame+TranslateTimeline.X]-x)*percent;y+=(frames[frame+TranslateTimeline.Y]-y)*percent}switch(blend){case MixBlend$2.setup:bone.x=bone.data.x+x*alpha;bone.y=bone.data.y+y*alpha;break;case MixBlend$2.first:case MixBlend$2.replace:bone.x+=(bone.data.x+x-bone.x)*alpha;bone.y+=(bone.data.y+y-bone.y)*alpha;break;case MixBlend$2.add:bone.x+=x*alpha;bone.y+=y*alpha}};TranslateTimeline.ENTRIES=3;TranslateTimeline.PREV_TIME=-3;TranslateTimeline.PREV_X=-2;TranslateTimeline.PREV_Y=-1;TranslateTimeline.X=1;TranslateTimeline.Y=2;return TranslateTimeline}(CurveTimeline$2);var ScaleTimeline$2=function(_super){__extends$3(ScaleTimeline,_super);function ScaleTimeline(frameCount){return _super.call(this,frameCount)||this}ScaleTimeline.prototype.getPropertyId=function(){return(TimelineType$1.scale<<24)+this.boneIndex};ScaleTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var frames=this.frames;var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;if(time<frames[0]){switch(blend){case MixBlend$2.setup:bone.scaleX=bone.data.scaleX;bone.scaleY=bone.data.scaleY;return;case MixBlend$2.first:bone.scaleX+=(bone.data.scaleX-bone.scaleX)*alpha;bone.scaleY+=(bone.data.scaleY-bone.scaleY)*alpha}return}var x=0,y=0;if(time>=frames[frames.length-ScaleTimeline.ENTRIES]){x=frames[frames.length+ScaleTimeline.PREV_X]*bone.data.scaleX;y=frames[frames.length+ScaleTimeline.PREV_Y]*bone.data.scaleY}else{var frame=Animation$2.binarySearch(frames,time,ScaleTimeline.ENTRIES);x=frames[frame+ScaleTimeline.PREV_X];y=frames[frame+ScaleTimeline.PREV_Y];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/ScaleTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+ScaleTimeline.PREV_TIME]-frameTime));x=(x+(frames[frame+ScaleTimeline.X]-x)*percent)*bone.data.scaleX;y=(y+(frames[frame+ScaleTimeline.Y]-y)*percent)*bone.data.scaleY}if(alpha==1){if(blend==MixBlend$2.add){bone.scaleX+=x-bone.data.scaleX;bone.scaleY+=y-bone.data.scaleY}else{bone.scaleX=x;bone.scaleY=y}}else{var bx=0,by=0;if(direction==MixDirection$2.mixOut){switch(blend){case MixBlend$2.setup:bx=bone.data.scaleX;by=bone.data.scaleY;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bx)*alpha;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-by)*alpha;break;case MixBlend$2.first:case MixBlend$2.replace:bx=bone.scaleX;by=bone.scaleY;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bx)*alpha;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-by)*alpha;break;case MixBlend$2.add:bx=bone.scaleX;by=bone.scaleY;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bone.data.scaleX)*alpha;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-bone.data.scaleY)*alpha}}else{switch(blend){case MixBlend$2.setup:bx=Math.abs(bone.data.scaleX)*MathUtils.signum(x);by=Math.abs(bone.data.scaleY)*MathUtils.signum(y);bone.scaleX=bx+(x-bx)*alpha;bone.scaleY=by+(y-by)*alpha;break;case MixBlend$2.first:case MixBlend$2.replace:bx=Math.abs(bone.scaleX)*MathUtils.signum(x);by=Math.abs(bone.scaleY)*MathUtils.signum(y);bone.scaleX=bx+(x-bx)*alpha;bone.scaleY=by+(y-by)*alpha;break;case MixBlend$2.add:bx=MathUtils.signum(x);by=MathUtils.signum(y);bone.scaleX=Math.abs(bone.scaleX)*bx+(x-Math.abs(bone.data.scaleX)*bx)*alpha;bone.scaleY=Math.abs(bone.scaleY)*by+(y-Math.abs(bone.data.scaleY)*by)*alpha}}}};return ScaleTimeline}(TranslateTimeline$2);var ShearTimeline$2=function(_super){__extends$3(ShearTimeline,_super);function ShearTimeline(frameCount){return _super.call(this,frameCount)||this}ShearTimeline.prototype.getPropertyId=function(){return(TimelineType$1.shear<<24)+this.boneIndex};ShearTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var frames=this.frames;var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;if(time<frames[0]){switch(blend){case MixBlend$2.setup:bone.shearX=bone.data.shearX;bone.shearY=bone.data.shearY;return;case MixBlend$2.first:bone.shearX+=(bone.data.shearX-bone.shearX)*alpha;bone.shearY+=(bone.data.shearY-bone.shearY)*alpha}return}var x=0,y=0;if(time>=frames[frames.length-ShearTimeline.ENTRIES]){x=frames[frames.length+ShearTimeline.PREV_X];y=frames[frames.length+ShearTimeline.PREV_Y]}else{var frame=Animation$2.binarySearch(frames,time,ShearTimeline.ENTRIES);x=frames[frame+ShearTimeline.PREV_X];y=frames[frame+ShearTimeline.PREV_Y];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/ShearTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+ShearTimeline.PREV_TIME]-frameTime));x=x+(frames[frame+ShearTimeline.X]-x)*percent;y=y+(frames[frame+ShearTimeline.Y]-y)*percent}switch(blend){case MixBlend$2.setup:bone.shearX=bone.data.shearX+x*alpha;bone.shearY=bone.data.shearY+y*alpha;break;case MixBlend$2.first:case MixBlend$2.replace:bone.shearX+=(bone.data.shearX+x-bone.shearX)*alpha;bone.shearY+=(bone.data.shearY+y-bone.shearY)*alpha;break;case MixBlend$2.add:bone.shearX+=x*alpha;bone.shearY+=y*alpha}};return ShearTimeline}(TranslateTimeline$2);var ColorTimeline$1=function(_super){__extends$3(ColorTimeline,_super);function ColorTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*ColorTimeline.ENTRIES);return _this}ColorTimeline.prototype.getPropertyId=function(){return(TimelineType$1.color<<24)+this.slotIndex};ColorTimeline.prototype.setFrame=function(frameIndex,time,r,g,b,a){frameIndex*=ColorTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+ColorTimeline.R]=r;this.frames[frameIndex+ColorTimeline.G]=g;this.frames[frameIndex+ColorTimeline.B]=b;this.frames[frameIndex+ColorTimeline.A]=a};ColorTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend$2.setup:slot.color.setFromColor(slot.data.color);return;case MixBlend$2.first:var color=slot.color,setup=slot.data.color;color.add((setup.r-color.r)*alpha,(setup.g-color.g)*alpha,(setup.b-color.b)*alpha,(setup.a-color.a)*alpha)}return}var r=0,g=0,b=0,a=0;if(time>=frames[frames.length-ColorTimeline.ENTRIES]){var i=frames.length;r=frames[i+ColorTimeline.PREV_R];g=frames[i+ColorTimeline.PREV_G];b=frames[i+ColorTimeline.PREV_B];a=frames[i+ColorTimeline.PREV_A]}else{var frame=Animation$2.binarySearch(frames,time,ColorTimeline.ENTRIES);r=frames[frame+ColorTimeline.PREV_R];g=frames[frame+ColorTimeline.PREV_G];b=frames[frame+ColorTimeline.PREV_B];a=frames[frame+ColorTimeline.PREV_A];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/ColorTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+ColorTimeline.PREV_TIME]-frameTime));r+=(frames[frame+ColorTimeline.R]-r)*percent;g+=(frames[frame+ColorTimeline.G]-g)*percent;b+=(frames[frame+ColorTimeline.B]-b)*percent;a+=(frames[frame+ColorTimeline.A]-a)*percent}if(alpha==1)slot.color.set(r,g,b,a);else{var color=slot.color;if(blend==MixBlend$2.setup)color.setFromColor(slot.data.color);color.add((r-color.r)*alpha,(g-color.g)*alpha,(b-color.b)*alpha,(a-color.a)*alpha)}};ColorTimeline.ENTRIES=5;ColorTimeline.PREV_TIME=-5;ColorTimeline.PREV_R=-4;ColorTimeline.PREV_G=-3;ColorTimeline.PREV_B=-2;ColorTimeline.PREV_A=-1;ColorTimeline.R=1;ColorTimeline.G=2;ColorTimeline.B=3;ColorTimeline.A=4;return ColorTimeline}(CurveTimeline$2);var TwoColorTimeline$1=function(_super){__extends$3(TwoColorTimeline,_super);function TwoColorTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*TwoColorTimeline.ENTRIES);return _this}TwoColorTimeline.prototype.getPropertyId=function(){return(TimelineType$1.twoColor<<24)+this.slotIndex};TwoColorTimeline.prototype.setFrame=function(frameIndex,time,r,g,b,a,r2,g2,b2){frameIndex*=TwoColorTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+TwoColorTimeline.R]=r;this.frames[frameIndex+TwoColorTimeline.G]=g;this.frames[frameIndex+TwoColorTimeline.B]=b;this.frames[frameIndex+TwoColorTimeline.A]=a;this.frames[frameIndex+TwoColorTimeline.R2]=r2;this.frames[frameIndex+TwoColorTimeline.G2]=g2;this.frames[frameIndex+TwoColorTimeline.B2]=b2};TwoColorTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend$2.setup:slot.color.setFromColor(slot.data.color);slot.darkColor.setFromColor(slot.data.darkColor);return;case MixBlend$2.first:var light=slot.color,dark=slot.darkColor,setupLight=slot.data.color,setupDark=slot.data.darkColor;light.add((setupLight.r-light.r)*alpha,(setupLight.g-light.g)*alpha,(setupLight.b-light.b)*alpha,(setupLight.a-light.a)*alpha);dark.add((setupDark.r-dark.r)*alpha,(setupDark.g-dark.g)*alpha,(setupDark.b-dark.b)*alpha,0)}return}var r=0,g=0,b=0,a=0,r2=0,g2=0,b2=0;if(time>=frames[frames.length-TwoColorTimeline.ENTRIES]){var i=frames.length;r=frames[i+TwoColorTimeline.PREV_R];g=frames[i+TwoColorTimeline.PREV_G];b=frames[i+TwoColorTimeline.PREV_B];a=frames[i+TwoColorTimeline.PREV_A];r2=frames[i+TwoColorTimeline.PREV_R2];g2=frames[i+TwoColorTimeline.PREV_G2];b2=frames[i+TwoColorTimeline.PREV_B2]}else{var frame=Animation$2.binarySearch(frames,time,TwoColorTimeline.ENTRIES);r=frames[frame+TwoColorTimeline.PREV_R];g=frames[frame+TwoColorTimeline.PREV_G];b=frames[frame+TwoColorTimeline.PREV_B];a=frames[frame+TwoColorTimeline.PREV_A];r2=frames[frame+TwoColorTimeline.PREV_R2];g2=frames[frame+TwoColorTimeline.PREV_G2];b2=frames[frame+TwoColorTimeline.PREV_B2];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/TwoColorTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+TwoColorTimeline.PREV_TIME]-frameTime));r+=(frames[frame+TwoColorTimeline.R]-r)*percent;g+=(frames[frame+TwoColorTimeline.G]-g)*percent;b+=(frames[frame+TwoColorTimeline.B]-b)*percent;a+=(frames[frame+TwoColorTimeline.A]-a)*percent;r2+=(frames[frame+TwoColorTimeline.R2]-r2)*percent;g2+=(frames[frame+TwoColorTimeline.G2]-g2)*percent;b2+=(frames[frame+TwoColorTimeline.B2]-b2)*percent}if(alpha==1){slot.color.set(r,g,b,a);slot.darkColor.set(r2,g2,b2,1)}else{var light=slot.color,dark=slot.darkColor;if(blend==MixBlend$2.setup){light.setFromColor(slot.data.color);dark.setFromColor(slot.data.darkColor)}light.add((r-light.r)*alpha,(g-light.g)*alpha,(b-light.b)*alpha,(a-light.a)*alpha);dark.add((r2-dark.r)*alpha,(g2-dark.g)*alpha,(b2-dark.b)*alpha,0)}};TwoColorTimeline.ENTRIES=8;TwoColorTimeline.PREV_TIME=-8;TwoColorTimeline.PREV_R=-7;TwoColorTimeline.PREV_G=-6;TwoColorTimeline.PREV_B=-5;TwoColorTimeline.PREV_A=-4;TwoColorTimeline.PREV_R2=-3;TwoColorTimeline.PREV_G2=-2;TwoColorTimeline.PREV_B2=-1;TwoColorTimeline.R=1;TwoColorTimeline.G=2;TwoColorTimeline.B=3;TwoColorTimeline.A=4;TwoColorTimeline.R2=5;TwoColorTimeline.G2=6;TwoColorTimeline.B2=7;return TwoColorTimeline}(CurveTimeline$2);var AttachmentTimeline$2=function(){function AttachmentTimeline(frameCount){this.frames=Utils.newFloatArray(frameCount);this.attachmentNames=new Array(frameCount)}AttachmentTimeline.prototype.getPropertyId=function(){return(TimelineType$1.attachment<<24)+this.slotIndex};AttachmentTimeline.prototype.getFrameCount=function(){return this.frames.length};AttachmentTimeline.prototype.setFrame=function(frameIndex,time,attachmentName){this.frames[frameIndex]=time;this.attachmentNames[frameIndex]=attachmentName};AttachmentTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;if(direction==MixDirection$2.mixOut){if(blend==MixBlend$2.setup)this.setAttachment(skeleton,slot,slot.data.attachmentName);return}var frames=this.frames;if(time<frames[0]){if(blend==MixBlend$2.setup||blend==MixBlend$2.first)this.setAttachment(skeleton,slot,slot.data.attachmentName);return}var frameIndex=0;if(time>=frames[frames.length-1])frameIndex=frames.length-1;else frameIndex=Animation$2.binarySearch(frames,time,1)-1;var attachmentName=this.attachmentNames[frameIndex];skeleton.slots[this.slotIndex].setAttachment(attachmentName==null?null:skeleton.getAttachment(this.slotIndex,attachmentName))};AttachmentTimeline.prototype.setAttachment=function(skeleton,slot,attachmentName){slot.setAttachment(attachmentName==null?null:skeleton.getAttachment(this.slotIndex,attachmentName))};return AttachmentTimeline}();var zeros$1=null;var DeformTimeline$2=function(_super){__extends$3(DeformTimeline,_super);function DeformTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount);_this.frameVertices=new Array(frameCount);if(zeros$1==null)zeros$1=Utils.newFloatArray(64);return _this}DeformTimeline.prototype.getPropertyId=function(){return(TimelineType$1.deform<<27)+ +this.attachment.id+this.slotIndex};DeformTimeline.prototype.setFrame=function(frameIndex,time,vertices){this.frames[frameIndex]=time;this.frameVertices[frameIndex]=vertices};DeformTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;var slotAttachment=slot.getAttachment();if(!(slotAttachment instanceof VertexAttachment$2)||!(slotAttachment.deformAttachment==this.attachment))return;var deformArray=slot.deform;if(deformArray.length==0)blend=MixBlend$2.setup;var frameVertices=this.frameVertices;var vertexCount=frameVertices[0].length;var frames=this.frames;if(time<frames[0]){var vertexAttachment=slotAttachment;switch(blend){case MixBlend$2.setup:deformArray.length=0;return;case MixBlend$2.first:if(alpha==1){deformArray.length=0;break}var deform_1=Utils.setArraySize(deformArray,vertexCount);if(vertexAttachment.bones==null){var setupVertices=vertexAttachment.vertices;for(var i=0;i<vertexCount;i++)deform_1[i]+=(setupVertices[i]-deform_1[i])*alpha}else{alpha=1-alpha;for(var i=0;i<vertexCount;i++)deform_1[i]*=alpha}}return}var deform=Utils.setArraySize(deformArray,vertexCount);if(time>=frames[frames.length-1]){var lastVertices=frameVertices[frames.length-1];if(alpha==1){if(blend==MixBlend$2.add){var vertexAttachment=slotAttachment;if(vertexAttachment.bones==null){var setupVertices=vertexAttachment.vertices;for(var i_1=0;i_1<vertexCount;i_1++){deform[i_1]+=lastVertices[i_1]-setupVertices[i_1]}}else{for(var i_2=0;i_2<vertexCount;i_2++)deform[i_2]+=lastVertices[i_2]}}else{Utils.arrayCopy(lastVertices,0,deform,0,vertexCount)}}else{switch(blend){case MixBlend$2.setup:{var vertexAttachment_1=slotAttachment;if(vertexAttachment_1.bones==null){var setupVertices=vertexAttachment_1.vertices;for(var i_3=0;i_3<vertexCount;i_3++){var setup=setupVertices[i_3];deform[i_3]=setup+(lastVertices[i_3]-setup)*alpha}}else{for(var i_4=0;i_4<vertexCount;i_4++)deform[i_4]=lastVertices[i_4]*alpha}break}case MixBlend$2.first:case MixBlend$2.replace:for(var i_5=0;i_5<vertexCount;i_5++)deform[i_5]+=(lastVertices[i_5]-deform[i_5])*alpha;break;case MixBlend$2.add:var vertexAttachment=slotAttachment;if(vertexAttachment.bones==null){var setupVertices=vertexAttachment.vertices;for(var i_6=0;i_6<vertexCount;i_6++){deform[i_6]+=(lastVertices[i_6]-setupVertices[i_6])*alpha}}else{for(var i_7=0;i_7<vertexCount;i_7++)deform[i_7]+=lastVertices[i_7]*alpha}}}return}var frame=Animation$2.binarySearch(frames,time);var prevVertices=frameVertices[frame-1];var nextVertices=frameVertices[frame];var frameTime=frames[frame];var percent=this.getCurvePercent(frame-1,1-(time-frameTime)/(frames[frame-1]-frameTime));if(alpha==1){if(blend==MixBlend$2.add){var vertexAttachment=slotAttachment;if(vertexAttachment.bones==null){var setupVertices=vertexAttachment.vertices;for(var i_8=0;i_8<vertexCount;i_8++){var prev=prevVertices[i_8];deform[i_8]+=prev+(nextVertices[i_8]-prev)*percent-setupVertices[i_8]}}else{for(var i_9=0;i_9<vertexCount;i_9++){var prev=prevVertices[i_9];deform[i_9]+=prev+(nextVertices[i_9]-prev)*percent}}}else{for(var i_10=0;i_10<vertexCount;i_10++){var prev=prevVertices[i_10];deform[i_10]=prev+(nextVertices[i_10]-prev)*percent}}}else{switch(blend){case MixBlend$2.setup:{var vertexAttachment_2=slotAttachment;if(vertexAttachment_2.bones==null){var setupVertices=vertexAttachment_2.vertices;for(var i_11=0;i_11<vertexCount;i_11++){var prev=prevVertices[i_11],setup=setupVertices[i_11];deform[i_11]=setup+(prev+(nextVertices[i_11]-prev)*percent-setup)*alpha}}else{for(var i_12=0;i_12<vertexCount;i_12++){var prev=prevVertices[i_12];deform[i_12]=(prev+(nextVertices[i_12]-prev)*percent)*alpha}}break}case MixBlend$2.first:case MixBlend$2.replace:for(var i_13=0;i_13<vertexCount;i_13++){var prev=prevVertices[i_13];deform[i_13]+=(prev+(nextVertices[i_13]-prev)*percent-deform[i_13])*alpha}break;case MixBlend$2.add:var vertexAttachment=slotAttachment;if(vertexAttachment.bones==null){var setupVertices=vertexAttachment.vertices;for(var i_14=0;i_14<vertexCount;i_14++){var prev=prevVertices[i_14];deform[i_14]+=(prev+(nextVertices[i_14]-prev)*percent-setupVertices[i_14])*alpha}}else{for(var i_15=0;i_15<vertexCount;i_15++){var prev=prevVertices[i_15];deform[i_15]+=(prev+(nextVertices[i_15]-prev)*percent)*alpha}}}}};return DeformTimeline}(CurveTimeline$2);var EventTimeline$2=function(){function EventTimeline(frameCount){this.frames=Utils.newFloatArray(frameCount);this.events=new Array(frameCount)}EventTimeline.prototype.getPropertyId=function(){return TimelineType$1.event<<24};EventTimeline.prototype.getFrameCount=function(){return this.frames.length};EventTimeline.prototype.setFrame=function(frameIndex,event){this.frames[frameIndex]=event.time;this.events[frameIndex]=event};EventTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){if(firedEvents==null)return;var frames=this.frames;var frameCount=this.frames.length;if(lastTime>time){this.apply(skeleton,lastTime,Number.MAX_VALUE,firedEvents,alpha,blend,direction);lastTime=-1}else if(lastTime>=frames[frameCount-1])return;if(time<frames[0])return;var frame=0;if(lastTime<frames[0])frame=0;else{frame=Animation$2.binarySearch(frames,lastTime);var frameTime=frames[frame];while(frame>0){if(frames[frame-1]!=frameTime)break;frame--}}for(;frame<frameCount&&time>=frames[frame];frame++)firedEvents.push(this.events[frame])};return EventTimeline}();var DrawOrderTimeline$2=function(){function DrawOrderTimeline(frameCount){this.frames=Utils.newFloatArray(frameCount);this.drawOrders=new Array(frameCount)}DrawOrderTimeline.prototype.getPropertyId=function(){return TimelineType$1.drawOrder<<24};DrawOrderTimeline.prototype.getFrameCount=function(){return this.frames.length};DrawOrderTimeline.prototype.setFrame=function(frameIndex,time,drawOrder){this.frames[frameIndex]=time;this.drawOrders[frameIndex]=drawOrder};DrawOrderTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var drawOrder=skeleton.drawOrder;var slots=skeleton.slots;if(direction==MixDirection$2.mixOut&&blend==MixBlend$2.setup){Utils.arrayCopy(skeleton.slots,0,skeleton.drawOrder,0,skeleton.slots.length);return}var frames=this.frames;if(time<frames[0]){if(blend==MixBlend$2.setup||blend==MixBlend$2.first)Utils.arrayCopy(skeleton.slots,0,skeleton.drawOrder,0,skeleton.slots.length);return}var frame=0;if(time>=frames[frames.length-1])frame=frames.length-1;else frame=Animation$2.binarySearch(frames,time)-1;var drawOrderToSetupIndex=this.drawOrders[frame];if(drawOrderToSetupIndex==null)Utils.arrayCopy(slots,0,drawOrder,0,slots.length);else{for(var i=0,n=drawOrderToSetupIndex.length;i<n;i++)drawOrder[i]=slots[drawOrderToSetupIndex[i]]}};return DrawOrderTimeline}();var IkConstraintTimeline$2=function(_super){__extends$3(IkConstraintTimeline,_super);function IkConstraintTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*IkConstraintTimeline.ENTRIES);return _this}IkConstraintTimeline.prototype.getPropertyId=function(){return(TimelineType$1.ikConstraint<<24)+this.ikConstraintIndex};IkConstraintTimeline.prototype.setFrame=function(frameIndex,time,mix,softness,bendDirection,compress,stretch){frameIndex*=IkConstraintTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+IkConstraintTimeline.MIX]=mix;this.frames[frameIndex+IkConstraintTimeline.SOFTNESS]=softness;this.frames[frameIndex+IkConstraintTimeline.BEND_DIRECTION]=bendDirection;this.frames[frameIndex+IkConstraintTimeline.COMPRESS]=compress?1:0;this.frames[frameIndex+IkConstraintTimeline.STRETCH]=stretch?1:0};IkConstraintTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var frames=this.frames;var constraint=skeleton.ikConstraints[this.ikConstraintIndex];if(!constraint.active)return;if(time<frames[0]){switch(blend){case MixBlend$2.setup:constraint.mix=constraint.data.mix;constraint.softness=constraint.data.softness;constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch;return;case MixBlend$2.first:constraint.mix+=(constraint.data.mix-constraint.mix)*alpha;constraint.softness+=(constraint.data.softness-constraint.softness)*alpha;constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch}return}if(time>=frames[frames.length-IkConstraintTimeline.ENTRIES]){if(blend==MixBlend$2.setup){constraint.mix=constraint.data.mix+(frames[frames.length+IkConstraintTimeline.PREV_MIX]-constraint.data.mix)*alpha;constraint.softness=constraint.data.softness+(frames[frames.length+IkConstraintTimeline.PREV_SOFTNESS]-constraint.data.softness)*alpha;if(direction==MixDirection$2.mixOut){constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch}else{constraint.bendDirection=frames[frames.length+IkConstraintTimeline.PREV_BEND_DIRECTION];constraint.compress=frames[frames.length+IkConstraintTimeline.PREV_COMPRESS]!=0;constraint.stretch=frames[frames.length+IkConstraintTimeline.PREV_STRETCH]!=0}}else{constraint.mix+=(frames[frames.length+IkConstraintTimeline.PREV_MIX]-constraint.mix)*alpha;constraint.softness+=(frames[frames.length+IkConstraintTimeline.PREV_SOFTNESS]-constraint.softness)*alpha;if(direction==MixDirection$2.mixIn){constraint.bendDirection=frames[frames.length+IkConstraintTimeline.PREV_BEND_DIRECTION];constraint.compress=frames[frames.length+IkConstraintTimeline.PREV_COMPRESS]!=0;constraint.stretch=frames[frames.length+IkConstraintTimeline.PREV_STRETCH]!=0}}return}var frame=Animation$2.binarySearch(frames,time,IkConstraintTimeline.ENTRIES);var mix=frames[frame+IkConstraintTimeline.PREV_MIX];var softness=frames[frame+IkConstraintTimeline.PREV_SOFTNESS];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/IkConstraintTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+IkConstraintTimeline.PREV_TIME]-frameTime));if(blend==MixBlend$2.setup){constraint.mix=constraint.data.mix+(mix+(frames[frame+IkConstraintTimeline.MIX]-mix)*percent-constraint.data.mix)*alpha;constraint.softness=constraint.data.softness+(softness+(frames[frame+IkConstraintTimeline.SOFTNESS]-softness)*percent-constraint.data.softness)*alpha;if(direction==MixDirection$2.mixOut){constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch}else{constraint.bendDirection=frames[frame+IkConstraintTimeline.PREV_BEND_DIRECTION];constraint.compress=frames[frame+IkConstraintTimeline.PREV_COMPRESS]!=0;constraint.stretch=frames[frame+IkConstraintTimeline.PREV_STRETCH]!=0}}else{constraint.mix+=(mix+(frames[frame+IkConstraintTimeline.MIX]-mix)*percent-constraint.mix)*alpha;constraint.softness+=(softness+(frames[frame+IkConstraintTimeline.SOFTNESS]-softness)*percent-constraint.softness)*alpha;if(direction==MixDirection$2.mixIn){constraint.bendDirection=frames[frame+IkConstraintTimeline.PREV_BEND_DIRECTION];constraint.compress=frames[frame+IkConstraintTimeline.PREV_COMPRESS]!=0;constraint.stretch=frames[frame+IkConstraintTimeline.PREV_STRETCH]!=0}}};IkConstraintTimeline.ENTRIES=6;IkConstraintTimeline.PREV_TIME=-6;IkConstraintTimeline.PREV_MIX=-5;IkConstraintTimeline.PREV_SOFTNESS=-4;IkConstraintTimeline.PREV_BEND_DIRECTION=-3;IkConstraintTimeline.PREV_COMPRESS=-2;IkConstraintTimeline.PREV_STRETCH=-1;IkConstraintTimeline.MIX=1;IkConstraintTimeline.SOFTNESS=2;IkConstraintTimeline.BEND_DIRECTION=3;IkConstraintTimeline.COMPRESS=4;IkConstraintTimeline.STRETCH=5;return IkConstraintTimeline}(CurveTimeline$2);var TransformConstraintTimeline$2=function(_super){__extends$3(TransformConstraintTimeline,_super);function TransformConstraintTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*TransformConstraintTimeline.ENTRIES);return _this}TransformConstraintTimeline.prototype.getPropertyId=function(){return(TimelineType$1.transformConstraint<<24)+this.transformConstraintIndex};TransformConstraintTimeline.prototype.setFrame=function(frameIndex,time,rotateMix,translateMix,scaleMix,shearMix){frameIndex*=TransformConstraintTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+TransformConstraintTimeline.ROTATE]=rotateMix;this.frames[frameIndex+TransformConstraintTimeline.TRANSLATE]=translateMix;this.frames[frameIndex+TransformConstraintTimeline.SCALE]=scaleMix;this.frames[frameIndex+TransformConstraintTimeline.SHEAR]=shearMix};TransformConstraintTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var frames=this.frames;var constraint=skeleton.transformConstraints[this.transformConstraintIndex];if(!constraint.active)return;if(time<frames[0]){var data=constraint.data;switch(blend){case MixBlend$2.setup:constraint.rotateMix=data.rotateMix;constraint.translateMix=data.translateMix;constraint.scaleMix=data.scaleMix;constraint.shearMix=data.shearMix;return;case MixBlend$2.first:constraint.rotateMix+=(data.rotateMix-constraint.rotateMix)*alpha;constraint.translateMix+=(data.translateMix-constraint.translateMix)*alpha;constraint.scaleMix+=(data.scaleMix-constraint.scaleMix)*alpha;constraint.shearMix+=(data.shearMix-constraint.shearMix)*alpha}return}var rotate=0,translate=0,scale=0,shear=0;if(time>=frames[frames.length-TransformConstraintTimeline.ENTRIES]){var i=frames.length;rotate=frames[i+TransformConstraintTimeline.PREV_ROTATE];translate=frames[i+TransformConstraintTimeline.PREV_TRANSLATE];scale=frames[i+TransformConstraintTimeline.PREV_SCALE];shear=frames[i+TransformConstraintTimeline.PREV_SHEAR]}else{var frame=Animation$2.binarySearch(frames,time,TransformConstraintTimeline.ENTRIES);rotate=frames[frame+TransformConstraintTimeline.PREV_ROTATE];translate=frames[frame+TransformConstraintTimeline.PREV_TRANSLATE];scale=frames[frame+TransformConstraintTimeline.PREV_SCALE];shear=frames[frame+TransformConstraintTimeline.PREV_SHEAR];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/TransformConstraintTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+TransformConstraintTimeline.PREV_TIME]-frameTime));rotate+=(frames[frame+TransformConstraintTimeline.ROTATE]-rotate)*percent;translate+=(frames[frame+TransformConstraintTimeline.TRANSLATE]-translate)*percent;scale+=(frames[frame+TransformConstraintTimeline.SCALE]-scale)*percent;shear+=(frames[frame+TransformConstraintTimeline.SHEAR]-shear)*percent}if(blend==MixBlend$2.setup){var data=constraint.data;constraint.rotateMix=data.rotateMix+(rotate-data.rotateMix)*alpha;constraint.translateMix=data.translateMix+(translate-data.translateMix)*alpha;constraint.scaleMix=data.scaleMix+(scale-data.scaleMix)*alpha;constraint.shearMix=data.shearMix+(shear-data.shearMix)*alpha}else{constraint.rotateMix+=(rotate-constraint.rotateMix)*alpha;constraint.translateMix+=(translate-constraint.translateMix)*alpha;constraint.scaleMix+=(scale-constraint.scaleMix)*alpha;constraint.shearMix+=(shear-constraint.shearMix)*alpha}};TransformConstraintTimeline.ENTRIES=5;TransformConstraintTimeline.PREV_TIME=-5;TransformConstraintTimeline.PREV_ROTATE=-4;TransformConstraintTimeline.PREV_TRANSLATE=-3;TransformConstraintTimeline.PREV_SCALE=-2;TransformConstraintTimeline.PREV_SHEAR=-1;TransformConstraintTimeline.ROTATE=1;TransformConstraintTimeline.TRANSLATE=2;TransformConstraintTimeline.SCALE=3;TransformConstraintTimeline.SHEAR=4;return TransformConstraintTimeline}(CurveTimeline$2);var PathConstraintPositionTimeline$2=function(_super){__extends$3(PathConstraintPositionTimeline,_super);function PathConstraintPositionTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*PathConstraintPositionTimeline.ENTRIES);return _this}PathConstraintPositionTimeline.prototype.getPropertyId=function(){return(TimelineType$1.pathConstraintPosition<<24)+this.pathConstraintIndex};PathConstraintPositionTimeline.prototype.setFrame=function(frameIndex,time,value){frameIndex*=PathConstraintPositionTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+PathConstraintPositionTimeline.VALUE]=value};PathConstraintPositionTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var frames=this.frames;var constraint=skeleton.pathConstraints[this.pathConstraintIndex];if(!constraint.active)return;if(time<frames[0]){switch(blend){case MixBlend$2.setup:constraint.position=constraint.data.position;return;case MixBlend$2.first:constraint.position+=(constraint.data.position-constraint.position)*alpha}return}var position=0;if(time>=frames[frames.length-PathConstraintPositionTimeline.ENTRIES])position=frames[frames.length+PathConstraintPositionTimeline.PREV_VALUE];else{var frame=Animation$2.binarySearch(frames,time,PathConstraintPositionTimeline.ENTRIES);position=frames[frame+PathConstraintPositionTimeline.PREV_VALUE];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/PathConstraintPositionTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+PathConstraintPositionTimeline.PREV_TIME]-frameTime));position+=(frames[frame+PathConstraintPositionTimeline.VALUE]-position)*percent}if(blend==MixBlend$2.setup)constraint.position=constraint.data.position+(position-constraint.data.position)*alpha;else constraint.position+=(position-constraint.position)*alpha};PathConstraintPositionTimeline.ENTRIES=2;PathConstraintPositionTimeline.PREV_TIME=-2;PathConstraintPositionTimeline.PREV_VALUE=-1;PathConstraintPositionTimeline.VALUE=1;return PathConstraintPositionTimeline}(CurveTimeline$2);var PathConstraintSpacingTimeline$2=function(_super){__extends$3(PathConstraintSpacingTimeline,_super);function PathConstraintSpacingTimeline(frameCount){return _super.call(this,frameCount)||this}PathConstraintSpacingTimeline.prototype.getPropertyId=function(){return(TimelineType$1.pathConstraintSpacing<<24)+this.pathConstraintIndex};PathConstraintSpacingTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var frames=this.frames;var constraint=skeleton.pathConstraints[this.pathConstraintIndex];if(!constraint.active)return;if(time<frames[0]){switch(blend){case MixBlend$2.setup:constraint.spacing=constraint.data.spacing;return;case MixBlend$2.first:constraint.spacing+=(constraint.data.spacing-constraint.spacing)*alpha}return}var spacing=0;if(time>=frames[frames.length-PathConstraintSpacingTimeline.ENTRIES])spacing=frames[frames.length+PathConstraintSpacingTimeline.PREV_VALUE];else{var frame=Animation$2.binarySearch(frames,time,PathConstraintSpacingTimeline.ENTRIES);spacing=frames[frame+PathConstraintSpacingTimeline.PREV_VALUE];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/PathConstraintSpacingTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+PathConstraintSpacingTimeline.PREV_TIME]-frameTime));spacing+=(frames[frame+PathConstraintSpacingTimeline.VALUE]-spacing)*percent}if(blend==MixBlend$2.setup)constraint.spacing=constraint.data.spacing+(spacing-constraint.data.spacing)*alpha;else constraint.spacing+=(spacing-constraint.spacing)*alpha};return PathConstraintSpacingTimeline}(PathConstraintPositionTimeline$2);var PathConstraintMixTimeline$2=function(_super){__extends$3(PathConstraintMixTimeline,_super);function PathConstraintMixTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*PathConstraintMixTimeline.ENTRIES);return _this}PathConstraintMixTimeline.prototype.getPropertyId=function(){return(TimelineType$1.pathConstraintMix<<24)+this.pathConstraintIndex};PathConstraintMixTimeline.prototype.setFrame=function(frameIndex,time,rotateMix,translateMix){frameIndex*=PathConstraintMixTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+PathConstraintMixTimeline.ROTATE]=rotateMix;this.frames[frameIndex+PathConstraintMixTimeline.TRANSLATE]=translateMix};PathConstraintMixTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var frames=this.frames;var constraint=skeleton.pathConstraints[this.pathConstraintIndex];if(!constraint.active)return;if(time<frames[0]){switch(blend){case MixBlend$2.setup:constraint.rotateMix=constraint.data.rotateMix;constraint.translateMix=constraint.data.translateMix;return;case MixBlend$2.first:constraint.rotateMix+=(constraint.data.rotateMix-constraint.rotateMix)*alpha;constraint.translateMix+=(constraint.data.translateMix-constraint.translateMix)*alpha}return}var rotate=0,translate=0;if(time>=frames[frames.length-PathConstraintMixTimeline.ENTRIES]){rotate=frames[frames.length+PathConstraintMixTimeline.PREV_ROTATE];translate=frames[frames.length+PathConstraintMixTimeline.PREV_TRANSLATE]}else{var frame=Animation$2.binarySearch(frames,time,PathConstraintMixTimeline.ENTRIES);rotate=frames[frame+PathConstraintMixTimeline.PREV_ROTATE];translate=frames[frame+PathConstraintMixTimeline.PREV_TRANSLATE];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/PathConstraintMixTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+PathConstraintMixTimeline.PREV_TIME]-frameTime));rotate+=(frames[frame+PathConstraintMixTimeline.ROTATE]-rotate)*percent;translate+=(frames[frame+PathConstraintMixTimeline.TRANSLATE]-translate)*percent}if(blend==MixBlend$2.setup){constraint.rotateMix=constraint.data.rotateMix+(rotate-constraint.data.rotateMix)*alpha;constraint.translateMix=constraint.data.translateMix+(translate-constraint.data.translateMix)*alpha}else{constraint.rotateMix+=(rotate-constraint.rotateMix)*alpha;constraint.translateMix+=(translate-constraint.translateMix)*alpha}};PathConstraintMixTimeline.ENTRIES=3;PathConstraintMixTimeline.PREV_TIME=-3;PathConstraintMixTimeline.PREV_ROTATE=-2;PathConstraintMixTimeline.PREV_TRANSLATE=-1;PathConstraintMixTimeline.ROTATE=1;PathConstraintMixTimeline.TRANSLATE=2;return PathConstraintMixTimeline}(CurveTimeline$2);var AnimationState$2=function(){function AnimationState(data){this.tracks=new Array;this.timeScale=1;this.unkeyedState=0;this.events=new Array;this.listeners=new Array;this.queue=new EventQueue$2(this);this.propertyIDs=new IntSet;this.animationsChanged=false;this.trackEntryPool=new Pool(function(){return new TrackEntry$2});this.data=data}AnimationState.prototype.update=function(delta){delta*=this.timeScale;var tracks=this.tracks;for(var i=0,n=tracks.length;i<n;i++){var current=tracks[i];if(current==null)continue;current.animationLast=current.nextAnimationLast;current.trackLast=current.nextTrackLast;var currentDelta=delta*current.timeScale;if(current.delay>0){current.delay-=currentDelta;if(current.delay>0)continue;currentDelta=-current.delay;current.delay=0}var next=current.next;if(next!=null){var nextTime=current.trackLast-next.delay;if(nextTime>=0){next.delay=0;next.trackTime+=current.timeScale==0?0:(nextTime/current.timeScale+delta)*next.timeScale;current.trackTime+=currentDelta;this.setCurrent(i,next,true);while(next.mixingFrom!=null){next.mixTime+=delta;next=next.mixingFrom}continue}}else if(current.trackLast>=current.trackEnd&&current.mixingFrom==null){tracks[i]=null;this.queue.end(current);this.disposeNext(current);continue}if(current.mixingFrom!=null&&this.updateMixingFrom(current,delta)){var from=current.mixingFrom;current.mixingFrom=null;if(from!=null)from.mixingTo=null;while(from!=null){this.queue.end(from);from=from.mixingFrom}}current.trackTime+=currentDelta}this.queue.drain()};AnimationState.prototype.updateMixingFrom=function(to,delta){var from=to.mixingFrom;if(from==null)return true;var finished=this.updateMixingFrom(from,delta);from.animationLast=from.nextAnimationLast;from.trackLast=from.nextTrackLast;if(to.mixTime>0&&to.mixTime>=to.mixDuration){if(from.totalAlpha==0||to.mixDuration==0){to.mixingFrom=from.mixingFrom;if(from.mixingFrom!=null)from.mixingFrom.mixingTo=to;to.interruptAlpha=from.interruptAlpha;this.queue.end(from)}return finished}from.trackTime+=delta*from.timeScale;to.mixTime+=delta;return false};AnimationState.prototype.apply=function(skeleton){if(skeleton==null)throw new Error("skeleton cannot be null.");if(this.animationsChanged)this._animationsChanged();var events=this.events;var tracks=this.tracks;var applied=false;for(var i_1=0,n_1=tracks.length;i_1<n_1;i_1++){var current=tracks[i_1];if(current==null||current.delay>0)continue;applied=true;var blend=i_1==0?MixBlend$2.first:current.mixBlend;var mix=current.alpha;if(current.mixingFrom!=null)mix*=this.applyMixingFrom(current,skeleton,blend);else if(current.trackTime>=current.trackEnd&&current.next==null)mix=0;var animationLast=current.animationLast,animationTime=current.getAnimationTime();var timelineCount=current.animation.timelines.length;var timelines=current.animation.timelines;if(i_1==0&&mix==1||blend==MixBlend$2.add){for(var ii=0;ii<timelineCount;ii++){Utils.webkit602BugfixHelper(mix,blend);var timeline=timelines[ii];if(timeline instanceof AttachmentTimeline$2)this.applyAttachmentTimeline(timeline,skeleton,animationTime,blend,true);else timeline.apply(skeleton,animationLast,animationTime,events,mix,blend,MixDirection$2.mixIn)}}else{var timelineMode=current.timelineMode;var firstFrame=current.timelinesRotation.length==0;if(firstFrame)Utils.setArraySize(current.timelinesRotation,timelineCount<<1,null);var timelinesRotation=current.timelinesRotation;for(var ii=0;ii<timelineCount;ii++){var timeline_1=timelines[ii];var timelineBlend=timelineMode[ii]==AnimationState.SUBSEQUENT?blend:MixBlend$2.setup;if(timeline_1 instanceof RotateTimeline$2){this.applyRotateTimeline(timeline_1,skeleton,animationTime,mix,timelineBlend,timelinesRotation,ii<<1,firstFrame)}else if(timeline_1 instanceof AttachmentTimeline$2){this.applyAttachmentTimeline(timeline_1,skeleton,animationTime,blend,true)}else{Utils.webkit602BugfixHelper(mix,blend);timeline_1.apply(skeleton,animationLast,animationTime,events,mix,timelineBlend,MixDirection$2.mixIn)}}}this.queueEvents(current,animationTime);events.length=0;current.nextAnimationLast=animationTime;current.nextTrackLast=current.trackTime}var setupState=this.unkeyedState+AnimationState.SETUP;var slots=skeleton.slots;for(var i=0,n=skeleton.slots.length;i<n;i++){var slot=slots[i];if(slot.attachmentState==setupState){var attachmentName=slot.data.attachmentName;slot.setAttachment(attachmentName==null?null:skeleton.getAttachment(slot.data.index,attachmentName))}}this.unkeyedState+=2;this.queue.drain();return applied};AnimationState.prototype.applyMixingFrom=function(to,skeleton,blend){var from=to.mixingFrom;if(from.mixingFrom!=null)this.applyMixingFrom(from,skeleton,blend);var mix=0;if(to.mixDuration==0){mix=1;if(blend==MixBlend$2.first)blend=MixBlend$2.setup}else{mix=to.mixTime/to.mixDuration;if(mix>1)mix=1;if(blend!=MixBlend$2.first)blend=from.mixBlend}var events=mix<from.eventThreshold?this.events:null;var attachments=mix<from.attachmentThreshold,drawOrder=mix<from.drawOrderThreshold;var animationLast=from.animationLast,animationTime=from.getAnimationTime();var timelineCount=from.animation.timelines.length;var timelines=from.animation.timelines;var alphaHold=from.alpha*to.interruptAlpha,alphaMix=alphaHold*(1-mix);if(blend==MixBlend$2.add){for(var i=0;i<timelineCount;i++)timelines[i].apply(skeleton,animationLast,animationTime,events,alphaMix,blend,MixDirection$2.mixOut)}else{var timelineMode=from.timelineMode;var timelineHoldMix=from.timelineHoldMix;var firstFrame=from.timelinesRotation.length==0;if(firstFrame)Utils.setArraySize(from.timelinesRotation,timelineCount<<1,null);var timelinesRotation=from.timelinesRotation;from.totalAlpha=0;for(var i=0;i<timelineCount;i++){var timeline=timelines[i];var direction=MixDirection$2.mixOut;var timelineBlend=void 0;var alpha=0;switch(timelineMode[i]){case AnimationState.SUBSEQUENT:if(!drawOrder&&timeline instanceof DrawOrderTimeline$2)continue;timelineBlend=blend;alpha=alphaMix;break;case AnimationState.FIRST:timelineBlend=MixBlend$2.setup;alpha=alphaMix;break;case AnimationState.HOLD_SUBSEQUENT:timelineBlend=blend;alpha=alphaHold;break;case AnimationState.HOLD_FIRST:timelineBlend=MixBlend$2.setup;alpha=alphaHold;break;default:timelineBlend=MixBlend$2.setup;var holdMix=timelineHoldMix[i];alpha=alphaHold*Math.max(0,1-holdMix.mixTime/holdMix.mixDuration);break}from.totalAlpha+=alpha;if(timeline instanceof RotateTimeline$2)this.applyRotateTimeline(timeline,skeleton,animationTime,alpha,timelineBlend,timelinesRotation,i<<1,firstFrame);else if(timeline instanceof AttachmentTimeline$2)this.applyAttachmentTimeline(timeline,skeleton,animationTime,timelineBlend,attachments);else{Utils.webkit602BugfixHelper(alpha,blend);if(drawOrder&&timeline instanceof DrawOrderTimeline$2&&timelineBlend==MixBlend$2.setup)direction=MixDirection$2.mixIn;timeline.apply(skeleton,animationLast,animationTime,events,alpha,timelineBlend,direction)}}}if(to.mixDuration>0)this.queueEvents(from,animationTime);this.events.length=0;from.nextAnimationLast=animationTime;from.nextTrackLast=from.trackTime;return mix};AnimationState.prototype.applyAttachmentTimeline=function(timeline,skeleton,time,blend,attachments){var slot=skeleton.slots[timeline.slotIndex];if(!slot.bone.active)return;var frames=timeline.frames;if(time<frames[0]){if(blend==MixBlend$2.setup||blend==MixBlend$2.first)this.setAttachment(skeleton,slot,slot.data.attachmentName,attachments)}else{var frameIndex;if(time>=frames[frames.length-1])frameIndex=frames.length-1;else frameIndex=Animation$2.binarySearch(frames,time)-1;this.setAttachment(skeleton,slot,timeline.attachmentNames[frameIndex],attachments)}if(slot.attachmentState<=this.unkeyedState)slot.attachmentState=this.unkeyedState+AnimationState.SETUP};AnimationState.prototype.setAttachment=function(skeleton,slot,attachmentName,attachments){slot.setAttachment(attachmentName==null?null:skeleton.getAttachment(slot.data.index,attachmentName));if(attachments)slot.attachmentState=this.unkeyedState+AnimationState.CURRENT};AnimationState.prototype.applyRotateTimeline=function(timeline,skeleton,time,alpha,blend,timelinesRotation,i,firstFrame){if(firstFrame)timelinesRotation[i]=0;if(alpha==1){timeline.apply(skeleton,0,time,null,1,blend,MixDirection$2.mixIn);return}var rotateTimeline=timeline;var frames=rotateTimeline.frames;var bone=skeleton.bones[rotateTimeline.boneIndex];if(!bone.active)return;var r1=0,r2=0;if(time<frames[0]){switch(blend){case MixBlend$2.setup:bone.rotation=bone.data.rotation;default:return;case MixBlend$2.first:r1=bone.rotation;r2=bone.data.rotation}}else{r1=blend==MixBlend$2.setup?bone.data.rotation:bone.rotation;if(time>=frames[frames.length-RotateTimeline$2.ENTRIES])r2=bone.data.rotation+frames[frames.length+RotateTimeline$2.PREV_ROTATION];else{var frame=Animation$2.binarySearch(frames,time,RotateTimeline$2.ENTRIES);var prevRotation=frames[frame+RotateTimeline$2.PREV_ROTATION];var frameTime=frames[frame];var percent=rotateTimeline.getCurvePercent((frame>>1)-1,1-(time-frameTime)/(frames[frame+RotateTimeline$2.PREV_TIME]-frameTime));r2=frames[frame+RotateTimeline$2.ROTATION]-prevRotation;r2-=(16384-(16384.499999999996-r2/360|0))*360;r2=prevRotation+r2*percent+bone.data.rotation;r2-=(16384-(16384.499999999996-r2/360|0))*360}}var total=0,diff=r2-r1;diff-=(16384-(16384.499999999996-diff/360|0))*360;if(diff==0){total=timelinesRotation[i]}else{var lastTotal=0,lastDiff=0;if(firstFrame){lastTotal=0;lastDiff=diff}else{lastTotal=timelinesRotation[i];lastDiff=timelinesRotation[i+1]}var current=diff>0,dir=lastTotal>=0;if(MathUtils.signum(lastDiff)!=MathUtils.signum(diff)&&Math.abs(lastDiff)<=90){if(Math.abs(lastTotal)>180)lastTotal+=360*MathUtils.signum(lastTotal);dir=current}total=diff+lastTotal-lastTotal%360;if(dir!=current)total+=360*MathUtils.signum(lastTotal);timelinesRotation[i]=total}timelinesRotation[i+1]=diff;r1+=total*alpha;bone.rotation=r1-(16384-(16384.499999999996-r1/360|0))*360};AnimationState.prototype.queueEvents=function(entry,animationTime){var animationStart=entry.animationStart,animationEnd=entry.animationEnd;var duration=animationEnd-animationStart;var trackLastWrapped=entry.trackLast%duration;var events=this.events;var i=0,n=events.length;for(;i<n;i++){var event_1=events[i];if(event_1.time<trackLastWrapped)break;if(event_1.time>animationEnd)continue;this.queue.event(entry,event_1)}var complete=false;if(entry.loop)complete=duration==0||trackLastWrapped>entry.trackTime%duration;else complete=animationTime>=animationEnd&&entry.animationLast<animationEnd;if(complete)this.queue.complete(entry);for(;i<n;i++){var event_2=events[i];if(event_2.time<animationStart)continue;this.queue.event(entry,events[i])}};AnimationState.prototype.clearTracks=function(){var oldDrainDisabled=this.queue.drainDisabled;this.queue.drainDisabled=true;for(var i=0,n=this.tracks.length;i<n;i++)this.clearTrack(i);this.tracks.length=0;this.queue.drainDisabled=oldDrainDisabled;this.queue.drain()};AnimationState.prototype.clearTrack=function(trackIndex){if(trackIndex>=this.tracks.length)return;var current=this.tracks[trackIndex];if(current==null)return;this.queue.end(current);this.disposeNext(current);var entry=current;while(true){var from=entry.mixingFrom;if(from==null)break;this.queue.end(from);entry.mixingFrom=null;entry.mixingTo=null;entry=from}this.tracks[current.trackIndex]=null;this.queue.drain()};AnimationState.prototype.setCurrent=function(index,current,interrupt){var from=this.expandToIndex(index);this.tracks[index]=current;if(from!=null){if(interrupt)this.queue.interrupt(from);current.mixingFrom=from;from.mixingTo=current;current.mixTime=0;if(from.mixingFrom!=null&&from.mixDuration>0)current.interruptAlpha*=Math.min(1,from.mixTime/from.mixDuration);from.timelinesRotation.length=0}this.queue.start(current)};AnimationState.prototype.setAnimation=function(trackIndex,animationName,loop){var animation=this.data.skeletonData.findAnimation(animationName);if(animation==null)throw new Error("Animation not found: "+animationName);return this.setAnimationWith(trackIndex,animation,loop)};AnimationState.prototype.setAnimationWith=function(trackIndex,animation,loop){if(animation==null)throw new Error("animation cannot be null.");var interrupt=true;var current=this.expandToIndex(trackIndex);if(current!=null){if(current.nextTrackLast==-1){this.tracks[trackIndex]=current.mixingFrom;this.queue.interrupt(current);this.queue.end(current);this.disposeNext(current);current=current.mixingFrom;interrupt=false}else this.disposeNext(current)}var entry=this.trackEntry(trackIndex,animation,loop,current);this.setCurrent(trackIndex,entry,interrupt);this.queue.drain();return entry};AnimationState.prototype.addAnimation=function(trackIndex,animationName,loop,delay){var animation=this.data.skeletonData.findAnimation(animationName);if(animation==null)throw new Error("Animation not found: "+animationName);return this.addAnimationWith(trackIndex,animation,loop,delay)};AnimationState.prototype.addAnimationWith=function(trackIndex,animation,loop,delay){if(animation==null)throw new Error("animation cannot be null.");var last=this.expandToIndex(trackIndex);if(last!=null){while(last.next!=null)last=last.next}var entry=this.trackEntry(trackIndex,animation,loop,last);if(last==null){this.setCurrent(trackIndex,entry,true);this.queue.drain()}else{last.next=entry;if(delay<=0){var duration=last.animationEnd-last.animationStart;if(duration!=0){if(last.loop)delay+=duration*(1+(last.trackTime/duration|0));else delay+=Math.max(duration,last.trackTime);delay-=this.data.getMix(last.animation,animation)}else delay=last.trackTime}}entry.delay=delay;return entry};AnimationState.prototype.setEmptyAnimation=function(trackIndex,mixDuration){var entry=this.setAnimationWith(trackIndex,AnimationState.emptyAnimation,false);entry.mixDuration=mixDuration;entry.trackEnd=mixDuration;return entry};AnimationState.prototype.addEmptyAnimation=function(trackIndex,mixDuration,delay){if(delay<=0)delay-=mixDuration;var entry=this.addAnimationWith(trackIndex,AnimationState.emptyAnimation,false,delay);entry.mixDuration=mixDuration;entry.trackEnd=mixDuration;return entry};AnimationState.prototype.setEmptyAnimations=function(mixDuration){var oldDrainDisabled=this.queue.drainDisabled;this.queue.drainDisabled=true;for(var i=0,n=this.tracks.length;i<n;i++){var current=this.tracks[i];if(current!=null)this.setEmptyAnimation(current.trackIndex,mixDuration)}this.queue.drainDisabled=oldDrainDisabled;this.queue.drain()};AnimationState.prototype.expandToIndex=function(index){if(index<this.tracks.length)return this.tracks[index];Utils.ensureArrayCapacity(this.tracks,index+1,null);this.tracks.length=index+1;return null};AnimationState.prototype.trackEntry=function(trackIndex,animation,loop,last){var entry=this.trackEntryPool.obtain();entry.trackIndex=trackIndex;entry.animation=animation;entry.loop=loop;entry.holdPrevious=false;entry.eventThreshold=0;entry.attachmentThreshold=0;entry.drawOrderThreshold=0;entry.animationStart=0;entry.animationEnd=animation.duration;entry.animationLast=-1;entry.nextAnimationLast=-1;entry.delay=0;entry.trackTime=0;entry.trackLast=-1;entry.nextTrackLast=-1;entry.trackEnd=Number.MAX_VALUE;entry.timeScale=1;entry.alpha=1;entry.interruptAlpha=1;entry.mixTime=0;entry.mixDuration=last==null?0:this.data.getMix(last.animation,animation);entry.mixBlend=MixBlend$2.replace;return entry};AnimationState.prototype.disposeNext=function(entry){var next=entry.next;while(next!=null){this.queue.dispose(next);next=next.next}entry.next=null};AnimationState.prototype._animationsChanged=function(){this.animationsChanged=false;this.propertyIDs.clear();for(var i=0,n=this.tracks.length;i<n;i++){var entry=this.tracks[i];if(entry==null)continue;while(entry.mixingFrom!=null)entry=entry.mixingFrom;do{if(entry.mixingFrom==null||entry.mixBlend!=MixBlend$2.add)this.computeHold(entry);entry=entry.mixingTo}while(entry!=null)}};AnimationState.prototype.computeHold=function(entry){var to=entry.mixingTo;var timelines=entry.animation.timelines;var timelinesCount=entry.animation.timelines.length;var timelineMode=Utils.setArraySize(entry.timelineMode,timelinesCount);entry.timelineHoldMix.length=0;var timelineDipMix=Utils.setArraySize(entry.timelineHoldMix,timelinesCount);var propertyIDs=this.propertyIDs;if(to!=null&&to.holdPrevious){for(var i=0;i<timelinesCount;i++){timelineMode[i]=propertyIDs.add(timelines[i].getPropertyId())?AnimationState.HOLD_FIRST:AnimationState.HOLD_SUBSEQUENT}return}outer:for(var i=0;i<timelinesCount;i++){var timeline=timelines[i];var id=timeline.getPropertyId();if(!propertyIDs.add(id))timelineMode[i]=AnimationState.SUBSEQUENT;else if(to==null||timeline instanceof AttachmentTimeline$2||timeline instanceof DrawOrderTimeline$2||timeline instanceof EventTimeline$2||!to.animation.hasTimeline(id)){timelineMode[i]=AnimationState.FIRST}else{for(var next=to.mixingTo;next!=null;next=next.mixingTo){if(next.animation.hasTimeline(id))continue;if(entry.mixDuration>0){timelineMode[i]=AnimationState.HOLD_MIX;timelineDipMix[i]=next;continue outer}break}timelineMode[i]=AnimationState.HOLD_FIRST}}};AnimationState.prototype.getCurrent=function(trackIndex){if(trackIndex>=this.tracks.length)return null;return this.tracks[trackIndex]};AnimationState.prototype.addListener=function(listener){if(listener==null)throw new Error("listener cannot be null.");this.listeners.push(listener)};AnimationState.prototype.removeListener=function(listener){var index=this.listeners.indexOf(listener);if(index>=0)this.listeners.splice(index,1)};AnimationState.prototype.clearListeners=function(){this.listeners.length=0};AnimationState.prototype.clearListenerNotifications=function(){this.queue.clear()};AnimationState.prototype.setAnimationByName=function(trackIndex,animationName,loop){if(!AnimationState.deprecatedWarning1){AnimationState.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")}this.setAnimation(trackIndex,animationName,loop)};AnimationState.prototype.addAnimationByName=function(trackIndex,animationName,loop,delay){if(!AnimationState.deprecatedWarning2){AnimationState.deprecatedWarning2=true;console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")}this.addAnimation(trackIndex,animationName,loop,delay)};AnimationState.prototype.hasAnimation=function(animationName){var animation=this.data.skeletonData.findAnimation(animationName);return animation!==null};AnimationState.prototype.hasAnimationByName=function(animationName){if(!AnimationState.deprecatedWarning3){AnimationState.deprecatedWarning3=true;console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")}return this.hasAnimation(animationName)};AnimationState.emptyAnimation=new Animation$2("<empty>",[],0);AnimationState.SUBSEQUENT=0;AnimationState.FIRST=1;AnimationState.HOLD_SUBSEQUENT=2;AnimationState.HOLD_FIRST=3;AnimationState.HOLD_MIX=4;AnimationState.SETUP=1;AnimationState.CURRENT=2;AnimationState.deprecatedWarning1=false;AnimationState.deprecatedWarning2=false;AnimationState.deprecatedWarning3=false;return AnimationState}();var TrackEntry$2=function(){function TrackEntry(){this.mixBlend=MixBlend$2.replace;this.timelineMode=new Array;this.timelineHoldMix=new Array;this.timelinesRotation=new Array}TrackEntry.prototype.reset=function(){this.next=null;this.mixingFrom=null;this.mixingTo=null;this.animation=null;this.listener=null;this.timelineMode.length=0;this.timelineHoldMix.length=0;this.timelinesRotation.length=0};TrackEntry.prototype.getAnimationTime=function(){if(this.loop){var duration=this.animationEnd-this.animationStart;if(duration==0)return this.animationStart;return this.trackTime%duration+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)};TrackEntry.prototype.setAnimationLast=function(animationLast){this.animationLast=animationLast;this.nextAnimationLast=animationLast};TrackEntry.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart};TrackEntry.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0};Object.defineProperty(TrackEntry.prototype,"time",{get:function(){if(!TrackEntry.deprecatedWarning1){TrackEntry.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")}return this.trackTime},set:function(value){if(!TrackEntry.deprecatedWarning1){TrackEntry.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")}this.trackTime=value},enumerable:false,configurable:true});Object.defineProperty(TrackEntry.prototype,"endTime",{get:function(){if(!TrackEntry.deprecatedWarning2){TrackEntry.deprecatedWarning2=true;console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")}return this.trackTime},set:function(value){if(!TrackEntry.deprecatedWarning2){TrackEntry.deprecatedWarning2=true;console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")}this.trackTime=value},enumerable:false,configurable:true});TrackEntry.prototype.loopsCount=function(){return Math.floor(this.trackTime/this.trackEnd)};TrackEntry.deprecatedWarning1=false;TrackEntry.deprecatedWarning2=false;return TrackEntry}();var EventQueue$2=function(){function EventQueue(animState){this.objects=[];this.drainDisabled=false;this.animState=animState}EventQueue.prototype.start=function(entry){this.objects.push(EventType$2.start);this.objects.push(entry);this.animState.animationsChanged=true};EventQueue.prototype.interrupt=function(entry){this.objects.push(EventType$2.interrupt);this.objects.push(entry)};EventQueue.prototype.end=function(entry){this.objects.push(EventType$2.end);this.objects.push(entry);this.animState.animationsChanged=true};EventQueue.prototype.dispose=function(entry){this.objects.push(EventType$2.dispose);this.objects.push(entry)};EventQueue.prototype.complete=function(entry){this.objects.push(EventType$2.complete);this.objects.push(entry)};EventQueue.prototype.event=function(entry,event){this.objects.push(EventType$2.event);this.objects.push(entry);this.objects.push(event)};EventQueue.prototype.deprecateStuff=function(){if(!EventQueue.deprecatedWarning1){EventQueue.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")}return true};EventQueue.prototype.drain=function(){if(this.drainDisabled)return;this.drainDisabled=true;var objects=this.objects;var listeners=this.animState.listeners;for(var i=0;i<objects.length;i+=2){var type=objects[i];var entry=objects[i+1];switch(type){case EventType$2.start:if(entry.listener!=null&&entry.listener.start)entry.listener.start(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].start)listeners[ii].start(entry);entry.onStart&&this.deprecateStuff()&&entry.onStart(entry.trackIndex);this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(entry.trackIndex);break;case EventType$2.interrupt:if(entry.listener!=null&&entry.listener.interrupt)entry.listener.interrupt(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].interrupt)listeners[ii].interrupt(entry);break;case EventType$2.end:if(entry.listener!=null&&entry.listener.end)entry.listener.end(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].end)listeners[ii].end(entry);entry.onEnd&&this.deprecateStuff()&&entry.onEnd(entry.trackIndex);this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(entry.trackIndex);case EventType$2.dispose:if(entry.listener!=null&&entry.listener.dispose)entry.listener.dispose(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].dispose)listeners[ii].dispose(entry);this.animState.trackEntryPool.free(entry);break;case EventType$2.complete:if(entry.listener!=null&&entry.listener.complete)entry.listener.complete(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].complete)listeners[ii].complete(entry);var count=MathUtils.toInt(entry.loopsCount());entry.onComplete&&this.deprecateStuff()&&entry.onComplete(entry.trackIndex,count);this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(entry.trackIndex,count);break;case EventType$2.event:var event_3=objects[i+++2];if(entry.listener!=null&&entry.listener.event)entry.listener.event(entry,event_3);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].event)listeners[ii].event(entry,event_3);entry.onEvent&&this.deprecateStuff()&&entry.onEvent(entry.trackIndex,event_3);this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(entry.trackIndex,event_3);break}}this.clear();this.drainDisabled=false};EventQueue.prototype.clear=function(){this.objects.length=0};EventQueue.deprecatedWarning1=false;return EventQueue}();var EventType$2;(function(EventType){EventType[EventType["start"]=0]="start";EventType[EventType["interrupt"]=1]="interrupt";EventType[EventType["end"]=2]="end";EventType[EventType["dispose"]=3]="dispose";EventType[EventType["complete"]=4]="complete";EventType[EventType["event"]=5]="event"})(EventType$2||(EventType$2={}));var AnimationStateAdapter$1=function(){function AnimationStateAdapter(){}AnimationStateAdapter.prototype.start=function(entry){};AnimationStateAdapter.prototype.interrupt=function(entry){};AnimationStateAdapter.prototype.end=function(entry){};AnimationStateAdapter.prototype.dispose=function(entry){};AnimationStateAdapter.prototype.complete=function(entry){};AnimationStateAdapter.prototype.event=function(entry,event){};return AnimationStateAdapter}();var AnimationStateData$2=function(){function AnimationStateData(skeletonData){this.animationToMixTime={};this.defaultMix=0;if(skeletonData==null)throw new Error("skeletonData cannot be null.");this.skeletonData=skeletonData}AnimationStateData.prototype.setMix=function(fromName,toName,duration){var from=this.skeletonData.findAnimation(fromName);if(from==null)throw new Error("Animation not found: "+fromName);var to=this.skeletonData.findAnimation(toName);if(to==null)throw new Error("Animation not found: "+toName);this.setMixWith(from,to,duration)};AnimationStateData.prototype.setMixByName=function(fromName,toName,duration){if(!AnimationStateData.deprecatedWarning1){AnimationStateData.deprecatedWarning1=true;console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")}this.setMix(fromName,toName,duration)};AnimationStateData.prototype.setMixWith=function(from,to,duration){if(from==null)throw new Error("from cannot be null.");if(to==null)throw new Error("to cannot be null.");var key=from.name+"."+to.name;this.animationToMixTime[key]=duration};AnimationStateData.prototype.getMix=function(from,to){var key=from.name+"."+to.name;var value=this.animationToMixTime[key];return value===undefined?this.defaultMix:value};AnimationStateData.deprecatedWarning1=false;return AnimationStateData}();var AtlasAttachmentLoader$2=function(){function AtlasAttachmentLoader(atlas){this.atlas=atlas}AtlasAttachmentLoader.prototype.newRegionAttachment=function(skin,name,path){var region=this.atlas.findRegion(path);if(region==null)throw new Error("Region not found in atlas: "+path+" (region attachment: "+name+")");var attachment=new RegionAttachment$2(name);attachment.region=region;return attachment};AtlasAttachmentLoader.prototype.newMeshAttachment=function(skin,name,path){var region=this.atlas.findRegion(path);if(region==null)throw new Error("Region not found in atlas: "+path+" (mesh attachment: "+name+")");var attachment=new MeshAttachment$2(name);attachment.region=region;return attachment};AtlasAttachmentLoader.prototype.newBoundingBoxAttachment=function(skin,name){return new BoundingBoxAttachment$2(name)};AtlasAttachmentLoader.prototype.newPathAttachment=function(skin,name){return new PathAttachment$2(name)};AtlasAttachmentLoader.prototype.newPointAttachment=function(skin,name){return new PointAttachment$2(name)};AtlasAttachmentLoader.prototype.newClippingAttachment=function(skin,name){return new ClippingAttachment$2(name)};return AtlasAttachmentLoader}();var BoneData$2=function(){function BoneData(index,name,parent){this.x=0;this.y=0;this.rotation=0;this.scaleX=1;this.scaleY=1;this.shearX=0;this.shearY=0;this.transformMode=TransformMode$2.Normal;this.skinRequired=false;this.color=new Color;if(index<0)throw new Error("index must be >= 0.");if(name==null)throw new Error("name cannot be null.");this.index=index;this.name=name;this.parent=parent}return BoneData}();var TransformMode$2;(function(TransformMode){TransformMode[TransformMode["Normal"]=0]="Normal";TransformMode[TransformMode["OnlyTranslation"]=1]="OnlyTranslation";TransformMode[TransformMode["NoRotationOrReflection"]=2]="NoRotationOrReflection";TransformMode[TransformMode["NoScale"]=3]="NoScale";TransformMode[TransformMode["NoScaleOrReflection"]=4]="NoScaleOrReflection"})(TransformMode$2||(TransformMode$2={}));var Bone$2=function(){function Bone(data,skeleton,parent){this.matrix=new math.Matrix;this.children=new Array;this.x=0;this.y=0;this.rotation=0;this.scaleX=0;this.scaleY=0;this.shearX=0;this.shearY=0;this.ax=0;this.ay=0;this.arotation=0;this.ascaleX=0;this.ascaleY=0;this.ashearX=0;this.ashearY=0;this.appliedValid=false;this.sorted=false;this.active=false;if(data==null)throw new Error("data cannot be null.");if(skeleton==null)throw new Error("skeleton cannot be null.");this.data=data;this.skeleton=skeleton;this.parent=parent;this.setToSetupPose()}Object.defineProperty(Bone.prototype,"worldX",{get:function(){return this.matrix.tx},enumerable:false,configurable:true});Object.defineProperty(Bone.prototype,"worldY",{get:function(){return this.matrix.ty},enumerable:false,configurable:true});Bone.prototype.isActive=function(){return this.active};Bone.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)};Bone.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)};Bone.prototype.updateWorldTransformWith=function(x,y,rotation,scaleX,scaleY,shearX,shearY){this.ax=x;this.ay=y;this.arotation=rotation;this.ascaleX=scaleX;this.ascaleY=scaleY;this.ashearX=shearX;this.ashearY=shearY;this.appliedValid=true;var parent=this.parent;var m=this.matrix;var sx=this.skeleton.scaleX;var sy=settings.yDown?-this.skeleton.scaleY:this.skeleton.scaleY;if(parent==null){var skeleton=this.skeleton;var rotationY=rotation+90+shearY;m.a=MathUtils.cosDeg(rotation+shearX)*scaleX*sx;m.c=MathUtils.cosDeg(rotationY)*scaleY*sx;m.b=MathUtils.sinDeg(rotation+shearX)*scaleX*sy;m.d=MathUtils.sinDeg(rotationY)*scaleY*sy;m.tx=x*sx+skeleton.x;m.ty=y*sy+skeleton.y;return}var pa=parent.matrix.a,pb=parent.matrix.c,pc=parent.matrix.b,pd=parent.matrix.d;m.tx=pa*x+pb*y+parent.matrix.tx;m.ty=pc*x+pd*y+parent.matrix.ty;switch(this.data.transformMode){case TransformMode$2.Normal:{var rotationY=rotation+90+shearY;var la=MathUtils.cosDeg(rotation+shearX)*scaleX;var lb=MathUtils.cosDeg(rotationY)*scaleY;var lc=MathUtils.sinDeg(rotation+shearX)*scaleX;var ld=MathUtils.sinDeg(rotationY)*scaleY;m.a=pa*la+pb*lc;m.c=pa*lb+pb*ld;m.b=pc*la+pd*lc;m.d=pc*lb+pd*ld;return}case TransformMode$2.OnlyTranslation:{var rotationY=rotation+90+shearY;m.a=MathUtils.cosDeg(rotation+shearX)*scaleX;m.c=MathUtils.cosDeg(rotationY)*scaleY;m.b=MathUtils.sinDeg(rotation+shearX)*scaleX;m.d=MathUtils.sinDeg(rotationY)*scaleY;break}case TransformMode$2.NoRotationOrReflection:{var s=pa*pa+pc*pc;var prx=0;if(s>1e-4){s=Math.abs(pa*pd-pb*pc)/s;pa/=this.skeleton.scaleX;pc/=this.skeleton.scaleY;pb=pc*s;pd=pa*s;prx=Math.atan2(pc,pa)*MathUtils.radDeg}else{pa=0;pc=0;prx=90-Math.atan2(pd,pb)*MathUtils.radDeg}var rx=rotation+shearX-prx;var ry=rotation+shearY-prx+90;var la=MathUtils.cosDeg(rx)*scaleX;var lb=MathUtils.cosDeg(ry)*scaleY;var lc=MathUtils.sinDeg(rx)*scaleX;var ld=MathUtils.sinDeg(ry)*scaleY;m.a=pa*la-pb*lc;m.c=pa*lb-pb*ld;m.b=pc*la+pd*lc;m.d=pc*lb+pd*ld;break}case TransformMode$2.NoScale:case TransformMode$2.NoScaleOrReflection:{var cos=MathUtils.cosDeg(rotation);var sin=MathUtils.sinDeg(rotation);var za=(pa*cos+pb*sin)/sx;var zc=(pc*cos+pd*sin)/sy;var s=Math.sqrt(za*za+zc*zc);if(s>1e-5)s=1/s;za*=s;zc*=s;s=Math.sqrt(za*za+zc*zc);if(this.data.transformMode==TransformMode$2.NoScale&&pa*pd-pb*pc<0!=(settings.yDown?this.skeleton.scaleX<0!=this.skeleton.scaleY>0:this.skeleton.scaleX<0!=this.skeleton.scaleY<0))s=-s;var r=Math.PI/2+Math.atan2(zc,za);var zb=Math.cos(r)*s;var zd=Math.sin(r)*s;var la=MathUtils.cosDeg(shearX)*scaleX;var lb=MathUtils.cosDeg(90+shearY)*scaleY;var lc=MathUtils.sinDeg(shearX)*scaleX;var ld=MathUtils.sinDeg(90+shearY)*scaleY;m.a=za*la+zb*lc;m.c=za*lb+zb*ld;m.b=zc*la+zd*lc;m.d=zc*lb+zd*ld;break}}m.a*=sx;m.c*=sx;m.b*=sy;m.d*=sy};Bone.prototype.setToSetupPose=function(){var data=this.data;this.x=data.x;this.y=data.y;this.rotation=data.rotation;this.scaleX=data.scaleX;this.scaleY=data.scaleY;this.shearX=data.shearX;this.shearY=data.shearY};Bone.prototype.getWorldRotationX=function(){return Math.atan2(this.matrix.b,this.matrix.a)*MathUtils.radDeg};Bone.prototype.getWorldRotationY=function(){return Math.atan2(this.matrix.d,this.matrix.c)*MathUtils.radDeg};Bone.prototype.getWorldScaleX=function(){var m=this.matrix;return Math.sqrt(m.a*m.a+m.c*m.c)};Bone.prototype.getWorldScaleY=function(){var m=this.matrix;return Math.sqrt(m.b*m.b+m.d*m.d)};Bone.prototype.updateAppliedTransform=function(){this.appliedValid=true;var parent=this.parent;var m=this.matrix;if(parent==null){this.ax=m.tx;this.ay=m.ty;this.arotation=Math.atan2(m.b,m.a)*MathUtils.radDeg;this.ascaleX=Math.sqrt(m.a*m.a+m.b*m.b);this.ascaleY=Math.sqrt(m.c*m.c+m.d*m.d);this.ashearX=0;this.ashearY=Math.atan2(m.a*m.c+m.b*m.d,m.a*m.d-m.b*m.c)*MathUtils.radDeg;return}var pm=parent.matrix;var pid=1/(pm.a*pm.d-pm.b*pm.c);var dx=m.tx-pm.tx,dy=m.ty-pm.ty;this.ax=dx*pm.d*pid-dy*pm.c*pid;this.ay=dy*pm.a*pid-dx*pm.b*pid;var ia=pid*pm.d;var id=pid*pm.a;var ib=pid*pm.c;var ic=pid*pm.b;var ra=ia*m.a-ib*m.b;var rb=ia*m.c-ib*m.d;var rc=id*m.b-ic*m.a;var rd=id*m.d-ic*m.c;this.ashearX=0;this.ascaleX=Math.sqrt(ra*ra+rc*rc);if(this.ascaleX>1e-4){var det=ra*rd-rb*rc;this.ascaleY=det/this.ascaleX;this.ashearY=Math.atan2(ra*rb+rc*rd,det)*MathUtils.radDeg;this.arotation=Math.atan2(rc,ra)*MathUtils.radDeg}else{this.ascaleX=0;this.ascaleY=Math.sqrt(rb*rb+rd*rd);this.ashearY=0;this.arotation=90-Math.atan2(rd,rb)*MathUtils.radDeg}};Bone.prototype.worldToLocal=function(world){var m=this.matrix;var a=m.a,b=m.c,c=m.b,d=m.d;var invDet=1/(a*d-b*c);var x=world.x-m.tx,y=world.y-m.ty;world.x=x*d*invDet-y*b*invDet;world.y=y*a*invDet-x*c*invDet;return world};Bone.prototype.localToWorld=function(local){var m=this.matrix;var x=local.x,y=local.y;local.x=x*m.a+y*m.c+m.tx;local.y=x*m.b+y*m.d+m.ty;return local};Bone.prototype.worldToLocalRotation=function(worldRotation){var sin=MathUtils.sinDeg(worldRotation),cos=MathUtils.cosDeg(worldRotation);var mat=this.matrix;return Math.atan2(mat.a*sin-mat.b*cos,mat.d*cos-mat.c*sin)*MathUtils.radDeg};Bone.prototype.localToWorldRotation=function(localRotation){var sin=MathUtils.sinDeg(localRotation),cos=MathUtils.cosDeg(localRotation);var mat=this.matrix;return Math.atan2(cos*mat.b+sin*mat.d,cos*mat.a+sin*mat.c)*MathUtils.radDeg};Bone.prototype.rotateWorld=function(degrees){var mat=this.matrix;var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var cos=MathUtils.cosDeg(degrees),sin=MathUtils.sinDeg(degrees);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d;this.appliedValid=false};return Bone}();var ConstraintData$1=function(){function ConstraintData(name,order,skinRequired){this.name=name;this.order=order;this.skinRequired=skinRequired}return ConstraintData}();var Event$2=function(){function Event(time,data){if(data==null)throw new Error("data cannot be null.");this.time=time;this.data=data}return Event}();var EventData$2=function(){function EventData(name){this.name=name}return EventData}();var IkConstraint$2=function(){function IkConstraint(data,skeleton){this.bendDirection=0;this.compress=false;this.stretch=false;this.mix=1;this.softness=0;this.active=false;if(data==null)throw new Error("data cannot be null.");if(skeleton==null)throw new Error("skeleton cannot be null.");this.data=data;this.mix=data.mix;this.softness=data.softness;this.bendDirection=data.bendDirection;this.compress=data.compress;this.stretch=data.stretch;this.bones=new Array;for(var i=0;i<data.bones.length;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findBone(data.target.name)}IkConstraint.prototype.isActive=function(){return this.active};IkConstraint.prototype.apply=function(){this.update()};IkConstraint.prototype.update=function(){var target=this.target;var bones=this.bones;switch(bones.length){case 1:this.apply1(bones[0],target.worldX,target.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(bones[0],bones[1],target.worldX,target.worldY,this.bendDirection,this.stretch,this.softness,this.mix);break}};IkConstraint.prototype.apply1=function(bone,targetX,targetY,compress,stretch,uniform,alpha){if(!bone.appliedValid)bone.updateAppliedTransform();var p=bone.parent.matrix;var pa=p.a,pb=p.c,pc=p.b,pd=p.d;var rotationIK=-bone.ashearX-bone.arotation,tx=0,ty=0;switch(bone.data.transformMode){case TransformMode$2.OnlyTranslation:tx=targetX-bone.worldX;ty=targetY-bone.worldY;break;case TransformMode$2.NoRotationOrReflection:var s=Math.abs(pa*pd-pb*pc)/(pa*pa+pc*pc);var sa=pa/bone.skeleton.scaleX;var sc=pc/bone.skeleton.scaleY;pb=-sc*s*bone.skeleton.scaleX;pd=sa*s*bone.skeleton.scaleY;rotationIK+=Math.atan2(sc,sa)*MathUtils.radDeg;default:var x=targetX-p.tx,y=targetY-p.ty;var d=pa*pd-pb*pc;tx=(x*pd-y*pb)/d-bone.ax;ty=(y*pa-x*pc)/d-bone.ay}rotationIK+=Math.atan2(ty,tx)*MathUtils.radDeg;if(bone.ascaleX<0)rotationIK+=180;if(rotationIK>180)rotationIK-=360;else if(rotationIK<-180)rotationIK+=360;var sx=bone.ascaleX,sy=bone.ascaleY;if(compress||stretch){switch(bone.data.transformMode){case TransformMode$2.NoScale:case TransformMode$2.NoScaleOrReflection:tx=targetX-bone.worldX;ty=targetY-bone.worldY}var b=bone.data.length*sx,dd=Math.sqrt(tx*tx+ty*ty);if(compress&&dd<b||stretch&&dd>b&&b>1e-4){var s=(dd/b-1)*alpha+1;sx*=s;if(uniform)sy*=s}}bone.updateWorldTransformWith(bone.ax,bone.ay,bone.arotation+rotationIK*alpha,sx,sy,bone.ashearX,bone.ashearY)};IkConstraint.prototype.apply2=function(parent,child,targetX,targetY,bendDir,stretch,softness,alpha){if(alpha==0){child.updateWorldTransform();return}if(!parent.appliedValid)parent.updateAppliedTransform();if(!child.appliedValid)child.updateAppliedTransform();var px=parent.ax,py=parent.ay,psx=parent.ascaleX,sx=psx,psy=parent.ascaleY,csx=child.ascaleX;var pmat=parent.matrix;var os1=0,os2=0,s2=0;if(psx<0){psx=-psx;os1=180;s2=-1}else{os1=0;s2=1}if(psy<0){psy=-psy;s2=-s2}if(csx<0){csx=-csx;os2=180}else os2=0;var cx=child.ax,cy=0,cwx=0,cwy=0,a=pmat.a,b=pmat.c,c=pmat.b,d=pmat.d;var u=Math.abs(psx-psy)<=1e-4;if(!u){cy=0;cwx=a*cx+pmat.tx;cwy=c*cx+pmat.ty}else{cy=child.ay;cwx=a*cx+b*cy+pmat.tx;cwy=c*cx+d*cy+pmat.ty}var pp=parent.parent.matrix;a=pp.a;b=pp.c;c=pp.b;d=pp.d;var id=1/(a*d-b*c),x=cwx-pp.tx,y=cwy-pp.ty;var dx=(x*d-y*b)*id-px,dy=(y*a-x*c)*id-py;var l1=Math.sqrt(dx*dx+dy*dy),l2=child.data.length*csx,a1,a2;if(l1<1e-4){this.apply1(parent,targetX,targetY,false,stretch,false,alpha);child.updateWorldTransformWith(cx,cy,0,child.ascaleX,child.ascaleY,child.ashearX,child.ashearY);return}x=targetX-pp.tx;y=targetY-pp.ty;var tx=(x*d-y*b)*id-px,ty=(y*a-x*c)*id-py;var dd=tx*tx+ty*ty;if(softness!=0){softness*=psx*(csx+1)/2;var td=Math.sqrt(dd),sd=td-l1-l2*psx+softness;if(sd>0){var p=Math.min(1,sd/(softness*2))-1;p=(sd-softness*(1-p*p))/td;tx-=p*tx;ty-=p*ty;dd=tx*tx+ty*ty}}outer:if(u){l2*=psx;var cos=(dd-l1*l1-l2*l2)/(2*l1*l2);if(cos<-1)cos=-1;else if(cos>1){cos=1;if(stretch)sx*=(Math.sqrt(dd)/(l1+l2)-1)*alpha+1}a2=Math.acos(cos)*bendDir;a=l1+l2*cos;b=l2*Math.sin(a2);a1=Math.atan2(ty*a-tx*b,tx*a+ty*b)}else{a=psx*l2;b=psy*l2;var aa=a*a,bb=b*b,ta=Math.atan2(ty,tx);c=bb*l1*l1+aa*dd-aa*bb;var c1=-2*bb*l1,c2=bb-aa;d=c1*c1-4*c2*c;if(d>=0){var q=Math.sqrt(d);if(c1<0)q=-q;q=-(c1+q)/2;var r0=q/c2,r1=c/q;var r=Math.abs(r0)<Math.abs(r1)?r0:r1;if(r*r<=dd){y=Math.sqrt(dd-r*r)*bendDir;a1=ta-Math.atan2(y,r);a2=Math.atan2(y/psy,(r-l1)/psx);break outer}}var minAngle=MathUtils.PI,minX=l1-a,minDist=minX*minX,minY=0;var maxAngle=0,maxX=l1+a,maxDist=maxX*maxX,maxY=0;c=-a*l1/(aa-bb);if(c>=-1&&c<=1){c=Math.acos(c);x=a*Math.cos(c)+l1;y=b*Math.sin(c);d=x*x+y*y;if(d<minDist){minAngle=c;minDist=d;minX=x;minY=y}if(d>maxDist){maxAngle=c;maxDist=d;maxX=x;maxY=y}}if(dd<=(minDist+maxDist)/2){a1=ta-Math.atan2(minY*bendDir,minX);a2=minAngle*bendDir}else{a1=ta-Math.atan2(maxY*bendDir,maxX);a2=maxAngle*bendDir}}var os=Math.atan2(cy,cx)*s2;var rotation=parent.arotation;a1=(a1-os)*MathUtils.radDeg+os1-rotation;if(a1>180)a1-=360;else if(a1<-180)a1+=360;parent.updateWorldTransformWith(px,py,rotation+a1*alpha,sx,parent.ascaleY,0,0);rotation=child.arotation;a2=((a2+os)*MathUtils.radDeg-child.ashearX)*s2+os2-rotation;if(a2>180)a2-=360;else if(a2<-180)a2+=360;child.updateWorldTransformWith(cx,cy,rotation+a2*alpha,child.ascaleX,child.ascaleY,child.ashearX,child.ashearY)};return IkConstraint}();var IkConstraintData$2=function(_super){__extends$3(IkConstraintData,_super);function IkConstraintData(name){var _this=_super.call(this,name,0,false)||this;_this.bones=new Array;_this.bendDirection=1;_this.compress=false;_this.stretch=false;_this.uniform=false;_this.mix=1;_this.softness=0;return _this}return IkConstraintData}(ConstraintData$1);var PathConstraintData$2=function(_super){__extends$3(PathConstraintData,_super);function PathConstraintData(name){var _this=_super.call(this,name,0,false)||this;_this.bones=new Array;return _this}return PathConstraintData}(ConstraintData$1);var PositionMode$2;(function(PositionMode){PositionMode[PositionMode["Fixed"]=0]="Fixed";PositionMode[PositionMode["Percent"]=1]="Percent"})(PositionMode$2||(PositionMode$2={}));var SpacingMode$2;(function(SpacingMode){SpacingMode[SpacingMode["Length"]=0]="Length";SpacingMode[SpacingMode["Fixed"]=1]="Fixed";SpacingMode[SpacingMode["Percent"]=2]="Percent"})(SpacingMode$2||(SpacingMode$2={}));var RotateMode$2;(function(RotateMode){RotateMode[RotateMode["Tangent"]=0]="Tangent";RotateMode[RotateMode["Chain"]=1]="Chain";RotateMode[RotateMode["ChainScale"]=2]="ChainScale"})(RotateMode$2||(RotateMode$2={}));var PathConstraint$2=function(){function PathConstraint(data,skeleton){this.position=0;this.spacing=0;this.rotateMix=0;this.translateMix=0;this.spaces=new Array;this.positions=new Array;this.world=new Array;this.curves=new Array;this.lengths=new Array;this.segments=new Array;this.active=false;if(data==null)throw new Error("data cannot be null.");if(skeleton==null)throw new Error("skeleton cannot be null.");this.data=data;this.bones=new Array;for(var i=0,n=data.bones.length;i<n;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findSlot(data.target.name);this.position=data.position;this.spacing=data.spacing;this.rotateMix=data.rotateMix;this.translateMix=data.translateMix}PathConstraint.prototype.isActive=function(){return this.active};PathConstraint.prototype.apply=function(){this.update()};PathConstraint.prototype.update=function(){var attachment=this.target.getAttachment();if(!(attachment instanceof PathAttachment$2))return;var rotateMix=this.rotateMix,translateMix=this.translateMix;var translate=translateMix>0,rotate=rotateMix>0;if(!translate&&!rotate)return;var data=this.data;var spacingMode=data.spacingMode;var lengthSpacing=spacingMode==SpacingMode$2.Length;var rotateMode=data.rotateMode;var tangents=rotateMode==RotateMode$2.Tangent,scale=rotateMode==RotateMode$2.ChainScale;var boneCount=this.bones.length,spacesCount=tangents?boneCount:boneCount+1;var bones=this.bones;var spaces=Utils.setArraySize(this.spaces,spacesCount),lengths=null;var spacing=this.spacing;if(scale||lengthSpacing){if(scale)lengths=Utils.setArraySize(this.lengths,boneCount);for(var i=0,n=spacesCount-1;i<n;){var bone=bones[i];var setupLength=bone.data.length;if(setupLength<PathConstraint.epsilon){if(scale)lengths[i]=0;spaces[++i]=0}else{var x=setupLength*bone.matrix.a,y=setupLength*bone.matrix.b;var length_1=Math.sqrt(x*x+y*y);if(scale)lengths[i]=length_1;spaces[++i]=(lengthSpacing?setupLength+spacing:spacing)*length_1/setupLength}}}else{for(var i=1;i<spacesCount;i++)spaces[i]=spacing}var positions=this.computeWorldPositions(attachment,spacesCount,tangents,data.positionMode==PositionMode$2.Percent,spacingMode==SpacingMode$2.Percent);var boneX=positions[0],boneY=positions[1],offsetRotation=data.offsetRotation;var tip=false;if(offsetRotation==0)tip=rotateMode==RotateMode$2.Chain;else{tip=false;var p=this.target.bone.matrix;offsetRotation*=p.a*p.d-p.b*p.c>0?MathUtils.degRad:-MathUtils.degRad}for(var i=0,p=3;i<boneCount;i++,p+=3){var bone=bones[i];var mat=bone.matrix;mat.tx+=(boneX-mat.tx)*translateMix;mat.ty+=(boneY-mat.ty)*translateMix;var x=positions[p],y=positions[p+1],dx=x-boneX,dy=y-boneY;if(scale){var length_2=lengths[i];if(length_2!=0){var s=(Math.sqrt(dx*dx+dy*dy)/length_2-1)*rotateMix+1;mat.a*=s;mat.b*=s}}boneX=x;boneY=y;if(rotate){var a=mat.a,b=mat.c,c=mat.b,d=mat.d,r=0,cos=0,sin=0;if(tangents)r=positions[p-1];else if(spaces[i+1]==0)r=positions[p+2];else r=Math.atan2(dy,dx);r-=Math.atan2(c,a);if(tip){cos=Math.cos(r);sin=Math.sin(r);var length_3=bone.data.length;boneX+=(length_3*(cos*a-sin*c)-dx)*rotateMix;boneY+=(length_3*(sin*a+cos*c)-dy)*rotateMix}else{r+=offsetRotation}if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r*=rotateMix;cos=Math.cos(r);sin=Math.sin(r);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d}bone.appliedValid=false}};PathConstraint.prototype.computeWorldPositions=function(path,spacesCount,tangents,percentPosition,percentSpacing){var target=this.target;var position=this.position;var spaces=this.spaces,out=Utils.setArraySize(this.positions,spacesCount*3+2),world=null;var closed=path.closed;var verticesLength=path.worldVerticesLength,curveCount=verticesLength/6,prevCurve=PathConstraint.NONE;if(!path.constantSpeed){var lengths=path.lengths;curveCount-=closed?1:2;var pathLength_1=lengths[curveCount];if(percentPosition)position*=pathLength_1;if(percentSpacing){for(var i=0;i<spacesCount;i++)spaces[i]*=pathLength_1}world=Utils.setArraySize(this.world,8);for(var i=0,o=0,curve=0;i<spacesCount;i++,o+=3){var space=spaces[i];position+=space;var p=position;if(closed){p%=pathLength_1;if(p<0)p+=pathLength_1;curve=0}else if(p<0){if(prevCurve!=PathConstraint.BEFORE){prevCurve=PathConstraint.BEFORE;path.computeWorldVertices(target,2,4,world,0,2)}this.addBeforePosition(p,world,0,out,o);continue}else if(p>pathLength_1){if(prevCurve!=PathConstraint.AFTER){prevCurve=PathConstraint.AFTER;path.computeWorldVertices(target,verticesLength-6,4,world,0,2)}this.addAfterPosition(p-pathLength_1,world,0,out,o);continue}for(;;curve++){var length_4=lengths[curve];if(p>length_4)continue;if(curve==0)p/=length_4;else{var prev=lengths[curve-1];p=(p-prev)/(length_4-prev)}break}if(curve!=prevCurve){prevCurve=curve;if(closed&&curve==curveCount){path.computeWorldVertices(target,verticesLength-4,4,world,0,2);path.computeWorldVertices(target,0,4,world,4,2)}else path.computeWorldVertices(target,curve*6+2,8,world,0,2)}this.addCurvePosition(p,world[0],world[1],world[2],world[3],world[4],world[5],world[6],world[7],out,o,tangents||i>0&&space==0)}return out}if(closed){verticesLength+=2;world=Utils.setArraySize(this.world,verticesLength);path.computeWorldVertices(target,2,verticesLength-4,world,0,2);path.computeWorldVertices(target,0,2,world,verticesLength-4,2);world[verticesLength-2]=world[0];world[verticesLength-1]=world[1]}else{curveCount--;verticesLength-=4;world=Utils.setArraySize(this.world,verticesLength);path.computeWorldVertices(target,2,verticesLength,world,0,2)}var curves=Utils.setArraySize(this.curves,curveCount);var pathLength=0;var x1=world[0],y1=world[1],cx1=0,cy1=0,cx2=0,cy2=0,x2=0,y2=0;var tmpx=0,tmpy=0,dddfx=0,dddfy=0,ddfx=0,ddfy=0,dfx=0,dfy=0;for(var i=0,w=2;i<curveCount;i++,w+=6){cx1=world[w];cy1=world[w+1];cx2=world[w+2];cy2=world[w+3];x2=world[w+4];y2=world[w+5];tmpx=(x1-cx1*2+cx2)*.1875;tmpy=(y1-cy1*2+cy2)*.1875;dddfx=((cx1-cx2)*3-x1+x2)*.09375;dddfy=((cy1-cy2)*3-y1+y2)*.09375;ddfx=tmpx*2+dddfx;ddfy=tmpy*2+dddfy;dfx=(cx1-x1)*.75+tmpx+dddfx*.16666667;dfy=(cy1-y1)*.75+tmpy+dddfy*.16666667;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx;dfy+=ddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx+dddfx;dfy+=ddfy+dddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);curves[i]=pathLength;x1=x2;y1=y2}if(percentPosition)position*=pathLength;if(percentSpacing){for(var i=0;i<spacesCount;i++)spaces[i]*=pathLength}var segments=this.segments;var curveLength=0;for(var i=0,o=0,curve=0,segment=0;i<spacesCount;i++,o+=3){var space=spaces[i];position+=space;var p=position;if(closed){p%=pathLength;if(p<0)p+=pathLength;curve=0}else if(p<0){this.addBeforePosition(p,world,0,out,o);continue}else if(p>pathLength){this.addAfterPosition(p-pathLength,world,verticesLength-4,out,o);continue}for(;;curve++){var length_5=curves[curve];if(p>length_5)continue;if(curve==0)p/=length_5;else{var prev=curves[curve-1];p=(p-prev)/(length_5-prev)}break}if(curve!=prevCurve){prevCurve=curve;var ii=curve*6;x1=world[ii];y1=world[ii+1];cx1=world[ii+2];cy1=world[ii+3];cx2=world[ii+4];cy2=world[ii+5];x2=world[ii+6];y2=world[ii+7];tmpx=(x1-cx1*2+cx2)*.03;tmpy=(y1-cy1*2+cy2)*.03;dddfx=((cx1-cx2)*3-x1+x2)*.006;dddfy=((cy1-cy2)*3-y1+y2)*.006;ddfx=tmpx*2+dddfx;ddfy=tmpy*2+dddfy;dfx=(cx1-x1)*.3+tmpx+dddfx*.16666667;dfy=(cy1-y1)*.3+tmpy+dddfy*.16666667;curveLength=Math.sqrt(dfx*dfx+dfy*dfy);segments[0]=curveLength;for(ii=1;ii<8;ii++){dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[ii]=curveLength}dfx+=ddfx;dfy+=ddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[8]=curveLength;dfx+=ddfx+dddfx;dfy+=ddfy+dddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[9]=curveLength;segment=0}p*=curveLength;for(;;segment++){var length_6=segments[segment];if(p>length_6)continue;if(segment==0)p/=length_6;else{var prev=segments[segment-1];p=segment+(p-prev)/(length_6-prev)}break}this.addCurvePosition(p*.1,x1,y1,cx1,cy1,cx2,cy2,x2,y2,out,o,tangents||i>0&&space==0)}return out};PathConstraint.prototype.addBeforePosition=function(p,temp,i,out,o){var x1=temp[i],y1=temp[i+1],dx=temp[i+2]-x1,dy=temp[i+3]-y1,r=Math.atan2(dy,dx);out[o]=x1+p*Math.cos(r);out[o+1]=y1+p*Math.sin(r);out[o+2]=r};PathConstraint.prototype.addAfterPosition=function(p,temp,i,out,o){var x1=temp[i+2],y1=temp[i+3],dx=x1-temp[i],dy=y1-temp[i+1],r=Math.atan2(dy,dx);out[o]=x1+p*Math.cos(r);out[o+1]=y1+p*Math.sin(r);out[o+2]=r};PathConstraint.prototype.addCurvePosition=function(p,x1,y1,cx1,cy1,cx2,cy2,x2,y2,out,o,tangents){if(p==0||isNaN(p))p=1e-4;var tt=p*p,ttt=tt*p,u=1-p,uu=u*u,uuu=uu*u;var ut=u*p,ut3=ut*3,uut3=u*ut3,utt3=ut3*p;var x=x1*uuu+cx1*uut3+cx2*utt3+x2*ttt,y=y1*uuu+cy1*uut3+cy2*utt3+y2*ttt;out[o]=x;out[o+1]=y;if(tangents)out[o+2]=Math.atan2(y-(y1*uu+cy1*ut*2+cy2*tt),x-(x1*uu+cx1*ut*2+cx2*tt))};PathConstraint.NONE=-1;PathConstraint.BEFORE=-2;PathConstraint.AFTER=-3;PathConstraint.epsilon=1e-5;return PathConstraint}();var Slot$2=function(){function Slot(data,bone){this.deform=new Array;if(data==null)throw new Error("data cannot be null.");if(bone==null)throw new Error("bone cannot be null.");this.data=data;this.bone=bone;this.color=new Color;this.darkColor=data.darkColor==null?null:new Color;this.setToSetupPose();this.blendMode=this.data.blendMode}Slot.prototype.getAttachment=function(){return this.attachment};Slot.prototype.setAttachment=function(attachment){if(this.attachment==attachment)return;this.attachment=attachment;this.attachmentTime=this.bone.skeleton.time;this.deform.length=0};Slot.prototype.setAttachmentTime=function(time){this.attachmentTime=this.bone.skeleton.time-time};Slot.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime};Slot.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color);if(this.darkColor!=null)this.darkColor.setFromColor(this.data.darkColor);if(this.data.attachmentName==null)this.attachment=null;else{this.attachment=null;this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))}};return Slot}();var TransformConstraint$2=function(){function TransformConstraint(data,skeleton){this.rotateMix=0;this.translateMix=0;this.scaleMix=0;this.shearMix=0;this.temp=new Vector2;this.active=false;if(data==null)throw new Error("data cannot be null.");if(skeleton==null)throw new Error("skeleton cannot be null.");this.data=data;this.rotateMix=data.rotateMix;this.translateMix=data.translateMix;this.scaleMix=data.scaleMix;this.shearMix=data.shearMix;this.bones=new Array;for(var i=0;i<data.bones.length;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findBone(data.target.name)}TransformConstraint.prototype.isActive=function(){return this.active};TransformConstraint.prototype.apply=function(){this.update()};TransformConstraint.prototype.update=function(){if(this.data.local){if(this.data.relative)this.applyRelativeLocal();else this.applyAbsoluteLocal()}else{if(this.data.relative)this.applyRelativeWorld();else this.applyAbsoluteWorld()}};TransformConstraint.prototype.applyAbsoluteWorld=function(){var rotateMix=this.rotateMix,translateMix=this.translateMix,scaleMix=this.scaleMix,shearMix=this.shearMix;var target=this.target;var targetMat=target.matrix;var ta=targetMat.a,tb=targetMat.c,tc=targetMat.b,td=targetMat.d;var degRadReflect=ta*td-tb*tc>0?MathUtils.degRad:-MathUtils.degRad;var offsetRotation=this.data.offsetRotation*degRadReflect;var offsetShearY=this.data.offsetShearY*degRadReflect;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];var modified=false;var mat=bone.matrix;if(rotateMix!=0){var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var r=Math.atan2(tc,ta)-Math.atan2(c,a)+offsetRotation;if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r*=rotateMix;var cos=Math.cos(r),sin=Math.sin(r);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d;modified=true}if(translateMix!=0){var temp=this.temp;target.localToWorld(temp.set(this.data.offsetX,this.data.offsetY));mat.tx+=(temp.x-mat.tx)*translateMix;mat.ty+=(temp.y-mat.ty)*translateMix;modified=true}if(scaleMix>0){var s=Math.sqrt(mat.a*mat.a+mat.b*mat.b);var ts=Math.sqrt(ta*ta+tc*tc);if(s>1e-5)s=(s+(ts-s+this.data.offsetScaleX)*scaleMix)/s;mat.a*=s;mat.b*=s;s=Math.sqrt(mat.c*mat.c+mat.d*mat.d);ts=Math.sqrt(tb*tb+td*td);if(s>1e-5)s=(s+(ts-s+this.data.offsetScaleY)*scaleMix)/s;mat.c*=s;mat.d*=s;modified=true}if(shearMix>0){var b=mat.c,d=mat.d;var by=Math.atan2(d,b);var r=Math.atan2(td,tb)-Math.atan2(tc,ta)-(by-Math.atan2(mat.b,mat.a));if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r=by+(r+offsetShearY)*shearMix;var s=Math.sqrt(b*b+d*d);mat.c=Math.cos(r)*s;mat.d=Math.sin(r)*s;modified=true}if(modified)bone.appliedValid=false}};TransformConstraint.prototype.applyRelativeWorld=function(){var rotateMix=this.rotateMix,translateMix=this.translateMix,scaleMix=this.scaleMix,shearMix=this.shearMix;var target=this.target;var targetMat=target.matrix;var ta=targetMat.a,tb=targetMat.c,tc=targetMat.b,td=targetMat.d;var degRadReflect=ta*td-tb*tc>0?MathUtils.degRad:-MathUtils.degRad;var offsetRotation=this.data.offsetRotation*degRadReflect,offsetShearY=this.data.offsetShearY*degRadReflect;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];var modified=false;var mat=bone.matrix;if(rotateMix!=0){var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var r=Math.atan2(tc,ta)+offsetRotation;if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r*=rotateMix;var cos=Math.cos(r),sin=Math.sin(r);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d;modified=true}if(translateMix!=0){var temp=this.temp;target.localToWorld(temp.set(this.data.offsetX,this.data.offsetY));mat.tx+=temp.x*translateMix;mat.ty+=temp.y*translateMix;modified=true}if(scaleMix>0){var s=(Math.sqrt(ta*ta+tc*tc)-1+this.data.offsetScaleX)*scaleMix+1;mat.a*=s;mat.b*=s;s=(Math.sqrt(tb*tb+td*td)-1+this.data.offsetScaleY)*scaleMix+1;mat.c*=s;mat.d*=s;modified=true}if(shearMix>0){var r=Math.atan2(td,tb)-Math.atan2(tc,ta);if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;var b=mat.c,d=mat.d;r=Math.atan2(d,b)+(r-MathUtils.PI/2+offsetShearY)*shearMix;var s=Math.sqrt(b*b+d*d);mat.c=Math.cos(r)*s;mat.d=Math.sin(r)*s;modified=true}if(modified)bone.appliedValid=false}};TransformConstraint.prototype.applyAbsoluteLocal=function(){var rotateMix=this.rotateMix,translateMix=this.translateMix,scaleMix=this.scaleMix,shearMix=this.shearMix;var target=this.target;if(!target.appliedValid)target.updateAppliedTransform();var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(!bone.appliedValid)bone.updateAppliedTransform();var rotation=bone.arotation;if(rotateMix!=0){var r=target.arotation-rotation+this.data.offsetRotation;r-=(16384-(16384.499999999996-r/360|0))*360;rotation+=r*rotateMix}var x=bone.ax,y=bone.ay;if(translateMix!=0){x+=(target.ax-x+this.data.offsetX)*translateMix;y+=(target.ay-y+this.data.offsetY)*translateMix}var scaleX=bone.ascaleX,scaleY=bone.ascaleY;if(scaleMix>0){if(scaleX>1e-5)scaleX=(scaleX+(target.ascaleX-scaleX+this.data.offsetScaleX)*scaleMix)/scaleX;if(scaleY>1e-5)scaleY=(scaleY+(target.ascaleY-scaleY+this.data.offsetScaleY)*scaleMix)/scaleY}var shearY=bone.ashearY;if(shearMix>0){var r=target.ashearY-shearY+this.data.offsetShearY;r-=(16384-(16384.499999999996-r/360|0))*360;bone.shearY+=r*shearMix}bone.updateWorldTransformWith(x,y,rotation,scaleX,scaleY,bone.ashearX,shearY)}};TransformConstraint.prototype.applyRelativeLocal=function(){var rotateMix=this.rotateMix,translateMix=this.translateMix,scaleMix=this.scaleMix,shearMix=this.shearMix;var target=this.target;if(!target.appliedValid)target.updateAppliedTransform();var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(!bone.appliedValid)bone.updateAppliedTransform();var rotation=bone.arotation;if(rotateMix!=0)rotation+=(target.arotation+this.data.offsetRotation)*rotateMix;var x=bone.ax,y=bone.ay;if(translateMix!=0){x+=(target.ax+this.data.offsetX)*translateMix;y+=(target.ay+this.data.offsetY)*translateMix}var scaleX=bone.ascaleX,scaleY=bone.ascaleY;if(scaleMix>0){if(scaleX>1e-5)scaleX*=(target.ascaleX-1+this.data.offsetScaleX)*scaleMix+1;if(scaleY>1e-5)scaleY*=(target.ascaleY-1+this.data.offsetScaleY)*scaleMix+1}var shearY=bone.ashearY;if(shearMix>0)shearY+=(target.ashearY+this.data.offsetShearY)*shearMix;bone.updateWorldTransformWith(x,y,rotation,scaleX,scaleY,bone.ashearX,shearY)}};return TransformConstraint}();var Skeleton$2=function(){function Skeleton(data){this._updateCache=new Array;this.updateCacheReset=new Array;this.time=0;this.scaleX=1;this.scaleY=1;this.x=0;this.y=0;if(data==null)throw new Error("data cannot be null.");this.data=data;this.bones=new Array;for(var i=0;i<data.bones.length;i++){var boneData=data.bones[i];var bone=void 0;if(boneData.parent==null)bone=new Bone$2(boneData,this,null);else{var parent_1=this.bones[boneData.parent.index];bone=new Bone$2(boneData,this,parent_1);parent_1.children.push(bone)}this.bones.push(bone)}this.slots=new Array;this.drawOrder=new Array;for(var i=0;i<data.slots.length;i++){var slotData=data.slots[i];var bone=this.bones[slotData.boneData.index];var slot=new Slot$2(slotData,bone);this.slots.push(slot);this.drawOrder.push(slot)}this.ikConstraints=new Array;for(var i=0;i<data.ikConstraints.length;i++){var ikConstraintData=data.ikConstraints[i];this.ikConstraints.push(new IkConstraint$2(ikConstraintData,this))}this.transformConstraints=new Array;for(var i=0;i<data.transformConstraints.length;i++){var transformConstraintData=data.transformConstraints[i];this.transformConstraints.push(new TransformConstraint$2(transformConstraintData,this))}this.pathConstraints=new Array;for(var i=0;i<data.pathConstraints.length;i++){var pathConstraintData=data.pathConstraints[i];this.pathConstraints.push(new PathConstraint$2(pathConstraintData,this))}this.color=new Color(1,1,1,1);this.updateCache()}Skeleton.prototype.updateCache=function(){var updateCache=this._updateCache;updateCache.length=0;this.updateCacheReset.length=0;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];bone.sorted=bone.data.skinRequired;bone.active=!bone.sorted}if(this.skin!=null){var skinBones=this.skin.bones;for(var i=0,n=this.skin.bones.length;i<n;i++){var bone=this.bones[skinBones[i].index];do{bone.sorted=false;bone.active=true;bone=bone.parent}while(bone!=null)}}var ikConstraints=this.ikConstraints;var transformConstraints=this.transformConstraints;var pathConstraints=this.pathConstraints;var ikCount=ikConstraints.length,transformCount=transformConstraints.length,pathCount=pathConstraints.length;var constraintCount=ikCount+transformCount+pathCount;outer:for(var i=0;i<constraintCount;i++){for(var ii=0;ii<ikCount;ii++){var constraint=ikConstraints[ii];if(constraint.data.order==i){this.sortIkConstraint(constraint);continue outer}}for(var ii=0;ii<transformCount;ii++){var constraint=transformConstraints[ii];if(constraint.data.order==i){this.sortTransformConstraint(constraint);continue outer}}for(var ii=0;ii<pathCount;ii++){var constraint=pathConstraints[ii];if(constraint.data.order==i){this.sortPathConstraint(constraint);continue outer}}}for(var i=0,n=bones.length;i<n;i++)this.sortBone(bones[i])};Skeleton.prototype.sortIkConstraint=function(constraint){constraint.active=constraint.target.isActive()&&(!constraint.data.skinRequired||this.skin!=null&&Utils.contains(this.skin.constraints,constraint.data,true));if(!constraint.active)return;var target=constraint.target;this.sortBone(target);var constrained=constraint.bones;var parent=constrained[0];this.sortBone(parent);if(constrained.length>1){var child=constrained[constrained.length-1];if(!(this._updateCache.indexOf(child)>-1))this.updateCacheReset.push(child)}this._updateCache.push(constraint);this.sortReset(parent.children);constrained[constrained.length-1].sorted=true};Skeleton.prototype.sortPathConstraint=function(constraint){constraint.active=constraint.target.bone.isActive()&&(!constraint.data.skinRequired||this.skin!=null&&Utils.contains(this.skin.constraints,constraint.data,true));if(!constraint.active)return;var slot=constraint.target;var slotIndex=slot.data.index;var slotBone=slot.bone;if(this.skin!=null)this.sortPathConstraintAttachment(this.skin,slotIndex,slotBone);if(this.data.defaultSkin!=null&&this.data.defaultSkin!=this.skin)this.sortPathConstraintAttachment(this.data.defaultSkin,slotIndex,slotBone);for(var i=0,n=this.data.skins.length;i<n;i++)this.sortPathConstraintAttachment(this.data.skins[i],slotIndex,slotBone);var attachment=slot.getAttachment();if(attachment instanceof PathAttachment$2)this.sortPathConstraintAttachmentWith(attachment,slotBone);var constrained=constraint.bones;var boneCount=constrained.length;for(var i=0;i<boneCount;i++)this.sortBone(constrained[i]);this._updateCache.push(constraint);for(var i=0;i<boneCount;i++)this.sortReset(constrained[i].children);for(var i=0;i<boneCount;i++)constrained[i].sorted=true};Skeleton.prototype.sortTransformConstraint=function(constraint){constraint.active=constraint.target.isActive()&&(!constraint.data.skinRequired||this.skin!=null&&Utils.contains(this.skin.constraints,constraint.data,true));if(!constraint.active)return;this.sortBone(constraint.target);var constrained=constraint.bones;var boneCount=constrained.length;if(constraint.data.local){for(var i=0;i<boneCount;i++){var child=constrained[i];this.sortBone(child.parent);if(!(this._updateCache.indexOf(child)>-1))this.updateCacheReset.push(child)}}else{for(var i=0;i<boneCount;i++){this.sortBone(constrained[i])}}this._updateCache.push(constraint);for(var ii=0;ii<boneCount;ii++)this.sortReset(constrained[ii].children);for(var ii=0;ii<boneCount;ii++)constrained[ii].sorted=true};Skeleton.prototype.sortPathConstraintAttachment=function(skin,slotIndex,slotBone){var attachments=skin.attachments[slotIndex];if(!attachments)return;for(var key in attachments){this.sortPathConstraintAttachmentWith(attachments[key],slotBone)}};Skeleton.prototype.sortPathConstraintAttachmentWith=function(attachment,slotBone){if(!(attachment instanceof PathAttachment$2))return;var pathBones=attachment.bones;if(pathBones==null)this.sortBone(slotBone);else{var bones=this.bones;var i=0;while(i<pathBones.length){var boneCount=pathBones[i++];for(var n=i+boneCount;i<n;i++){var boneIndex=pathBones[i];this.sortBone(bones[boneIndex])}}}};Skeleton.prototype.sortBone=function(bone){if(bone.sorted)return;var parent=bone.parent;if(parent!=null)this.sortBone(parent);bone.sorted=true;this._updateCache.push(bone)};Skeleton.prototype.sortReset=function(bones){for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(!bone.active)continue;if(bone.sorted)this.sortReset(bone.children);bone.sorted=false}};Skeleton.prototype.updateWorldTransform=function(){var updateCacheReset=this.updateCacheReset;for(var i=0,n=updateCacheReset.length;i<n;i++){var bone=updateCacheReset[i];bone.ax=bone.x;bone.ay=bone.y;bone.arotation=bone.rotation;bone.ascaleX=bone.scaleX;bone.ascaleY=bone.scaleY;bone.ashearX=bone.shearX;bone.ashearY=bone.shearY;bone.appliedValid=true}var updateCache=this._updateCache;for(var i=0,n=updateCache.length;i<n;i++)updateCache[i].update()};Skeleton.prototype.setToSetupPose=function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()};Skeleton.prototype.setBonesToSetupPose=function(){var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)bones[i].setToSetupPose();var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++){var constraint=ikConstraints[i];constraint.mix=constraint.data.mix;constraint.softness=constraint.data.softness;constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch}var transformConstraints=this.transformConstraints;for(var i=0,n=transformConstraints.length;i<n;i++){var constraint=transformConstraints[i];var data=constraint.data;constraint.rotateMix=data.rotateMix;constraint.translateMix=data.translateMix;constraint.scaleMix=data.scaleMix;constraint.shearMix=data.shearMix}var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++){var constraint=pathConstraints[i];var data=constraint.data;constraint.position=data.position;constraint.spacing=data.spacing;constraint.rotateMix=data.rotateMix;constraint.translateMix=data.translateMix}};Skeleton.prototype.setSlotsToSetupPose=function(){var slots=this.slots;Utils.arrayCopy(slots,0,this.drawOrder,0,slots.length);for(var i=0,n=slots.length;i<n;i++)slots[i].setToSetupPose()};Skeleton.prototype.getRootBone=function(){if(this.bones.length==0)return null;return this.bones[0]};Skeleton.prototype.findBone=function(boneName){if(boneName==null)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(bone.data.name==boneName)return bone}return null};Skeleton.prototype.findBoneIndex=function(boneName){if(boneName==null)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)if(bones[i].data.name==boneName)return i;return-1};Skeleton.prototype.findSlot=function(slotName){if(slotName==null)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];if(slot.data.name==slotName)return slot}return null};Skeleton.prototype.findSlotIndex=function(slotName){if(slotName==null)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++)if(slots[i].data.name==slotName)return i;return-1};Skeleton.prototype.setSkinByName=function(skinName){var skin=this.data.findSkin(skinName);if(skin==null)throw new Error("Skin not found: "+skinName);this.setSkin(skin)};Skeleton.prototype.setSkin=function(newSkin){if(newSkin==this.skin)return;if(newSkin!=null){if(this.skin!=null)newSkin.attachAll(this,this.skin);else{var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];var name_1=slot.data.attachmentName;if(name_1!=null){var attachment=newSkin.getAttachment(i,name_1);if(attachment!=null)slot.setAttachment(attachment)}}}}this.skin=newSkin;this.updateCache()};Skeleton.prototype.getAttachmentByName=function(slotName,attachmentName){return this.getAttachment(this.data.findSlotIndex(slotName),attachmentName)};Skeleton.prototype.getAttachment=function(slotIndex,attachmentName){if(attachmentName==null)throw new Error("attachmentName cannot be null.");if(this.skin!=null){var attachment=this.skin.getAttachment(slotIndex,attachmentName);if(attachment!=null)return attachment}if(this.data.defaultSkin!=null)return this.data.defaultSkin.getAttachment(slotIndex,attachmentName);return null};Skeleton.prototype.setAttachment=function(slotName,attachmentName){if(slotName==null)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];if(slot.data.name==slotName){var attachment=null;if(attachmentName!=null){attachment=this.getAttachment(i,attachmentName);if(attachment==null)throw new Error("Attachment not found: "+attachmentName+", for slot: "+slotName)}slot.setAttachment(attachment);return}}throw new Error("Slot not found: "+slotName)};Skeleton.prototype.findIkConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++){var ikConstraint=ikConstraints[i];if(ikConstraint.data.name==constraintName)return ikConstraint}return null};Skeleton.prototype.findTransformConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var transformConstraints=this.transformConstraints;for(var i=0,n=transformConstraints.length;i<n;i++){var constraint=transformConstraints[i];if(constraint.data.name==constraintName)return constraint}return null};Skeleton.prototype.findPathConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++){var constraint=pathConstraints[i];if(constraint.data.name==constraintName)return constraint}return null};Skeleton.prototype.getBounds=function(offset,size,temp){if(temp===void 0){temp=new Array(2)}if(offset==null)throw new Error("offset cannot be null.");if(size==null)throw new Error("size cannot be null.");var drawOrder=this.drawOrder;var minX=Number.POSITIVE_INFINITY,minY=Number.POSITIVE_INFINITY,maxX=Number.NEGATIVE_INFINITY,maxY=Number.NEGATIVE_INFINITY;for(var i=0,n=drawOrder.length;i<n;i++){var slot=drawOrder[i];if(!slot.bone.active)continue;var verticesLength=0;var vertices=null;var attachment=slot.getAttachment();if(attachment instanceof RegionAttachment$2){verticesLength=8;vertices=Utils.setArraySize(temp,verticesLength,0);attachment.computeWorldVertices(slot.bone,vertices,0,2)}else if(attachment instanceof MeshAttachment$2){var mesh=attachment;verticesLength=mesh.worldVerticesLength;vertices=Utils.setArraySize(temp,verticesLength,0);mesh.computeWorldVertices(slot,0,verticesLength,vertices,0,2)}if(vertices!=null){for(var ii=0,nn=vertices.length;ii<nn;ii+=2){var x=vertices[ii],y=vertices[ii+1];minX=Math.min(minX,x);minY=Math.min(minY,y);maxX=Math.max(maxX,x);maxY=Math.max(maxY,y)}}}offset.set(minX,minY);size.set(maxX-minX,maxY-minY)};Skeleton.prototype.update=function(delta){this.time+=delta};Object.defineProperty(Skeleton.prototype,"flipX",{get:function(){return this.scaleX==-1},set:function(value){if(!Skeleton.deprecatedWarning1){Skeleton.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")}this.scaleX=value?1:-1},enumerable:false,configurable:true});Object.defineProperty(Skeleton.prototype,"flipY",{get:function(){return this.scaleY==-1},set:function(value){if(!Skeleton.deprecatedWarning1){Skeleton.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")}this.scaleY=value?1:-1},enumerable:false,configurable:true});Skeleton.deprecatedWarning1=false;return Skeleton}();var SkeletonData$2=function(){function SkeletonData(){this.bones=new Array;this.slots=new Array;this.skins=new Array;this.events=new Array;this.animations=new Array;this.ikConstraints=new Array;this.transformConstraints=new Array;this.pathConstraints=new Array;this.fps=0}SkeletonData.prototype.findBone=function(boneName){if(boneName==null)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(bone.name==boneName)return bone}return null};SkeletonData.prototype.findBoneIndex=function(boneName){if(boneName==null)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)if(bones[i].name==boneName)return i;return-1};SkeletonData.prototype.findSlot=function(slotName){if(slotName==null)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];if(slot.name==slotName)return slot}return null};SkeletonData.prototype.findSlotIndex=function(slotName){if(slotName==null)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++)if(slots[i].name==slotName)return i;return-1};SkeletonData.prototype.findSkin=function(skinName){if(skinName==null)throw new Error("skinName cannot be null.");var skins=this.skins;for(var i=0,n=skins.length;i<n;i++){var skin=skins[i];if(skin.name==skinName)return skin}return null};SkeletonData.prototype.findEvent=function(eventDataName){if(eventDataName==null)throw new Error("eventDataName cannot be null.");var events=this.events;for(var i=0,n=events.length;i<n;i++){var event_1=events[i];if(event_1.name==eventDataName)return event_1}return null};SkeletonData.prototype.findAnimation=function(animationName){if(animationName==null)throw new Error("animationName cannot be null.");var animations=this.animations;for(var i=0,n=animations.length;i<n;i++){var animation=animations[i];if(animation.name==animationName)return animation}return null};SkeletonData.prototype.findIkConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++){var constraint=ikConstraints[i];if(constraint.name==constraintName)return constraint}return null};SkeletonData.prototype.findTransformConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var transformConstraints=this.transformConstraints;for(var i=0,n=transformConstraints.length;i<n;i++){var constraint=transformConstraints[i];if(constraint.name==constraintName)return constraint}return null};SkeletonData.prototype.findPathConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++){var constraint=pathConstraints[i];if(constraint.name==constraintName)return constraint}return null};SkeletonData.prototype.findPathConstraintIndex=function(pathConstraintName){if(pathConstraintName==null)throw new Error("pathConstraintName cannot be null.");var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++)if(pathConstraints[i].name==pathConstraintName)return i;return-1};return SkeletonData}();var SlotData$2=function(){function SlotData(index,name,boneData){this.color=new Color(1,1,1,1);if(index<0)throw new Error("index must be >= 0.");if(name==null)throw new Error("name cannot be null.");if(boneData==null)throw new Error("boneData cannot be null.");this.index=index;this.name=name;this.boneData=boneData}return SlotData}();var TransformConstraintData$2=function(_super){__extends$3(TransformConstraintData,_super);function TransformConstraintData(name){var _this=_super.call(this,name,0,false)||this;_this.bones=new Array;_this.rotateMix=0;_this.translateMix=0;_this.scaleMix=0;_this.shearMix=0;_this.offsetRotation=0;_this.offsetX=0;_this.offsetY=0;_this.offsetScaleX=0;_this.offsetScaleY=0;_this.offsetShearY=0;_this.relative=false;_this.local=false;return _this}return TransformConstraintData}(ConstraintData$1);var SkinEntry$1=function(){function SkinEntry(slotIndex,name,attachment){this.slotIndex=slotIndex;this.name=name;this.attachment=attachment}return SkinEntry}();var Skin$2=function(){function Skin(name){this.attachments=new Array;this.bones=Array();this.constraints=new Array;if(name==null)throw new Error("name cannot be null.");this.name=name}Skin.prototype.setAttachment=function(slotIndex,name,attachment){if(attachment==null)throw new Error("attachment cannot be null.");var attachments=this.attachments;if(slotIndex>=attachments.length)attachments.length=slotIndex+1;if(!attachments[slotIndex])attachments[slotIndex]={};attachments[slotIndex][name]=attachment};Skin.prototype.addSkin=function(skin){for(var i=0;i<skin.bones.length;i++){var bone=skin.bones[i];var contained=false;for(var j=0;j<this.bones.length;j++){if(this.bones[j]==bone){contained=true;break}}if(!contained)this.bones.push(bone)}for(var i=0;i<skin.constraints.length;i++){var constraint=skin.constraints[i];var contained=false;for(var j=0;j<this.constraints.length;j++){if(this.constraints[j]==constraint){contained=true;break}}if(!contained)this.constraints.push(constraint)}var attachments=skin.getAttachments();for(var i=0;i<attachments.length;i++){var attachment=attachments[i];this.setAttachment(attachment.slotIndex,attachment.name,attachment.attachment)}};Skin.prototype.copySkin=function(skin){for(var i=0;i<skin.bones.length;i++){var bone=skin.bones[i];var contained=false;for(var j=0;j<this.bones.length;j++){if(this.bones[j]==bone){contained=true;break}}if(!contained)this.bones.push(bone)}for(var i=0;i<skin.constraints.length;i++){var constraint=skin.constraints[i];var contained=false;for(var j=0;j<this.constraints.length;j++){if(this.constraints[j]==constraint){contained=true;break}}if(!contained)this.constraints.push(constraint)}var attachments=skin.getAttachments();for(var i=0;i<attachments.length;i++){var attachment=attachments[i];if(attachment.attachment==null)continue;if(attachment.attachment instanceof MeshAttachment$2){attachment.attachment=attachment.attachment.newLinkedMesh();this.setAttachment(attachment.slotIndex,attachment.name,attachment.attachment)}else{attachment.attachment=attachment.attachment.copy();this.setAttachment(attachment.slotIndex,attachment.name,attachment.attachment)}}};Skin.prototype.getAttachment=function(slotIndex,name){var dictionary=this.attachments[slotIndex];return dictionary?dictionary[name]:null};Skin.prototype.removeAttachment=function(slotIndex,name){var dictionary=this.attachments[slotIndex];if(dictionary)dictionary[name]=null};Skin.prototype.getAttachments=function(){var entries=new Array;for(var i=0;i<this.attachments.length;i++){var slotAttachments=this.attachments[i];if(slotAttachments){for(var name_1 in slotAttachments){var attachment=slotAttachments[name_1];if(attachment)entries.push(new SkinEntry$1(i,name_1,attachment))}}}return entries};Skin.prototype.getAttachmentsForSlot=function(slotIndex,attachments){var slotAttachments=this.attachments[slotIndex];if(slotAttachments){for(var name_2 in slotAttachments){var attachment=slotAttachments[name_2];if(attachment)attachments.push(new SkinEntry$1(slotIndex,name_2,attachment))}}};Skin.prototype.clear=function(){this.attachments.length=0;this.bones.length=0;this.constraints.length=0};Skin.prototype.attachAll=function(skeleton,oldSkin){var slotIndex=0;for(var i=0;i<skeleton.slots.length;i++){var slot=skeleton.slots[i];var slotAttachment=slot.getAttachment();if(slotAttachment&&slotIndex<oldSkin.attachments.length){var dictionary=oldSkin.attachments[slotIndex];for(var key in dictionary){var skinAttachment=dictionary[key];if(slotAttachment==skinAttachment){var attachment=this.getAttachment(slotIndex,key);if(attachment!=null)slot.setAttachment(attachment);break}}}slotIndex++}};return Skin}();var SkeletonBinary$1=function(){function SkeletonBinary(attachmentLoader){this.scale=1;this.linkedMeshes=new Array;this.attachmentLoader=attachmentLoader}SkeletonBinary.prototype.readSkeletonData=function(binary){var scale=this.scale;var skeletonData=new SkeletonData$2;skeletonData.name="";var input=new BinaryInput(binary);skeletonData.hash=input.readString();skeletonData.version=input.readString();if(skeletonData.version==="3.8.75"){var error="Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine.";console.error(error)}skeletonData.x=input.readFloat();skeletonData.y=input.readFloat();skeletonData.width=input.readFloat();skeletonData.height=input.readFloat();var nonessential=input.readBoolean();if(nonessential){skeletonData.fps=input.readFloat();skeletonData.imagesPath=input.readString();skeletonData.audioPath=input.readString()}var n=0;n=input.readInt(true);for(var i=0;i<n;i++)input.strings.push(input.readString());n=input.readInt(true);for(var i=0;i<n;i++){var name_1=input.readString();var parent_1=i==0?null:skeletonData.bones[input.readInt(true)];var data=new BoneData$2(i,name_1,parent_1);data.rotation=input.readFloat();data.x=input.readFloat()*scale;data.y=input.readFloat()*scale;data.scaleX=input.readFloat();data.scaleY=input.readFloat();data.shearX=input.readFloat();data.shearY=input.readFloat();data.length=input.readFloat()*scale;data.transformMode=SkeletonBinary.TransformModeValues[input.readInt(true)];data.skinRequired=input.readBoolean();if(nonessential)Color.rgba8888ToColor(data.color,input.readInt32());skeletonData.bones.push(data)}n=input.readInt(true);for(var i=0;i<n;i++){var slotName=input.readString();var boneData=skeletonData.bones[input.readInt(true)];var data=new SlotData$2(i,slotName,boneData);Color.rgba8888ToColor(data.color,input.readInt32());var darkColor=input.readInt32();if(darkColor!=-1)Color.rgb888ToColor(data.darkColor=new Color,darkColor);data.attachmentName=input.readStringRef();data.blendMode=SkeletonBinary.BlendModeValues[input.readInt(true)];skeletonData.slots.push(data)}n=input.readInt(true);for(var i=0,nn=void 0;i<n;i++){var data=new IkConstraintData$2(input.readString());data.order=input.readInt(true);data.skinRequired=input.readBoolean();nn=input.readInt(true);for(var ii=0;ii<nn;ii++)data.bones.push(skeletonData.bones[input.readInt(true)]);data.target=skeletonData.bones[input.readInt(true)];data.mix=input.readFloat();data.softness=input.readFloat()*scale;data.bendDirection=input.readByte();data.compress=input.readBoolean();data.stretch=input.readBoolean();data.uniform=input.readBoolean();skeletonData.ikConstraints.push(data)}n=input.readInt(true);for(var i=0,nn=void 0;i<n;i++){var data=new TransformConstraintData$2(input.readString());data.order=input.readInt(true);data.skinRequired=input.readBoolean();nn=input.readInt(true);for(var ii=0;ii<nn;ii++)data.bones.push(skeletonData.bones[input.readInt(true)]);data.target=skeletonData.bones[input.readInt(true)];data.local=input.readBoolean();data.relative=input.readBoolean();data.offsetRotation=input.readFloat();data.offsetX=input.readFloat()*scale;data.offsetY=input.readFloat()*scale;data.offsetScaleX=input.readFloat();data.offsetScaleY=input.readFloat();data.offsetShearY=input.readFloat();data.rotateMix=input.readFloat();data.translateMix=input.readFloat();data.scaleMix=input.readFloat();data.shearMix=input.readFloat();skeletonData.transformConstraints.push(data)}n=input.readInt(true);for(var i=0,nn=void 0;i<n;i++){var data=new PathConstraintData$2(input.readString());data.order=input.readInt(true);data.skinRequired=input.readBoolean();nn=input.readInt(true);for(var ii=0;ii<nn;ii++)data.bones.push(skeletonData.bones[input.readInt(true)]);data.target=skeletonData.slots[input.readInt(true)];data.positionMode=SkeletonBinary.PositionModeValues[input.readInt(true)];data.spacingMode=SkeletonBinary.SpacingModeValues[input.readInt(true)];data.rotateMode=SkeletonBinary.RotateModeValues[input.readInt(true)];data.offsetRotation=input.readFloat();data.position=input.readFloat();if(data.positionMode==PositionMode$2.Fixed)data.position*=scale;data.spacing=input.readFloat();if(data.spacingMode==SpacingMode$2.Length||data.spacingMode==SpacingMode$2.Fixed)data.spacing*=scale;data.rotateMix=input.readFloat();data.translateMix=input.readFloat();skeletonData.pathConstraints.push(data)}var defaultSkin=this.readSkin(input,skeletonData,true,nonessential);if(defaultSkin!=null){skeletonData.defaultSkin=defaultSkin;skeletonData.skins.push(defaultSkin)}{var i=skeletonData.skins.length;Utils.setArraySize(skeletonData.skins,n=i+input.readInt(true));for(;i<n;i++)skeletonData.skins[i]=this.readSkin(input,skeletonData,false,nonessential)}n=this.linkedMeshes.length;for(var i=0;i<n;i++){var linkedMesh=this.linkedMeshes[i];var skin=linkedMesh.skin==null?skeletonData.defaultSkin:skeletonData.findSkin(linkedMesh.skin);if(skin==null)throw new Error("Skin not found: "+linkedMesh.skin);var parent_2=skin.getAttachment(linkedMesh.slotIndex,linkedMesh.parent);if(parent_2==null)throw new Error("Parent mesh not found: "+linkedMesh.parent);linkedMesh.mesh.deformAttachment=linkedMesh.inheritDeform?parent_2:linkedMesh.mesh;linkedMesh.mesh.setParentMesh(parent_2)}this.linkedMeshes.length=0;n=input.readInt(true);for(var i=0;i<n;i++){var data=new EventData$2(input.readStringRef());data.intValue=input.readInt(false);data.floatValue=input.readFloat();data.stringValue=input.readString();data.audioPath=input.readString();if(data.audioPath!=null){data.volume=input.readFloat();data.balance=input.readFloat()}skeletonData.events.push(data)}n=input.readInt(true);for(var i=0;i<n;i++)skeletonData.animations.push(this.readAnimation(input,input.readString(),skeletonData));return skeletonData};SkeletonBinary.prototype.readSkin=function(input,skeletonData,defaultSkin,nonessential){var skin=null;var slotCount=0;if(defaultSkin){slotCount=input.readInt(true);if(slotCount==0)return null;skin=new Skin$2("default")}else{skin=new Skin$2(input.readStringRef());skin.bones.length=input.readInt(true);for(var i=0,n=skin.bones.length;i<n;i++)skin.bones[i]=skeletonData.bones[input.readInt(true)];for(var i=0,n=input.readInt(true);i<n;i++)skin.constraints.push(skeletonData.ikConstraints[input.readInt(true)]);for(var i=0,n=input.readInt(true);i<n;i++)skin.constraints.push(skeletonData.transformConstraints[input.readInt(true)]);for(var i=0,n=input.readInt(true);i<n;i++)skin.constraints.push(skeletonData.pathConstraints[input.readInt(true)]);slotCount=input.readInt(true)}for(var i=0;i<slotCount;i++){var slotIndex=input.readInt(true);for(var ii=0,nn=input.readInt(true);ii<nn;ii++){var name_2=input.readStringRef();var attachment=this.readAttachment(input,skeletonData,skin,slotIndex,name_2,nonessential);if(attachment!=null)skin.setAttachment(slotIndex,name_2,attachment)}}return skin};SkeletonBinary.prototype.readAttachment=function(input,skeletonData,skin,slotIndex,attachmentName,nonessential){var scale=this.scale;var name=input.readStringRef();if(name==null)name=attachmentName;var typeIndex=input.readByte();var type=SkeletonBinary.AttachmentTypeValues[typeIndex];switch(type){case exports.AttachmentType.Region:{var path=input.readStringRef();var rotation=input.readFloat();var x=input.readFloat();var y=input.readFloat();var scaleX=input.readFloat();var scaleY=input.readFloat();var width=input.readFloat();var height=input.readFloat();var color=input.readInt32();if(path==null)path=name;var region=this.attachmentLoader.newRegionAttachment(skin,name,path);if(region==null)return null;region.path=path;region.x=x*scale;region.y=y*scale;region.scaleX=scaleX;region.scaleY=scaleY;region.rotation=rotation;region.width=width*scale;region.height=height*scale;Color.rgba8888ToColor(region.color,color);return region}case exports.AttachmentType.BoundingBox:{var vertexCount=input.readInt(true);var vertices=this.readVertices(input,vertexCount);var color=nonessential?input.readInt32():0;var box=this.attachmentLoader.newBoundingBoxAttachment(skin,name);if(box==null)return null;box.worldVerticesLength=vertexCount<<1;box.vertices=vertices.vertices;box.bones=vertices.bones;if(nonessential)Color.rgba8888ToColor(box.color,color);return box}case exports.AttachmentType.Mesh:{var path=input.readStringRef();var color=input.readInt32();var vertexCount=input.readInt(true);var uvs=this.readFloatArray(input,vertexCount<<1,1);var triangles=this.readShortArray(input);var vertices=this.readVertices(input,vertexCount);var hullLength=input.readInt(true);var edges=null;var width=0,height=0;if(nonessential){edges=this.readShortArray(input);width=input.readFloat();height=input.readFloat()}if(path==null)path=name;var mesh=this.attachmentLoader.newMeshAttachment(skin,name,path);if(mesh==null)return null;mesh.path=path;Color.rgba8888ToColor(mesh.color,color);mesh.bones=vertices.bones;mesh.vertices=vertices.vertices;mesh.worldVerticesLength=vertexCount<<1;mesh.triangles=triangles;mesh.regionUVs=new Float32Array(uvs);mesh.hullLength=hullLength<<1;if(nonessential){mesh.edges=edges;mesh.width=width*scale;mesh.height=height*scale}return mesh}case exports.AttachmentType.LinkedMesh:{var path=input.readStringRef();var color=input.readInt32();var skinName=input.readStringRef();var parent_3=input.readStringRef();var inheritDeform=input.readBoolean();var width=0,height=0;if(nonessential){width=input.readFloat();height=input.readFloat()}if(path==null)path=name;var mesh=this.attachmentLoader.newMeshAttachment(skin,name,path);if(mesh==null)return null;mesh.path=path;Color.rgba8888ToColor(mesh.color,color);if(nonessential){mesh.width=width*scale;mesh.height=height*scale}this.linkedMeshes.push(new LinkedMesh$1$1(mesh,skinName,slotIndex,parent_3,inheritDeform));return mesh}case exports.AttachmentType.Path:{var closed_1=input.readBoolean();var constantSpeed=input.readBoolean();var vertexCount=input.readInt(true);var vertices=this.readVertices(input,vertexCount);var lengths=Utils.newArray(vertexCount/3,0);for(var i=0,n=lengths.length;i<n;i++)lengths[i]=input.readFloat()*scale;var color=nonessential?input.readInt32():0;var path=this.attachmentLoader.newPathAttachment(skin,name);if(path==null)return null;path.closed=closed_1;path.constantSpeed=constantSpeed;path.worldVerticesLength=vertexCount<<1;path.vertices=vertices.vertices;path.bones=vertices.bones;path.lengths=lengths;if(nonessential)Color.rgba8888ToColor(path.color,color);return path}case exports.AttachmentType.Point:{var rotation=input.readFloat();var x=input.readFloat();var y=input.readFloat();var color=nonessential?input.readInt32():0;var point=this.attachmentLoader.newPointAttachment(skin,name);if(point==null)return null;point.x=x*scale;point.y=y*scale;point.rotation=rotation;if(nonessential)Color.rgba8888ToColor(point.color,color);return point}case exports.AttachmentType.Clipping:{var endSlotIndex=input.readInt(true);var vertexCount=input.readInt(true);var vertices=this.readVertices(input,vertexCount);var color=nonessential?input.readInt32():0;var clip=this.attachmentLoader.newClippingAttachment(skin,name);if(clip==null)return null;clip.endSlot=skeletonData.slots[endSlotIndex];clip.worldVerticesLength=vertexCount<<1;clip.vertices=vertices.vertices;clip.bones=vertices.bones;if(nonessential)Color.rgba8888ToColor(clip.color,color);return clip}}return null};SkeletonBinary.prototype.readVertices=function(input,vertexCount){var verticesLength=vertexCount<<1;var vertices=new Vertices$1;var scale=this.scale;if(!input.readBoolean()){vertices.vertices=this.readFloatArray(input,verticesLength,scale);return vertices}var weights=new Array;var bonesArray=new Array;for(var i=0;i<vertexCount;i++){var boneCount=input.readInt(true);bonesArray.push(boneCount);for(var ii=0;ii<boneCount;ii++){bonesArray.push(input.readInt(true));weights.push(input.readFloat()*scale);weights.push(input.readFloat()*scale);weights.push(input.readFloat())}}vertices.vertices=Utils.toFloatArray(weights);vertices.bones=bonesArray;return vertices};SkeletonBinary.prototype.readFloatArray=function(input,n,scale){var array=new Array(n);if(scale==1){for(var i=0;i<n;i++)array[i]=input.readFloat()}else{for(var i=0;i<n;i++)array[i]=input.readFloat()*scale}return array};SkeletonBinary.prototype.readShortArray=function(input){var n=input.readInt(true);var array=new Array(n);for(var i=0;i<n;i++)array[i]=input.readShort();return array};SkeletonBinary.prototype.readAnimation=function(input,name,skeletonData){var timelines=new Array;var scale=this.scale;var duration=0;var tempColor1=new Color;var tempColor2=new Color;for(var i=0,n=input.readInt(true);i<n;i++){var slotIndex=input.readInt(true);for(var ii=0,nn=input.readInt(true);ii<nn;ii++){var timelineType=input.readByte();var frameCount=input.readInt(true);switch(timelineType){case SkeletonBinary.SLOT_ATTACHMENT:{var timeline=new AttachmentTimeline$2(frameCount);timeline.slotIndex=slotIndex;for(var frameIndex=0;frameIndex<frameCount;frameIndex++)timeline.setFrame(frameIndex,input.readFloat(),input.readStringRef());timelines.push(timeline);duration=Math.max(duration,timeline.frames[frameCount-1]);break}case SkeletonBinary.SLOT_COLOR:{var timeline=new ColorTimeline$1(frameCount);timeline.slotIndex=slotIndex;for(var frameIndex=0;frameIndex<frameCount;frameIndex++){var time=input.readFloat();Color.rgba8888ToColor(tempColor1,input.readInt32());timeline.setFrame(frameIndex,time,tempColor1.r,tempColor1.g,tempColor1.b,tempColor1.a);if(frameIndex<frameCount-1)this.readCurve(input,frameIndex,timeline)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(frameCount-1)*ColorTimeline$1.ENTRIES]);break}case SkeletonBinary.SLOT_TWO_COLOR:{var timeline=new TwoColorTimeline$1(frameCount);timeline.slotIndex=slotIndex;for(var frameIndex=0;frameIndex<frameCount;frameIndex++){var time=input.readFloat();Color.rgba8888ToColor(tempColor1,input.readInt32());Color.rgb888ToColor(tempColor2,input.readInt32());timeline.setFrame(frameIndex,time,tempColor1.r,tempColor1.g,tempColor1.b,tempColor1.a,tempColor2.r,tempColor2.g,tempColor2.b);if(frameIndex<frameCount-1)this.readCurve(input,frameIndex,timeline)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(frameCount-1)*TwoColorTimeline$1.ENTRIES]);break}}}}for(var i=0,n=input.readInt(true);i<n;i++){var boneIndex=input.readInt(true);for(var ii=0,nn=input.readInt(true);ii<nn;ii++){var timelineType=input.readByte();var frameCount=input.readInt(true);switch(timelineType){case SkeletonBinary.BONE_ROTATE:{var timeline=new RotateTimeline$2(frameCount);timeline.boneIndex=boneIndex;for(var frameIndex=0;frameIndex<frameCount;frameIndex++){timeline.setFrame(frameIndex,input.readFloat(),input.readFloat());if(frameIndex<frameCount-1)this.readCurve(input,frameIndex,timeline)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(frameCount-1)*RotateTimeline$2.ENTRIES]);break}case SkeletonBinary.BONE_TRANSLATE:case SkeletonBinary.BONE_SCALE:case SkeletonBinary.BONE_SHEAR:{var timeline=void 0;var timelineScale=1;if(timelineType==SkeletonBinary.BONE_SCALE)timeline=new ScaleTimeline$2(frameCount);else if(timelineType==SkeletonBinary.BONE_SHEAR)timeline=new ShearTimeline$2(frameCount);else{timeline=new TranslateTimeline$2(frameCount);timelineScale=scale}timeline.boneIndex=boneIndex;for(var frameIndex=0;frameIndex<frameCount;frameIndex++){timeline.setFrame(frameIndex,input.readFloat(),input.readFloat()*timelineScale,input.readFloat()*timelineScale);if(frameIndex<frameCount-1)this.readCurve(input,frameIndex,timeline)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(frameCount-1)*TranslateTimeline$2.ENTRIES]);break}}}}for(var i=0,n=input.readInt(true);i<n;i++){var index=input.readInt(true);var frameCount=input.readInt(true);var timeline=new IkConstraintTimeline$2(frameCount);timeline.ikConstraintIndex=index;for(var frameIndex=0;frameIndex<frameCount;frameIndex++){timeline.setFrame(frameIndex,input.readFloat(),input.readFloat(),input.readFloat()*scale,input.readByte(),input.readBoolean(),input.readBoolean());if(frameIndex<frameCount-1)this.readCurve(input,frameIndex,timeline)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(frameCount-1)*IkConstraintTimeline$2.ENTRIES])}for(var i=0,n=input.readInt(true);i<n;i++){var index=input.readInt(true);var frameCount=input.readInt(true);var timeline=new TransformConstraintTimeline$2(frameCount);timeline.transformConstraintIndex=index;for(var frameIndex=0;frameIndex<frameCount;frameIndex++){timeline.setFrame(frameIndex,input.readFloat(),input.readFloat(),input.readFloat(),input.readFloat(),input.readFloat());if(frameIndex<frameCount-1)this.readCurve(input,frameIndex,timeline)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(frameCount-1)*TransformConstraintTimeline$2.ENTRIES])}for(var i=0,n=input.readInt(true);i<n;i++){var index=input.readInt(true);var data=skeletonData.pathConstraints[index];for(var ii=0,nn=input.readInt(true);ii<nn;ii++){var timelineType=input.readByte();var frameCount=input.readInt(true);switch(timelineType){case SkeletonBinary.PATH_POSITION:case SkeletonBinary.PATH_SPACING:{var timeline=void 0;var timelineScale=1;if(timelineType==SkeletonBinary.PATH_SPACING){timeline=new PathConstraintSpacingTimeline$2(frameCount);if(data.spacingMode==SpacingMode$2.Length||data.spacingMode==SpacingMode$2.Fixed)timelineScale=scale}else{timeline=new PathConstraintPositionTimeline$2(frameCount);if(data.positionMode==PositionMode$2.Fixed)timelineScale=scale}timeline.pathConstraintIndex=index;for(var frameIndex=0;frameIndex<frameCount;frameIndex++){timeline.setFrame(frameIndex,input.readFloat(),input.readFloat()*timelineScale);if(frameIndex<frameCount-1)this.readCurve(input,frameIndex,timeline)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(frameCount-1)*PathConstraintPositionTimeline$2.ENTRIES]);break}case SkeletonBinary.PATH_MIX:{var timeline=new PathConstraintMixTimeline$2(frameCount);timeline.pathConstraintIndex=index;for(var frameIndex=0;frameIndex<frameCount;frameIndex++){timeline.setFrame(frameIndex,input.readFloat(),input.readFloat(),input.readFloat());if(frameIndex<frameCount-1)this.readCurve(input,frameIndex,timeline)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(frameCount-1)*PathConstraintMixTimeline$2.ENTRIES]);break}}}}for(var i=0,n=input.readInt(true);i<n;i++){var skin=skeletonData.skins[input.readInt(true)];for(var ii=0,nn=input.readInt(true);ii<nn;ii++){var slotIndex=input.readInt(true);for(var iii=0,nnn=input.readInt(true);iii<nnn;iii++){var attachment=skin.getAttachment(slotIndex,input.readStringRef());var weighted=attachment.bones!=null;var vertices=attachment.vertices;var deformLength=weighted?vertices.length/3*2:vertices.length;var frameCount=input.readInt(true);var timeline=new DeformTimeline$2(frameCount);timeline.slotIndex=slotIndex;timeline.attachment=attachment;for(var frameIndex=0;frameIndex<frameCount;frameIndex++){var time=input.readFloat();var deform=void 0;var end=input.readInt(true);if(end==0)deform=weighted?Utils.newFloatArray(deformLength):vertices;else{deform=Utils.newFloatArray(deformLength);var start=input.readInt(true);end+=start;if(scale==1){for(var v=start;v<end;v++)deform[v]=input.readFloat()}else{for(var v=start;v<end;v++)deform[v]=input.readFloat()*scale}if(!weighted){for(var v=0,vn=deform.length;v<vn;v++)deform[v]+=vertices[v]}}timeline.setFrame(frameIndex,time,deform);if(frameIndex<frameCount-1)this.readCurve(input,frameIndex,timeline)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[frameCount-1])}}}var drawOrderCount=input.readInt(true);if(drawOrderCount>0){var timeline=new DrawOrderTimeline$2(drawOrderCount);var slotCount=skeletonData.slots.length;for(var i=0;i<drawOrderCount;i++){var time=input.readFloat();var offsetCount=input.readInt(true);var drawOrder=Utils.newArray(slotCount,0);for(var ii=slotCount-1;ii>=0;ii--)drawOrder[ii]=-1;var unchanged=Utils.newArray(slotCount-offsetCount,0);var originalIndex=0,unchangedIndex=0;for(var ii=0;ii<offsetCount;ii++){var slotIndex=input.readInt(true);while(originalIndex!=slotIndex)unchanged[unchangedIndex++]=originalIndex++;drawOrder[originalIndex+input.readInt(true)]=originalIndex++}while(originalIndex<slotCount)unchanged[unchangedIndex++]=originalIndex++;for(var ii=slotCount-1;ii>=0;ii--)if(drawOrder[ii]==-1)drawOrder[ii]=unchanged[--unchangedIndex];timeline.setFrame(i,time,drawOrder)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[drawOrderCount-1])}var eventCount=input.readInt(true);if(eventCount>0){var timeline=new EventTimeline$2(eventCount);for(var i=0;i<eventCount;i++){var time=input.readFloat();var eventData=skeletonData.events[input.readInt(true)];var event_1=new Event$2(time,eventData);event_1.intValue=input.readInt(false);event_1.floatValue=input.readFloat();event_1.stringValue=input.readBoolean()?input.readString():eventData.stringValue;if(event_1.data.audioPath!=null){event_1.volume=input.readFloat();event_1.balance=input.readFloat()}timeline.setFrame(i,event_1)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[eventCount-1])}return new Animation$2(name,timelines,duration)};SkeletonBinary.prototype.readCurve=function(input,frameIndex,timeline){switch(input.readByte()){case SkeletonBinary.CURVE_STEPPED:timeline.setStepped(frameIndex);break;case SkeletonBinary.CURVE_BEZIER:this.setCurve(timeline,frameIndex,input.readFloat(),input.readFloat(),input.readFloat(),input.readFloat());break}};SkeletonBinary.prototype.setCurve=function(timeline,frameIndex,cx1,cy1,cx2,cy2){timeline.setCurve(frameIndex,cx1,cy1,cx2,cy2)};SkeletonBinary.AttachmentTypeValues=[0,1,2,3,4,5,6];SkeletonBinary.TransformModeValues=[TransformMode$2.Normal,TransformMode$2.OnlyTranslation,TransformMode$2.NoRotationOrReflection,TransformMode$2.NoScale,TransformMode$2.NoScaleOrReflection];SkeletonBinary.PositionModeValues=[PositionMode$2.Fixed,PositionMode$2.Percent];SkeletonBinary.SpacingModeValues=[SpacingMode$2.Length,SpacingMode$2.Fixed,SpacingMode$2.Percent];SkeletonBinary.RotateModeValues=[RotateMode$2.Tangent,RotateMode$2.Chain,RotateMode$2.ChainScale];SkeletonBinary.BlendModeValues=[constants.BLEND_MODES.NORMAL,constants.BLEND_MODES.ADD,constants.BLEND_MODES.MULTIPLY,constants.BLEND_MODES.SCREEN];SkeletonBinary.BONE_ROTATE=0;SkeletonBinary.BONE_TRANSLATE=1;SkeletonBinary.BONE_SCALE=2;SkeletonBinary.BONE_SHEAR=3;SkeletonBinary.SLOT_ATTACHMENT=0;SkeletonBinary.SLOT_COLOR=1;SkeletonBinary.SLOT_TWO_COLOR=2;SkeletonBinary.PATH_POSITION=0;SkeletonBinary.PATH_SPACING=1;SkeletonBinary.PATH_MIX=2;SkeletonBinary.CURVE_LINEAR=0;SkeletonBinary.CURVE_STEPPED=1;SkeletonBinary.CURVE_BEZIER=2;return SkeletonBinary}();var LinkedMesh$1$1=function(){function LinkedMesh(mesh,skin,slotIndex,parent,inheritDeform){this.mesh=mesh;this.skin=skin;this.slotIndex=slotIndex;this.parent=parent;this.inheritDeform=inheritDeform}return LinkedMesh}();var Vertices$1=function(){function Vertices(bones,vertices){if(bones===void 0){bones=null}if(vertices===void 0){vertices=null}this.bones=bones;this.vertices=vertices}return Vertices}();var SkeletonBounds$2=function(){function SkeletonBounds(){this.minX=0;this.minY=0;this.maxX=0;this.maxY=0;this.boundingBoxes=new Array;this.polygons=new Array;this.polygonPool=new Pool(function(){return Utils.newFloatArray(16)})}SkeletonBounds.prototype.update=function(skeleton,updateAabb){if(skeleton==null)throw new Error("skeleton cannot be null.");var boundingBoxes=this.boundingBoxes;var polygons=this.polygons;var polygonPool=this.polygonPool;var slots=skeleton.slots;var slotCount=slots.length;boundingBoxes.length=0;polygonPool.freeAll(polygons);polygons.length=0;for(var i=0;i<slotCount;i++){var slot=slots[i];if(!slot.bone.active)continue;var attachment=slot.getAttachment();if(attachment instanceof BoundingBoxAttachment$2){var boundingBox=attachment;boundingBoxes.push(boundingBox);var polygon=polygonPool.obtain();if(polygon.length!=boundingBox.worldVerticesLength){polygon=Utils.newFloatArray(boundingBox.worldVerticesLength)}polygons.push(polygon);boundingBox.computeWorldVertices(slot,0,boundingBox.worldVerticesLength,polygon,0,2)}}if(updateAabb){this.aabbCompute()}else{this.minX=Number.POSITIVE_INFINITY;this.minY=Number.POSITIVE_INFINITY;this.maxX=Number.NEGATIVE_INFINITY;this.maxY=Number.NEGATIVE_INFINITY}};SkeletonBounds.prototype.aabbCompute=function(){var minX=Number.POSITIVE_INFINITY,minY=Number.POSITIVE_INFINITY,maxX=Number.NEGATIVE_INFINITY,maxY=Number.NEGATIVE_INFINITY;var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++){var polygon=polygons[i];var vertices=polygon;for(var ii=0,nn=polygon.length;ii<nn;ii+=2){var x=vertices[ii];var y=vertices[ii+1];minX=Math.min(minX,x);minY=Math.min(minY,y);maxX=Math.max(maxX,x);maxY=Math.max(maxY,y)}}this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};SkeletonBounds.prototype.aabbContainsPoint=function(x,y){return x>=this.minX&&x<=this.maxX&&y>=this.minY&&y<=this.maxY};SkeletonBounds.prototype.aabbIntersectsSegment=function(x1,y1,x2,y2){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;if(x1<=minX&&x2<=minX||y1<=minY&&y2<=minY||x1>=maxX&&x2>=maxX||y1>=maxY&&y2>=maxY)return false;var m=(y2-y1)/(x2-x1);var y=m*(minX-x1)+y1;if(y>minY&&y<maxY)return true;y=m*(maxX-x1)+y1;if(y>minY&&y<maxY)return true;var x=(minY-y1)/m+x1;if(x>minX&&x<maxX)return true;x=(maxY-y1)/m+x1;if(x>minX&&x<maxX)return true;return false};SkeletonBounds.prototype.aabbIntersectsSkeleton=function(bounds){return this.minX<bounds.maxX&&this.maxX>bounds.minX&&this.minY<bounds.maxY&&this.maxY>bounds.minY};SkeletonBounds.prototype.containsPoint=function(x,y){var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++)if(this.containsPointPolygon(polygons[i],x,y))return this.boundingBoxes[i];return null};SkeletonBounds.prototype.containsPointPolygon=function(polygon,x,y){var vertices=polygon;var nn=polygon.length;var prevIndex=nn-2;var inside=false;for(var ii=0;ii<nn;ii+=2){var vertexY=vertices[ii+1];var prevY=vertices[prevIndex+1];if(vertexY<y&&prevY>=y||prevY<y&&vertexY>=y){var vertexX=vertices[ii];if(vertexX+(y-vertexY)/(prevY-vertexY)*(vertices[prevIndex]-vertexX)<x)inside=!inside}prevIndex=ii}return inside};SkeletonBounds.prototype.intersectsSegment=function(x1,y1,x2,y2){var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++)if(this.intersectsSegmentPolygon(polygons[i],x1,y1,x2,y2))return this.boundingBoxes[i];return null};SkeletonBounds.prototype.intersectsSegmentPolygon=function(polygon,x1,y1,x2,y2){var vertices=polygon;var nn=polygon.length;var width12=x1-x2,height12=y1-y2;var det1=x1*y2-y1*x2;var x3=vertices[nn-2],y3=vertices[nn-1];for(var ii=0;ii<nn;ii+=2){var x4=vertices[ii],y4=vertices[ii+1];var det2=x3*y4-y3*x4;var width34=x3-x4,height34=y3-y4;var det3=width12*height34-height12*width34;var x=(det1*width34-width12*det2)/det3;if((x>=x3&&x<=x4||x>=x4&&x<=x3)&&(x>=x1&&x<=x2||x>=x2&&x<=x1)){var y=(det1*height34-height12*det2)/det3;if((y>=y3&&y<=y4||y>=y4&&y<=y3)&&(y>=y1&&y<=y2||y>=y2&&y<=y1))return true}x3=x4;y3=y4}return false};SkeletonBounds.prototype.getPolygon=function(boundingBox){if(boundingBox==null)throw new Error("boundingBox cannot be null.");var index=this.boundingBoxes.indexOf(boundingBox);return index==-1?null:this.polygons[index]};SkeletonBounds.prototype.getWidth=function(){return this.maxX-this.minX};SkeletonBounds.prototype.getHeight=function(){return this.maxY-this.minY};return SkeletonBounds}();var SkeletonJson$2=function(){function SkeletonJson(attachmentLoader){this.scale=1;this.linkedMeshes=new Array;this.attachmentLoader=attachmentLoader}SkeletonJson.prototype.readSkeletonData=function(json){var scale=this.scale;var skeletonData=new SkeletonData$2;var root=typeof json==="string"?JSON.parse(json):json;var skeletonMap=root.skeleton;if(skeletonMap!=null){skeletonData.hash=skeletonMap.hash;skeletonData.version=skeletonMap.spine;if(skeletonData.version.substr(0,3)!=="3.8"){var error="Spine 3.8 loader cant load version "+skeletonMap.spine+". Please configure your pixi-spine bundle";console.error(error)}if(skeletonData.version==="3.8.75"){var error="Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine.";console.error(error)}skeletonData.x=skeletonMap.x;skeletonData.y=skeletonMap.y;skeletonData.width=skeletonMap.width;skeletonData.height=skeletonMap.height;skeletonData.fps=skeletonMap.fps;skeletonData.imagesPath=skeletonMap.images}if(root.bones){for(var i=0;i<root.bones.length;i++){var boneMap=root.bones[i];var parent_1=null;var parentName=this.getValue(boneMap,"parent",null);if(parentName!=null){parent_1=skeletonData.findBone(parentName);if(parent_1==null)throw new Error("Parent bone not found: "+parentName)}var data=new BoneData$2(skeletonData.bones.length,boneMap.name,parent_1);data.length=this.getValue(boneMap,"length",0)*scale;data.x=this.getValue(boneMap,"x",0)*scale;data.y=this.getValue(boneMap,"y",0)*scale;data.rotation=this.getValue(boneMap,"rotation",0);data.scaleX=this.getValue(boneMap,"scaleX",1);data.scaleY=this.getValue(boneMap,"scaleY",1);data.shearX=this.getValue(boneMap,"shearX",0);data.shearY=this.getValue(boneMap,"shearY",0);data.transformMode=SkeletonJson.transformModeFromString(this.getValue(boneMap,"transform","normal"));data.skinRequired=this.getValue(boneMap,"skin",false);skeletonData.bones.push(data)}}if(root.slots){for(var i=0;i<root.slots.length;i++){var slotMap=root.slots[i];var slotName=slotMap.name;var boneName=slotMap.bone;var boneData=skeletonData.findBone(boneName);if(boneData==null)throw new Error("Slot bone not found: "+boneName);var data=new SlotData$2(skeletonData.slots.length,slotName,boneData);var color=this.getValue(slotMap,"color",null);if(color!=null)data.color.setFromString(color);var dark=this.getValue(slotMap,"dark",null);if(dark!=null){data.darkColor=new Color(1,1,1,1);data.darkColor.setFromString(dark)}data.attachmentName=this.getValue(slotMap,"attachment",null);data.blendMode=SkeletonJson.blendModeFromString(this.getValue(slotMap,"blend","normal"));skeletonData.slots.push(data)}}if(root.ik){for(var i=0;i<root.ik.length;i++){var constraintMap=root.ik[i];var data=new IkConstraintData$2(constraintMap.name);data.order=this.getValue(constraintMap,"order",0);data.skinRequired=this.getValue(constraintMap,"skin",false);for(var j=0;j<constraintMap.bones.length;j++){var boneName=constraintMap.bones[j];var bone=skeletonData.findBone(boneName);if(bone==null)throw new Error("IK bone not found: "+boneName);data.bones.push(bone)}var targetName=constraintMap.target;data.target=skeletonData.findBone(targetName);if(data.target==null)throw new Error("IK target bone not found: "+targetName);data.mix=this.getValue(constraintMap,"mix",1);data.softness=this.getValue(constraintMap,"softness",0)*scale;data.bendDirection=this.getValue(constraintMap,"bendPositive",true)?1:-1;data.compress=this.getValue(constraintMap,"compress",false);data.stretch=this.getValue(constraintMap,"stretch",false);data.uniform=this.getValue(constraintMap,"uniform",false);skeletonData.ikConstraints.push(data)}}if(root.transform){for(var i=0;i<root.transform.length;i++){var constraintMap=root.transform[i];var data=new TransformConstraintData$2(constraintMap.name);data.order=this.getValue(constraintMap,"order",0);data.skinRequired=this.getValue(constraintMap,"skin",false);for(var j=0;j<constraintMap.bones.length;j++){var boneName=constraintMap.bones[j];var bone=skeletonData.findBone(boneName);if(bone==null)throw new Error("Transform constraint bone not found: "+boneName);data.bones.push(bone)}var targetName=constraintMap.target;data.target=skeletonData.findBone(targetName);if(data.target==null)throw new Error("Transform constraint target bone not found: "+targetName);data.local=this.getValue(constraintMap,"local",false);data.relative=this.getValue(constraintMap,"relative",false);data.offsetRotation=this.getValue(constraintMap,"rotation",0);data.offsetX=this.getValue(constraintMap,"x",0)*scale;data.offsetY=this.getValue(constraintMap,"y",0)*scale;data.offsetScaleX=this.getValue(constraintMap,"scaleX",0);data.offsetScaleY=this.getValue(constraintMap,"scaleY",0);data.offsetShearY=this.getValue(constraintMap,"shearY",0);data.rotateMix=this.getValue(constraintMap,"rotateMix",1);data.translateMix=this.getValue(constraintMap,"translateMix",1);data.scaleMix=this.getValue(constraintMap,"scaleMix",1);data.shearMix=this.getValue(constraintMap,"shearMix",1);skeletonData.transformConstraints.push(data)}}if(root.path){for(var i=0;i<root.path.length;i++){var constraintMap=root.path[i];var data=new PathConstraintData$2(constraintMap.name);data.order=this.getValue(constraintMap,"order",0);data.skinRequired=this.getValue(constraintMap,"skin",false);for(var j=0;j<constraintMap.bones.length;j++){var boneName=constraintMap.bones[j];var bone=skeletonData.findBone(boneName);if(bone==null)throw new Error("Transform constraint bone not found: "+boneName);data.bones.push(bone)}var targetName=constraintMap.target;data.target=skeletonData.findSlot(targetName);if(data.target==null)throw new Error("Path target slot not found: "+targetName);data.positionMode=SkeletonJson.positionModeFromString(this.getValue(constraintMap,"positionMode","percent"));data.spacingMode=SkeletonJson.spacingModeFromString(this.getValue(constraintMap,"spacingMode","length"));data.rotateMode=SkeletonJson.rotateModeFromString(this.getValue(constraintMap,"rotateMode","tangent"));data.offsetRotation=this.getValue(constraintMap,"rotation",0);data.position=this.getValue(constraintMap,"position",0);if(data.positionMode==PositionMode$2.Fixed)data.position*=scale;data.spacing=this.getValue(constraintMap,"spacing",0);if(data.spacingMode==SpacingMode$2.Length||data.spacingMode==SpacingMode$2.Fixed)data.spacing*=scale;data.rotateMix=this.getValue(constraintMap,"rotateMix",1);data.translateMix=this.getValue(constraintMap,"translateMix",1);skeletonData.pathConstraints.push(data)}}if(root.skins){for(var i=0;i<root.skins.length;i++){var skinMap=root.skins[i];var skin=new Skin$2(skinMap.name);if(skinMap.bones){for(var ii=0;ii<skinMap.bones.length;ii++){var bone=skeletonData.findBone(skinMap.bones[ii]);if(bone==null)throw new Error("Skin bone not found: "+skinMap.bones[i]);skin.bones.push(bone)}}if(skinMap.ik){for(var ii=0;ii<skinMap.ik.length;ii++){var constraint=skeletonData.findIkConstraint(skinMap.ik[ii]);if(constraint==null)throw new Error("Skin IK constraint not found: "+skinMap.ik[i]);skin.constraints.push(constraint)}}if(skinMap.transform){for(var ii=0;ii<skinMap.transform.length;ii++){var constraint=skeletonData.findTransformConstraint(skinMap.transform[ii]);if(constraint==null)throw new Error("Skin transform constraint not found: "+skinMap.transform[i]);skin.constraints.push(constraint)}}if(skinMap.path){for(var ii=0;ii<skinMap.path.length;ii++){var constraint=skeletonData.findPathConstraint(skinMap.path[ii]);if(constraint==null)throw new Error("Skin path constraint not found: "+skinMap.path[i]);skin.constraints.push(constraint)}}for(var slotName in skinMap.attachments){var slot=skeletonData.findSlot(slotName);if(slot==null)throw new Error("Slot not found: "+slotName);var slotMap=skinMap.attachments[slotName];for(var entryName in slotMap){var attachment=this.readAttachment(slotMap[entryName],skin,slot.index,entryName,skeletonData);if(attachment!=null)skin.setAttachment(slot.index,entryName,attachment)}}skeletonData.skins.push(skin);if(skin.name=="default")skeletonData.defaultSkin=skin}}for(var i=0,n=this.linkedMeshes.length;i<n;i++){var linkedMesh=this.linkedMeshes[i];var skin=linkedMesh.skin==null?skeletonData.defaultSkin:skeletonData.findSkin(linkedMesh.skin);if(skin==null)throw new Error("Skin not found: "+linkedMesh.skin);var parent_2=skin.getAttachment(linkedMesh.slotIndex,linkedMesh.parent);if(parent_2==null)throw new Error("Parent mesh not found: "+linkedMesh.parent);linkedMesh.mesh.deformAttachment=linkedMesh.inheritDeform?parent_2:linkedMesh.mesh;linkedMesh.mesh.setParentMesh(parent_2)}this.linkedMeshes.length=0;if(root.events){for(var eventName in root.events){var eventMap=root.events[eventName];var data=new EventData$2(eventName);data.intValue=this.getValue(eventMap,"int",0);data.floatValue=this.getValue(eventMap,"float",0);data.stringValue=this.getValue(eventMap,"string","");data.audioPath=this.getValue(eventMap,"audio",null);if(data.audioPath!=null){data.volume=this.getValue(eventMap,"volume",1);data.balance=this.getValue(eventMap,"balance",0)}skeletonData.events.push(data)}}if(root.animations){for(var animationName in root.animations){var animationMap=root.animations[animationName];this.readAnimation(animationMap,animationName,skeletonData)}}return skeletonData};SkeletonJson.prototype.readAttachment=function(map,skin,slotIndex,name,skeletonData){var scale=this.scale;name=this.getValue(map,"name",name);var type=this.getValue(map,"type","region");switch(type){case"region":{var path=this.getValue(map,"path",name);var region=this.attachmentLoader.newRegionAttachment(skin,name,path);if(region==null)return null;region.path=path;region.x=this.getValue(map,"x",0)*scale;region.y=this.getValue(map,"y",0)*scale;region.scaleX=this.getValue(map,"scaleX",1);region.scaleY=this.getValue(map,"scaleY",1);region.rotation=this.getValue(map,"rotation",0);region.width=map.width*scale;region.height=map.height*scale;var color=this.getValue(map,"color",null);if(color!=null)region.color.setFromString(color);return region}case"boundingbox":{var box=this.attachmentLoader.newBoundingBoxAttachment(skin,name);if(box==null)return null;this.readVertices(map,box,map.vertexCount<<1);var color=this.getValue(map,"color",null);if(color!=null)box.color.setFromString(color);return box}case"mesh":case"linkedmesh":{var path=this.getValue(map,"path",name);var mesh=this.attachmentLoader.newMeshAttachment(skin,name,path);if(mesh==null)return null;mesh.path=path;var color=this.getValue(map,"color",null);if(color!=null)mesh.color.setFromString(color);mesh.width=this.getValue(map,"width",0)*scale;mesh.height=this.getValue(map,"height",0)*scale;var parent_3=this.getValue(map,"parent",null);if(parent_3!=null){this.linkedMeshes.push(new LinkedMesh$3(mesh,this.getValue(map,"skin",null),slotIndex,parent_3,this.getValue(map,"deform",true)));return mesh}var uvs=map.uvs;this.readVertices(map,mesh,uvs.length);mesh.triangles=map.triangles;mesh.regionUVs=new Float32Array(uvs);mesh.edges=this.getValue(map,"edges",null);mesh.hullLength=this.getValue(map,"hull",0)*2;return mesh}case"path":{var path=this.attachmentLoader.newPathAttachment(skin,name);if(path==null)return null;path.closed=this.getValue(map,"closed",false);path.constantSpeed=this.getValue(map,"constantSpeed",true);var vertexCount=map.vertexCount;this.readVertices(map,path,vertexCount<<1);var lengths=Utils.newArray(vertexCount/3,0);for(var i=0;i<map.lengths.length;i++)lengths[i]=map.lengths[i]*scale;path.lengths=lengths;var color=this.getValue(map,"color",null);if(color!=null)path.color.setFromString(color);return path}case"point":{var point=this.attachmentLoader.newPointAttachment(skin,name);if(point==null)return null;point.x=this.getValue(map,"x",0)*scale;point.y=this.getValue(map,"y",0)*scale;point.rotation=this.getValue(map,"rotation",0);var color=this.getValue(map,"color",null);if(color!=null)point.color.setFromString(color);return point}case"clipping":{var clip=this.attachmentLoader.newClippingAttachment(skin,name);if(clip==null)return null;var end=this.getValue(map,"end",null);if(end!=null){var slot=skeletonData.findSlot(end);if(slot==null)throw new Error("Clipping end slot not found: "+end);clip.endSlot=slot}var vertexCount=map.vertexCount;this.readVertices(map,clip,vertexCount<<1);var color=this.getValue(map,"color",null);if(color!=null)clip.color.setFromString(color);return clip}}return null};SkeletonJson.prototype.readVertices=function(map,attachment,verticesLength){var scale=this.scale;attachment.worldVerticesLength=verticesLength;var vertices=map.vertices;if(verticesLength==vertices.length){var scaledVertices=Utils.toFloatArray(vertices);if(scale!=1){for(var i=0,n=vertices.length;i<n;i++)scaledVertices[i]*=scale}attachment.vertices=scaledVertices;return}var weights=new Array;var bones=new Array;for(var i=0,n=vertices.length;i<n;){var boneCount=vertices[i++];bones.push(boneCount);for(var nn=i+boneCount*4;i<nn;i+=4){bones.push(vertices[i]);weights.push(vertices[i+1]*scale);weights.push(vertices[i+2]*scale);weights.push(vertices[i+3])}}attachment.bones=bones;attachment.vertices=Utils.toFloatArray(weights)};SkeletonJson.prototype.readAnimation=function(map,name,skeletonData){var scale=this.scale;var timelines=new Array;var duration=0;if(map.slots){for(var slotName in map.slots){var slotMap=map.slots[slotName];var slotIndex=skeletonData.findSlotIndex(slotName);if(slotIndex==-1)throw new Error("Slot not found: "+slotName);for(var timelineName in slotMap){var timelineMap=slotMap[timelineName];if(timelineName=="attachment"){var timeline=new AttachmentTimeline$2(timelineMap.length);timeline.slotIndex=slotIndex;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];timeline.setFrame(frameIndex++,this.getValue(valueMap,"time",0),valueMap.name)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}else if(timelineName=="color"){var timeline=new ColorTimeline$1(timelineMap.length);timeline.slotIndex=slotIndex;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];var color=new Color;color.setFromString(valueMap.color||"ffffffff");timeline.setFrame(frameIndex,this.getValue(valueMap,"time",0),color.r,color.g,color.b,color.a);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*ColorTimeline$1.ENTRIES])}else if(timelineName=="twoColor"){var timeline=new TwoColorTimeline$1(timelineMap.length);timeline.slotIndex=slotIndex;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];var light=new Color;var dark=new Color;light.setFromString(valueMap.light);dark.setFromString(valueMap.dark);timeline.setFrame(frameIndex,this.getValue(valueMap,"time",0),light.r,light.g,light.b,light.a,dark.r,dark.g,dark.b);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*TwoColorTimeline$1.ENTRIES])}else throw new Error("Invalid timeline type for a slot: "+timelineName+" ("+slotName+")")}}}if(map.bones){for(var boneName in map.bones){var boneMap=map.bones[boneName];var boneIndex=skeletonData.findBoneIndex(boneName);if(boneIndex==-1)throw new Error("Bone not found: "+boneName);for(var timelineName in boneMap){var timelineMap=boneMap[timelineName];if(timelineName==="rotate"){var timeline=new RotateTimeline$2(timelineMap.length);timeline.boneIndex=boneIndex;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];timeline.setFrame(frameIndex,this.getValue(valueMap,"time",0),this.getValue(valueMap,"angle",0));this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*RotateTimeline$2.ENTRIES])}else if(timelineName==="translate"||timelineName==="scale"||timelineName==="shear"){var timeline=null;var timelineScale=1,defaultValue=0;if(timelineName==="scale"){timeline=new ScaleTimeline$2(timelineMap.length);defaultValue=1}else if(timelineName==="shear")timeline=new ShearTimeline$2(timelineMap.length);else{timeline=new TranslateTimeline$2(timelineMap.length);timelineScale=scale}timeline.boneIndex=boneIndex;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];var x=this.getValue(valueMap,"x",defaultValue),y=this.getValue(valueMap,"y",defaultValue);timeline.setFrame(frameIndex,this.getValue(valueMap,"time",0),x*timelineScale,y*timelineScale);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*TranslateTimeline$2.ENTRIES])}else throw new Error("Invalid timeline type for a bone: "+timelineName+" ("+boneName+")")}}}if(map.ik){for(var constraintName in map.ik){var constraintMap=map.ik[constraintName];var constraint=skeletonData.findIkConstraint(constraintName);var timeline=new IkConstraintTimeline$2(constraintMap.length);timeline.ikConstraintIndex=skeletonData.ikConstraints.indexOf(constraint);var frameIndex=0;for(var i=0;i<constraintMap.length;i++){var valueMap=constraintMap[i];timeline.setFrame(frameIndex,this.getValue(valueMap,"time",0),this.getValue(valueMap,"mix",1),this.getValue(valueMap,"softness",0)*scale,this.getValue(valueMap,"bendPositive",true)?1:-1,this.getValue(valueMap,"compress",false),this.getValue(valueMap,"stretch",false));this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*IkConstraintTimeline$2.ENTRIES])}}if(map.transform){for(var constraintName in map.transform){var constraintMap=map.transform[constraintName];var constraint=skeletonData.findTransformConstraint(constraintName);var timeline=new TransformConstraintTimeline$2(constraintMap.length);timeline.transformConstraintIndex=skeletonData.transformConstraints.indexOf(constraint);var frameIndex=0;for(var i=0;i<constraintMap.length;i++){var valueMap=constraintMap[i];timeline.setFrame(frameIndex,this.getValue(valueMap,"time",0),this.getValue(valueMap,"rotateMix",1),this.getValue(valueMap,"translateMix",1),this.getValue(valueMap,"scaleMix",1),this.getValue(valueMap,"shearMix",1));this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*TransformConstraintTimeline$2.ENTRIES])}}if(map.path){for(var constraintName in map.path){var constraintMap=map.path[constraintName];var index=skeletonData.findPathConstraintIndex(constraintName);if(index==-1)throw new Error("Path constraint not found: "+constraintName);var data=skeletonData.pathConstraints[index];for(var timelineName in constraintMap){var timelineMap=constraintMap[timelineName];if(timelineName==="position"||timelineName==="spacing"){var timeline=null;var timelineScale=1;if(timelineName==="spacing"){timeline=new PathConstraintSpacingTimeline$2(timelineMap.length);if(data.spacingMode==SpacingMode$2.Length||data.spacingMode==SpacingMode$2.Fixed)timelineScale=scale}else{timeline=new PathConstraintPositionTimeline$2(timelineMap.length);if(data.positionMode==PositionMode$2.Fixed)timelineScale=scale}timeline.pathConstraintIndex=index;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];timeline.setFrame(frameIndex,this.getValue(valueMap,"time",0),this.getValue(valueMap,timelineName,0)*timelineScale);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*PathConstraintPositionTimeline$2.ENTRIES])}else if(timelineName==="mix"){var timeline=new PathConstraintMixTimeline$2(timelineMap.length);timeline.pathConstraintIndex=index;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];timeline.setFrame(frameIndex,this.getValue(valueMap,"time",0),this.getValue(valueMap,"rotateMix",1),this.getValue(valueMap,"translateMix",1));this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*PathConstraintMixTimeline$2.ENTRIES])}}}}if(map.deform){for(var deformName in map.deform){var deformMap=map.deform[deformName];var skin=skeletonData.findSkin(deformName);if(skin==null){if(settings.FAIL_ON_NON_EXISTING_SKIN){throw new Error("Skin not found: "+deformName)}else{continue}}for(var slotName in deformMap){var slotMap=deformMap[slotName];var slotIndex=skeletonData.findSlotIndex(slotName);if(slotIndex==-1)throw new Error("Slot not found: "+slotMap.name);for(var timelineName in slotMap){var timelineMap=slotMap[timelineName];var attachment=skin.getAttachment(slotIndex,timelineName);if(attachment==null)throw new Error("Deform attachment not found: "+timelineMap.name);var weighted=attachment.bones!=null;var vertices=attachment.vertices;var deformLength=weighted?vertices.length/3*2:vertices.length;var timeline=new DeformTimeline$2(timelineMap.length);timeline.slotIndex=slotIndex;timeline.attachment=attachment;var frameIndex=0;for(var j=0;j<timelineMap.length;j++){var valueMap=timelineMap[j];var deform=void 0;var verticesValue=this.getValue(valueMap,"vertices",null);if(verticesValue==null)deform=weighted?Utils.newFloatArray(deformLength):vertices;else{deform=Utils.newFloatArray(deformLength);var start=this.getValue(valueMap,"offset",0);Utils.arrayCopy(verticesValue,0,deform,start,verticesValue.length);if(scale!=1){for(var i=start,n=i+verticesValue.length;i<n;i++)deform[i]*=scale}if(!weighted){for(var i=0;i<deformLength;i++)deform[i]+=vertices[i]}}timeline.setFrame(frameIndex,this.getValue(valueMap,"time",0),deform);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}}}}var drawOrderNode=map.drawOrder;if(drawOrderNode==null)drawOrderNode=map.draworder;if(drawOrderNode!=null){var timeline=new DrawOrderTimeline$2(drawOrderNode.length);var slotCount=skeletonData.slots.length;var frameIndex=0;for(var j=0;j<drawOrderNode.length;j++){var drawOrderMap=drawOrderNode[j];var drawOrder=null;var offsets=this.getValue(drawOrderMap,"offsets",null);if(offsets!=null){drawOrder=Utils.newArray(slotCount,-1);var unchanged=Utils.newArray(slotCount-offsets.length,0);var originalIndex=0,unchangedIndex=0;for(var i=0;i<offsets.length;i++){var offsetMap=offsets[i];var slotIndex=skeletonData.findSlotIndex(offsetMap.slot);if(slotIndex==-1)throw new Error("Slot not found: "+offsetMap.slot);while(originalIndex!=slotIndex)unchanged[unchangedIndex++]=originalIndex++;drawOrder[originalIndex+offsetMap.offset]=originalIndex++}while(originalIndex<slotCount)unchanged[unchangedIndex++]=originalIndex++;for(var i=slotCount-1;i>=0;i--)if(drawOrder[i]==-1)drawOrder[i]=unchanged[--unchangedIndex]}timeline.setFrame(frameIndex++,this.getValue(drawOrderMap,"time",0),drawOrder)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}if(map.events){var timeline=new EventTimeline$2(map.events.length);var frameIndex=0;for(var i=0;i<map.events.length;i++){var eventMap=map.events[i];var eventData=skeletonData.findEvent(eventMap.name);if(eventData==null)throw new Error("Event not found: "+eventMap.name);var event_1=new Event$2(Utils.toSinglePrecision(this.getValue(eventMap,"time",0)),eventData);event_1.intValue=this.getValue(eventMap,"int",eventData.intValue);event_1.floatValue=this.getValue(eventMap,"float",eventData.floatValue);event_1.stringValue=this.getValue(eventMap,"string",eventData.stringValue);if(event_1.data.audioPath!=null){event_1.volume=this.getValue(eventMap,"volume",1);event_1.balance=this.getValue(eventMap,"balance",0)}timeline.setFrame(frameIndex++,event_1)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}if(isNaN(duration)){throw new Error("Error while parsing animation, duration is NaN")}skeletonData.animations.push(new Animation$2(name,timelines,duration))};SkeletonJson.prototype.readCurve=function(map,timeline,frameIndex){if(!map.hasOwnProperty("curve"))return;if(map.curve==="stepped")timeline.setStepped(frameIndex);else{var curve=map.curve;timeline.setCurve(frameIndex,curve,this.getValue(map,"c2",0),this.getValue(map,"c3",1),this.getValue(map,"c4",1))}};SkeletonJson.prototype.getValue=function(map,prop,defaultValue){return map[prop]!==undefined?map[prop]:defaultValue};SkeletonJson.blendModeFromString=function(str){str=str.toLowerCase();if(str=="normal")return constants.BLEND_MODES.NORMAL;if(str=="additive")return constants.BLEND_MODES.ADD;if(str=="multiply")return constants.BLEND_MODES.MULTIPLY;if(str=="screen")return constants.BLEND_MODES.SCREEN;throw new Error("Unknown blend mode: "+str)};SkeletonJson.positionModeFromString=function(str){str=str.toLowerCase();if(str=="fixed")return PositionMode$2.Fixed;if(str=="percent")return PositionMode$2.Percent;throw new Error("Unknown position mode: "+str)};SkeletonJson.spacingModeFromString=function(str){str=str.toLowerCase();if(str=="length")return SpacingMode$2.Length;if(str=="fixed")return SpacingMode$2.Fixed;if(str=="percent")return SpacingMode$2.Percent;throw new Error("Unknown position mode: "+str)};SkeletonJson.rotateModeFromString=function(str){str=str.toLowerCase();if(str=="tangent")return RotateMode$2.Tangent;if(str=="chain")return RotateMode$2.Chain;if(str=="chainscale")return RotateMode$2.ChainScale;throw new Error("Unknown rotate mode: "+str)};SkeletonJson.transformModeFromString=function(str){str=str.toLowerCase();if(str=="normal")return TransformMode$2.Normal;if(str=="onlytranslation")return TransformMode$2.OnlyTranslation;if(str=="norotationorreflection")return TransformMode$2.NoRotationOrReflection;if(str=="noscale")return TransformMode$2.NoScale;if(str=="noscaleorreflection")return TransformMode$2.NoScaleOrReflection;throw new Error("Unknown transform mode: "+str)};return SkeletonJson}();var LinkedMesh$3=function(){function LinkedMesh(mesh,skin,slotIndex,parent,inheritDeform){this.mesh=mesh;this.skin=skin;this.slotIndex=slotIndex;this.parent=parent;this.inheritDeform=inheritDeform}return LinkedMesh}();var Spine$3=function(_super){__extends$3(Spine,_super);function Spine(){return _super!==null&&_super.apply(this,arguments)||this}Spine.prototype.createSkeleton=function(spineData){this.skeleton=new Skeleton$2(spineData);this.skeleton.updateWorldTransform();this.stateData=new AnimationStateData$2(spineData);this.state=new AnimationState$2(this.stateData)};return Spine}(SpineBase);var spine38=Object.freeze({__proto__:null,Animation:Animation$2,AnimationState:AnimationState$2,AnimationStateAdapter:AnimationStateAdapter$1,AnimationStateData:AnimationStateData$2,AtlasAttachmentLoader:AtlasAttachmentLoader$2,Attachment:Attachment$2,AttachmentTimeline:AttachmentTimeline$2,Bone:Bone$2,BoneData:BoneData$2,BoundingBoxAttachment:BoundingBoxAttachment$2,ClippingAttachment:ClippingAttachment$2,ColorTimeline:ColorTimeline$1,ConstraintData:ConstraintData$1,CurveTimeline:CurveTimeline$2,DeformTimeline:DeformTimeline$2,DrawOrderTimeline:DrawOrderTimeline$2,Event:Event$2,EventData:EventData$2,EventQueue:EventQueue$2,EventTimeline:EventTimeline$2,get EventType(){return EventType$2},IkConstraint:IkConstraint$2,IkConstraintData:IkConstraintData$2,IkConstraintTimeline:IkConstraintTimeline$2,JitterEffect:JitterEffect$2,MeshAttachment:MeshAttachment$2,get MixBlend(){return MixBlend$2},get MixDirection(){return MixDirection$2},PathAttachment:PathAttachment$2,PathConstraint:PathConstraint$2,PathConstraintData:PathConstraintData$2,PathConstraintMixTimeline:PathConstraintMixTimeline$2,PathConstraintPositionTimeline:PathConstraintPositionTimeline$2,PathConstraintSpacingTimeline:PathConstraintSpacingTimeline$2,PointAttachment:PointAttachment$2,get PositionMode(){return PositionMode$2},RegionAttachment:RegionAttachment$2,get RotateMode(){return RotateMode$2},RotateTimeline:RotateTimeline$2,ScaleTimeline:ScaleTimeline$2,ShearTimeline:ShearTimeline$2,Skeleton:Skeleton$2,SkeletonBinary:SkeletonBinary$1,SkeletonBounds:SkeletonBounds$2,SkeletonData:SkeletonData$2,SkeletonJson:SkeletonJson$2,Skin:Skin$2,SkinEntry:SkinEntry$1,Slot:Slot$2,SlotData:SlotData$2,get SpacingMode(){return SpacingMode$2},Spine:Spine$3,SwirlEffect:SwirlEffect$2,get TimelineType(){return TimelineType$1},TrackEntry:TrackEntry$2,TransformConstraint:TransformConstraint$2,TransformConstraintData:TransformConstraintData$2,TransformConstraintTimeline:TransformConstraintTimeline$2,get TransformMode(){return TransformMode$2},TranslateTimeline:TranslateTimeline$2,TwoColorTimeline:TwoColorTimeline$1,VertexAttachment:VertexAttachment$2});var extendStatics$2=function(d,b){extendStatics$2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics$2(d,b)};function __extends$2(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics$2(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var Attachment$1=function(){function Attachment(name){if(name==null)throw new Error("name cannot be null.");this.name=name}return Attachment}();var VertexAttachment$1=function(_super){__extends$2(VertexAttachment,_super);function VertexAttachment(name){var _this=_super.call(this,name)||this;_this.id=(VertexAttachment.nextID++&65535)<<11;_this.worldVerticesLength=0;return _this}VertexAttachment.prototype.computeWorldVerticesOld=function(slot,worldVertices){this.computeWorldVertices(slot,0,this.worldVerticesLength,worldVertices,0,2)};VertexAttachment.prototype.computeWorldVertices=function(slot,start,count,worldVertices,offset,stride){count=offset+(count>>1)*stride;var skeleton=slot.bone.skeleton;var deformArray=slot.attachmentVertices;var vertices=this.vertices;var bones=this.bones;if(bones==null){if(deformArray.length>0)vertices=deformArray;var mat=slot.bone.matrix;var x=mat.tx;var y=mat.ty;var a=mat.a,b=mat.c,c=mat.b,d=mat.d;for(var v_1=start,w=offset;w<count;v_1+=2,w+=stride){var vx=vertices[v_1],vy=vertices[v_1+1];worldVertices[w]=vx*a+vy*b+x;worldVertices[w+1]=vx*c+vy*d+y}return}var v=0,skip=0;for(var i=0;i<start;i+=2){var n=bones[v];v+=n+1;skip+=n}var skeletonBones=skeleton.bones;if(deformArray.length==0){for(var w=offset,b=skip*3;w<count;w+=stride){var wx=0,wy=0;var n=bones[v++];n+=v;for(;v<n;v++,b+=3){var mat=skeletonBones[bones[v]].matrix;var vx=vertices[b],vy=vertices[b+1],weight=vertices[b+2];wx+=(vx*mat.a+vy*mat.c+mat.tx)*weight;wy+=(vx*mat.b+vy*mat.d+mat.ty)*weight}worldVertices[w]=wx;worldVertices[w+1]=wy}}else{var deform=deformArray;for(var w=offset,b=skip*3,f=skip<<1;w<count;w+=stride){var wx=0,wy=0;var n=bones[v++];n+=v;for(;v<n;v++,b+=3,f+=2){var mat=skeletonBones[bones[v]].matrix;var vx=vertices[b]+deform[f],vy=vertices[b+1]+deform[f+1],weight=vertices[b+2];wx+=(vx*mat.a+vy*mat.c+mat.tx)*weight;wy+=(vx*mat.b+vy*mat.d+mat.ty)*weight}worldVertices[w]=wx;worldVertices[w+1]=wy}}};VertexAttachment.prototype.applyDeform=function(sourceAttachment){return this==sourceAttachment};VertexAttachment.nextID=0;return VertexAttachment}(Attachment$1);var BoundingBoxAttachment$1=function(_super){__extends$2(BoundingBoxAttachment,_super);function BoundingBoxAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.BoundingBox;_this.color=new Color(1,1,1,1);return _this}return BoundingBoxAttachment}(VertexAttachment$1);var ClippingAttachment$1=function(_super){__extends$2(ClippingAttachment,_super);function ClippingAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Clipping;_this.color=new Color(.2275,.2275,.8078,1);return _this}return ClippingAttachment}(VertexAttachment$1);var MeshAttachment$1=function(_super){__extends$2(MeshAttachment,_super);function MeshAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Mesh;_this.color=new Color(1,1,1,1);_this.inheritDeform=false;_this.tempColor=new Color(0,0,0,0);return _this}MeshAttachment.prototype.applyDeform=function(sourceAttachment){return this==sourceAttachment||this.inheritDeform&&this.parentMesh==sourceAttachment};MeshAttachment.prototype.getParentMesh=function(){return this.parentMesh};MeshAttachment.prototype.setParentMesh=function(parentMesh){this.parentMesh=parentMesh;if(parentMesh!=null){this.bones=parentMesh.bones;this.vertices=parentMesh.vertices;this.worldVerticesLength=parentMesh.worldVerticesLength;this.regionUVs=parentMesh.regionUVs;this.triangles=parentMesh.triangles;this.hullLength=parentMesh.hullLength;this.worldVerticesLength=parentMesh.worldVerticesLength}};return MeshAttachment}(VertexAttachment$1);var PathAttachment$1=function(_super){__extends$2(PathAttachment,_super);function PathAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Path;_this.closed=false;_this.constantSpeed=false;_this.color=new Color(1,1,1,1);return _this}return PathAttachment}(VertexAttachment$1);var PointAttachment$1=function(_super){__extends$2(PointAttachment,_super);function PointAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Point;_this.color=new Color(.38,.94,0,1);return _this}PointAttachment.prototype.computeWorldPosition=function(bone,point){var mat=bone.matrix;point.x=this.x*mat.a+this.y*mat.c+bone.worldX;point.y=this.x*mat.b+this.y*mat.d+bone.worldY;return point};PointAttachment.prototype.computeWorldRotation=function(bone){var mat=bone.matrix;var cos=MathUtils.cosDeg(this.rotation),sin=MathUtils.sinDeg(this.rotation);var x=cos*mat.a+sin*mat.c;var y=cos*mat.b+sin*mat.d;return Math.atan2(y,x)*MathUtils.radDeg};return PointAttachment}(VertexAttachment$1);var RegionAttachment$1=function(_super){__extends$2(RegionAttachment,_super);function RegionAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Region;_this.x=0;_this.y=0;_this.scaleX=1;_this.scaleY=1;_this.rotation=0;_this.width=0;_this.height=0;_this.color=new Color(1,1,1,1);_this.offset=Utils.newFloatArray(8);_this.uvs=Utils.newFloatArray(8);_this.tempColor=new Color(1,1,1,1);return _this}RegionAttachment.prototype.updateOffset=function(){var regionScaleX=this.width/this.region.originalWidth*this.scaleX;var regionScaleY=this.height/this.region.originalHeight*this.scaleY;var localX=-this.width/2*this.scaleX+this.region.offsetX*regionScaleX;var localY=-this.height/2*this.scaleY+this.region.offsetY*regionScaleY;var localX2=localX+this.region.width*regionScaleX;var localY2=localY+this.region.height*regionScaleY;var radians=this.rotation*Math.PI/180;var cos=Math.cos(radians);var sin=Math.sin(radians);var localXCos=localX*cos+this.x;var localXSin=localX*sin;var localYCos=localY*cos+this.y;var localYSin=localY*sin;var localX2Cos=localX2*cos+this.x;var localX2Sin=localX2*sin;var localY2Cos=localY2*cos+this.y;var localY2Sin=localY2*sin;var offset=this.offset;offset[RegionAttachment.OX1]=localXCos-localYSin;offset[RegionAttachment.OY1]=localYCos+localXSin;offset[RegionAttachment.OX2]=localXCos-localY2Sin;offset[RegionAttachment.OY2]=localY2Cos+localXSin;offset[RegionAttachment.OX3]=localX2Cos-localY2Sin;offset[RegionAttachment.OY3]=localY2Cos+localX2Sin;offset[RegionAttachment.OX4]=localX2Cos-localYSin;offset[RegionAttachment.OY4]=localYCos+localX2Sin};RegionAttachment.prototype.setRegion=function(region){this.region=region;var uvs=this.uvs;if(region.rotate){uvs[2]=region.u;uvs[3]=region.v2;uvs[4]=region.u;uvs[5]=region.v;uvs[6]=region.u2;uvs[7]=region.v;uvs[0]=region.u2;uvs[1]=region.v2}else{uvs[0]=region.u;uvs[1]=region.v2;uvs[2]=region.u;uvs[3]=region.v;uvs[4]=region.u2;uvs[5]=region.v;uvs[6]=region.u2;uvs[7]=region.v2}};RegionAttachment.prototype.computeWorldVertices=function(bone,worldVertices,offset,stride){var vertexOffset=this.offset;var mat=bone.matrix;var x=mat.tx,y=mat.ty;var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var offsetX=0,offsetY=0;offsetX=vertexOffset[RegionAttachment.OX1];offsetY=vertexOffset[RegionAttachment.OY1];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y;offset+=stride;offsetX=vertexOffset[RegionAttachment.OX2];offsetY=vertexOffset[RegionAttachment.OY2];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y;offset+=stride;offsetX=vertexOffset[RegionAttachment.OX3];offsetY=vertexOffset[RegionAttachment.OY3];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y;offset+=stride;offsetX=vertexOffset[RegionAttachment.OX4];offsetY=vertexOffset[RegionAttachment.OY4];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y};RegionAttachment.OX1=0;RegionAttachment.OY1=1;RegionAttachment.OX2=2;RegionAttachment.OY2=3;RegionAttachment.OX3=4;RegionAttachment.OY3=5;RegionAttachment.OX4=6;RegionAttachment.OY4=7;RegionAttachment.X1=0;RegionAttachment.Y1=1;RegionAttachment.C1R=2;RegionAttachment.C1G=3;RegionAttachment.C1B=4;RegionAttachment.C1A=5;RegionAttachment.U1=6;RegionAttachment.V1=7;RegionAttachment.X2=8;RegionAttachment.Y2=9;RegionAttachment.C2R=10;RegionAttachment.C2G=11;RegionAttachment.C2B=12;RegionAttachment.C2A=13;RegionAttachment.U2=14;RegionAttachment.V2=15;RegionAttachment.X3=16;RegionAttachment.Y3=17;RegionAttachment.C3R=18;RegionAttachment.C3G=19;RegionAttachment.C3B=20;RegionAttachment.C3A=21;RegionAttachment.U3=22;RegionAttachment.V3=23;RegionAttachment.X4=24;RegionAttachment.Y4=25;RegionAttachment.C4R=26;RegionAttachment.C4G=27;RegionAttachment.C4B=28;RegionAttachment.C4A=29;RegionAttachment.U4=30;RegionAttachment.V4=31;return RegionAttachment}(Attachment$1);var JitterEffect$1=function(){function JitterEffect(jitterX,jitterY){this.jitterX=0;this.jitterY=0;this.jitterX=jitterX;this.jitterY=jitterY}JitterEffect.prototype.begin=function(skeleton){};JitterEffect.prototype.transform=function(position,uv,light,dark){position.x+=MathUtils.randomTriangular(-this.jitterX,this.jitterY);position.y+=MathUtils.randomTriangular(-this.jitterX,this.jitterY)};JitterEffect.prototype.end=function(){};return JitterEffect}();var SwirlEffect$1=function(){function SwirlEffect(radius){this.centerX=0;this.centerY=0;this.radius=0;this.angle=0;this.worldX=0;this.worldY=0;this.radius=radius}SwirlEffect.prototype.begin=function(skeleton){this.worldX=skeleton.x+this.centerX;this.worldY=skeleton.y+this.centerY};SwirlEffect.prototype.transform=function(position,uv,light,dark){var radAngle=this.angle*MathUtils.degreesToRadians;var x=position.x-this.worldX;var y=position.y-this.worldY;var dist=Math.sqrt(x*x+y*y);if(dist<this.radius){var theta=SwirlEffect.interpolation.apply(0,radAngle,(this.radius-dist)/this.radius);var cos=Math.cos(theta);var sin=Math.sin(theta);position.x=cos*x-sin*y+this.worldX;position.y=sin*x+cos*y+this.worldY}};SwirlEffect.prototype.end=function(){};SwirlEffect.interpolation=new PowOut(2);return SwirlEffect}();var Animation$1=function(){function Animation(name,timelines,duration){if(name==null)throw new Error("name cannot be null.");if(timelines==null)throw new Error("timelines cannot be null.");this.name=name;this.timelines=timelines;this.duration=duration}Animation.prototype.apply=function(skeleton,lastTime,time,loop,events,alpha,blend,direction){if(skeleton==null)throw new Error("skeleton cannot be null.");if(loop&&this.duration!=0){time%=this.duration;if(lastTime>0)lastTime%=this.duration}var timelines=this.timelines;for(var i=0,n=timelines.length;i<n;i++)timelines[i].apply(skeleton,lastTime,time,events,alpha,blend,direction)};Animation.binarySearch=function(values,target,step){if(step===void 0){step=1}var low=0;var high=values.length/step-2;if(high==0)return step;var current=high>>>1;while(true){if(values[(current+1)*step]<=target)low=current+1;else high=current;if(low==high)return(low+1)*step;current=low+high>>>1}};Animation.linearSearch=function(values,target,step){for(var i=0,last=values.length-step;i<=last;i+=step)if(values[i]>target)return i;return-1};return Animation}();var MixBlend$1;(function(MixBlend){MixBlend[MixBlend["setup"]=0]="setup";MixBlend[MixBlend["first"]=1]="first";MixBlend[MixBlend["replace"]=2]="replace";MixBlend[MixBlend["add"]=3]="add"})(MixBlend$1||(MixBlend$1={}));var MixDirection$1;(function(MixDirection){MixDirection[MixDirection["in"]=0]="in";MixDirection[MixDirection["out"]=1]="out"})(MixDirection$1||(MixDirection$1={}));var TimelineType;(function(TimelineType){TimelineType[TimelineType["rotate"]=0]="rotate";TimelineType[TimelineType["translate"]=1]="translate";TimelineType[TimelineType["scale"]=2]="scale";TimelineType[TimelineType["shear"]=3]="shear";TimelineType[TimelineType["attachment"]=4]="attachment";TimelineType[TimelineType["color"]=5]="color";TimelineType[TimelineType["deform"]=6]="deform";TimelineType[TimelineType["event"]=7]="event";TimelineType[TimelineType["drawOrder"]=8]="drawOrder";TimelineType[TimelineType["ikConstraint"]=9]="ikConstraint";TimelineType[TimelineType["transformConstraint"]=10]="transformConstraint";TimelineType[TimelineType["pathConstraintPosition"]=11]="pathConstraintPosition";TimelineType[TimelineType["pathConstraintSpacing"]=12]="pathConstraintSpacing";TimelineType[TimelineType["pathConstraintMix"]=13]="pathConstraintMix";TimelineType[TimelineType["twoColor"]=14]="twoColor"})(TimelineType||(TimelineType={}));var CurveTimeline$1=function(){function CurveTimeline(frameCount){if(frameCount<=0)throw new Error("frameCount must be > 0: "+frameCount);this.curves=Utils.newFloatArray((frameCount-1)*CurveTimeline.BEZIER_SIZE)}CurveTimeline.prototype.getFrameCount=function(){return this.curves.length/CurveTimeline.BEZIER_SIZE+1};CurveTimeline.prototype.setLinear=function(frameIndex){this.curves[frameIndex*CurveTimeline.BEZIER_SIZE]=CurveTimeline.LINEAR};CurveTimeline.prototype.setStepped=function(frameIndex){this.curves[frameIndex*CurveTimeline.BEZIER_SIZE]=CurveTimeline.STEPPED};CurveTimeline.prototype.getCurveType=function(frameIndex){var index=frameIndex*CurveTimeline.BEZIER_SIZE;if(index==this.curves.length)return CurveTimeline.LINEAR;var type=this.curves[index];if(type==CurveTimeline.LINEAR)return CurveTimeline.LINEAR;if(type==CurveTimeline.STEPPED)return CurveTimeline.STEPPED;return CurveTimeline.BEZIER};CurveTimeline.prototype.setCurve=function(frameIndex,cx1,cy1,cx2,cy2){var tmpx=(-cx1*2+cx2)*.03,tmpy=(-cy1*2+cy2)*.03;var dddfx=((cx1-cx2)*3+1)*.006,dddfy=((cy1-cy2)*3+1)*.006;var ddfx=tmpx*2+dddfx,ddfy=tmpy*2+dddfy;var dfx=cx1*.3+tmpx+dddfx*.16666667,dfy=cy1*.3+tmpy+dddfy*.16666667;var i=frameIndex*CurveTimeline.BEZIER_SIZE;var curves=this.curves;curves[i++]=CurveTimeline.BEZIER;var x=dfx,y=dfy;for(var n=i+CurveTimeline.BEZIER_SIZE-1;i<n;i+=2){curves[i]=x;curves[i+1]=y;dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;x+=dfx;y+=dfy}};CurveTimeline.prototype.getCurvePercent=function(frameIndex,percent){percent=MathUtils.clamp(percent,0,1);var curves=this.curves;var i=frameIndex*CurveTimeline.BEZIER_SIZE;var type=curves[i];if(type==CurveTimeline.LINEAR)return percent;if(type==CurveTimeline.STEPPED)return 0;i++;var x=0;for(var start=i,n=i+CurveTimeline.BEZIER_SIZE-1;i<n;i+=2){x=curves[i];if(x>=percent){var prevX=void 0,prevY=void 0;if(i==start){prevX=0;prevY=0}else{prevX=curves[i-2];prevY=curves[i-1]}return prevY+(curves[i+1]-prevY)*(percent-prevX)/(x-prevX)}}var y=curves[i-1];return y+(1-y)*(percent-x)/(1-x)};CurveTimeline.LINEAR=0;CurveTimeline.STEPPED=1;CurveTimeline.BEZIER=2;CurveTimeline.BEZIER_SIZE=10*2-1;return CurveTimeline}();var RotateTimeline$1=function(_super){__extends$2(RotateTimeline,_super);function RotateTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount<<1);return _this}RotateTimeline.prototype.getPropertyId=function(){return(TimelineType.rotate<<24)+this.boneIndex};RotateTimeline.prototype.setFrame=function(frameIndex,time,degrees){frameIndex<<=1;this.frames[frameIndex]=time;this.frames[frameIndex+RotateTimeline.ROTATION]=degrees};RotateTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var frames=this.frames;var bone=skeleton.bones[this.boneIndex];if(time<frames[0]){switch(blend){case MixBlend$1.setup:bone.rotation=bone.data.rotation;return;case MixBlend$1.first:var r_1=bone.data.rotation-bone.rotation;bone.rotation+=(r_1-(16384-(16384.499999999996-r_1/360|0))*360)*alpha}return}if(time>=frames[frames.length-RotateTimeline.ENTRIES]){var r_2=frames[frames.length+RotateTimeline.PREV_ROTATION];switch(blend){case MixBlend$1.setup:bone.rotation=bone.data.rotation+r_2*alpha;break;case MixBlend$1.first:case MixBlend$1.replace:r_2+=bone.data.rotation-bone.rotation;r_2-=(16384-(16384.499999999996-r_2/360|0))*360;case MixBlend$1.add:bone.rotation+=r_2*alpha}return}var frame=Animation$1.binarySearch(frames,time,RotateTimeline.ENTRIES);var prevRotation=frames[frame+RotateTimeline.PREV_ROTATION];var frameTime=frames[frame];var percent=this.getCurvePercent((frame>>1)-1,1-(time-frameTime)/(frames[frame+RotateTimeline.PREV_TIME]-frameTime));var r=frames[frame+RotateTimeline.ROTATION]-prevRotation;r=prevRotation+(r-(16384-(16384.499999999996-r/360|0))*360)*percent;switch(blend){case MixBlend$1.setup:bone.rotation=bone.data.rotation+(r-(16384-(16384.499999999996-r/360|0))*360)*alpha;break;case MixBlend$1.first:case MixBlend$1.replace:r+=bone.data.rotation-bone.rotation;case MixBlend$1.add:bone.rotation+=(r-(16384-(16384.499999999996-r/360|0))*360)*alpha}};RotateTimeline.ENTRIES=2;RotateTimeline.PREV_TIME=-2;RotateTimeline.PREV_ROTATION=-1;RotateTimeline.ROTATION=1;return RotateTimeline}(CurveTimeline$1);var TranslateTimeline$1=function(_super){__extends$2(TranslateTimeline,_super);function TranslateTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*TranslateTimeline.ENTRIES);return _this}TranslateTimeline.prototype.getPropertyId=function(){return(TimelineType.translate<<24)+this.boneIndex};TranslateTimeline.prototype.setFrame=function(frameIndex,time,x,y){frameIndex*=TranslateTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+TranslateTimeline.X]=x;this.frames[frameIndex+TranslateTimeline.Y]=y};TranslateTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var frames=this.frames;var bone=skeleton.bones[this.boneIndex];if(time<frames[0]){switch(blend){case MixBlend$1.setup:bone.x=bone.data.x;bone.y=bone.data.y;return;case MixBlend$1.first:bone.x+=(bone.data.x-bone.x)*alpha;bone.y+=(bone.data.y-bone.y)*alpha}return}var x=0,y=0;if(time>=frames[frames.length-TranslateTimeline.ENTRIES]){x=frames[frames.length+TranslateTimeline.PREV_X];y=frames[frames.length+TranslateTimeline.PREV_Y]}else{var frame=Animation$1.binarySearch(frames,time,TranslateTimeline.ENTRIES);x=frames[frame+TranslateTimeline.PREV_X];y=frames[frame+TranslateTimeline.PREV_Y];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/TranslateTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+TranslateTimeline.PREV_TIME]-frameTime));x+=(frames[frame+TranslateTimeline.X]-x)*percent;y+=(frames[frame+TranslateTimeline.Y]-y)*percent}switch(blend){case MixBlend$1.setup:bone.x=bone.data.x+x*alpha;bone.y=bone.data.y+y*alpha;break;case MixBlend$1.first:case MixBlend$1.replace:bone.x+=(bone.data.x+x-bone.x)*alpha;bone.y+=(bone.data.y+y-bone.y)*alpha;break;case MixBlend$1.add:bone.x+=x*alpha;bone.y+=y*alpha}};TranslateTimeline.ENTRIES=3;TranslateTimeline.PREV_TIME=-3;TranslateTimeline.PREV_X=-2;TranslateTimeline.PREV_Y=-1;TranslateTimeline.X=1;TranslateTimeline.Y=2;return TranslateTimeline}(CurveTimeline$1);var ScaleTimeline$1=function(_super){__extends$2(ScaleTimeline,_super);function ScaleTimeline(frameCount){return _super.call(this,frameCount)||this}ScaleTimeline.prototype.getPropertyId=function(){return(TimelineType.scale<<24)+this.boneIndex};ScaleTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var frames=this.frames;var bone=skeleton.bones[this.boneIndex];if(time<frames[0]){switch(blend){case MixBlend$1.setup:bone.scaleX=bone.data.scaleX;bone.scaleY=bone.data.scaleY;return;case MixBlend$1.first:bone.scaleX+=(bone.data.scaleX-bone.scaleX)*alpha;bone.scaleY+=(bone.data.scaleY-bone.scaleY)*alpha}return}var x=0,y=0;if(time>=frames[frames.length-ScaleTimeline.ENTRIES]){x=frames[frames.length+ScaleTimeline.PREV_X]*bone.data.scaleX;y=frames[frames.length+ScaleTimeline.PREV_Y]*bone.data.scaleY}else{var frame=Animation$1.binarySearch(frames,time,ScaleTimeline.ENTRIES);x=frames[frame+ScaleTimeline.PREV_X];y=frames[frame+ScaleTimeline.PREV_Y];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/ScaleTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+ScaleTimeline.PREV_TIME]-frameTime));x=(x+(frames[frame+ScaleTimeline.X]-x)*percent)*bone.data.scaleX;y=(y+(frames[frame+ScaleTimeline.Y]-y)*percent)*bone.data.scaleY}if(alpha==1){if(blend==MixBlend$1.add){bone.scaleX+=x-bone.data.scaleX;bone.scaleY+=y-bone.data.scaleY}else{bone.scaleX=x;bone.scaleY=y}}else{var bx=0,by=0;if(direction==MixDirection$1.out){switch(blend){case MixBlend$1.setup:bx=bone.data.scaleX;by=bone.data.scaleY;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bx)*alpha;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-by)*alpha;break;case MixBlend$1.first:case MixBlend$1.replace:bx=bone.scaleX;by=bone.scaleY;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bx)*alpha;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-by)*alpha;break;case MixBlend$1.add:bx=bone.scaleX;by=bone.scaleY;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bone.data.scaleX)*alpha;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-bone.data.scaleY)*alpha}}else{switch(blend){case MixBlend$1.setup:bx=Math.abs(bone.data.scaleX)*MathUtils.signum(x);by=Math.abs(bone.data.scaleY)*MathUtils.signum(y);bone.scaleX=bx+(x-bx)*alpha;bone.scaleY=by+(y-by)*alpha;break;case MixBlend$1.first:case MixBlend$1.replace:bx=Math.abs(bone.scaleX)*MathUtils.signum(x);by=Math.abs(bone.scaleY)*MathUtils.signum(y);bone.scaleX=bx+(x-bx)*alpha;bone.scaleY=by+(y-by)*alpha;break;case MixBlend$1.add:bx=MathUtils.signum(x);by=MathUtils.signum(y);bone.scaleX=Math.abs(bone.scaleX)*bx+(x-Math.abs(bone.data.scaleX)*bx)*alpha;bone.scaleY=Math.abs(bone.scaleY)*by+(y-Math.abs(bone.data.scaleY)*by)*alpha}}}};return ScaleTimeline}(TranslateTimeline$1);var ShearTimeline$1=function(_super){__extends$2(ShearTimeline,_super);function ShearTimeline(frameCount){return _super.call(this,frameCount)||this}ShearTimeline.prototype.getPropertyId=function(){return(TimelineType.shear<<24)+this.boneIndex};ShearTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var frames=this.frames;var bone=skeleton.bones[this.boneIndex];if(time<frames[0]){switch(blend){case MixBlend$1.setup:bone.shearX=bone.data.shearX;bone.shearY=bone.data.shearY;return;case MixBlend$1.first:bone.shearX+=(bone.data.shearX-bone.shearX)*alpha;bone.shearY+=(bone.data.shearY-bone.shearY)*alpha}return}var x=0,y=0;if(time>=frames[frames.length-ShearTimeline.ENTRIES]){x=frames[frames.length+ShearTimeline.PREV_X];y=frames[frames.length+ShearTimeline.PREV_Y]}else{var frame=Animation$1.binarySearch(frames,time,ShearTimeline.ENTRIES);x=frames[frame+ShearTimeline.PREV_X];y=frames[frame+ShearTimeline.PREV_Y];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/ShearTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+ShearTimeline.PREV_TIME]-frameTime));x=x+(frames[frame+ShearTimeline.X]-x)*percent;y=y+(frames[frame+ShearTimeline.Y]-y)*percent}switch(blend){case MixBlend$1.setup:bone.shearX=bone.data.shearX+x*alpha;bone.shearY=bone.data.shearY+y*alpha;break;case MixBlend$1.first:case MixBlend$1.replace:bone.shearX+=(bone.data.shearX+x-bone.shearX)*alpha;bone.shearY+=(bone.data.shearY+y-bone.shearY)*alpha;break;case MixBlend$1.add:bone.shearX+=x*alpha;bone.shearY+=y*alpha}};return ShearTimeline}(TranslateTimeline$1);var ColorTimeline=function(_super){__extends$2(ColorTimeline,_super);function ColorTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*ColorTimeline.ENTRIES);return _this}ColorTimeline.prototype.getPropertyId=function(){return(TimelineType.color<<24)+this.slotIndex};ColorTimeline.prototype.setFrame=function(frameIndex,time,r,g,b,a){frameIndex*=ColorTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+ColorTimeline.R]=r;this.frames[frameIndex+ColorTimeline.G]=g;this.frames[frameIndex+ColorTimeline.B]=b;this.frames[frameIndex+ColorTimeline.A]=a};ColorTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend$1.setup:slot.color.setFromColor(slot.data.color);return;case MixBlend$1.first:var color=slot.color,setup=slot.data.color;color.add((setup.r-color.r)*alpha,(setup.g-color.g)*alpha,(setup.b-color.b)*alpha,(setup.a-color.a)*alpha)}return}var r=0,g=0,b=0,a=0;if(time>=frames[frames.length-ColorTimeline.ENTRIES]){var i=frames.length;r=frames[i+ColorTimeline.PREV_R];g=frames[i+ColorTimeline.PREV_G];b=frames[i+ColorTimeline.PREV_B];a=frames[i+ColorTimeline.PREV_A]}else{var frame=Animation$1.binarySearch(frames,time,ColorTimeline.ENTRIES);r=frames[frame+ColorTimeline.PREV_R];g=frames[frame+ColorTimeline.PREV_G];b=frames[frame+ColorTimeline.PREV_B];a=frames[frame+ColorTimeline.PREV_A];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/ColorTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+ColorTimeline.PREV_TIME]-frameTime));r+=(frames[frame+ColorTimeline.R]-r)*percent;g+=(frames[frame+ColorTimeline.G]-g)*percent;b+=(frames[frame+ColorTimeline.B]-b)*percent;a+=(frames[frame+ColorTimeline.A]-a)*percent}if(alpha==1)slot.color.set(r,g,b,a);else{var color=slot.color;if(blend==MixBlend$1.setup)color.setFromColor(slot.data.color);color.add((r-color.r)*alpha,(g-color.g)*alpha,(b-color.b)*alpha,(a-color.a)*alpha)}};ColorTimeline.ENTRIES=5;ColorTimeline.PREV_TIME=-5;ColorTimeline.PREV_R=-4;ColorTimeline.PREV_G=-3;ColorTimeline.PREV_B=-2;ColorTimeline.PREV_A=-1;ColorTimeline.R=1;ColorTimeline.G=2;ColorTimeline.B=3;ColorTimeline.A=4;return ColorTimeline}(CurveTimeline$1);var TwoColorTimeline=function(_super){__extends$2(TwoColorTimeline,_super);function TwoColorTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*TwoColorTimeline.ENTRIES);return _this}TwoColorTimeline.prototype.getPropertyId=function(){return(TimelineType.twoColor<<24)+this.slotIndex};TwoColorTimeline.prototype.setFrame=function(frameIndex,time,r,g,b,a,r2,g2,b2){frameIndex*=TwoColorTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+TwoColorTimeline.R]=r;this.frames[frameIndex+TwoColorTimeline.G]=g;this.frames[frameIndex+TwoColorTimeline.B]=b;this.frames[frameIndex+TwoColorTimeline.A]=a;this.frames[frameIndex+TwoColorTimeline.R2]=r2;this.frames[frameIndex+TwoColorTimeline.G2]=g2;this.frames[frameIndex+TwoColorTimeline.B2]=b2};TwoColorTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend$1.setup:slot.color.setFromColor(slot.data.color);slot.darkColor.setFromColor(slot.data.darkColor);return;case MixBlend$1.first:var light=slot.color,dark=slot.darkColor,setupLight=slot.data.color,setupDark=slot.data.darkColor;light.add((setupLight.r-light.r)*alpha,(setupLight.g-light.g)*alpha,(setupLight.b-light.b)*alpha,(setupLight.a-light.a)*alpha);dark.add((setupDark.r-dark.r)*alpha,(setupDark.g-dark.g)*alpha,(setupDark.b-dark.b)*alpha,0)}return}var r=0,g=0,b=0,a=0,r2=0,g2=0,b2=0;if(time>=frames[frames.length-TwoColorTimeline.ENTRIES]){var i=frames.length;r=frames[i+TwoColorTimeline.PREV_R];g=frames[i+TwoColorTimeline.PREV_G];b=frames[i+TwoColorTimeline.PREV_B];a=frames[i+TwoColorTimeline.PREV_A];r2=frames[i+TwoColorTimeline.PREV_R2];g2=frames[i+TwoColorTimeline.PREV_G2];b2=frames[i+TwoColorTimeline.PREV_B2]}else{var frame=Animation$1.binarySearch(frames,time,TwoColorTimeline.ENTRIES);r=frames[frame+TwoColorTimeline.PREV_R];g=frames[frame+TwoColorTimeline.PREV_G];b=frames[frame+TwoColorTimeline.PREV_B];a=frames[frame+TwoColorTimeline.PREV_A];r2=frames[frame+TwoColorTimeline.PREV_R2];g2=frames[frame+TwoColorTimeline.PREV_G2];b2=frames[frame+TwoColorTimeline.PREV_B2];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/TwoColorTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+TwoColorTimeline.PREV_TIME]-frameTime));r+=(frames[frame+TwoColorTimeline.R]-r)*percent;g+=(frames[frame+TwoColorTimeline.G]-g)*percent;b+=(frames[frame+TwoColorTimeline.B]-b)*percent;a+=(frames[frame+TwoColorTimeline.A]-a)*percent;r2+=(frames[frame+TwoColorTimeline.R2]-r2)*percent;g2+=(frames[frame+TwoColorTimeline.G2]-g2)*percent;b2+=(frames[frame+TwoColorTimeline.B2]-b2)*percent}if(alpha==1){slot.color.set(r,g,b,a);slot.darkColor.set(r2,g2,b2,1)}else{var light=slot.color,dark=slot.darkColor;if(blend==MixBlend$1.setup){light.setFromColor(slot.data.color);dark.setFromColor(slot.data.darkColor)}light.add((r-light.r)*alpha,(g-light.g)*alpha,(b-light.b)*alpha,(a-light.a)*alpha);dark.add((r2-dark.r)*alpha,(g2-dark.g)*alpha,(b2-dark.b)*alpha,0)}};TwoColorTimeline.ENTRIES=8;TwoColorTimeline.PREV_TIME=-8;TwoColorTimeline.PREV_R=-7;TwoColorTimeline.PREV_G=-6;TwoColorTimeline.PREV_B=-5;TwoColorTimeline.PREV_A=-4;TwoColorTimeline.PREV_R2=-3;TwoColorTimeline.PREV_G2=-2;TwoColorTimeline.PREV_B2=-1;TwoColorTimeline.R=1;TwoColorTimeline.G=2;TwoColorTimeline.B=3;TwoColorTimeline.A=4;TwoColorTimeline.R2=5;TwoColorTimeline.G2=6;TwoColorTimeline.B2=7;return TwoColorTimeline}(CurveTimeline$1);var AttachmentTimeline$1=function(){function AttachmentTimeline(frameCount){this.frames=Utils.newFloatArray(frameCount);this.attachmentNames=new Array(frameCount)}AttachmentTimeline.prototype.getPropertyId=function(){return(TimelineType.attachment<<24)+this.slotIndex};AttachmentTimeline.prototype.getFrameCount=function(){return this.frames.length};AttachmentTimeline.prototype.setFrame=function(frameIndex,time,attachmentName){this.frames[frameIndex]=time;this.attachmentNames[frameIndex]=attachmentName};AttachmentTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(direction==MixDirection$1.out&&blend==MixBlend$1.setup){var attachmentName_1=slot.data.attachmentName;slot.setAttachment(attachmentName_1==null?null:skeleton.getAttachment(this.slotIndex,attachmentName_1));return}var frames=this.frames;if(time<frames[0]){if(blend==MixBlend$1.setup||blend==MixBlend$1.first){var attachmentName_2=slot.data.attachmentName;slot.setAttachment(attachmentName_2==null?null:skeleton.getAttachment(this.slotIndex,attachmentName_2))}return}var frameIndex=0;if(time>=frames[frames.length-1])frameIndex=frames.length-1;else frameIndex=Animation$1.binarySearch(frames,time,1)-1;var attachmentName=this.attachmentNames[frameIndex];skeleton.slots[this.slotIndex].setAttachment(attachmentName==null?null:skeleton.getAttachment(this.slotIndex,attachmentName))};return AttachmentTimeline}();var zeros=null;var DeformTimeline$1=function(_super){__extends$2(DeformTimeline,_super);function DeformTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount);_this.frameVertices=new Array(frameCount);if(zeros==null)zeros=Utils.newFloatArray(64);return _this}DeformTimeline.prototype.getPropertyId=function(){return(TimelineType.deform<<27)+ +this.attachment.id+this.slotIndex};DeformTimeline.prototype.setFrame=function(frameIndex,time,vertices){this.frames[frameIndex]=time;this.frameVertices[frameIndex]=vertices};DeformTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];var slotAttachment=slot.getAttachment();if(!(slotAttachment instanceof VertexAttachment$1)||!slotAttachment.applyDeform(this.attachment))return;var verticesArray=slot.attachmentVertices;if(verticesArray.length==0)blend=MixBlend$1.setup;var frameVertices=this.frameVertices;var vertexCount=frameVertices[0].length;var frames=this.frames;if(time<frames[0]){var vertexAttachment=slotAttachment;switch(blend){case MixBlend$1.setup:verticesArray.length=0;return;case MixBlend$1.first:if(alpha==1){verticesArray.length=0;break}var vertices_1=Utils.setArraySize(verticesArray,vertexCount);if(vertexAttachment.bones==null){var setupVertices=vertexAttachment.vertices;for(var i=0;i<vertexCount;i++)vertices_1[i]+=(setupVertices[i]-vertices_1[i])*alpha}else{alpha=1-alpha;for(var i=0;i<vertexCount;i++)vertices_1[i]*=alpha}}return}var vertices=Utils.setArraySize(verticesArray,vertexCount);if(time>=frames[frames.length-1]){var lastVertices=frameVertices[frames.length-1];if(alpha==1){if(blend==MixBlend$1.add){var vertexAttachment=slotAttachment;if(vertexAttachment.bones==null){var setupVertices=vertexAttachment.vertices;for(var i=0;i<vertexCount;i++){vertices[i]+=lastVertices[i]-setupVertices[i]}}else{for(var i=0;i<vertexCount;i++)vertices[i]+=lastVertices[i]}}else{Utils.arrayCopy(lastVertices,0,vertices,0,vertexCount)}}else{switch(blend){case MixBlend$1.setup:{var vertexAttachment_1=slotAttachment;if(vertexAttachment_1.bones==null){var setupVertices=vertexAttachment_1.vertices;for(var i=0;i<vertexCount;i++){var setup=setupVertices[i];vertices[i]=setup+(lastVertices[i]-setup)*alpha}}else{for(var i=0;i<vertexCount;i++)vertices[i]=lastVertices[i]*alpha}break}case MixBlend$1.first:case MixBlend$1.replace:for(var i=0;i<vertexCount;i++)vertices[i]+=(lastVertices[i]-vertices[i])*alpha;case MixBlend$1.add:var vertexAttachment=slotAttachment;if(vertexAttachment.bones==null){var setupVertices=vertexAttachment.vertices;for(var i=0;i<vertexCount;i++){vertices[i]+=(lastVertices[i]-setupVertices[i])*alpha}}else{for(var i=0;i<vertexCount;i++)vertices[i]+=lastVertices[i]*alpha}}}return}var frame=Animation$1.binarySearch(frames,time);var prevVertices=frameVertices[frame-1];var nextVertices=frameVertices[frame];var frameTime=frames[frame];var percent=this.getCurvePercent(frame-1,1-(time-frameTime)/(frames[frame-1]-frameTime));if(alpha==1){if(blend==MixBlend$1.add){var vertexAttachment=slotAttachment;if(vertexAttachment.bones==null){var setupVertices=vertexAttachment.vertices;for(var i=0;i<vertexCount;i++){var prev=prevVertices[i];vertices[i]+=prev+(nextVertices[i]-prev)*percent-setupVertices[i]}}else{for(var i=0;i<vertexCount;i++){var prev=prevVertices[i];vertices[i]+=prev+(nextVertices[i]-prev)*percent}}}else{for(var i=0;i<vertexCount;i++){var prev=prevVertices[i];vertices[i]=prev+(nextVertices[i]-prev)*percent}}}else{switch(blend){case MixBlend$1.setup:{var vertexAttachment_2=slotAttachment;if(vertexAttachment_2.bones==null){var setupVertices=vertexAttachment_2.vertices;for(var i=0;i<vertexCount;i++){var prev=prevVertices[i],setup=setupVertices[i];vertices[i]=setup+(prev+(nextVertices[i]-prev)*percent-setup)*alpha}}else{for(var i=0;i<vertexCount;i++){var prev=prevVertices[i];vertices[i]=(prev+(nextVertices[i]-prev)*percent)*alpha}}break}case MixBlend$1.first:case MixBlend$1.replace:for(var i=0;i<vertexCount;i++){var prev=prevVertices[i];vertices[i]+=(prev+(nextVertices[i]-prev)*percent-vertices[i])*alpha}break;case MixBlend$1.add:var vertexAttachment=slotAttachment;if(vertexAttachment.bones==null){var setupVertices=vertexAttachment.vertices;for(var i=0;i<vertexCount;i++){var prev=prevVertices[i];vertices[i]+=(prev+(nextVertices[i]-prev)*percent-setupVertices[i])*alpha}}else{for(var i=0;i<vertexCount;i++){var prev=prevVertices[i];vertices[i]+=(prev+(nextVertices[i]-prev)*percent)*alpha}}}}};return DeformTimeline}(CurveTimeline$1);var EventTimeline$1=function(){function EventTimeline(frameCount){this.frames=Utils.newFloatArray(frameCount);this.events=new Array(frameCount)}EventTimeline.prototype.getPropertyId=function(){return TimelineType.event<<24};EventTimeline.prototype.getFrameCount=function(){return this.frames.length};EventTimeline.prototype.setFrame=function(frameIndex,event){this.frames[frameIndex]=event.time;this.events[frameIndex]=event};EventTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){if(firedEvents==null)return;var frames=this.frames;var frameCount=this.frames.length;if(lastTime>time){this.apply(skeleton,lastTime,Number.MAX_VALUE,firedEvents,alpha,blend,direction);lastTime=-1}else if(lastTime>=frames[frameCount-1])return;if(time<frames[0])return;var frame=0;if(lastTime<frames[0])frame=0;else{frame=Animation$1.binarySearch(frames,lastTime);var frameTime=frames[frame];while(frame>0){if(frames[frame-1]!=frameTime)break;frame--}}for(;frame<frameCount&&time>=frames[frame];frame++)firedEvents.push(this.events[frame])};return EventTimeline}();var DrawOrderTimeline$1=function(){function DrawOrderTimeline(frameCount){this.frames=Utils.newFloatArray(frameCount);this.drawOrders=new Array(frameCount)}DrawOrderTimeline.prototype.getPropertyId=function(){return TimelineType.drawOrder<<24};DrawOrderTimeline.prototype.getFrameCount=function(){return this.frames.length};DrawOrderTimeline.prototype.setFrame=function(frameIndex,time,drawOrder){this.frames[frameIndex]=time;this.drawOrders[frameIndex]=drawOrder};DrawOrderTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var drawOrder=skeleton.drawOrder;var slots=skeleton.slots;if(direction==MixDirection$1.out&&blend==MixBlend$1.setup){Utils.arrayCopy(skeleton.slots,0,skeleton.drawOrder,0,skeleton.slots.length);return}var frames=this.frames;if(time<frames[0]){if(blend==MixBlend$1.setup||blend==MixBlend$1.first)Utils.arrayCopy(skeleton.slots,0,skeleton.drawOrder,0,skeleton.slots.length);return}var frame=0;if(time>=frames[frames.length-1])frame=frames.length-1;else frame=Animation$1.binarySearch(frames,time)-1;var drawOrderToSetupIndex=this.drawOrders[frame];if(drawOrderToSetupIndex==null)Utils.arrayCopy(slots,0,drawOrder,0,slots.length);else{for(var i=0,n=drawOrderToSetupIndex.length;i<n;i++)drawOrder[i]=slots[drawOrderToSetupIndex[i]]}};return DrawOrderTimeline}();var IkConstraintTimeline$1=function(_super){__extends$2(IkConstraintTimeline,_super);function IkConstraintTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*IkConstraintTimeline.ENTRIES);return _this}IkConstraintTimeline.prototype.getPropertyId=function(){return(TimelineType.ikConstraint<<24)+this.ikConstraintIndex};IkConstraintTimeline.prototype.setFrame=function(frameIndex,time,mix,bendDirection,compress,stretch){frameIndex*=IkConstraintTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+IkConstraintTimeline.MIX]=mix;this.frames[frameIndex+IkConstraintTimeline.BEND_DIRECTION]=bendDirection;this.frames[frameIndex+IkConstraintTimeline.COMPRESS]=compress?1:0;this.frames[frameIndex+IkConstraintTimeline.STRETCH]=stretch?1:0};IkConstraintTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var frames=this.frames;var constraint=skeleton.ikConstraints[this.ikConstraintIndex];if(time<frames[0]){switch(blend){case MixBlend$1.setup:constraint.mix=constraint.data.mix;constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch;return;case MixBlend$1.first:constraint.mix+=(constraint.data.mix-constraint.mix)*alpha;constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch}return}if(time>=frames[frames.length-IkConstraintTimeline.ENTRIES]){if(blend==MixBlend$1.setup){constraint.mix=constraint.data.mix+(frames[frames.length+IkConstraintTimeline.PREV_MIX]-constraint.data.mix)*alpha;if(direction==MixDirection$1.out){constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch}else{constraint.bendDirection=frames[frames.length+IkConstraintTimeline.PREV_BEND_DIRECTION];constraint.compress=frames[frames.length+IkConstraintTimeline.PREV_COMPRESS]!=0;constraint.stretch=frames[frames.length+IkConstraintTimeline.PREV_STRETCH]!=0}}else{constraint.mix+=(frames[frames.length+IkConstraintTimeline.PREV_MIX]-constraint.mix)*alpha;if(direction==MixDirection$1.in){constraint.bendDirection=frames[frames.length+IkConstraintTimeline.PREV_BEND_DIRECTION];constraint.compress=frames[frames.length+IkConstraintTimeline.PREV_COMPRESS]!=0;constraint.stretch=frames[frames.length+IkConstraintTimeline.PREV_STRETCH]!=0}}return}var frame=Animation$1.binarySearch(frames,time,IkConstraintTimeline.ENTRIES);var mix=frames[frame+IkConstraintTimeline.PREV_MIX];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/IkConstraintTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+IkConstraintTimeline.PREV_TIME]-frameTime));if(blend==MixBlend$1.setup){constraint.mix=constraint.data.mix+(mix+(frames[frame+IkConstraintTimeline.MIX]-mix)*percent-constraint.data.mix)*alpha;if(direction==MixDirection$1.out){constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch}else{constraint.bendDirection=frames[frame+IkConstraintTimeline.PREV_BEND_DIRECTION];constraint.compress=frames[frame+IkConstraintTimeline.PREV_COMPRESS]!=0;constraint.stretch=frames[frame+IkConstraintTimeline.PREV_STRETCH]!=0}}else{constraint.mix+=(mix+(frames[frame+IkConstraintTimeline.MIX]-mix)*percent-constraint.mix)*alpha;if(direction==MixDirection$1.in){constraint.bendDirection=frames[frame+IkConstraintTimeline.PREV_BEND_DIRECTION];constraint.compress=frames[frame+IkConstraintTimeline.PREV_COMPRESS]!=0;constraint.stretch=frames[frame+IkConstraintTimeline.PREV_STRETCH]!=0}}};IkConstraintTimeline.ENTRIES=5;IkConstraintTimeline.PREV_TIME=-5;IkConstraintTimeline.PREV_MIX=-4;IkConstraintTimeline.PREV_BEND_DIRECTION=-3;IkConstraintTimeline.PREV_COMPRESS=-2;IkConstraintTimeline.PREV_STRETCH=-1;IkConstraintTimeline.MIX=1;IkConstraintTimeline.BEND_DIRECTION=2;IkConstraintTimeline.COMPRESS=3;IkConstraintTimeline.STRETCH=4;return IkConstraintTimeline}(CurveTimeline$1);var TransformConstraintTimeline$1=function(_super){__extends$2(TransformConstraintTimeline,_super);function TransformConstraintTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*TransformConstraintTimeline.ENTRIES);return _this}TransformConstraintTimeline.prototype.getPropertyId=function(){return(TimelineType.transformConstraint<<24)+this.transformConstraintIndex};TransformConstraintTimeline.prototype.setFrame=function(frameIndex,time,rotateMix,translateMix,scaleMix,shearMix){frameIndex*=TransformConstraintTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+TransformConstraintTimeline.ROTATE]=rotateMix;this.frames[frameIndex+TransformConstraintTimeline.TRANSLATE]=translateMix;this.frames[frameIndex+TransformConstraintTimeline.SCALE]=scaleMix;this.frames[frameIndex+TransformConstraintTimeline.SHEAR]=shearMix};TransformConstraintTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var frames=this.frames;var constraint=skeleton.transformConstraints[this.transformConstraintIndex];if(time<frames[0]){var data=constraint.data;switch(blend){case MixBlend$1.setup:constraint.rotateMix=data.rotateMix;constraint.translateMix=data.translateMix;constraint.scaleMix=data.scaleMix;constraint.shearMix=data.shearMix;return;case MixBlend$1.first:constraint.rotateMix+=(data.rotateMix-constraint.rotateMix)*alpha;constraint.translateMix+=(data.translateMix-constraint.translateMix)*alpha;constraint.scaleMix+=(data.scaleMix-constraint.scaleMix)*alpha;constraint.shearMix+=(data.shearMix-constraint.shearMix)*alpha}return}var rotate=0,translate=0,scale=0,shear=0;if(time>=frames[frames.length-TransformConstraintTimeline.ENTRIES]){var i=frames.length;rotate=frames[i+TransformConstraintTimeline.PREV_ROTATE];translate=frames[i+TransformConstraintTimeline.PREV_TRANSLATE];scale=frames[i+TransformConstraintTimeline.PREV_SCALE];shear=frames[i+TransformConstraintTimeline.PREV_SHEAR]}else{var frame=Animation$1.binarySearch(frames,time,TransformConstraintTimeline.ENTRIES);rotate=frames[frame+TransformConstraintTimeline.PREV_ROTATE];translate=frames[frame+TransformConstraintTimeline.PREV_TRANSLATE];scale=frames[frame+TransformConstraintTimeline.PREV_SCALE];shear=frames[frame+TransformConstraintTimeline.PREV_SHEAR];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/TransformConstraintTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+TransformConstraintTimeline.PREV_TIME]-frameTime));rotate+=(frames[frame+TransformConstraintTimeline.ROTATE]-rotate)*percent;translate+=(frames[frame+TransformConstraintTimeline.TRANSLATE]-translate)*percent;scale+=(frames[frame+TransformConstraintTimeline.SCALE]-scale)*percent;shear+=(frames[frame+TransformConstraintTimeline.SHEAR]-shear)*percent}if(blend==MixBlend$1.setup){var data=constraint.data;constraint.rotateMix=data.rotateMix+(rotate-data.rotateMix)*alpha;constraint.translateMix=data.translateMix+(translate-data.translateMix)*alpha;constraint.scaleMix=data.scaleMix+(scale-data.scaleMix)*alpha;constraint.shearMix=data.shearMix+(shear-data.shearMix)*alpha}else{constraint.rotateMix+=(rotate-constraint.rotateMix)*alpha;constraint.translateMix+=(translate-constraint.translateMix)*alpha;constraint.scaleMix+=(scale-constraint.scaleMix)*alpha;constraint.shearMix+=(shear-constraint.shearMix)*alpha}};TransformConstraintTimeline.ENTRIES=5;TransformConstraintTimeline.PREV_TIME=-5;TransformConstraintTimeline.PREV_ROTATE=-4;TransformConstraintTimeline.PREV_TRANSLATE=-3;TransformConstraintTimeline.PREV_SCALE=-2;TransformConstraintTimeline.PREV_SHEAR=-1;TransformConstraintTimeline.ROTATE=1;TransformConstraintTimeline.TRANSLATE=2;TransformConstraintTimeline.SCALE=3;TransformConstraintTimeline.SHEAR=4;return TransformConstraintTimeline}(CurveTimeline$1);var PathConstraintPositionTimeline$1=function(_super){__extends$2(PathConstraintPositionTimeline,_super);function PathConstraintPositionTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*PathConstraintPositionTimeline.ENTRIES);return _this}PathConstraintPositionTimeline.prototype.getPropertyId=function(){return(TimelineType.pathConstraintPosition<<24)+this.pathConstraintIndex};PathConstraintPositionTimeline.prototype.setFrame=function(frameIndex,time,value){frameIndex*=PathConstraintPositionTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+PathConstraintPositionTimeline.VALUE]=value};PathConstraintPositionTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var frames=this.frames;var constraint=skeleton.pathConstraints[this.pathConstraintIndex];if(time<frames[0]){switch(blend){case MixBlend$1.setup:constraint.position=constraint.data.position;return;case MixBlend$1.first:constraint.position+=(constraint.data.position-constraint.position)*alpha}return}var position=0;if(time>=frames[frames.length-PathConstraintPositionTimeline.ENTRIES])position=frames[frames.length+PathConstraintPositionTimeline.PREV_VALUE];else{var frame=Animation$1.binarySearch(frames,time,PathConstraintPositionTimeline.ENTRIES);position=frames[frame+PathConstraintPositionTimeline.PREV_VALUE];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/PathConstraintPositionTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+PathConstraintPositionTimeline.PREV_TIME]-frameTime));position+=(frames[frame+PathConstraintPositionTimeline.VALUE]-position)*percent}if(blend==MixBlend$1.setup)constraint.position=constraint.data.position+(position-constraint.data.position)*alpha;else constraint.position+=(position-constraint.position)*alpha};PathConstraintPositionTimeline.ENTRIES=2;PathConstraintPositionTimeline.PREV_TIME=-2;PathConstraintPositionTimeline.PREV_VALUE=-1;PathConstraintPositionTimeline.VALUE=1;return PathConstraintPositionTimeline}(CurveTimeline$1);var PathConstraintSpacingTimeline$1=function(_super){__extends$2(PathConstraintSpacingTimeline,_super);function PathConstraintSpacingTimeline(frameCount){return _super.call(this,frameCount)||this}PathConstraintSpacingTimeline.prototype.getPropertyId=function(){return(TimelineType.pathConstraintSpacing<<24)+this.pathConstraintIndex};PathConstraintSpacingTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var frames=this.frames;var constraint=skeleton.pathConstraints[this.pathConstraintIndex];if(time<frames[0]){switch(blend){case MixBlend$1.setup:constraint.spacing=constraint.data.spacing;return;case MixBlend$1.first:constraint.spacing+=(constraint.data.spacing-constraint.spacing)*alpha}return}var spacing=0;if(time>=frames[frames.length-PathConstraintSpacingTimeline.ENTRIES])spacing=frames[frames.length+PathConstraintSpacingTimeline.PREV_VALUE];else{var frame=Animation$1.binarySearch(frames,time,PathConstraintSpacingTimeline.ENTRIES);spacing=frames[frame+PathConstraintSpacingTimeline.PREV_VALUE];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/PathConstraintSpacingTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+PathConstraintSpacingTimeline.PREV_TIME]-frameTime));spacing+=(frames[frame+PathConstraintSpacingTimeline.VALUE]-spacing)*percent}if(blend==MixBlend$1.setup)constraint.spacing=constraint.data.spacing+(spacing-constraint.data.spacing)*alpha;else constraint.spacing+=(spacing-constraint.spacing)*alpha};return PathConstraintSpacingTimeline}(PathConstraintPositionTimeline$1);var PathConstraintMixTimeline$1=function(_super){__extends$2(PathConstraintMixTimeline,_super);function PathConstraintMixTimeline(frameCount){var _this=_super.call(this,frameCount)||this;_this.frames=Utils.newFloatArray(frameCount*PathConstraintMixTimeline.ENTRIES);return _this}PathConstraintMixTimeline.prototype.getPropertyId=function(){return(TimelineType.pathConstraintMix<<24)+this.pathConstraintIndex};PathConstraintMixTimeline.prototype.setFrame=function(frameIndex,time,rotateMix,translateMix){frameIndex*=PathConstraintMixTimeline.ENTRIES;this.frames[frameIndex]=time;this.frames[frameIndex+PathConstraintMixTimeline.ROTATE]=rotateMix;this.frames[frameIndex+PathConstraintMixTimeline.TRANSLATE]=translateMix};PathConstraintMixTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var frames=this.frames;var constraint=skeleton.pathConstraints[this.pathConstraintIndex];if(time<frames[0]){switch(blend){case MixBlend$1.setup:constraint.rotateMix=constraint.data.rotateMix;constraint.translateMix=constraint.data.translateMix;return;case MixBlend$1.first:constraint.rotateMix+=(constraint.data.rotateMix-constraint.rotateMix)*alpha;constraint.translateMix+=(constraint.data.translateMix-constraint.translateMix)*alpha}return}var rotate=0,translate=0;if(time>=frames[frames.length-PathConstraintMixTimeline.ENTRIES]){rotate=frames[frames.length+PathConstraintMixTimeline.PREV_ROTATE];translate=frames[frames.length+PathConstraintMixTimeline.PREV_TRANSLATE]}else{var frame=Animation$1.binarySearch(frames,time,PathConstraintMixTimeline.ENTRIES);rotate=frames[frame+PathConstraintMixTimeline.PREV_ROTATE];translate=frames[frame+PathConstraintMixTimeline.PREV_TRANSLATE];var frameTime=frames[frame];var percent=this.getCurvePercent(frame/PathConstraintMixTimeline.ENTRIES-1,1-(time-frameTime)/(frames[frame+PathConstraintMixTimeline.PREV_TIME]-frameTime));rotate+=(frames[frame+PathConstraintMixTimeline.ROTATE]-rotate)*percent;translate+=(frames[frame+PathConstraintMixTimeline.TRANSLATE]-translate)*percent}if(blend==MixBlend$1.setup){constraint.rotateMix=constraint.data.rotateMix+(rotate-constraint.data.rotateMix)*alpha;constraint.translateMix=constraint.data.translateMix+(translate-constraint.data.translateMix)*alpha}else{constraint.rotateMix+=(rotate-constraint.rotateMix)*alpha;constraint.translateMix+=(translate-constraint.translateMix)*alpha}};PathConstraintMixTimeline.ENTRIES=3;PathConstraintMixTimeline.PREV_TIME=-3;PathConstraintMixTimeline.PREV_ROTATE=-2;PathConstraintMixTimeline.PREV_TRANSLATE=-1;PathConstraintMixTimeline.ROTATE=1;PathConstraintMixTimeline.TRANSLATE=2;return PathConstraintMixTimeline}(CurveTimeline$1);var AnimationState$1=function(){function AnimationState(data){this.tracks=new Array;this.events=new Array;this.listeners=new Array;this.queue=new EventQueue$1(this);this.propertyIDs=new IntSet;this.animationsChanged=false;this.timeScale=1;this.trackEntryPool=new Pool(function(){return new TrackEntry$1});this.data=data}AnimationState.prototype.update=function(delta){delta*=this.timeScale;var tracks=this.tracks;for(var i=0,n=tracks.length;i<n;i++){var current=tracks[i];if(current==null)continue;current.animationLast=current.nextAnimationLast;current.trackLast=current.nextTrackLast;var currentDelta=delta*current.timeScale;if(current.delay>0){current.delay-=currentDelta;if(current.delay>0)continue;currentDelta=-current.delay;current.delay=0}var next=current.next;if(next!=null){var nextTime=current.trackLast-next.delay;if(nextTime>=0){next.delay=0;next.trackTime=current.timeScale==0?0:(nextTime/current.timeScale+delta)*next.timeScale;current.trackTime+=currentDelta;this.setCurrent(i,next,true);while(next.mixingFrom!=null){next.mixTime+=delta;next=next.mixingFrom}continue}}else if(current.trackLast>=current.trackEnd&&current.mixingFrom==null){tracks[i]=null;this.queue.end(current);this.disposeNext(current);continue}if(current.mixingFrom!=null&&this.updateMixingFrom(current,delta)){var from=current.mixingFrom;current.mixingFrom=null;if(from!=null)from.mixingTo=null;while(from!=null){this.queue.end(from);from=from.mixingFrom}}current.trackTime+=currentDelta}this.queue.drain()};AnimationState.prototype.updateMixingFrom=function(to,delta){var from=to.mixingFrom;if(from==null)return true;var finished=this.updateMixingFrom(from,delta);from.animationLast=from.nextAnimationLast;from.trackLast=from.nextTrackLast;if(to.mixTime>0&&to.mixTime>=to.mixDuration){if(from.totalAlpha==0||to.mixDuration==0){to.mixingFrom=from.mixingFrom;if(from.mixingFrom!=null)from.mixingFrom.mixingTo=to;to.interruptAlpha=from.interruptAlpha;this.queue.end(from)}return finished}from.trackTime+=delta*from.timeScale;to.mixTime+=delta;return false};AnimationState.prototype.apply=function(skeleton){if(skeleton==null)throw new Error("skeleton cannot be null.");if(this.animationsChanged)this._animationsChanged();var events=this.events;var tracks=this.tracks;var applied=false;for(var i=0,n=tracks.length;i<n;i++){var current=tracks[i];if(current==null||current.delay>0)continue;applied=true;var blend=i==0?MixBlend$1.first:current.mixBlend;var mix=current.alpha;if(current.mixingFrom!=null)mix*=this.applyMixingFrom(current,skeleton,blend);else if(current.trackTime>=current.trackEnd&&current.next==null)mix=0;var animationLast=current.animationLast,animationTime=current.getAnimationTime();var timelineCount=current.animation.timelines.length;var timelines=current.animation.timelines;if(i==0&&mix==1||blend==MixBlend$1.add){for(var ii=0;ii<timelineCount;ii++){Utils.webkit602BugfixHelper(mix,blend);timelines[ii].apply(skeleton,animationLast,animationTime,events,mix,blend,MixDirection$1.in)}}else{var timelineMode=current.timelineMode;var firstFrame=current.timelinesRotation.length==0;if(firstFrame)Utils.setArraySize(current.timelinesRotation,timelineCount<<1,null);var timelinesRotation=current.timelinesRotation;for(var ii=0;ii<timelineCount;ii++){var timeline=timelines[ii];var timelineBlend=timelineMode[ii]==AnimationState.SUBSEQUENT?blend:MixBlend$1.setup;if(timeline instanceof RotateTimeline$1){this.applyRotateTimeline(timeline,skeleton,animationTime,mix,timelineBlend,timelinesRotation,ii<<1,firstFrame)}else{Utils.webkit602BugfixHelper(mix,blend);timeline.apply(skeleton,animationLast,animationTime,events,mix,timelineBlend,MixDirection$1.in)}}}this.queueEvents(current,animationTime);events.length=0;current.nextAnimationLast=animationTime;current.nextTrackLast=current.trackTime}this.queue.drain();return applied};AnimationState.prototype.applyMixingFrom=function(to,skeleton,blend){var from=to.mixingFrom;if(from.mixingFrom!=null)this.applyMixingFrom(from,skeleton,blend);var mix=0;if(to.mixDuration==0){mix=1;if(blend==MixBlend$1.first)blend=MixBlend$1.setup}else{mix=to.mixTime/to.mixDuration;if(mix>1)mix=1;if(blend!=MixBlend$1.first)blend=from.mixBlend}var events=mix<from.eventThreshold?this.events:null;var attachments=mix<from.attachmentThreshold,drawOrder=mix<from.drawOrderThreshold;var animationLast=from.animationLast,animationTime=from.getAnimationTime();var timelineCount=from.animation.timelines.length;var timelines=from.animation.timelines;var alphaHold=from.alpha*to.interruptAlpha,alphaMix=alphaHold*(1-mix);if(blend==MixBlend$1.add){for(var i=0;i<timelineCount;i++)timelines[i].apply(skeleton,animationLast,animationTime,events,alphaMix,blend,MixDirection$1.out)}else{var timelineMode=from.timelineMode;var timelineHoldMix=from.timelineHoldMix;var firstFrame=from.timelinesRotation.length==0;if(firstFrame)Utils.setArraySize(from.timelinesRotation,timelineCount<<1,null);var timelinesRotation=from.timelinesRotation;from.totalAlpha=0;for(var i=0;i<timelineCount;i++){var timeline=timelines[i];var direction=MixDirection$1.out;var timelineBlend=void 0;var alpha=0;switch(timelineMode[i]){case AnimationState.SUBSEQUENT:if(!attachments&&timeline instanceof AttachmentTimeline$1)continue;if(!drawOrder&&timeline instanceof DrawOrderTimeline$1)continue;timelineBlend=blend;alpha=alphaMix;break;case AnimationState.FIRST:timelineBlend=MixBlend$1.setup;alpha=alphaMix;break;case AnimationState.HOLD:timelineBlend=MixBlend$1.setup;alpha=alphaHold;break;default:timelineBlend=MixBlend$1.setup;var holdMix=timelineHoldMix[i];alpha=alphaHold*Math.max(0,1-holdMix.mixTime/holdMix.mixDuration);break}from.totalAlpha+=alpha;if(timeline instanceof RotateTimeline$1)this.applyRotateTimeline(timeline,skeleton,animationTime,alpha,timelineBlend,timelinesRotation,i<<1,firstFrame);else{Utils.webkit602BugfixHelper(alpha,blend);if(timelineBlend==MixBlend$1.setup){if(timeline instanceof AttachmentTimeline$1){if(attachments)direction=MixDirection$1.out}else if(timeline instanceof DrawOrderTimeline$1){if(drawOrder)direction=MixDirection$1.out}}timeline.apply(skeleton,animationLast,animationTime,events,alpha,timelineBlend,direction)}}}if(to.mixDuration>0)this.queueEvents(from,animationTime);this.events.length=0;from.nextAnimationLast=animationTime;from.nextTrackLast=from.trackTime;return mix};AnimationState.prototype.applyRotateTimeline=function(timeline,skeleton,time,alpha,blend,timelinesRotation,i,firstFrame){if(firstFrame)timelinesRotation[i]=0;if(alpha==1){timeline.apply(skeleton,0,time,null,1,blend,MixDirection$1.in);return}var rotateTimeline=timeline;var frames=rotateTimeline.frames;var bone=skeleton.bones[rotateTimeline.boneIndex];var r1=0,r2=0;if(time<frames[0]){switch(blend){case MixBlend$1.setup:bone.rotation=bone.data.rotation;default:return;case MixBlend$1.first:r1=bone.rotation;r2=bone.data.rotation}}else{r1=blend==MixBlend$1.setup?bone.data.rotation:bone.rotation;if(time>=frames[frames.length-RotateTimeline$1.ENTRIES])r2=bone.data.rotation+frames[frames.length+RotateTimeline$1.PREV_ROTATION];else{var frame=Animation$1.binarySearch(frames,time,RotateTimeline$1.ENTRIES);var prevRotation=frames[frame+RotateTimeline$1.PREV_ROTATION];var frameTime=frames[frame];var percent=rotateTimeline.getCurvePercent((frame>>1)-1,1-(time-frameTime)/(frames[frame+RotateTimeline$1.PREV_TIME]-frameTime));r2=frames[frame+RotateTimeline$1.ROTATION]-prevRotation;r2-=(16384-(16384.499999999996-r2/360|0))*360;r2=prevRotation+r2*percent+bone.data.rotation;r2-=(16384-(16384.499999999996-r2/360|0))*360}}var total=0,diff=r2-r1;diff-=(16384-(16384.499999999996-diff/360|0))*360;if(diff==0){total=timelinesRotation[i]}else{var lastTotal=0,lastDiff=0;if(firstFrame){lastTotal=0;lastDiff=diff}else{lastTotal=timelinesRotation[i];lastDiff=timelinesRotation[i+1]}var current=diff>0,dir=lastTotal>=0;if(MathUtils.signum(lastDiff)!=MathUtils.signum(diff)&&Math.abs(lastDiff)<=90){if(Math.abs(lastTotal)>180)lastTotal+=360*MathUtils.signum(lastTotal);dir=current}total=diff+lastTotal-lastTotal%360;if(dir!=current)total+=360*MathUtils.signum(lastTotal);timelinesRotation[i]=total}timelinesRotation[i+1]=diff;r1+=total*alpha;bone.rotation=r1-(16384-(16384.499999999996-r1/360|0))*360};AnimationState.prototype.queueEvents=function(entry,animationTime){var animationStart=entry.animationStart,animationEnd=entry.animationEnd;var duration=animationEnd-animationStart;var trackLastWrapped=entry.trackLast%duration;var events=this.events;var i=0,n=events.length;for(;i<n;i++){var event_1=events[i];if(event_1.time<trackLastWrapped)break;if(event_1.time>animationEnd)continue;this.queue.event(entry,event_1)}var complete=false;if(entry.loop)complete=duration==0||trackLastWrapped>entry.trackTime%duration;else complete=animationTime>=animationEnd&&entry.animationLast<animationEnd;if(complete)this.queue.complete(entry);for(;i<n;i++){var event_2=events[i];if(event_2.time<animationStart)continue;this.queue.event(entry,events[i])}};AnimationState.prototype.clearTracks=function(){var oldDrainDisabled=this.queue.drainDisabled;this.queue.drainDisabled=true;for(var i=0,n=this.tracks.length;i<n;i++)this.clearTrack(i);this.tracks.length=0;this.queue.drainDisabled=oldDrainDisabled;this.queue.drain()};AnimationState.prototype.clearTrack=function(trackIndex){if(trackIndex>=this.tracks.length)return;var current=this.tracks[trackIndex];if(current==null)return;this.queue.end(current);this.disposeNext(current);var entry=current;while(true){var from=entry.mixingFrom;if(from==null)break;this.queue.end(from);entry.mixingFrom=null;entry.mixingTo=null;entry=from}this.tracks[current.trackIndex]=null;this.queue.drain()};AnimationState.prototype.setCurrent=function(index,current,interrupt){var from=this.expandToIndex(index);this.tracks[index]=current;if(from!=null){if(interrupt)this.queue.interrupt(from);current.mixingFrom=from;from.mixingTo=current;current.mixTime=0;if(from.mixingFrom!=null&&from.mixDuration>0)current.interruptAlpha*=Math.min(1,from.mixTime/from.mixDuration);from.timelinesRotation.length=0}this.queue.start(current)};AnimationState.prototype.setAnimation=function(trackIndex,animationName,loop){var animation=this.data.skeletonData.findAnimation(animationName);if(animation==null)throw new Error("Animation not found: "+animationName);return this.setAnimationWith(trackIndex,animation,loop)};AnimationState.prototype.setAnimationWith=function(trackIndex,animation,loop){if(animation==null)throw new Error("animation cannot be null.");var interrupt=true;var current=this.expandToIndex(trackIndex);if(current!=null){if(current.nextTrackLast==-1){this.tracks[trackIndex]=current.mixingFrom;this.queue.interrupt(current);this.queue.end(current);this.disposeNext(current);current=current.mixingFrom;interrupt=false}else this.disposeNext(current)}var entry=this.trackEntry(trackIndex,animation,loop,current);this.setCurrent(trackIndex,entry,interrupt);this.queue.drain();return entry};AnimationState.prototype.addAnimation=function(trackIndex,animationName,loop,delay){var animation=this.data.skeletonData.findAnimation(animationName);if(animation==null)throw new Error("Animation not found: "+animationName);return this.addAnimationWith(trackIndex,animation,loop,delay)};AnimationState.prototype.addAnimationWith=function(trackIndex,animation,loop,delay){if(animation==null)throw new Error("animation cannot be null.");var last=this.expandToIndex(trackIndex);if(last!=null){while(last.next!=null)last=last.next}var entry=this.trackEntry(trackIndex,animation,loop,last);if(last==null){this.setCurrent(trackIndex,entry,true);this.queue.drain()}else{last.next=entry;if(delay<=0){var duration=last.animationEnd-last.animationStart;if(duration!=0){if(last.loop)delay+=duration*(1+(last.trackTime/duration|0));else delay+=Math.max(duration,last.trackTime);delay-=this.data.getMix(last.animation,animation)}else delay=last.trackTime}}entry.delay=delay;return entry};AnimationState.prototype.setEmptyAnimation=function(trackIndex,mixDuration){var entry=this.setAnimationWith(trackIndex,AnimationState.emptyAnimation,false);entry.mixDuration=mixDuration;entry.trackEnd=mixDuration;return entry};AnimationState.prototype.addEmptyAnimation=function(trackIndex,mixDuration,delay){if(delay<=0)delay-=mixDuration;var entry=this.addAnimationWith(trackIndex,AnimationState.emptyAnimation,false,delay);entry.mixDuration=mixDuration;entry.trackEnd=mixDuration;return entry};AnimationState.prototype.setEmptyAnimations=function(mixDuration){var oldDrainDisabled=this.queue.drainDisabled;this.queue.drainDisabled=true;for(var i=0,n=this.tracks.length;i<n;i++){var current=this.tracks[i];if(current!=null)this.setEmptyAnimation(current.trackIndex,mixDuration)}this.queue.drainDisabled=oldDrainDisabled;this.queue.drain()};AnimationState.prototype.expandToIndex=function(index){if(index<this.tracks.length)return this.tracks[index];Utils.ensureArrayCapacity(this.tracks,index-this.tracks.length+1,null);this.tracks.length=index+1;return null};AnimationState.prototype.trackEntry=function(trackIndex,animation,loop,last){var entry=this.trackEntryPool.obtain();entry.trackIndex=trackIndex;entry.animation=animation;entry.loop=loop;entry.holdPrevious=false;entry.eventThreshold=0;entry.attachmentThreshold=0;entry.drawOrderThreshold=0;entry.animationStart=0;entry.animationEnd=animation.duration;entry.animationLast=-1;entry.nextAnimationLast=-1;entry.delay=0;entry.trackTime=0;entry.trackLast=-1;entry.nextTrackLast=-1;entry.trackEnd=Number.MAX_VALUE;entry.timeScale=1;entry.alpha=1;entry.interruptAlpha=1;entry.mixTime=0;entry.mixDuration=last==null?0:this.data.getMix(last.animation,animation);return entry};AnimationState.prototype.disposeNext=function(entry){var next=entry.next;while(next!=null){this.queue.dispose(next);next=next.next}entry.next=null};AnimationState.prototype._animationsChanged=function(){this.animationsChanged=false;this.propertyIDs.clear();for(var i=0,n=this.tracks.length;i<n;i++){var entry=this.tracks[i];if(entry==null)continue;while(entry.mixingFrom!=null)entry=entry.mixingFrom;do{if(entry.mixingFrom==null||entry.mixBlend!=MixBlend$1.add)this.setTimelineModes(entry);entry=entry.mixingTo}while(entry!=null)}};AnimationState.prototype.setTimelineModes=function(entry){var to=entry.mixingTo;var timelines=entry.animation.timelines;var timelinesCount=entry.animation.timelines.length;var timelineMode=Utils.setArraySize(entry.timelineMode,timelinesCount);entry.timelineHoldMix.length=0;var timelineDipMix=Utils.setArraySize(entry.timelineHoldMix,timelinesCount);var propertyIDs=this.propertyIDs;if(to!=null&&to.holdPrevious){for(var i=0;i<timelinesCount;i++){propertyIDs.add(timelines[i].getPropertyId());timelineMode[i]=AnimationState.HOLD}return}outer:for(var i=0;i<timelinesCount;i++){var id=timelines[i].getPropertyId();if(!propertyIDs.add(id))timelineMode[i]=AnimationState.SUBSEQUENT;else if(to==null||!this.hasTimeline(to,id))timelineMode[i]=AnimationState.FIRST;else{for(var next=to.mixingTo;next!=null;next=next.mixingTo){if(this.hasTimeline(next,id))continue;if(entry.mixDuration>0){timelineMode[i]=AnimationState.HOLD_MIX;timelineDipMix[i]=next;continue outer}break}timelineMode[i]=AnimationState.HOLD}}};AnimationState.prototype.hasTimeline=function(entry,id){var timelines=entry.animation.timelines;for(var i=0,n=timelines.length;i<n;i++)if(timelines[i].getPropertyId()==id)return true;return false};AnimationState.prototype.getCurrent=function(trackIndex){if(trackIndex>=this.tracks.length)return null;return this.tracks[trackIndex]};AnimationState.prototype.addListener=function(listener){if(listener==null)throw new Error("listener cannot be null.");this.listeners.push(listener)};AnimationState.prototype.removeListener=function(listener){var index=this.listeners.indexOf(listener);if(index>=0)this.listeners.splice(index,1)};AnimationState.prototype.clearListeners=function(){this.listeners.length=0};AnimationState.prototype.clearListenerNotifications=function(){this.queue.clear()};AnimationState.prototype.setAnimationByName=function(trackIndex,animationName,loop){if(!AnimationState.deprecatedWarning1){AnimationState.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")}this.setAnimation(trackIndex,animationName,loop)};AnimationState.prototype.addAnimationByName=function(trackIndex,animationName,loop,delay){if(!AnimationState.deprecatedWarning2){AnimationState.deprecatedWarning2=true;console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")}this.addAnimation(trackIndex,animationName,loop,delay)};AnimationState.prototype.hasAnimation=function(animationName){var animation=this.data.skeletonData.findAnimation(animationName);return animation!==null};AnimationState.prototype.hasAnimationByName=function(animationName){if(!AnimationState.deprecatedWarning3){AnimationState.deprecatedWarning3=true;console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")}return this.hasAnimation(animationName)};AnimationState.emptyAnimation=new Animation$1("<empty>",[],0);AnimationState.SUBSEQUENT=0;AnimationState.FIRST=1;AnimationState.HOLD=2;AnimationState.HOLD_MIX=3;AnimationState.deprecatedWarning1=false;AnimationState.deprecatedWarning2=false;AnimationState.deprecatedWarning3=false;return AnimationState}();var TrackEntry$1=function(){function TrackEntry(){this.mixBlend=MixBlend$1.replace;this.timelineMode=new Array;this.timelineHoldMix=new Array;this.timelinesRotation=new Array}TrackEntry.prototype.reset=function(){this.next=null;this.mixingFrom=null;this.mixingTo=null;this.animation=null;this.listener=null;this.timelineMode.length=0;this.timelineHoldMix.length=0;this.timelinesRotation.length=0};TrackEntry.prototype.getAnimationTime=function(){if(this.loop){var duration=this.animationEnd-this.animationStart;if(duration==0)return this.animationStart;return this.trackTime%duration+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)};TrackEntry.prototype.setAnimationLast=function(animationLast){this.animationLast=animationLast;this.nextAnimationLast=animationLast};TrackEntry.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart};TrackEntry.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0};Object.defineProperty(TrackEntry.prototype,"time",{get:function(){if(!TrackEntry.deprecatedWarning1){TrackEntry.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")}return this.trackTime},set:function(value){if(!TrackEntry.deprecatedWarning1){TrackEntry.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")}this.trackTime=value},enumerable:false,configurable:true});Object.defineProperty(TrackEntry.prototype,"endTime",{get:function(){if(!TrackEntry.deprecatedWarning2){TrackEntry.deprecatedWarning2=true;console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")}return this.trackTime},set:function(value){if(!TrackEntry.deprecatedWarning2){TrackEntry.deprecatedWarning2=true;console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")}this.trackTime=value},enumerable:false,configurable:true});TrackEntry.prototype.loopsCount=function(){return Math.floor(this.trackTime/this.trackEnd)};TrackEntry.deprecatedWarning1=false;TrackEntry.deprecatedWarning2=false;return TrackEntry}();var EventQueue$1=function(){function EventQueue(animState){this.objects=[];this.drainDisabled=false;this.animState=animState}EventQueue.prototype.start=function(entry){this.objects.push(EventType$1.start);this.objects.push(entry);this.animState.animationsChanged=true};EventQueue.prototype.interrupt=function(entry){this.objects.push(EventType$1.interrupt);this.objects.push(entry)};EventQueue.prototype.end=function(entry){this.objects.push(EventType$1.end);this.objects.push(entry);this.animState.animationsChanged=true};EventQueue.prototype.dispose=function(entry){this.objects.push(EventType$1.dispose);this.objects.push(entry)};EventQueue.prototype.complete=function(entry){this.objects.push(EventType$1.complete);this.objects.push(entry)};EventQueue.prototype.event=function(entry,event){this.objects.push(EventType$1.event);this.objects.push(entry);this.objects.push(event)};EventQueue.prototype.deprecateStuff=function(){if(!EventQueue.deprecatedWarning1){EventQueue.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")}return true};EventQueue.prototype.drain=function(){if(this.drainDisabled)return;this.drainDisabled=true;var objects=this.objects;var listeners=this.animState.listeners;for(var i=0;i<objects.length;i+=2){var type=objects[i];var entry=objects[i+1];switch(type){case EventType$1.start:if(entry.listener!=null&&entry.listener.start)entry.listener.start(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].start)listeners[ii].start(entry);entry.onStart&&this.deprecateStuff()&&entry.onStart(entry.trackIndex);this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(entry.trackIndex);break;case EventType$1.interrupt:if(entry.listener!=null&&entry.listener.interrupt)entry.listener.interrupt(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].interrupt)listeners[ii].interrupt(entry);break;case EventType$1.end:if(entry.listener!=null&&entry.listener.end)entry.listener.end(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].end)listeners[ii].end(entry);entry.onEnd&&this.deprecateStuff()&&entry.onEnd(entry.trackIndex);this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(entry.trackIndex);case EventType$1.dispose:if(entry.listener!=null&&entry.listener.dispose)entry.listener.dispose(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].dispose)listeners[ii].dispose(entry);this.animState.trackEntryPool.free(entry);break;case EventType$1.complete:if(entry.listener!=null&&entry.listener.complete)entry.listener.complete(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].complete)listeners[ii].complete(entry);var count=MathUtils.toInt(entry.loopsCount());entry.onComplete&&this.deprecateStuff()&&entry.onComplete(entry.trackIndex,count);this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(entry.trackIndex,count);break;case EventType$1.event:var event_3=objects[i+++2];if(entry.listener!=null&&entry.listener.event)entry.listener.event(entry,event_3);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].event)listeners[ii].event(entry,event_3);entry.onEvent&&this.deprecateStuff()&&entry.onEvent(entry.trackIndex,event_3);this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(entry.trackIndex,event_3);break}}this.clear();this.drainDisabled=false};EventQueue.prototype.clear=function(){this.objects.length=0};EventQueue.deprecatedWarning1=false;return EventQueue}();var EventType$1;(function(EventType){EventType[EventType["start"]=0]="start";EventType[EventType["interrupt"]=1]="interrupt";EventType[EventType["end"]=2]="end";EventType[EventType["dispose"]=3]="dispose";EventType[EventType["complete"]=4]="complete";EventType[EventType["event"]=5]="event"})(EventType$1||(EventType$1={}));var AnimationStateAdapter2=function(){function AnimationStateAdapter2(){}AnimationStateAdapter2.prototype.start=function(entry){};AnimationStateAdapter2.prototype.interrupt=function(entry){};AnimationStateAdapter2.prototype.end=function(entry){};AnimationStateAdapter2.prototype.dispose=function(entry){};AnimationStateAdapter2.prototype.complete=function(entry){};AnimationStateAdapter2.prototype.event=function(entry,event){};return AnimationStateAdapter2}();var AnimationStateData$1=function(){function AnimationStateData(skeletonData){this.animationToMixTime={};this.defaultMix=0;if(skeletonData==null)throw new Error("skeletonData cannot be null.");this.skeletonData=skeletonData}AnimationStateData.prototype.setMix=function(fromName,toName,duration){var from=this.skeletonData.findAnimation(fromName);if(from==null)throw new Error("Animation not found: "+fromName);var to=this.skeletonData.findAnimation(toName);if(to==null)throw new Error("Animation not found: "+toName);this.setMixWith(from,to,duration)};AnimationStateData.prototype.setMixByName=function(fromName,toName,duration){if(!AnimationStateData.deprecatedWarning1){AnimationStateData.deprecatedWarning1=true;console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")}this.setMix(fromName,toName,duration)};AnimationStateData.prototype.setMixWith=function(from,to,duration){if(from==null)throw new Error("from cannot be null.");if(to==null)throw new Error("to cannot be null.");var key=from.name+"."+to.name;this.animationToMixTime[key]=duration};AnimationStateData.prototype.getMix=function(from,to){var key=from.name+"."+to.name;var value=this.animationToMixTime[key];return value===undefined?this.defaultMix:value};AnimationStateData.deprecatedWarning1=false;return AnimationStateData}();var AtlasAttachmentLoader$1=function(){function AtlasAttachmentLoader(atlas){this.atlas=atlas}AtlasAttachmentLoader.prototype.newRegionAttachment=function(skin,name,path){var region=this.atlas.findRegion(path);if(region==null)throw new Error("Region not found in atlas: "+path+" (region attachment: "+name+")");var attachment=new RegionAttachment$1(name);attachment.region=region;return attachment};AtlasAttachmentLoader.prototype.newMeshAttachment=function(skin,name,path){var region=this.atlas.findRegion(path);if(region==null)throw new Error("Region not found in atlas: "+path+" (mesh attachment: "+name+")");var attachment=new MeshAttachment$1(name);attachment.region=region;return attachment};AtlasAttachmentLoader.prototype.newBoundingBoxAttachment=function(skin,name){return new BoundingBoxAttachment$1(name)};AtlasAttachmentLoader.prototype.newPathAttachment=function(skin,name){return new PathAttachment$1(name)};AtlasAttachmentLoader.prototype.newPointAttachment=function(skin,name){return new PointAttachment$1(name)};AtlasAttachmentLoader.prototype.newClippingAttachment=function(skin,name){return new ClippingAttachment$1(name)};return AtlasAttachmentLoader}();var BoneData$1=function(){function BoneData(index,name,parent){this.x=0;this.y=0;this.rotation=0;this.scaleX=1;this.scaleY=1;this.shearX=0;this.shearY=0;this.transformMode=TransformMode$1.Normal;if(index<0)throw new Error("index must be >= 0.");if(name==null)throw new Error("name cannot be null.");this.index=index;this.name=name;this.parent=parent}return BoneData}();var TransformMode$1;(function(TransformMode){TransformMode[TransformMode["Normal"]=0]="Normal";TransformMode[TransformMode["OnlyTranslation"]=1]="OnlyTranslation";TransformMode[TransformMode["NoRotationOrReflection"]=2]="NoRotationOrReflection";TransformMode[TransformMode["NoScale"]=3]="NoScale";TransformMode[TransformMode["NoScaleOrReflection"]=4]="NoScaleOrReflection"})(TransformMode$1||(TransformMode$1={}));var Bone$1=function(){function Bone(data,skeleton,parent){this.matrix=new math.Matrix;this.children=new Array;this.x=0;this.y=0;this.rotation=0;this.scaleX=0;this.scaleY=0;this.shearX=0;this.shearY=0;this.ax=0;this.ay=0;this.arotation=0;this.ascaleX=0;this.ascaleY=0;this.ashearX=0;this.ashearY=0;this.appliedValid=false;this.sorted=false;if(data==null)throw new Error("data cannot be null.");if(skeleton==null)throw new Error("skeleton cannot be null.");this.data=data;this.skeleton=skeleton;this.parent=parent;this.setToSetupPose()}Object.defineProperty(Bone.prototype,"worldX",{get:function(){return this.matrix.tx},enumerable:false,configurable:true});Object.defineProperty(Bone.prototype,"worldY",{get:function(){return this.matrix.ty},enumerable:false,configurable:true});Bone.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)};Bone.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)};Bone.prototype.updateWorldTransformWith=function(x,y,rotation,scaleX,scaleY,shearX,shearY){this.ax=x;this.ay=y;this.arotation=rotation;this.ascaleX=scaleX;this.ascaleY=scaleY;this.ashearX=shearX;this.ashearY=shearY;this.appliedValid=true;var parent=this.parent;var m=this.matrix;var sx=this.skeleton.scaleX;var sy=settings.yDown?-this.skeleton.scaleY:this.skeleton.scaleY;if(parent==null){var skeleton=this.skeleton;var rotationY=rotation+90+shearY;m.a=MathUtils.cosDeg(rotation+shearX)*scaleX*sx;m.c=MathUtils.cosDeg(rotationY)*scaleY*sx;m.b=MathUtils.sinDeg(rotation+shearX)*scaleX*sy;m.d=MathUtils.sinDeg(rotationY)*scaleY*sy;m.tx=x*sx+skeleton.x;m.ty=y*sy+skeleton.y;return}var pa=parent.matrix.a,pb=parent.matrix.c,pc=parent.matrix.b,pd=parent.matrix.d;m.tx=pa*x+pb*y+parent.matrix.tx;m.ty=pc*x+pd*y+parent.matrix.ty;switch(this.data.transformMode){case TransformMode$1.Normal:{var rotationY=rotation+90+shearY;var la=MathUtils.cosDeg(rotation+shearX)*scaleX;var lb=MathUtils.cosDeg(rotationY)*scaleY;var lc=MathUtils.sinDeg(rotation+shearX)*scaleX;var ld=MathUtils.sinDeg(rotationY)*scaleY;m.a=pa*la+pb*lc;m.c=pa*lb+pb*ld;m.b=pc*la+pd*lc;m.d=pc*lb+pd*ld;return}case TransformMode$1.OnlyTranslation:{var rotationY=rotation+90+shearY;m.a=MathUtils.cosDeg(rotation+shearX)*scaleX;m.c=MathUtils.cosDeg(rotationY)*scaleY;m.b=MathUtils.sinDeg(rotation+shearX)*scaleX;m.d=MathUtils.sinDeg(rotationY)*scaleY;break}case TransformMode$1.NoRotationOrReflection:{var s=pa*pa+pc*pc;var prx=0;if(s>1e-4){s=Math.abs(pa*pd-pb*pc)/s;pb=pc*s;pd=pa*s;prx=Math.atan2(pc,pa)*MathUtils.radDeg}else{pa=0;pc=0;prx=90-Math.atan2(pd,pb)*MathUtils.radDeg}var rx=rotation+shearX-prx;var ry=rotation+shearY-prx+90;var la=MathUtils.cosDeg(rx)*scaleX;var lb=MathUtils.cosDeg(ry)*scaleY;var lc=MathUtils.sinDeg(rx)*scaleX;var ld=MathUtils.sinDeg(ry)*scaleY;m.a=pa*la-pb*lc;m.c=pa*lb-pb*ld;m.b=pc*la+pd*lc;m.d=pc*lb+pd*ld;break}case TransformMode$1.NoScale:case TransformMode$1.NoScaleOrReflection:{var cos=MathUtils.cosDeg(rotation);var sin=MathUtils.sinDeg(rotation);var za=(pa*cos+pb*sin)/sx;var zc=(pc*cos+pd*sin)/sy;var s=Math.sqrt(za*za+zc*zc);if(s>1e-5)s=1/s;za*=s;zc*=s;s=Math.sqrt(za*za+zc*zc);if(this.data.transformMode==TransformMode$1.NoScale&&pa*pd-pb*pc<0!=(settings.yDown?this.skeleton.scaleX<0!=this.skeleton.scaleY>0:this.skeleton.scaleX<0!=this.skeleton.scaleY<0))s=-s;var r=Math.PI/2+Math.atan2(zc,za);var zb=Math.cos(r)*s;var zd=Math.sin(r)*s;var la=MathUtils.cosDeg(shearX)*scaleX;var lb=MathUtils.cosDeg(90+shearY)*scaleY;var lc=MathUtils.sinDeg(shearX)*scaleX;var ld=MathUtils.sinDeg(90+shearY)*scaleY;m.a=za*la+zb*lc;m.c=za*lb+zb*ld;m.b=zc*la+zd*lc;m.d=zc*lb+zd*ld;break}}m.a*=sx;m.c*=sx;m.b*=sy;m.d*=sy};Bone.prototype.setToSetupPose=function(){var data=this.data;this.x=data.x;this.y=data.y;this.rotation=data.rotation;this.scaleX=data.scaleX;this.scaleY=data.scaleY;this.shearX=data.shearX;this.shearY=data.shearY};Bone.prototype.getWorldRotationX=function(){return Math.atan2(this.matrix.b,this.matrix.a)*MathUtils.radDeg};Bone.prototype.getWorldRotationY=function(){return Math.atan2(this.matrix.d,this.matrix.c)*MathUtils.radDeg};Bone.prototype.getWorldScaleX=function(){var m=this.matrix;return Math.sqrt(m.a*m.a+m.c*m.c)};Bone.prototype.getWorldScaleY=function(){var m=this.matrix;return Math.sqrt(m.b*m.b+m.d*m.d)};Bone.prototype.updateAppliedTransform=function(){this.appliedValid=true;var parent=this.parent;var m=this.matrix;if(parent==null){this.ax=m.tx;this.ay=m.ty;this.arotation=Math.atan2(m.b,m.a)*MathUtils.radDeg;this.ascaleX=Math.sqrt(m.a*m.a+m.b*m.b);this.ascaleY=Math.sqrt(m.c*m.c+m.d*m.d);this.ashearX=0;this.ashearY=Math.atan2(m.a*m.c+m.b*m.d,m.a*m.d-m.b*m.c)*MathUtils.radDeg;return}var pm=parent.matrix;var pid=1/(pm.a*pm.d-pm.b*pm.c);var dx=m.tx-pm.tx,dy=m.ty-pm.ty;this.ax=dx*pm.d*pid-dy*pm.c*pid;this.ay=dy*pm.a*pid-dx*pm.b*pid;var ia=pid*pm.d;var id=pid*pm.a;var ib=pid*pm.c;var ic=pid*pm.b;var ra=ia*m.a-ib*m.b;var rb=ia*m.c-ib*m.d;var rc=id*m.b-ic*m.a;var rd=id*m.d-ic*m.c;this.ashearX=0;this.ascaleX=Math.sqrt(ra*ra+rc*rc);if(this.ascaleX>1e-4){var det=ra*rd-rb*rc;this.ascaleY=det/this.ascaleX;this.ashearY=Math.atan2(ra*rb+rc*rd,det)*MathUtils.radDeg;this.arotation=Math.atan2(rc,ra)*MathUtils.radDeg}else{this.ascaleX=0;this.ascaleY=Math.sqrt(rb*rb+rd*rd);this.ashearY=0;this.arotation=90-Math.atan2(rd,rb)*MathUtils.radDeg}};Bone.prototype.worldToLocal=function(world){var m=this.matrix;var a=m.a,b=m.c,c=m.b,d=m.d;var invDet=1/(a*d-b*c);var x=world.x-m.tx,y=world.y-m.ty;world.x=x*d*invDet-y*b*invDet;world.y=y*a*invDet-x*c*invDet;return world};Bone.prototype.localToWorld=function(local){var m=this.matrix;var x=local.x,y=local.y;local.x=x*m.a+y*m.c+m.tx;local.y=x*m.b+y*m.d+m.ty;return local};Bone.prototype.worldToLocalRotation=function(worldRotation){var sin=MathUtils.sinDeg(worldRotation),cos=MathUtils.cosDeg(worldRotation);var mat=this.matrix;return Math.atan2(mat.a*sin-mat.b*cos,mat.d*cos-mat.c*sin)*MathUtils.radDeg};Bone.prototype.localToWorldRotation=function(localRotation){var sin=MathUtils.sinDeg(localRotation),cos=MathUtils.cosDeg(localRotation);var mat=this.matrix;return Math.atan2(cos*mat.b+sin*mat.d,cos*mat.a+sin*mat.c)*MathUtils.radDeg};Bone.prototype.rotateWorld=function(degrees){var mat=this.matrix;var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var cos=MathUtils.cosDeg(degrees),sin=MathUtils.sinDeg(degrees);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d;this.appliedValid=false};return Bone}();var Event$1=function(){function Event(time,data){if(data==null)throw new Error("data cannot be null.");this.time=time;this.data=data}return Event}();var EventData$1=function(){function EventData(name){this.name=name}return EventData}();var IkConstraint$1=function(){function IkConstraint(data,skeleton){this.bendDirection=0;this.compress=false;this.stretch=false;this.mix=1;if(data==null)throw new Error("data cannot be null.");if(skeleton==null)throw new Error("skeleton cannot be null.");this.data=data;this.mix=data.mix;this.bendDirection=data.bendDirection;this.compress=data.compress;this.stretch=data.stretch;this.bones=new Array;for(var i=0;i<data.bones.length;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findBone(data.target.name)}IkConstraint.prototype.getOrder=function(){return this.data.order};IkConstraint.prototype.apply=function(){this.update()};IkConstraint.prototype.update=function(){var target=this.target;var bones=this.bones;switch(bones.length){case 1:this.apply1(bones[0],target.worldX,target.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(bones[0],bones[1],target.worldX,target.worldY,this.bendDirection,this.stretch,this.mix);break}};IkConstraint.prototype.apply1=function(bone,targetX,targetY,compress,stretch,uniform,alpha){if(!bone.appliedValid)bone.updateAppliedTransform();var p=bone.parent.matrix;var id=1/(p.a*p.d-p.b*p.c);var x=targetX-p.tx,y=targetY-p.ty;var tx=(x*p.d-y*p.c)*id-bone.ax,ty=(y*p.a-x*p.b)*id-bone.ay;var rotationIK=Math.atan2(ty,tx)*MathUtils.radDeg-bone.ashearX-bone.arotation;if(bone.ascaleX<0)rotationIK+=180;if(rotationIK>180)rotationIK-=360;else if(rotationIK<-180)rotationIK+=360;var sx=bone.ascaleX,sy=bone.ascaleY;if(compress||stretch){var b=bone.data.length*sx,dd=Math.sqrt(tx*tx+ty*ty);if(compress&&dd<b||stretch&&dd>b&&b>1e-4){var s=(dd/b-1)*alpha+1;sx*=s;if(uniform)sy*=s}}bone.updateWorldTransformWith(bone.ax,bone.ay,bone.arotation+rotationIK*alpha,sx,sy,bone.ashearX,bone.ashearY)};IkConstraint.prototype.apply2=function(parent,child,targetX,targetY,bendDir,stretch,alpha){if(alpha==0){child.updateWorldTransform();return}if(!parent.appliedValid)parent.updateAppliedTransform();if(!child.appliedValid)child.updateAppliedTransform();var px=parent.ax,py=parent.ay,psx=parent.ascaleX,sx=psx,psy=parent.ascaleY,csx=child.ascaleX;var pmat=parent.matrix;var os1=0,os2=0,s2=0;if(psx<0){psx=-psx;os1=180;s2=-1}else{os1=0;s2=1}if(psy<0){psy=-psy;s2=-s2}if(csx<0){csx=-csx;os2=180}else os2=0;var cx=child.ax,cy=0,cwx=0,cwy=0,a=pmat.a,b=pmat.c,c=pmat.b,d=pmat.d;var u=Math.abs(psx-psy)<=1e-4;if(!u){cy=0;cwx=a*cx+pmat.tx;cwy=c*cx+pmat.ty}else{cy=child.ay;cwx=a*cx+b*cy+pmat.tx;cwy=c*cx+d*cy+pmat.ty}var pp=parent.parent.matrix;a=pp.a;b=pp.c;c=pp.b;d=pp.d;var id=1/(a*d-b*c),x=targetX-pp.tx,y=targetY-pp.ty;var tx=(x*d-y*b)*id-px,ty=(y*a-x*c)*id-py,dd=tx*tx+ty*ty;x=cwx-pp.tx;y=cwy-pp.ty;var dx=(x*d-y*b)*id-px,dy=(y*a-x*c)*id-py;var l1=Math.sqrt(dx*dx+dy*dy),l2=child.data.length*csx,a1=0,a2=0;outer:if(u){l2*=psx;var cos=(dd-l1*l1-l2*l2)/(2*l1*l2);if(cos<-1)cos=-1;else if(cos>1){cos=1;if(stretch&&l1+l2>1e-4)sx*=(Math.sqrt(dd)/(l1+l2)-1)*alpha+1}a2=Math.acos(cos)*bendDir;a=l1+l2*cos;b=l2*Math.sin(a2);a1=Math.atan2(ty*a-tx*b,tx*a+ty*b)}else{a=psx*l2;b=psy*l2;var aa=a*a,bb=b*b,ta=Math.atan2(ty,tx);c=bb*l1*l1+aa*dd-aa*bb;var c1=-2*bb*l1,c2=bb-aa;d=c1*c1-4*c2*c;if(d>=0){var q=Math.sqrt(d);if(c1<0)q=-q;q=-(c1+q)/2;var r0=q/c2,r1=c/q;var r=Math.abs(r0)<Math.abs(r1)?r0:r1;if(r*r<=dd){y=Math.sqrt(dd-r*r)*bendDir;a1=ta-Math.atan2(y,r);a2=Math.atan2(y/psy,(r-l1)/psx);break outer}}var minAngle=MathUtils.PI,minX=l1-a,minDist=minX*minX,minY=0;var maxAngle=0,maxX=l1+a,maxDist=maxX*maxX,maxY=0;c=-a*l1/(aa-bb);if(c>=-1&&c<=1){c=Math.acos(c);x=a*Math.cos(c)+l1;y=b*Math.sin(c);d=x*x+y*y;if(d<minDist){minAngle=c;minDist=d;minX=x;minY=y}if(d>maxDist){maxAngle=c;maxDist=d;maxX=x;maxY=y}}if(dd<=(minDist+maxDist)/2){a1=ta-Math.atan2(minY*bendDir,minX);a2=minAngle*bendDir}else{a1=ta-Math.atan2(maxY*bendDir,maxX);a2=maxAngle*bendDir}}var os=Math.atan2(cy,cx)*s2;var rotation=parent.arotation;a1=(a1-os)*MathUtils.radDeg+os1-rotation;if(a1>180)a1-=360;else if(a1<-180)a1+=360;parent.updateWorldTransformWith(px,py,rotation+a1*alpha,sx,parent.ascaleY,0,0);rotation=child.arotation;a2=((a2+os)*MathUtils.radDeg-child.ashearX)*s2+os2-rotation;if(a2>180)a2-=360;else if(a2<-180)a2+=360;child.updateWorldTransformWith(cx,cy,rotation+a2*alpha,child.ascaleX,child.ascaleY,child.ashearX,child.ashearY)};return IkConstraint}();var IkConstraintData$1=function(){function IkConstraintData(name){this.order=0;this.bones=new Array;this.bendDirection=1;this.compress=false;this.stretch=false;this.uniform=false;this.mix=1;this.name=name}return IkConstraintData}();var PathConstraintData$1=function(){function PathConstraintData(name){this.order=0;this.bones=new Array;this.name=name}return PathConstraintData}();var PositionMode$1;(function(PositionMode){PositionMode[PositionMode["Fixed"]=0]="Fixed";PositionMode[PositionMode["Percent"]=1]="Percent"})(PositionMode$1||(PositionMode$1={}));var SpacingMode$1;(function(SpacingMode){SpacingMode[SpacingMode["Length"]=0]="Length";SpacingMode[SpacingMode["Fixed"]=1]="Fixed";SpacingMode[SpacingMode["Percent"]=2]="Percent"})(SpacingMode$1||(SpacingMode$1={}));var RotateMode$1;(function(RotateMode){RotateMode[RotateMode["Tangent"]=0]="Tangent";RotateMode[RotateMode["Chain"]=1]="Chain";RotateMode[RotateMode["ChainScale"]=2]="ChainScale"})(RotateMode$1||(RotateMode$1={}));var PathConstraint$1=function(){function PathConstraint(data,skeleton){this.position=0;this.spacing=0;this.rotateMix=0;this.translateMix=0;this.spaces=new Array;this.positions=new Array;this.world=new Array;this.curves=new Array;this.lengths=new Array;this.segments=new Array;if(data==null)throw new Error("data cannot be null.");if(skeleton==null)throw new Error("skeleton cannot be null.");this.data=data;this.bones=new Array;for(var i=0,n=data.bones.length;i<n;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findSlot(data.target.name);this.position=data.position;this.spacing=data.spacing;this.rotateMix=data.rotateMix;this.translateMix=data.translateMix}PathConstraint.prototype.apply=function(){this.update()};PathConstraint.prototype.update=function(){var attachment=this.target.getAttachment();if(!(attachment instanceof PathAttachment$1))return;var rotateMix=this.rotateMix,translateMix=this.translateMix;var translate=translateMix>0,rotate=rotateMix>0;if(!translate&&!rotate)return;var data=this.data;var spacingMode=data.spacingMode;var lengthSpacing=spacingMode==SpacingMode$1.Length;var rotateMode=data.rotateMode;var tangents=rotateMode==RotateMode$1.Tangent,scale=rotateMode==RotateMode$1.ChainScale;var boneCount=this.bones.length,spacesCount=tangents?boneCount:boneCount+1;var bones=this.bones;var spaces=Utils.setArraySize(this.spaces,spacesCount),lengths=null;var spacing=this.spacing;if(scale||lengthSpacing){if(scale)lengths=Utils.setArraySize(this.lengths,boneCount);for(var i=0,n=spacesCount-1;i<n;){var bone=bones[i];var setupLength=bone.data.length;if(setupLength<PathConstraint.epsilon){if(scale)lengths[i]=0;spaces[++i]=0}else{var x=setupLength*bone.matrix.a,y=setupLength*bone.matrix.b;var length_1=Math.sqrt(x*x+y*y);if(scale)lengths[i]=length_1;spaces[++i]=(lengthSpacing?setupLength+spacing:spacing)*length_1/setupLength}}}else{for(var i=1;i<spacesCount;i++)spaces[i]=spacing}var positions=this.computeWorldPositions(attachment,spacesCount,tangents,data.positionMode==PositionMode$1.Percent,spacingMode==SpacingMode$1.Percent);var boneX=positions[0],boneY=positions[1],offsetRotation=data.offsetRotation;var tip=false;if(offsetRotation==0)tip=rotateMode==RotateMode$1.Chain;else{tip=false;var p=this.target.bone.matrix;offsetRotation*=p.a*p.d-p.b*p.c>0?MathUtils.degRad:-MathUtils.degRad}for(var i=0,p=3;i<boneCount;i++,p+=3){var bone=bones[i];var mat=bone.matrix;mat.tx+=(boneX-mat.tx)*translateMix;mat.ty+=(boneY-mat.ty)*translateMix;var x=positions[p],y=positions[p+1],dx=x-boneX,dy=y-boneY;if(scale){var length_2=lengths[i];if(length_2!=0){var s=(Math.sqrt(dx*dx+dy*dy)/length_2-1)*rotateMix+1;mat.a*=s;mat.b*=s}}boneX=x;boneY=y;if(rotate){var a=mat.a,b=mat.c,c=mat.b,d=mat.d,r=0,cos=0,sin=0;if(tangents)r=positions[p-1];else if(spaces[i+1]==0)r=positions[p+2];else r=Math.atan2(dy,dx);r-=Math.atan2(c,a);if(tip){cos=Math.cos(r);sin=Math.sin(r);var length_3=bone.data.length;boneX+=(length_3*(cos*a-sin*c)-dx)*rotateMix;boneY+=(length_3*(sin*a+cos*c)-dy)*rotateMix}else{r+=offsetRotation}if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r*=rotateMix;cos=Math.cos(r);sin=Math.sin(r);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d}bone.appliedValid=false}};PathConstraint.prototype.computeWorldPositions=function(path,spacesCount,tangents,percentPosition,percentSpacing){var target=this.target;var position=this.position;var spaces=this.spaces,out=Utils.setArraySize(this.positions,spacesCount*3+2),world=null;var closed=path.closed;var verticesLength=path.worldVerticesLength,curveCount=verticesLength/6,prevCurve=PathConstraint.NONE;if(!path.constantSpeed){var lengths=path.lengths;curveCount-=closed?1:2;var pathLength_1=lengths[curveCount];if(percentPosition)position*=pathLength_1;if(percentSpacing){for(var i=0;i<spacesCount;i++)spaces[i]*=pathLength_1}world=Utils.setArraySize(this.world,8);for(var i=0,o=0,curve=0;i<spacesCount;i++,o+=3){var space=spaces[i];position+=space;var p=position;if(closed){p%=pathLength_1;if(p<0)p+=pathLength_1;curve=0}else if(p<0){if(prevCurve!=PathConstraint.BEFORE){prevCurve=PathConstraint.BEFORE;path.computeWorldVertices(target,2,4,world,0,2)}this.addBeforePosition(p,world,0,out,o);continue}else if(p>pathLength_1){if(prevCurve!=PathConstraint.AFTER){prevCurve=PathConstraint.AFTER;path.computeWorldVertices(target,verticesLength-6,4,world,0,2)}this.addAfterPosition(p-pathLength_1,world,0,out,o);continue}for(;;curve++){var length_4=lengths[curve];if(p>length_4)continue;if(curve==0)p/=length_4;else{var prev=lengths[curve-1];p=(p-prev)/(length_4-prev)}break}if(curve!=prevCurve){prevCurve=curve;if(closed&&curve==curveCount){path.computeWorldVertices(target,verticesLength-4,4,world,0,2);path.computeWorldVertices(target,0,4,world,4,2)}else path.computeWorldVertices(target,curve*6+2,8,world,0,2)}this.addCurvePosition(p,world[0],world[1],world[2],world[3],world[4],world[5],world[6],world[7],out,o,tangents||i>0&&space==0)}return out}if(closed){verticesLength+=2;world=Utils.setArraySize(this.world,verticesLength);path.computeWorldVertices(target,2,verticesLength-4,world,0,2);path.computeWorldVertices(target,0,2,world,verticesLength-4,2);world[verticesLength-2]=world[0];world[verticesLength-1]=world[1]}else{curveCount--;verticesLength-=4;world=Utils.setArraySize(this.world,verticesLength);path.computeWorldVertices(target,2,verticesLength,world,0,2)}var curves=Utils.setArraySize(this.curves,curveCount);var pathLength=0;var x1=world[0],y1=world[1],cx1=0,cy1=0,cx2=0,cy2=0,x2=0,y2=0;var tmpx=0,tmpy=0,dddfx=0,dddfy=0,ddfx=0,ddfy=0,dfx=0,dfy=0;for(var i=0,w=2;i<curveCount;i++,w+=6){cx1=world[w];cy1=world[w+1];cx2=world[w+2];cy2=world[w+3];x2=world[w+4];y2=world[w+5];tmpx=(x1-cx1*2+cx2)*.1875;tmpy=(y1-cy1*2+cy2)*.1875;dddfx=((cx1-cx2)*3-x1+x2)*.09375;dddfy=((cy1-cy2)*3-y1+y2)*.09375;ddfx=tmpx*2+dddfx;ddfy=tmpy*2+dddfy;dfx=(cx1-x1)*.75+tmpx+dddfx*.16666667;dfy=(cy1-y1)*.75+tmpy+dddfy*.16666667;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx;dfy+=ddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx+dddfx;dfy+=ddfy+dddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);curves[i]=pathLength;x1=x2;y1=y2}if(percentPosition)position*=pathLength;if(percentSpacing){for(var i=0;i<spacesCount;i++)spaces[i]*=pathLength}var segments=this.segments;var curveLength=0;for(var i=0,o=0,curve=0,segment=0;i<spacesCount;i++,o+=3){var space=spaces[i];position+=space;var p=position;if(closed){p%=pathLength;if(p<0)p+=pathLength;curve=0}else if(p<0){this.addBeforePosition(p,world,0,out,o);continue}else if(p>pathLength){this.addAfterPosition(p-pathLength,world,verticesLength-4,out,o);continue}for(;;curve++){var length_5=curves[curve];if(p>length_5)continue;if(curve==0)p/=length_5;else{var prev=curves[curve-1];p=(p-prev)/(length_5-prev)}break}if(curve!=prevCurve){prevCurve=curve;var ii=curve*6;x1=world[ii];y1=world[ii+1];cx1=world[ii+2];cy1=world[ii+3];cx2=world[ii+4];cy2=world[ii+5];x2=world[ii+6];y2=world[ii+7];tmpx=(x1-cx1*2+cx2)*.03;tmpy=(y1-cy1*2+cy2)*.03;dddfx=((cx1-cx2)*3-x1+x2)*.006;dddfy=((cy1-cy2)*3-y1+y2)*.006;ddfx=tmpx*2+dddfx;ddfy=tmpy*2+dddfy;dfx=(cx1-x1)*.3+tmpx+dddfx*.16666667;dfy=(cy1-y1)*.3+tmpy+dddfy*.16666667;curveLength=Math.sqrt(dfx*dfx+dfy*dfy);segments[0]=curveLength;for(ii=1;ii<8;ii++){dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[ii]=curveLength}dfx+=ddfx;dfy+=ddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[8]=curveLength;dfx+=ddfx+dddfx;dfy+=ddfy+dddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[9]=curveLength;segment=0}p*=curveLength;for(;;segment++){var length_6=segments[segment];if(p>length_6)continue;if(segment==0)p/=length_6;else{var prev=segments[segment-1];p=segment+(p-prev)/(length_6-prev)}break}this.addCurvePosition(p*.1,x1,y1,cx1,cy1,cx2,cy2,x2,y2,out,o,tangents||i>0&&space==0)}return out};PathConstraint.prototype.addBeforePosition=function(p,temp,i,out,o){var x1=temp[i],y1=temp[i+1],dx=temp[i+2]-x1,dy=temp[i+3]-y1,r=Math.atan2(dy,dx);out[o]=x1+p*Math.cos(r);out[o+1]=y1+p*Math.sin(r);out[o+2]=r};PathConstraint.prototype.addAfterPosition=function(p,temp,i,out,o){var x1=temp[i+2],y1=temp[i+3],dx=x1-temp[i],dy=y1-temp[i+1],r=Math.atan2(dy,dx);out[o]=x1+p*Math.cos(r);out[o+1]=y1+p*Math.sin(r);out[o+2]=r};PathConstraint.prototype.addCurvePosition=function(p,x1,y1,cx1,cy1,cx2,cy2,x2,y2,out,o,tangents){if(p==0||isNaN(p))p=1e-4;var tt=p*p,ttt=tt*p,u=1-p,uu=u*u,uuu=uu*u;var ut=u*p,ut3=ut*3,uut3=u*ut3,utt3=ut3*p;var x=x1*uuu+cx1*uut3+cx2*utt3+x2*ttt,y=y1*uuu+cy1*uut3+cy2*utt3+y2*ttt;out[o]=x;out[o+1]=y;if(tangents)out[o+2]=Math.atan2(y-(y1*uu+cy1*ut*2+cy2*tt),x-(x1*uu+cx1*ut*2+cx2*tt))};PathConstraint.prototype.getOrder=function(){return this.data.order};PathConstraint.NONE=-1;PathConstraint.BEFORE=-2;PathConstraint.AFTER=-3;PathConstraint.epsilon=1e-5;return PathConstraint}();var Slot$1=function(){function Slot(data,bone){this.attachmentVertices=new Array;if(data==null)throw new Error("data cannot be null.");if(bone==null)throw new Error("bone cannot be null.");this.data=data;this.bone=bone;this.color=new Color;this.darkColor=data.darkColor==null?null:new Color;this.setToSetupPose();this.blendMode=this.data.blendMode}Slot.prototype.getAttachment=function(){return this.attachment};Slot.prototype.setAttachment=function(attachment){if(this.attachment==attachment)return;this.attachment=attachment;this.attachmentTime=this.bone.skeleton.time;this.attachmentVertices.length=0};Slot.prototype.setAttachmentTime=function(time){this.attachmentTime=this.bone.skeleton.time-time};Slot.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime};Slot.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color);if(this.darkColor!=null)this.darkColor.setFromColor(this.data.darkColor);if(this.data.attachmentName==null)this.attachment=null;else{this.attachment=null;this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))}};return Slot}();var TransformConstraint$1=function(){function TransformConstraint(data,skeleton){this.rotateMix=0;this.translateMix=0;this.scaleMix=0;this.shearMix=0;this.temp=new Vector2;if(data==null)throw new Error("data cannot be null.");if(skeleton==null)throw new Error("skeleton cannot be null.");this.data=data;this.rotateMix=data.rotateMix;this.translateMix=data.translateMix;this.scaleMix=data.scaleMix;this.shearMix=data.shearMix;this.bones=new Array;for(var i=0;i<data.bones.length;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findBone(data.target.name)}TransformConstraint.prototype.apply=function(){this.update()};TransformConstraint.prototype.update=function(){if(this.data.local){if(this.data.relative)this.applyRelativeLocal();else this.applyAbsoluteLocal()}else{if(this.data.relative)this.applyRelativeWorld();else this.applyAbsoluteWorld()}};TransformConstraint.prototype.applyAbsoluteWorld=function(){var rotateMix=this.rotateMix,translateMix=this.translateMix,scaleMix=this.scaleMix,shearMix=this.shearMix;var target=this.target;var targetMat=target.matrix;var ta=targetMat.a,tb=targetMat.c,tc=targetMat.b,td=targetMat.d;var degRadReflect=ta*td-tb*tc>0?MathUtils.degRad:-MathUtils.degRad;var offsetRotation=this.data.offsetRotation*degRadReflect;var offsetShearY=this.data.offsetShearY*degRadReflect;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];var modified=false;var mat=bone.matrix;if(rotateMix!=0){var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var r=Math.atan2(tc,ta)-Math.atan2(c,a)+offsetRotation;if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r*=rotateMix;var cos=Math.cos(r),sin=Math.sin(r);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d;modified=true}if(translateMix!=0){var temp=this.temp;target.localToWorld(temp.set(this.data.offsetX,this.data.offsetY));mat.tx+=(temp.x-mat.tx)*translateMix;mat.ty+=(temp.y-mat.ty)*translateMix;modified=true}if(scaleMix>0){var s=Math.sqrt(mat.a*mat.a+mat.b*mat.b);var ts=Math.sqrt(ta*ta+tc*tc);if(s>1e-5)s=(s+(ts-s+this.data.offsetScaleX)*scaleMix)/s;mat.a*=s;mat.b*=s;s=Math.sqrt(mat.c*mat.c+mat.d*mat.d);ts=Math.sqrt(tb*tb+td*td);if(s>1e-5)s=(s+(ts-s+this.data.offsetScaleY)*scaleMix)/s;mat.c*=s;mat.d*=s;modified=true}if(shearMix>0){var b=mat.c,d=mat.d;var by=Math.atan2(d,b);var r=Math.atan2(td,tb)-Math.atan2(tc,ta)-(by-Math.atan2(mat.b,mat.a));if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r=by+(r+offsetShearY)*shearMix;var s=Math.sqrt(b*b+d*d);mat.c=Math.cos(r)*s;mat.d=Math.sin(r)*s;modified=true}if(modified)bone.appliedValid=false}};TransformConstraint.prototype.applyRelativeWorld=function(){var rotateMix=this.rotateMix,translateMix=this.translateMix,scaleMix=this.scaleMix,shearMix=this.shearMix;var target=this.target;var targetMat=target.matrix;var ta=targetMat.a,tb=targetMat.c,tc=targetMat.b,td=targetMat.d;var degRadReflect=ta*td-tb*tc>0?MathUtils.degRad:-MathUtils.degRad;var offsetRotation=this.data.offsetRotation*degRadReflect,offsetShearY=this.data.offsetShearY*degRadReflect;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];var modified=false;var mat=bone.matrix;if(rotateMix!=0){var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var r=Math.atan2(tc,ta)+offsetRotation;if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r*=rotateMix;var cos=Math.cos(r),sin=Math.sin(r);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d;modified=true}if(translateMix!=0){var temp=this.temp;target.localToWorld(temp.set(this.data.offsetX,this.data.offsetY));mat.tx+=temp.x*translateMix;mat.ty+=temp.y*translateMix;modified=true}if(scaleMix>0){var s=(Math.sqrt(ta*ta+tc*tc)-1+this.data.offsetScaleX)*scaleMix+1;mat.a*=s;mat.b*=s;s=(Math.sqrt(tb*tb+td*td)-1+this.data.offsetScaleY)*scaleMix+1;mat.c*=s;mat.d*=s;modified=true}if(shearMix>0){var r=Math.atan2(td,tb)-Math.atan2(tc,ta);if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;var b=mat.c,d=mat.d;r=Math.atan2(d,b)+(r-MathUtils.PI/2+offsetShearY)*shearMix;var s=Math.sqrt(b*b+d*d);mat.c=Math.cos(r)*s;mat.d=Math.sin(r)*s;modified=true}if(modified)bone.appliedValid=false}};TransformConstraint.prototype.applyAbsoluteLocal=function(){var rotateMix=this.rotateMix,translateMix=this.translateMix,scaleMix=this.scaleMix,shearMix=this.shearMix;var target=this.target;if(!target.appliedValid)target.updateAppliedTransform();var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(!bone.appliedValid)bone.updateAppliedTransform();var rotation=bone.arotation;if(rotateMix!=0){var r=target.arotation-rotation+this.data.offsetRotation;r-=(16384-(16384.499999999996-r/360|0))*360;rotation+=r*rotateMix}var x=bone.ax,y=bone.ay;if(translateMix!=0){x+=(target.ax-x+this.data.offsetX)*translateMix;y+=(target.ay-y+this.data.offsetY)*translateMix}var scaleX=bone.ascaleX,scaleY=bone.ascaleY;if(scaleMix>0){if(scaleX>1e-5)scaleX=(scaleX+(target.ascaleX-scaleX+this.data.offsetScaleX)*scaleMix)/scaleX;if(scaleY>1e-5)scaleY=(scaleY+(target.ascaleY-scaleY+this.data.offsetScaleY)*scaleMix)/scaleY}var shearY=bone.ashearY;if(shearMix>0){var r=target.ashearY-shearY+this.data.offsetShearY;r-=(16384-(16384.499999999996-r/360|0))*360;bone.shearY+=r*shearMix}bone.updateWorldTransformWith(x,y,rotation,scaleX,scaleY,bone.ashearX,shearY)}};TransformConstraint.prototype.applyRelativeLocal=function(){var rotateMix=this.rotateMix,translateMix=this.translateMix,scaleMix=this.scaleMix,shearMix=this.shearMix;var target=this.target;if(!target.appliedValid)target.updateAppliedTransform();var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(!bone.appliedValid)bone.updateAppliedTransform();var rotation=bone.arotation;if(rotateMix!=0)rotation+=(target.arotation+this.data.offsetRotation)*rotateMix;var x=bone.ax,y=bone.ay;if(translateMix!=0){x+=(target.ax+this.data.offsetX)*translateMix;y+=(target.ay+this.data.offsetY)*translateMix}var scaleX=bone.ascaleX,scaleY=bone.ascaleY;if(scaleMix>0){if(scaleX>1e-5)scaleX*=(target.ascaleX-1+this.data.offsetScaleX)*scaleMix+1;if(scaleY>1e-5)scaleY*=(target.ascaleY-1+this.data.offsetScaleY)*scaleMix+1}var shearY=bone.ashearY;if(shearMix>0)shearY+=(target.ashearY+this.data.offsetShearY)*shearMix;bone.updateWorldTransformWith(x,y,rotation,scaleX,scaleY,bone.ashearX,shearY)}};TransformConstraint.prototype.getOrder=function(){return this.data.order};return TransformConstraint}();var Skeleton$1=function(){function Skeleton(data){this._updateCache=new Array;this.updateCacheReset=new Array;this.time=0;this.scaleX=1;this.scaleY=1;this.x=0;this.y=0;if(data==null)throw new Error("data cannot be null.");this.data=data;this.bones=new Array;for(var i=0;i<data.bones.length;i++){var boneData=data.bones[i];var bone=void 0;if(boneData.parent==null)bone=new Bone$1(boneData,this,null);else{var parent_1=this.bones[boneData.parent.index];bone=new Bone$1(boneData,this,parent_1);parent_1.children.push(bone)}this.bones.push(bone)}this.slots=new Array;this.drawOrder=new Array;for(var i=0;i<data.slots.length;i++){var slotData=data.slots[i];var bone=this.bones[slotData.boneData.index];var slot=new Slot$1(slotData,bone);this.slots.push(slot);this.drawOrder.push(slot)}this.ikConstraints=new Array;for(var i=0;i<data.ikConstraints.length;i++){var ikConstraintData=data.ikConstraints[i];this.ikConstraints.push(new IkConstraint$1(ikConstraintData,this))}this.transformConstraints=new Array;for(var i=0;i<data.transformConstraints.length;i++){var transformConstraintData=data.transformConstraints[i];this.transformConstraints.push(new TransformConstraint$1(transformConstraintData,this))}this.pathConstraints=new Array;for(var i=0;i<data.pathConstraints.length;i++){var pathConstraintData=data.pathConstraints[i];this.pathConstraints.push(new PathConstraint$1(pathConstraintData,this))}this.color=new Color(1,1,1,1);this.updateCache()}Skeleton.prototype.updateCache=function(){var updateCache=this._updateCache;updateCache.length=0;this.updateCacheReset.length=0;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)bones[i].sorted=false;var ikConstraints=this.ikConstraints;var transformConstraints=this.transformConstraints;var pathConstraints=this.pathConstraints;var ikCount=ikConstraints.length,transformCount=transformConstraints.length,pathCount=pathConstraints.length;var constraintCount=ikCount+transformCount+pathCount;outer:for(var i=0;i<constraintCount;i++){for(var ii=0;ii<ikCount;ii++){var constraint=ikConstraints[ii];if(constraint.data.order==i){this.sortIkConstraint(constraint);continue outer}}for(var ii=0;ii<transformCount;ii++){var constraint=transformConstraints[ii];if(constraint.data.order==i){this.sortTransformConstraint(constraint);continue outer}}for(var ii=0;ii<pathCount;ii++){var constraint=pathConstraints[ii];if(constraint.data.order==i){this.sortPathConstraint(constraint);continue outer}}}for(var i=0,n=bones.length;i<n;i++)this.sortBone(bones[i])};Skeleton.prototype.sortIkConstraint=function(constraint){var target=constraint.target;this.sortBone(target);var constrained=constraint.bones;var parent=constrained[0];this.sortBone(parent);if(constrained.length>1){var child=constrained[constrained.length-1];if(!(this._updateCache.indexOf(child)>-1))this.updateCacheReset.push(child)}this._updateCache.push(constraint);this.sortReset(parent.children);constrained[constrained.length-1].sorted=true};Skeleton.prototype.sortPathConstraint=function(constraint){var slot=constraint.target;var slotIndex=slot.data.index;var slotBone=slot.bone;if(this.skin!=null)this.sortPathConstraintAttachment(this.skin,slotIndex,slotBone);if(this.data.defaultSkin!=null&&this.data.defaultSkin!=this.skin)this.sortPathConstraintAttachment(this.data.defaultSkin,slotIndex,slotBone);for(var i=0,n=this.data.skins.length;i<n;i++)this.sortPathConstraintAttachment(this.data.skins[i],slotIndex,slotBone);var attachment=slot.getAttachment();if(attachment instanceof PathAttachment$1)this.sortPathConstraintAttachmentWith(attachment,slotBone);var constrained=constraint.bones;var boneCount=constrained.length;for(var i=0;i<boneCount;i++)this.sortBone(constrained[i]);this._updateCache.push(constraint);for(var i=0;i<boneCount;i++)this.sortReset(constrained[i].children);for(var i=0;i<boneCount;i++)constrained[i].sorted=true};Skeleton.prototype.sortTransformConstraint=function(constraint){this.sortBone(constraint.target);var constrained=constraint.bones;var boneCount=constrained.length;if(constraint.data.local){for(var i=0;i<boneCount;i++){var child=constrained[i];this.sortBone(child.parent);if(!(this._updateCache.indexOf(child)>-1))this.updateCacheReset.push(child)}}else{for(var i=0;i<boneCount;i++){this.sortBone(constrained[i])}}this._updateCache.push(constraint);for(var ii=0;ii<boneCount;ii++)this.sortReset(constrained[ii].children);for(var ii=0;ii<boneCount;ii++)constrained[ii].sorted=true};Skeleton.prototype.sortPathConstraintAttachment=function(skin,slotIndex,slotBone){var attachments=skin.attachments[slotIndex];if(!attachments)return;for(var key in attachments){this.sortPathConstraintAttachmentWith(attachments[key],slotBone)}};Skeleton.prototype.sortPathConstraintAttachmentWith=function(attachment,slotBone){if(!(attachment instanceof PathAttachment$1))return;var pathBones=attachment.bones;if(pathBones==null)this.sortBone(slotBone);else{var bones=this.bones;var i=0;while(i<pathBones.length){var boneCount=pathBones[i++];for(var n=i+boneCount;i<n;i++){var boneIndex=pathBones[i];this.sortBone(bones[boneIndex])}}}};Skeleton.prototype.sortBone=function(bone){if(bone.sorted)return;var parent=bone.parent;if(parent!=null)this.sortBone(parent);bone.sorted=true;this._updateCache.push(bone)};Skeleton.prototype.sortReset=function(bones){for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(bone.sorted)this.sortReset(bone.children);bone.sorted=false}};Skeleton.prototype.updateWorldTransform=function(){var updateCacheReset=this.updateCacheReset;for(var i=0,n=updateCacheReset.length;i<n;i++){var bone=updateCacheReset[i];bone.ax=bone.x;bone.ay=bone.y;bone.arotation=bone.rotation;bone.ascaleX=bone.scaleX;bone.ascaleY=bone.scaleY;bone.ashearX=bone.shearX;bone.ashearY=bone.shearY;bone.appliedValid=true}var updateCache=this._updateCache;for(var i=0,n=updateCache.length;i<n;i++)updateCache[i].update()};Skeleton.prototype.setToSetupPose=function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()};Skeleton.prototype.setBonesToSetupPose=function(){var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)bones[i].setToSetupPose();var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++){var constraint=ikConstraints[i];constraint.bendDirection=constraint.data.bendDirection;constraint.mix=constraint.data.mix}var transformConstraints=this.transformConstraints;for(var i=0,n=transformConstraints.length;i<n;i++){var constraint=transformConstraints[i];var data=constraint.data;constraint.rotateMix=data.rotateMix;constraint.translateMix=data.translateMix;constraint.scaleMix=data.scaleMix;constraint.shearMix=data.shearMix}var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++){var constraint=pathConstraints[i];var data=constraint.data;constraint.position=data.position;constraint.spacing=data.spacing;constraint.rotateMix=data.rotateMix;constraint.translateMix=data.translateMix}};Skeleton.prototype.setSlotsToSetupPose=function(){var slots=this.slots;Utils.arrayCopy(slots,0,this.drawOrder,0,slots.length);for(var i=0,n=slots.length;i<n;i++)slots[i].setToSetupPose()};Skeleton.prototype.getRootBone=function(){if(this.bones.length==0)return null;return this.bones[0]};Skeleton.prototype.findBone=function(boneName){if(boneName==null)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(bone.data.name==boneName)return bone}return null};Skeleton.prototype.findBoneIndex=function(boneName){if(boneName==null)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)if(bones[i].data.name==boneName)return i;return-1};Skeleton.prototype.findSlot=function(slotName){if(slotName==null)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];if(slot.data.name==slotName)return slot}return null};Skeleton.prototype.findSlotIndex=function(slotName){if(slotName==null)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++)if(slots[i].data.name==slotName)return i;return-1};Skeleton.prototype.setSkinByName=function(skinName){var skin=this.data.findSkin(skinName);if(skin==null)throw new Error("Skin not found: "+skinName);this.setSkin(skin)};Skeleton.prototype.setSkin=function(newSkin){if(newSkin!=null){if(this.skin!=null)newSkin.attachAll(this,this.skin);else{var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];var name_1=slot.data.attachmentName;if(name_1!=null){var attachment=newSkin.getAttachment(i,name_1);if(attachment!=null)slot.setAttachment(attachment)}}}}this.skin=newSkin};Skeleton.prototype.getAttachmentByName=function(slotName,attachmentName){return this.getAttachment(this.data.findSlotIndex(slotName),attachmentName)};Skeleton.prototype.getAttachment=function(slotIndex,attachmentName){if(attachmentName==null)throw new Error("attachmentName cannot be null.");if(this.skin!=null){var attachment=this.skin.getAttachment(slotIndex,attachmentName);if(attachment!=null)return attachment}if(this.data.defaultSkin!=null)return this.data.defaultSkin.getAttachment(slotIndex,attachmentName);return null};Skeleton.prototype.setAttachment=function(slotName,attachmentName){if(slotName==null)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];if(slot.data.name==slotName){var attachment=null;if(attachmentName!=null){attachment=this.getAttachment(i,attachmentName);if(attachment==null)throw new Error("Attachment not found: "+attachmentName+", for slot: "+slotName)}slot.setAttachment(attachment);return}}throw new Error("Slot not found: "+slotName)};Skeleton.prototype.findIkConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++){var ikConstraint=ikConstraints[i];if(ikConstraint.data.name==constraintName)return ikConstraint}return null};Skeleton.prototype.findTransformConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var transformConstraints=this.transformConstraints;for(var i=0,n=transformConstraints.length;i<n;i++){var constraint=transformConstraints[i];if(constraint.data.name==constraintName)return constraint}return null};Skeleton.prototype.findPathConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++){var constraint=pathConstraints[i];if(constraint.data.name==constraintName)return constraint}return null};Skeleton.prototype.getBounds=function(offset,size,temp){if(offset==null)throw new Error("offset cannot be null.");if(size==null)throw new Error("size cannot be null.");var drawOrder=this.drawOrder;var minX=Number.POSITIVE_INFINITY,minY=Number.POSITIVE_INFINITY,maxX=Number.NEGATIVE_INFINITY,maxY=Number.NEGATIVE_INFINITY;for(var i=0,n=drawOrder.length;i<n;i++){var slot=drawOrder[i];var verticesLength=0;var vertices=null;var attachment=slot.getAttachment();if(attachment instanceof RegionAttachment$1){verticesLength=8;vertices=Utils.setArraySize(temp,verticesLength,0);attachment.computeWorldVertices(slot.bone,vertices,0,2)}else if(attachment instanceof MeshAttachment$1){var mesh=attachment;verticesLength=mesh.worldVerticesLength;vertices=Utils.setArraySize(temp,verticesLength,0);mesh.computeWorldVertices(slot,0,verticesLength,vertices,0,2)}if(vertices!=null){for(var ii=0,nn=vertices.length;ii<nn;ii+=2){var x=vertices[ii],y=vertices[ii+1];minX=Math.min(minX,x);minY=Math.min(minY,y);maxX=Math.max(maxX,x);maxY=Math.max(maxY,y)}}}offset.set(minX,minY);size.set(maxX-minX,maxY-minY)};Skeleton.prototype.update=function(delta){this.time+=delta};Object.defineProperty(Skeleton.prototype,"flipX",{get:function(){return this.scaleX==-1},set:function(value){if(!Skeleton.deprecatedWarning1){Skeleton.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")}this.scaleX=value?1:-1},enumerable:false,configurable:true});Object.defineProperty(Skeleton.prototype,"flipY",{get:function(){return this.scaleY==-1},set:function(value){if(!Skeleton.deprecatedWarning1){Skeleton.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")}this.scaleY=value?1:-1},enumerable:false,configurable:true});Skeleton.deprecatedWarning1=false;return Skeleton}();var SkeletonBounds$1=function(){function SkeletonBounds(){this.minX=0;this.minY=0;this.maxX=0;this.maxY=0;this.boundingBoxes=new Array;this.polygons=new Array;this.polygonPool=new Pool(function(){return Utils.newFloatArray(16)})}SkeletonBounds.prototype.update=function(skeleton,updateAabb){if(skeleton==null)throw new Error("skeleton cannot be null.");var boundingBoxes=this.boundingBoxes;var polygons=this.polygons;var polygonPool=this.polygonPool;var slots=skeleton.slots;var slotCount=slots.length;boundingBoxes.length=0;polygonPool.freeAll(polygons);polygons.length=0;for(var i=0;i<slotCount;i++){var slot=slots[i];var attachment=slot.getAttachment();if(attachment instanceof BoundingBoxAttachment$1){var boundingBox=attachment;boundingBoxes.push(boundingBox);var polygon=polygonPool.obtain();if(polygon.length!=boundingBox.worldVerticesLength){polygon=Utils.newFloatArray(boundingBox.worldVerticesLength)}polygons.push(polygon);boundingBox.computeWorldVertices(slot,0,boundingBox.worldVerticesLength,polygon,0,2)}}if(updateAabb){this.aabbCompute()}else{this.minX=Number.POSITIVE_INFINITY;this.minY=Number.POSITIVE_INFINITY;this.maxX=Number.NEGATIVE_INFINITY;this.maxY=Number.NEGATIVE_INFINITY}};SkeletonBounds.prototype.aabbCompute=function(){var minX=Number.POSITIVE_INFINITY,minY=Number.POSITIVE_INFINITY,maxX=Number.NEGATIVE_INFINITY,maxY=Number.NEGATIVE_INFINITY;var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++){var polygon=polygons[i];var vertices=polygon;for(var ii=0,nn=polygon.length;ii<nn;ii+=2){var x=vertices[ii];var y=vertices[ii+1];minX=Math.min(minX,x);minY=Math.min(minY,y);maxX=Math.max(maxX,x);maxY=Math.max(maxY,y)}}this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};SkeletonBounds.prototype.aabbContainsPoint=function(x,y){return x>=this.minX&&x<=this.maxX&&y>=this.minY&&y<=this.maxY};SkeletonBounds.prototype.aabbIntersectsSegment=function(x1,y1,x2,y2){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;if(x1<=minX&&x2<=minX||y1<=minY&&y2<=minY||x1>=maxX&&x2>=maxX||y1>=maxY&&y2>=maxY)return false;var m=(y2-y1)/(x2-x1);var y=m*(minX-x1)+y1;if(y>minY&&y<maxY)return true;y=m*(maxX-x1)+y1;if(y>minY&&y<maxY)return true;var x=(minY-y1)/m+x1;if(x>minX&&x<maxX)return true;x=(maxY-y1)/m+x1;if(x>minX&&x<maxX)return true;return false};SkeletonBounds.prototype.aabbIntersectsSkeleton=function(bounds){return this.minX<bounds.maxX&&this.maxX>bounds.minX&&this.minY<bounds.maxY&&this.maxY>bounds.minY};SkeletonBounds.prototype.containsPoint=function(x,y){var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++)if(this.containsPointPolygon(polygons[i],x,y))return this.boundingBoxes[i];return null};SkeletonBounds.prototype.containsPointPolygon=function(polygon,x,y){var vertices=polygon;var nn=polygon.length;var prevIndex=nn-2;var inside=false;for(var ii=0;ii<nn;ii+=2){var vertexY=vertices[ii+1];var prevY=vertices[prevIndex+1];if(vertexY<y&&prevY>=y||prevY<y&&vertexY>=y){var vertexX=vertices[ii];if(vertexX+(y-vertexY)/(prevY-vertexY)*(vertices[prevIndex]-vertexX)<x)inside=!inside}prevIndex=ii}return inside};SkeletonBounds.prototype.intersectsSegment=function(x1,y1,x2,y2){var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++)if(this.intersectsSegmentPolygon(polygons[i],x1,y1,x2,y2))return this.boundingBoxes[i];return null};SkeletonBounds.prototype.intersectsSegmentPolygon=function(polygon,x1,y1,x2,y2){var vertices=polygon;var nn=polygon.length;var width12=x1-x2,height12=y1-y2;var det1=x1*y2-y1*x2;var x3=vertices[nn-2],y3=vertices[nn-1];for(var ii=0;ii<nn;ii+=2){var x4=vertices[ii],y4=vertices[ii+1];var det2=x3*y4-y3*x4;var width34=x3-x4,height34=y3-y4;var det3=width12*height34-height12*width34;var x=(det1*width34-width12*det2)/det3;if((x>=x3&&x<=x4||x>=x4&&x<=x3)&&(x>=x1&&x<=x2||x>=x2&&x<=x1)){var y=(det1*height34-height12*det2)/det3;if((y>=y3&&y<=y4||y>=y4&&y<=y3)&&(y>=y1&&y<=y2||y>=y2&&y<=y1))return true}x3=x4;y3=y4}return false};SkeletonBounds.prototype.getPolygon=function(boundingBox){if(boundingBox==null)throw new Error("boundingBox cannot be null.");var index=this.boundingBoxes.indexOf(boundingBox);return index==-1?null:this.polygons[index]};SkeletonBounds.prototype.getWidth=function(){return this.maxX-this.minX};SkeletonBounds.prototype.getHeight=function(){return this.maxY-this.minY};return SkeletonBounds}();var SkeletonData$1=function(){function SkeletonData(){this.bones=new Array;this.slots=new Array;this.skins=new Array;this.events=new Array;this.animations=new Array;this.ikConstraints=new Array;this.transformConstraints=new Array;this.pathConstraints=new Array;this.fps=0}SkeletonData.prototype.findBone=function(boneName){if(boneName==null)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(bone.name==boneName)return bone}return null};SkeletonData.prototype.findBoneIndex=function(boneName){if(boneName==null)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)if(bones[i].name==boneName)return i;return-1};SkeletonData.prototype.findSlot=function(slotName){if(slotName==null)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];if(slot.name==slotName)return slot}return null};SkeletonData.prototype.findSlotIndex=function(slotName){if(slotName==null)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++)if(slots[i].name==slotName)return i;return-1};SkeletonData.prototype.findSkin=function(skinName){if(skinName==null)throw new Error("skinName cannot be null.");var skins=this.skins;for(var i=0,n=skins.length;i<n;i++){var skin=skins[i];if(skin.name==skinName)return skin}return null};SkeletonData.prototype.findEvent=function(eventDataName){if(eventDataName==null)throw new Error("eventDataName cannot be null.");var events=this.events;for(var i=0,n=events.length;i<n;i++){var event_1=events[i];if(event_1.name==eventDataName)return event_1}return null};SkeletonData.prototype.findAnimation=function(animationName){if(animationName==null)throw new Error("animationName cannot be null.");var animations=this.animations;for(var i=0,n=animations.length;i<n;i++){var animation=animations[i];if(animation.name==animationName)return animation}return null};SkeletonData.prototype.findIkConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++){var constraint=ikConstraints[i];if(constraint.name==constraintName)return constraint}return null};SkeletonData.prototype.findTransformConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var transformConstraints=this.transformConstraints;for(var i=0,n=transformConstraints.length;i<n;i++){var constraint=transformConstraints[i];if(constraint.name==constraintName)return constraint}return null};SkeletonData.prototype.findPathConstraint=function(constraintName){if(constraintName==null)throw new Error("constraintName cannot be null.");var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++){var constraint=pathConstraints[i];if(constraint.name==constraintName)return constraint}return null};SkeletonData.prototype.findPathConstraintIndex=function(pathConstraintName){if(pathConstraintName==null)throw new Error("pathConstraintName cannot be null.");var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++)if(pathConstraints[i].name==pathConstraintName)return i;return-1};return SkeletonData}();var SlotData$1=function(){function SlotData(index,name,boneData){this.color=new Color(1,1,1,1);if(index<0)throw new Error("index must be >= 0.");if(name==null)throw new Error("name cannot be null.");if(boneData==null)throw new Error("boneData cannot be null.");this.index=index;this.name=name;this.boneData=boneData}return SlotData}();var TransformConstraintData$1=function(){function TransformConstraintData(name){this.order=0;this.bones=new Array;this.rotateMix=0;this.translateMix=0;this.scaleMix=0;this.shearMix=0;this.offsetRotation=0;this.offsetX=0;this.offsetY=0;this.offsetScaleX=0;this.offsetScaleY=0;this.offsetShearY=0;this.relative=false;this.local=false;if(name==null)throw new Error("name cannot be null.");this.name=name}return TransformConstraintData}();var Skin$1=function(){function Skin(name){this.attachments=new Array;if(name==null)throw new Error("name cannot be null.");this.name=name}Skin.prototype.addAttachment=function(slotIndex,name,attachment){if(attachment==null)throw new Error("attachment cannot be null.");var attachments=this.attachments;if(slotIndex>=attachments.length)attachments.length=slotIndex+1;if(!attachments[slotIndex])attachments[slotIndex]={};attachments[slotIndex][name]=attachment};Skin.prototype.getAttachment=function(slotIndex,name){var dictionary=this.attachments[slotIndex];return dictionary?dictionary[name]:null};Skin.prototype.attachAll=function(skeleton,oldSkin){var slotIndex=0;for(var i=0;i<skeleton.slots.length;i++){var slot=skeleton.slots[i];var slotAttachment=slot.getAttachment();if(slotAttachment&&slotIndex<oldSkin.attachments.length){var dictionary=oldSkin.attachments[slotIndex];for(var key in dictionary){var skinAttachment=dictionary[key];if(slotAttachment==skinAttachment){var attachment=this.getAttachment(slotIndex,key);if(attachment!=null)slot.setAttachment(attachment);break}}}slotIndex++}};return Skin}();var SkeletonJson$1=function(){function SkeletonJson(attachmentLoader){this.scale=1;this.linkedMeshes=new Array;this.attachmentLoader=attachmentLoader}SkeletonJson.prototype.readSkeletonData=function(json){var scale=this.scale;var skeletonData=new SkeletonData$1;var root=typeof json==="string"?JSON.parse(json):json;var skeletonMap=root.skeleton;if(skeletonMap!=null){skeletonData.hash=skeletonMap.hash;skeletonData.version=skeletonMap.spine;skeletonData.width=skeletonMap.width;skeletonData.height=skeletonMap.height;skeletonData.fps=skeletonMap.fps;skeletonData.imagesPath=skeletonMap.images}if(root.bones){for(var i=0;i<root.bones.length;i++){var boneMap=root.bones[i];var parent_1=null;var parentName=this.getValue(boneMap,"parent",null);if(parentName!=null){parent_1=skeletonData.findBone(parentName);if(parent_1==null)throw new Error("Parent bone not found: "+parentName)}var data=new BoneData$1(skeletonData.bones.length,boneMap.name,parent_1);data.length=this.getValue(boneMap,"length",0)*scale;data.x=this.getValue(boneMap,"x",0)*scale;data.y=this.getValue(boneMap,"y",0)*scale;data.rotation=this.getValue(boneMap,"rotation",0);data.scaleX=this.getValue(boneMap,"scaleX",1);data.scaleY=this.getValue(boneMap,"scaleY",1);data.shearX=this.getValue(boneMap,"shearX",0);data.shearY=this.getValue(boneMap,"shearY",0);data.transformMode=SkeletonJson.transformModeFromString(this.getValue(boneMap,"transform","normal"));skeletonData.bones.push(data)}}if(root.slots){for(var i=0;i<root.slots.length;i++){var slotMap=root.slots[i];var slotName=slotMap.name;var boneName=slotMap.bone;var boneData=skeletonData.findBone(boneName);if(boneData==null)throw new Error("Slot bone not found: "+boneName);var data=new SlotData$1(skeletonData.slots.length,slotName,boneData);var color=this.getValue(slotMap,"color",null);if(color!=null)data.color.setFromString(color);var dark=this.getValue(slotMap,"dark",null);if(dark!=null){data.darkColor=new Color(1,1,1,1);data.darkColor.setFromString(dark)}data.attachmentName=this.getValue(slotMap,"attachment",null);data.blendMode=SkeletonJson.blendModeFromString(this.getValue(slotMap,"blend","normal"));skeletonData.slots.push(data)}}if(root.ik){for(var i=0;i<root.ik.length;i++){var constraintMap=root.ik[i];var data=new IkConstraintData$1(constraintMap.name);data.order=this.getValue(constraintMap,"order",0);for(var j=0;j<constraintMap.bones.length;j++){var boneName=constraintMap.bones[j];var bone=skeletonData.findBone(boneName);if(bone==null)throw new Error("IK bone not found: "+boneName);data.bones.push(bone)}var targetName=constraintMap.target;data.target=skeletonData.findBone(targetName);if(data.target==null)throw new Error("IK target bone not found: "+targetName);data.bendDirection=this.getValue(constraintMap,"bendPositive",true)?1:-1;data.mix=this.getValue(constraintMap,"mix",1);skeletonData.ikConstraints.push(data)}}if(root.transform){for(var i=0;i<root.transform.length;i++){var constraintMap=root.transform[i];var data=new TransformConstraintData$1(constraintMap.name);data.order=this.getValue(constraintMap,"order",0);for(var j=0;j<constraintMap.bones.length;j++){var boneName=constraintMap.bones[j];var bone=skeletonData.findBone(boneName);if(bone==null)throw new Error("Transform constraint bone not found: "+boneName);data.bones.push(bone)}var targetName=constraintMap.target;data.target=skeletonData.findBone(targetName);if(data.target==null)throw new Error("Transform constraint target bone not found: "+targetName);data.local=this.getValue(constraintMap,"local",false);data.relative=this.getValue(constraintMap,"relative",false);data.offsetRotation=this.getValue(constraintMap,"rotation",0);data.offsetX=this.getValue(constraintMap,"x",0)*scale;data.offsetY=this.getValue(constraintMap,"y",0)*scale;data.offsetScaleX=this.getValue(constraintMap,"scaleX",0);data.offsetScaleY=this.getValue(constraintMap,"scaleY",0);data.offsetShearY=this.getValue(constraintMap,"shearY",0);data.rotateMix=this.getValue(constraintMap,"rotateMix",1);data.translateMix=this.getValue(constraintMap,"translateMix",1);data.scaleMix=this.getValue(constraintMap,"scaleMix",1);data.shearMix=this.getValue(constraintMap,"shearMix",1);skeletonData.transformConstraints.push(data)}}if(root.path){for(var i=0;i<root.path.length;i++){var constraintMap=root.path[i];var data=new PathConstraintData$1(constraintMap.name);data.order=this.getValue(constraintMap,"order",0);for(var j=0;j<constraintMap.bones.length;j++){var boneName=constraintMap.bones[j];var bone=skeletonData.findBone(boneName);if(bone==null)throw new Error("Transform constraint bone not found: "+boneName);data.bones.push(bone)}var targetName=constraintMap.target;data.target=skeletonData.findSlot(targetName);if(data.target==null)throw new Error("Path target slot not found: "+targetName);data.positionMode=SkeletonJson.positionModeFromString(this.getValue(constraintMap,"positionMode","percent"));data.spacingMode=SkeletonJson.spacingModeFromString(this.getValue(constraintMap,"spacingMode","length"));data.rotateMode=SkeletonJson.rotateModeFromString(this.getValue(constraintMap,"rotateMode","tangent"));data.offsetRotation=this.getValue(constraintMap,"rotation",0);data.position=this.getValue(constraintMap,"position",0);if(data.positionMode==PositionMode$1.Fixed)data.position*=scale;data.spacing=this.getValue(constraintMap,"spacing",0);if(data.spacingMode==SpacingMode$1.Length||data.spacingMode==SpacingMode$1.Fixed)data.spacing*=scale;data.rotateMix=this.getValue(constraintMap,"rotateMix",1);data.translateMix=this.getValue(constraintMap,"translateMix",1);skeletonData.pathConstraints.push(data)}}if(root.skins){for(var skinName in root.skins){var skinMap=root.skins[skinName];var skin=new Skin$1(skinName);for(var slotName in skinMap){var slotIndex=skeletonData.findSlotIndex(slotName);if(slotIndex==-1)throw new Error("Slot not found: "+slotName);var slotMap=skinMap[slotName];for(var entryName in slotMap){var attachment=this.readAttachment(slotMap[entryName],skin,slotIndex,entryName,skeletonData);if(attachment!=null)skin.addAttachment(slotIndex,entryName,attachment)}}skeletonData.skins.push(skin);if(skin.name=="default")skeletonData.defaultSkin=skin}}for(var i=0,n=this.linkedMeshes.length;i<n;i++){var linkedMesh=this.linkedMeshes[i];var skin=linkedMesh.skin==null?skeletonData.defaultSkin:skeletonData.findSkin(linkedMesh.skin);if(skin==null)throw new Error("Skin not found: "+linkedMesh.skin);var parent_2=skin.getAttachment(linkedMesh.slotIndex,linkedMesh.parent);if(parent_2==null)throw new Error("Parent mesh not found: "+linkedMesh.parent);linkedMesh.mesh.setParentMesh(parent_2)}this.linkedMeshes.length=0;if(root.events){for(var eventName in root.events){var eventMap=root.events[eventName];var data=new EventData$1(eventName);data.intValue=this.getValue(eventMap,"int",0);data.floatValue=this.getValue(eventMap,"float",0);data.stringValue=this.getValue(eventMap,"string","");data.audioPath=this.getValue(eventMap,"audio",null);if(data.audioPath!=null){data.volume=this.getValue(eventMap,"volume",1);data.balance=this.getValue(eventMap,"balance",0)}skeletonData.events.push(data)}}if(root.animations){for(var animationName in root.animations){var animationMap=root.animations[animationName];this.readAnimation(animationMap,animationName,skeletonData)}}return skeletonData};SkeletonJson.prototype.readAttachment=function(map,skin,slotIndex,name,skeletonData){var scale=this.scale;name=this.getValue(map,"name",name);var type=this.getValue(map,"type","region");switch(type){case"region":{var path=this.getValue(map,"path",name);var region=this.attachmentLoader.newRegionAttachment(skin,name,path);if(region==null)return null;region.path=path;region.x=this.getValue(map,"x",0)*scale;region.y=this.getValue(map,"y",0)*scale;region.scaleX=this.getValue(map,"scaleX",1);region.scaleY=this.getValue(map,"scaleY",1);region.rotation=this.getValue(map,"rotation",0);region.width=map.width*scale;region.height=map.height*scale;var color=this.getValue(map,"color",null);if(color!=null)region.color.setFromString(color);return region}case"boundingbox":{var box=this.attachmentLoader.newBoundingBoxAttachment(skin,name);if(box==null)return null;this.readVertices(map,box,map.vertexCount<<1);var color=this.getValue(map,"color",null);if(color!=null)box.color.setFromString(color);return box}case"mesh":case"linkedmesh":{var path=this.getValue(map,"path",name);var mesh=this.attachmentLoader.newMeshAttachment(skin,name,path);if(mesh==null)return null;mesh.path=path;var color=this.getValue(map,"color",null);if(color!=null)mesh.color.setFromString(color);var parent_3=this.getValue(map,"parent",null);if(parent_3!=null){mesh.inheritDeform=this.getValue(map,"deform",true);this.linkedMeshes.push(new LinkedMesh$2(mesh,this.getValue(map,"skin",null),slotIndex,parent_3));return mesh}var uvs=map.uvs;this.readVertices(map,mesh,uvs.length);mesh.triangles=map.triangles;mesh.regionUVs=new Float32Array(uvs);mesh.hullLength=this.getValue(map,"hull",0)*2;return mesh}case"path":{var path=this.attachmentLoader.newPathAttachment(skin,name);if(path==null)return null;path.closed=this.getValue(map,"closed",false);path.constantSpeed=this.getValue(map,"constantSpeed",true);var vertexCount=map.vertexCount;this.readVertices(map,path,vertexCount<<1);var lengths=Utils.newArray(vertexCount/3,0);for(var i=0;i<map.lengths.length;i++)lengths[i]=map.lengths[i]*scale;path.lengths=lengths;var color=this.getValue(map,"color",null);if(color!=null)path.color.setFromString(color);return path}case"point":{var point=this.attachmentLoader.newPointAttachment(skin,name);if(point==null)return null;point.x=this.getValue(map,"x",0)*scale;point.y=this.getValue(map,"y",0)*scale;point.rotation=this.getValue(map,"rotation",0);var color=this.getValue(map,"color",null);if(color!=null)point.color.setFromString(color);return point}case"clipping":{var clip=this.attachmentLoader.newClippingAttachment(skin,name);if(clip==null)return null;var end=this.getValue(map,"end",null);if(end!=null){var slot=skeletonData.findSlot(end);if(slot==null)throw new Error("Clipping end slot not found: "+end);clip.endSlot=slot}var vertexCount=map.vertexCount;this.readVertices(map,clip,vertexCount<<1);var color=this.getValue(map,"color",null);if(color!=null)clip.color.setFromString(color);return clip}}return null};SkeletonJson.prototype.readVertices=function(map,attachment,verticesLength){var scale=this.scale;attachment.worldVerticesLength=verticesLength;var vertices=map.vertices;if(verticesLength==vertices.length){var scaledVertices=Utils.toFloatArray(vertices);if(scale!=1){for(var i=0,n=vertices.length;i<n;i++)scaledVertices[i]*=scale}attachment.vertices=scaledVertices;return}var weights=new Array;var bones=new Array;for(var i=0,n=vertices.length;i<n;){var boneCount=vertices[i++];bones.push(boneCount);for(var nn=i+boneCount*4;i<nn;i+=4){bones.push(vertices[i]);weights.push(vertices[i+1]*scale);weights.push(vertices[i+2]*scale);weights.push(vertices[i+3])}}attachment.bones=bones;attachment.vertices=Utils.toFloatArray(weights)};SkeletonJson.prototype.readAnimation=function(map,name,skeletonData){var scale=this.scale;var timelines=new Array;var duration=0;if(map.slots){for(var slotName in map.slots){var slotMap=map.slots[slotName];var slotIndex=skeletonData.findSlotIndex(slotName);if(slotIndex==-1)throw new Error("Slot not found: "+slotName);for(var timelineName in slotMap){var timelineMap=slotMap[timelineName];if(timelineName=="attachment"){var timeline=new AttachmentTimeline$1(timelineMap.length);timeline.slotIndex=slotIndex;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];timeline.setFrame(frameIndex++,valueMap.time,valueMap.name)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}else if(timelineName=="color"){var timeline=new ColorTimeline(timelineMap.length);timeline.slotIndex=slotIndex;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];var color=new Color;color.setFromString(valueMap.color||"ffffffff");timeline.setFrame(frameIndex,valueMap.time,color.r,color.g,color.b,color.a);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*ColorTimeline.ENTRIES])}else if(timelineName=="twoColor"){var timeline=new TwoColorTimeline(timelineMap.length);timeline.slotIndex=slotIndex;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];var light=new Color;var dark=new Color;light.setFromString(valueMap.light);dark.setFromString(valueMap.dark);timeline.setFrame(frameIndex,valueMap.time,light.r,light.g,light.b,light.a,dark.r,dark.g,dark.b);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*TwoColorTimeline.ENTRIES])}else throw new Error("Invalid timeline type for a slot: "+timelineName+" ("+slotName+")")}}}if(map.bones){for(var boneName in map.bones){var boneMap=map.bones[boneName];var boneIndex=skeletonData.findBoneIndex(boneName);if(boneIndex==-1)throw new Error("Bone not found: "+boneName);for(var timelineName in boneMap){var timelineMap=boneMap[timelineName];if(timelineName==="rotate"){var timeline=new RotateTimeline$1(timelineMap.length);timeline.boneIndex=boneIndex;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];timeline.setFrame(frameIndex,valueMap.time,valueMap.angle);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*RotateTimeline$1.ENTRIES])}else if(timelineName==="translate"||timelineName==="scale"||timelineName==="shear"){var timeline=null;var timelineScale=1;if(timelineName==="scale")timeline=new ScaleTimeline$1(timelineMap.length);else if(timelineName==="shear")timeline=new ShearTimeline$1(timelineMap.length);else{timeline=new TranslateTimeline$1(timelineMap.length);timelineScale=scale}timeline.boneIndex=boneIndex;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];var x=this.getValue(valueMap,"x",0),y=this.getValue(valueMap,"y",0);timeline.setFrame(frameIndex,valueMap.time,x*timelineScale,y*timelineScale);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*TranslateTimeline$1.ENTRIES])}else throw new Error("Invalid timeline type for a bone: "+timelineName+" ("+boneName+")")}}}if(map.ik){for(var constraintName in map.ik){var constraintMap=map.ik[constraintName];var constraint=skeletonData.findIkConstraint(constraintName);var timeline=new IkConstraintTimeline$1(constraintMap.length);timeline.ikConstraintIndex=skeletonData.ikConstraints.indexOf(constraint);var frameIndex=0;for(var i=0;i<constraintMap.length;i++){var valueMap=constraintMap[i];timeline.setFrame(frameIndex,valueMap.time,this.getValue(valueMap,"mix",1),this.getValue(valueMap,"bendPositive",true)?1:-1,this.getValue(valueMap,"compress",false),this.getValue(valueMap,"stretch",false));this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*IkConstraintTimeline$1.ENTRIES])}}if(map.transform){for(var constraintName in map.transform){var constraintMap=map.transform[constraintName];var constraint=skeletonData.findTransformConstraint(constraintName);var timeline=new TransformConstraintTimeline$1(constraintMap.length);timeline.transformConstraintIndex=skeletonData.transformConstraints.indexOf(constraint);var frameIndex=0;for(var i=0;i<constraintMap.length;i++){var valueMap=constraintMap[i];timeline.setFrame(frameIndex,valueMap.time,this.getValue(valueMap,"rotateMix",1),this.getValue(valueMap,"translateMix",1),this.getValue(valueMap,"scaleMix",1),this.getValue(valueMap,"shearMix",1));this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*TransformConstraintTimeline$1.ENTRIES])}}if(map.paths){for(var constraintName in map.paths){var constraintMap=map.paths[constraintName];var index=skeletonData.findPathConstraintIndex(constraintName);if(index==-1)throw new Error("Path constraint not found: "+constraintName);var data=skeletonData.pathConstraints[index];for(var timelineName in constraintMap){var timelineMap=constraintMap[timelineName];if(timelineName==="position"||timelineName==="spacing"){var timeline=null;var timelineScale=1;if(timelineName==="spacing"){timeline=new PathConstraintSpacingTimeline$1(timelineMap.length);if(data.spacingMode==SpacingMode$1.Length||data.spacingMode==SpacingMode$1.Fixed)timelineScale=scale}else{timeline=new PathConstraintPositionTimeline$1(timelineMap.length);if(data.positionMode==PositionMode$1.Fixed)timelineScale=scale}timeline.pathConstraintIndex=index;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];timeline.setFrame(frameIndex,valueMap.time,this.getValue(valueMap,timelineName,0)*timelineScale);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*PathConstraintPositionTimeline$1.ENTRIES])}else if(timelineName==="mix"){var timeline=new PathConstraintMixTimeline$1(timelineMap.length);timeline.pathConstraintIndex=index;var frameIndex=0;for(var i=0;i<timelineMap.length;i++){var valueMap=timelineMap[i];timeline.setFrame(frameIndex,valueMap.time,this.getValue(valueMap,"rotateMix",1),this.getValue(valueMap,"translateMix",1));this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[(timeline.getFrameCount()-1)*PathConstraintMixTimeline$1.ENTRIES])}}}}if(map.deform){for(var deformName in map.deform){var deformMap=map.deform[deformName];var skin=skeletonData.findSkin(deformName);if(skin==null){if(settings.FAIL_ON_NON_EXISTING_SKIN){throw new Error("Skin not found: "+deformName)}else{continue}}for(var slotName in deformMap){var slotMap=deformMap[slotName];var slotIndex=skeletonData.findSlotIndex(slotName);if(slotIndex==-1)throw new Error("Slot not found: "+slotMap.name);for(var timelineName in slotMap){var timelineMap=slotMap[timelineName];var attachment=skin.getAttachment(slotIndex,timelineName);if(attachment==null)throw new Error("Deform attachment not found: "+timelineMap.name);var weighted=attachment.bones!=null;var vertices=attachment.vertices;var deformLength=weighted?vertices.length/3*2:vertices.length;var timeline=new DeformTimeline$1(timelineMap.length);timeline.slotIndex=slotIndex;timeline.attachment=attachment;var frameIndex=0;for(var j=0;j<timelineMap.length;j++){var valueMap=timelineMap[j];var deform=void 0;var verticesValue=this.getValue(valueMap,"vertices",null);if(verticesValue==null)deform=weighted?Utils.newFloatArray(deformLength):vertices;else{deform=Utils.newFloatArray(deformLength);var start=this.getValue(valueMap,"offset",0);Utils.arrayCopy(verticesValue,0,deform,start,verticesValue.length);if(scale!=1){for(var i=start,n=i+verticesValue.length;i<n;i++)deform[i]*=scale}if(!weighted){for(var i=0;i<deformLength;i++)deform[i]+=vertices[i]}}timeline.setFrame(frameIndex,valueMap.time,deform);this.readCurve(valueMap,timeline,frameIndex);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}}}}var drawOrderNode=map.drawOrder;if(drawOrderNode==null)drawOrderNode=map.draworder;if(drawOrderNode!=null){var timeline=new DrawOrderTimeline$1(drawOrderNode.length);var slotCount=skeletonData.slots.length;var frameIndex=0;for(var j=0;j<drawOrderNode.length;j++){var drawOrderMap=drawOrderNode[j];var drawOrder=null;var offsets=this.getValue(drawOrderMap,"offsets",null);if(offsets!=null){drawOrder=Utils.newArray(slotCount,-1);var unchanged=Utils.newArray(slotCount-offsets.length,0);var originalIndex=0,unchangedIndex=0;for(var i=0;i<offsets.length;i++){var offsetMap=offsets[i];var slotIndex=skeletonData.findSlotIndex(offsetMap.slot);if(slotIndex==-1)throw new Error("Slot not found: "+offsetMap.slot);while(originalIndex!=slotIndex)unchanged[unchangedIndex++]=originalIndex++;drawOrder[originalIndex+offsetMap.offset]=originalIndex++}while(originalIndex<slotCount)unchanged[unchangedIndex++]=originalIndex++;for(var i=slotCount-1;i>=0;i--)if(drawOrder[i]==-1)drawOrder[i]=unchanged[--unchangedIndex]}timeline.setFrame(frameIndex++,drawOrderMap.time,drawOrder)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}if(map.events){var timeline=new EventTimeline$1(map.events.length);var frameIndex=0;for(var i=0;i<map.events.length;i++){var eventMap=map.events[i];var eventData=skeletonData.findEvent(eventMap.name);if(eventData==null)throw new Error("Event not found: "+eventMap.name);var event_1=new Event$1(Utils.toSinglePrecision(eventMap.time),eventData);event_1.intValue=this.getValue(eventMap,"int",eventData.intValue);event_1.floatValue=this.getValue(eventMap,"float",eventData.floatValue);event_1.stringValue=this.getValue(eventMap,"string",eventData.stringValue);if(event_1.data.audioPath!=null){event_1.volume=this.getValue(eventMap,"volume",1);event_1.balance=this.getValue(eventMap,"balance",0)}timeline.setFrame(frameIndex++,event_1)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}if(isNaN(duration)){throw new Error("Error while parsing animation, duration is NaN")}skeletonData.animations.push(new Animation$1(name,timelines,duration))};SkeletonJson.prototype.readCurve=function(map,timeline,frameIndex){if(!map.curve)return;if(map.curve==="stepped")timeline.setStepped(frameIndex);else if(Object.prototype.toString.call(map.curve)==="[object Array]"){var curve=map.curve;timeline.setCurve(frameIndex,curve[0],curve[1],curve[2],curve[3])}};SkeletonJson.prototype.getValue=function(map,prop,defaultValue){return map[prop]!==undefined?map[prop]:defaultValue};SkeletonJson.blendModeFromString=function(str){str=str.toLowerCase();if(str=="normal")return constants.BLEND_MODES.NORMAL;if(str=="additive")return constants.BLEND_MODES.ADD;if(str=="multiply")return constants.BLEND_MODES.MULTIPLY;if(str=="screen")return constants.BLEND_MODES.SCREEN;throw new Error("Unknown blend mode: "+str)};SkeletonJson.positionModeFromString=function(str){str=str.toLowerCase();if(str=="fixed")return PositionMode$1.Fixed;if(str=="percent")return PositionMode$1.Percent;throw new Error("Unknown position mode: "+str)};SkeletonJson.spacingModeFromString=function(str){str=str.toLowerCase();if(str=="length")return SpacingMode$1.Length;if(str=="fixed")return SpacingMode$1.Fixed;if(str=="percent")return SpacingMode$1.Percent;throw new Error("Unknown position mode: "+str)};SkeletonJson.rotateModeFromString=function(str){str=str.toLowerCase();if(str=="tangent")return RotateMode$1.Tangent;if(str=="chain")return RotateMode$1.Chain;if(str=="chainscale")return RotateMode$1.ChainScale;throw new Error("Unknown rotate mode: "+str)};SkeletonJson.transformModeFromString=function(str){str=str.toLowerCase();if(str=="normal")return TransformMode$1.Normal;if(str=="onlytranslation")return TransformMode$1.OnlyTranslation;if(str=="norotationorreflection")return TransformMode$1.NoRotationOrReflection;if(str=="noscale")return TransformMode$1.NoScale;if(str=="noscaleorreflection")return TransformMode$1.NoScaleOrReflection;throw new Error("Unknown transform mode: "+str)};return SkeletonJson}();var LinkedMesh$2=function(){function LinkedMesh(mesh,skin,slotIndex,parent){this.mesh=mesh;this.skin=skin;this.slotIndex=slotIndex;this.parent=parent}return LinkedMesh}();var Spine$2=function(_super){__extends$2(Spine,_super);function Spine(){return _super!==null&&_super.apply(this,arguments)||this}Spine.prototype.createSkeleton=function(spineData){this.skeleton=new Skeleton$1(spineData);this.skeleton.updateWorldTransform();this.stateData=new AnimationStateData$1(spineData);this.state=new AnimationState$1(this.stateData)};return Spine}(SpineBase);var spine37=Object.freeze({__proto__:null,Animation:Animation$1,AnimationState:AnimationState$1,AnimationStateAdapter2:AnimationStateAdapter2,AnimationStateData:AnimationStateData$1,AtlasAttachmentLoader:AtlasAttachmentLoader$1,Attachment:Attachment$1,AttachmentTimeline:AttachmentTimeline$1,Bone:Bone$1,BoneData:BoneData$1,BoundingBoxAttachment:BoundingBoxAttachment$1,ClippingAttachment:ClippingAttachment$1,ColorTimeline:ColorTimeline,CurveTimeline:CurveTimeline$1,DeformTimeline:DeformTimeline$1,DrawOrderTimeline:DrawOrderTimeline$1,Event:Event$1,EventData:EventData$1,EventQueue:EventQueue$1,EventTimeline:EventTimeline$1,get EventType(){return EventType$1},IkConstraint:IkConstraint$1,IkConstraintData:IkConstraintData$1,IkConstraintTimeline:IkConstraintTimeline$1,JitterEffect:JitterEffect$1,MeshAttachment:MeshAttachment$1,get MixBlend(){return MixBlend$1},get MixDirection(){return MixDirection$1},PathAttachment:PathAttachment$1,PathConstraint:PathConstraint$1,PathConstraintData:PathConstraintData$1,PathConstraintMixTimeline:PathConstraintMixTimeline$1,PathConstraintPositionTimeline:PathConstraintPositionTimeline$1,PathConstraintSpacingTimeline:PathConstraintSpacingTimeline$1,PointAttachment:PointAttachment$1,get PositionMode(){return PositionMode$1},RegionAttachment:RegionAttachment$1,get RotateMode(){return RotateMode$1},RotateTimeline:RotateTimeline$1,ScaleTimeline:ScaleTimeline$1,ShearTimeline:ShearTimeline$1,Skeleton:Skeleton$1,SkeletonBounds:SkeletonBounds$1,SkeletonData:SkeletonData$1,SkeletonJson:SkeletonJson$1,Skin:Skin$1,Slot:Slot$1,SlotData:SlotData$1,get SpacingMode(){return SpacingMode$1},Spine:Spine$2,SwirlEffect:SwirlEffect$1,get TimelineType(){return TimelineType},TrackEntry:TrackEntry$1,TransformConstraint:TransformConstraint$1,TransformConstraintData:TransformConstraintData$1,TransformConstraintTimeline:TransformConstraintTimeline$1,get TransformMode(){return TransformMode$1},TranslateTimeline:TranslateTimeline$1,TwoColorTimeline:TwoColorTimeline,VertexAttachment:VertexAttachment$1});var extendStatics$1=function(d,b){extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics$1(d,b)};function __extends$1(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics$1(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var Attachment=function(){function Attachment(name){if(!name)throw new Error("name cannot be null.");this.name=name}return Attachment}();var VertexAttachment=function(_super){__extends$1(VertexAttachment,_super);function VertexAttachment(name){var _this=_super.call(this,name)||this;_this.id=VertexAttachment.nextID++;_this.worldVerticesLength=0;_this.deformAttachment=_this;return _this}VertexAttachment.prototype.computeWorldVerticesOld=function(slot,worldVertices){this.computeWorldVertices(slot,0,this.worldVerticesLength,worldVertices,0,2)};VertexAttachment.prototype.computeWorldVertices=function(slot,start,count,worldVertices,offset,stride){count=offset+(count>>1)*stride;var skeleton=slot.bone.skeleton;var deformArray=slot.deform;var vertices=this.vertices;var bones=this.bones;if(!bones){if(deformArray.length>0)vertices=deformArray;var mat=slot.bone.matrix;var x=mat.tx;var y=mat.ty;var a=mat.a,b=mat.c,c=mat.b,d=mat.d;for(var v_1=start,w=offset;w<count;v_1+=2,w+=stride){var vx=vertices[v_1],vy=vertices[v_1+1];worldVertices[w]=vx*a+vy*b+x;worldVertices[w+1]=vx*c+vy*d+y}return}var v=0,skip=0;for(var i=0;i<start;i+=2){var n=bones[v];v+=n+1;skip+=n}var skeletonBones=skeleton.bones;if(deformArray.length==0){for(var w=offset,b=skip*3;w<count;w+=stride){var wx=0,wy=0;var n=bones[v++];n+=v;for(;v<n;v++,b+=3){var mat=skeletonBones[bones[v]].matrix;var vx=vertices[b],vy=vertices[b+1],weight=vertices[b+2];wx+=(vx*mat.a+vy*mat.c+mat.tx)*weight;wy+=(vx*mat.b+vy*mat.d+mat.ty)*weight}worldVertices[w]=wx;worldVertices[w+1]=wy}}else{var deform=deformArray;for(var w=offset,b=skip*3,f=skip<<1;w<count;w+=stride){var wx=0,wy=0;var n=bones[v++];n+=v;for(;v<n;v++,b+=3,f+=2){var mat=skeletonBones[bones[v]].matrix;var vx=vertices[b]+deform[f],vy=vertices[b+1]+deform[f+1],weight=vertices[b+2];wx+=(vx*mat.a+vy*mat.c+mat.tx)*weight;wy+=(vx*mat.b+vy*mat.d+mat.ty)*weight}worldVertices[w]=wx;worldVertices[w+1]=wy}}};VertexAttachment.prototype.copyTo=function(attachment){if(this.bones){attachment.bones=new Array(this.bones.length);Utils.arrayCopy(this.bones,0,attachment.bones,0,this.bones.length)}else attachment.bones=null;if(this.vertices){attachment.vertices=Utils.newFloatArray(this.vertices.length);Utils.arrayCopy(this.vertices,0,attachment.vertices,0,this.vertices.length)}else attachment.vertices=null;attachment.worldVerticesLength=this.worldVerticesLength;attachment.deformAttachment=this.deformAttachment};VertexAttachment.nextID=0;return VertexAttachment}(Attachment);var BoundingBoxAttachment=function(_super){__extends$1(BoundingBoxAttachment,_super);function BoundingBoxAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.BoundingBox;_this.color=new Color(1,1,1,1);return _this}BoundingBoxAttachment.prototype.copy=function(){var copy=new BoundingBoxAttachment(this.name);this.copyTo(copy);copy.color.setFromColor(this.color);return copy};return BoundingBoxAttachment}(VertexAttachment);var ClippingAttachment=function(_super){__extends$1(ClippingAttachment,_super);function ClippingAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Clipping;_this.color=new Color(.2275,.2275,.8078,1);return _this}ClippingAttachment.prototype.copy=function(){var copy=new ClippingAttachment(this.name);this.copyTo(copy);copy.endSlot=this.endSlot;copy.color.setFromColor(this.color);return copy};return ClippingAttachment}(VertexAttachment);var MeshAttachment=function(_super){__extends$1(MeshAttachment,_super);function MeshAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Mesh;_this.color=new Color(1,1,1,1);_this.tempColor=new Color(0,0,0,0);return _this}MeshAttachment.prototype.getParentMesh=function(){return this.parentMesh};MeshAttachment.prototype.setParentMesh=function(parentMesh){this.parentMesh=parentMesh;if(parentMesh){this.bones=parentMesh.bones;this.vertices=parentMesh.vertices;this.worldVerticesLength=parentMesh.worldVerticesLength;this.regionUVs=parentMesh.regionUVs;this.triangles=parentMesh.triangles;this.hullLength=parentMesh.hullLength;this.worldVerticesLength=parentMesh.worldVerticesLength}};MeshAttachment.prototype.copy=function(){if(this.parentMesh)return this.newLinkedMesh();var copy=new MeshAttachment(this.name);copy.region=this.region;copy.path=this.path;copy.color.setFromColor(this.color);this.copyTo(copy);copy.regionUVs=new Float32Array(this.regionUVs.length);Utils.arrayCopy(this.regionUVs,0,copy.regionUVs,0,this.regionUVs.length);copy.triangles=new Array(this.triangles.length);Utils.arrayCopy(this.triangles,0,copy.triangles,0,this.triangles.length);copy.hullLength=this.hullLength;if(this.edges){copy.edges=new Array(this.edges.length);Utils.arrayCopy(this.edges,0,copy.edges,0,this.edges.length)}copy.width=this.width;copy.height=this.height;return copy};MeshAttachment.prototype.newLinkedMesh=function(){var copy=new MeshAttachment(this.name);copy.region=this.region;copy.path=this.path;copy.color.setFromColor(this.color);copy.deformAttachment=this.deformAttachment;copy.setParentMesh(this.parentMesh?this.parentMesh:this);return copy};return MeshAttachment}(VertexAttachment);var PathAttachment=function(_super){__extends$1(PathAttachment,_super);function PathAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Path;_this.closed=false;_this.constantSpeed=false;_this.color=new Color(1,1,1,1);return _this}PathAttachment.prototype.copy=function(){var copy=new PathAttachment(this.name);this.copyTo(copy);copy.lengths=new Array(this.lengths.length);Utils.arrayCopy(this.lengths,0,copy.lengths,0,this.lengths.length);copy.closed=closed;copy.constantSpeed=this.constantSpeed;copy.color.setFromColor(this.color);return copy};return PathAttachment}(VertexAttachment);var PointAttachment=function(_super){__extends$1(PointAttachment,_super);function PointAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Point;_this.color=new Color(.38,.94,0,1);return _this}PointAttachment.prototype.computeWorldPosition=function(bone,point){var mat=bone.matrix;point.x=this.x*mat.a+this.y*mat.c+bone.worldX;point.y=this.x*mat.b+this.y*mat.d+bone.worldY;return point};PointAttachment.prototype.computeWorldRotation=function(bone){var mat=bone.matrix;var cos=MathUtils.cosDeg(this.rotation),sin=MathUtils.sinDeg(this.rotation);var x=cos*mat.a+sin*mat.c;var y=cos*mat.b+sin*mat.d;return Math.atan2(y,x)*MathUtils.radDeg};PointAttachment.prototype.copy=function(){var copy=new PointAttachment(this.name);copy.x=this.x;copy.y=this.y;copy.rotation=this.rotation;copy.color.setFromColor(this.color);return copy};return PointAttachment}(VertexAttachment);var RegionAttachment=function(_super){__extends$1(RegionAttachment,_super);function RegionAttachment(name){var _this=_super.call(this,name)||this;_this.type=exports.AttachmentType.Region;_this.x=0;_this.y=0;_this.scaleX=1;_this.scaleY=1;_this.rotation=0;_this.width=0;_this.height=0;_this.color=new Color(1,1,1,1);_this.offset=Utils.newFloatArray(8);_this.uvs=Utils.newFloatArray(8);_this.tempColor=new Color(1,1,1,1);return _this}RegionAttachment.prototype.updateOffset=function(){var regionScaleX=this.width/this.region.originalWidth*this.scaleX;var regionScaleY=this.height/this.region.originalHeight*this.scaleY;var localX=-this.width/2*this.scaleX+this.region.offsetX*regionScaleX;var localY=-this.height/2*this.scaleY+this.region.offsetY*regionScaleY;var localX2=localX+this.region.width*regionScaleX;var localY2=localY+this.region.height*regionScaleY;var radians=this.rotation*Math.PI/180;var cos=Math.cos(radians);var sin=Math.sin(radians);var localXCos=localX*cos+this.x;var localXSin=localX*sin;var localYCos=localY*cos+this.y;var localYSin=localY*sin;var localX2Cos=localX2*cos+this.x;var localX2Sin=localX2*sin;var localY2Cos=localY2*cos+this.y;var localY2Sin=localY2*sin;var offset=this.offset;offset[RegionAttachment.OX1]=localXCos-localYSin;offset[RegionAttachment.OY1]=localYCos+localXSin;offset[RegionAttachment.OX2]=localXCos-localY2Sin;offset[RegionAttachment.OY2]=localY2Cos+localXSin;offset[RegionAttachment.OX3]=localX2Cos-localY2Sin;offset[RegionAttachment.OY3]=localY2Cos+localX2Sin;offset[RegionAttachment.OX4]=localX2Cos-localYSin;offset[RegionAttachment.OY4]=localYCos+localX2Sin};RegionAttachment.prototype.setRegion=function(region){this.region=region;var uvs=this.uvs;if(region.degrees==90){uvs[2]=region.u;uvs[3]=region.v2;uvs[4]=region.u;uvs[5]=region.v;uvs[6]=region.u2;uvs[7]=region.v;uvs[0]=region.u2;uvs[1]=region.v2}else{uvs[0]=region.u;uvs[1]=region.v2;uvs[2]=region.u;uvs[3]=region.v;uvs[4]=region.u2;uvs[5]=region.v;uvs[6]=region.u2;uvs[7]=region.v2}};RegionAttachment.prototype.computeWorldVertices=function(bone,worldVertices,offset,stride){var vertexOffset=this.offset;var mat=bone.matrix;var x=mat.tx,y=mat.ty;var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var offsetX=0,offsetY=0;offsetX=vertexOffset[RegionAttachment.OX1];offsetY=vertexOffset[RegionAttachment.OY1];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y;offset+=stride;offsetX=vertexOffset[RegionAttachment.OX2];offsetY=vertexOffset[RegionAttachment.OY2];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y;offset+=stride;offsetX=vertexOffset[RegionAttachment.OX3];offsetY=vertexOffset[RegionAttachment.OY3];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y;offset+=stride;offsetX=vertexOffset[RegionAttachment.OX4];offsetY=vertexOffset[RegionAttachment.OY4];worldVertices[offset]=offsetX*a+offsetY*b+x;worldVertices[offset+1]=offsetX*c+offsetY*d+y};RegionAttachment.prototype.copy=function(){var copy=new RegionAttachment(this.name);copy.region=this.region;copy.rendererObject=this.rendererObject;copy.path=this.path;copy.x=this.x;copy.y=this.y;copy.scaleX=this.scaleX;copy.scaleY=this.scaleY;copy.rotation=this.rotation;copy.width=this.width;copy.height=this.height;Utils.arrayCopy(this.uvs,0,copy.uvs,0,8);Utils.arrayCopy(this.offset,0,copy.offset,0,8);copy.color.setFromColor(this.color);return copy};RegionAttachment.OX1=0;RegionAttachment.OY1=1;RegionAttachment.OX2=2;RegionAttachment.OY2=3;RegionAttachment.OX3=4;RegionAttachment.OY3=5;RegionAttachment.OX4=6;RegionAttachment.OY4=7;RegionAttachment.X1=0;RegionAttachment.Y1=1;RegionAttachment.C1R=2;RegionAttachment.C1G=3;RegionAttachment.C1B=4;RegionAttachment.C1A=5;RegionAttachment.U1=6;RegionAttachment.V1=7;RegionAttachment.X2=8;RegionAttachment.Y2=9;RegionAttachment.C2R=10;RegionAttachment.C2G=11;RegionAttachment.C2B=12;RegionAttachment.C2A=13;RegionAttachment.U2=14;RegionAttachment.V2=15;RegionAttachment.X3=16;RegionAttachment.Y3=17;RegionAttachment.C3R=18;RegionAttachment.C3G=19;RegionAttachment.C3B=20;RegionAttachment.C3A=21;RegionAttachment.U3=22;RegionAttachment.V3=23;RegionAttachment.X4=24;RegionAttachment.Y4=25;RegionAttachment.C4R=26;RegionAttachment.C4G=27;RegionAttachment.C4B=28;RegionAttachment.C4A=29;RegionAttachment.U4=30;RegionAttachment.V4=31;return RegionAttachment}(Attachment);var JitterEffect=function(){function JitterEffect(jitterX,jitterY){this.jitterX=0;this.jitterY=0;this.jitterX=jitterX;this.jitterY=jitterY}JitterEffect.prototype.begin=function(skeleton){};JitterEffect.prototype.transform=function(position,uv,light,dark){position.x+=MathUtils.randomTriangular(-this.jitterX,this.jitterY);position.y+=MathUtils.randomTriangular(-this.jitterX,this.jitterY)};JitterEffect.prototype.end=function(){};return JitterEffect}();var SwirlEffect=function(){function SwirlEffect(radius){this.centerX=0;this.centerY=0;this.radius=0;this.angle=0;this.worldX=0;this.worldY=0;this.radius=radius}SwirlEffect.prototype.begin=function(skeleton){this.worldX=skeleton.x+this.centerX;this.worldY=skeleton.y+this.centerY};SwirlEffect.prototype.transform=function(position,uv,light,dark){var radAngle=this.angle*MathUtils.degreesToRadians;var x=position.x-this.worldX;var y=position.y-this.worldY;var dist=Math.sqrt(x*x+y*y);if(dist<this.radius){var theta=SwirlEffect.interpolation.apply(0,radAngle,(this.radius-dist)/this.radius);var cos=Math.cos(theta);var sin=Math.sin(theta);position.x=cos*x-sin*y+this.worldX;position.y=sin*x+cos*y+this.worldY}};SwirlEffect.prototype.end=function(){};SwirlEffect.interpolation=new PowOut(2);return SwirlEffect}();var Animation=function(){function Animation(name,timelines,duration){if(!name)throw new Error("name cannot be null.");this.name=name;this.setTimelines(timelines);this.duration=duration}Animation.prototype.setTimelines=function(timelines){if(!timelines)throw new Error("timelines cannot be null.");this.timelines=timelines;this.timelineIds=new StringSet;for(var i=0;i<timelines.length;i++)this.timelineIds.addAll(timelines[i].getPropertyIds())};Animation.prototype.hasTimeline=function(ids){for(var i=0;i<ids.length;i++)if(this.timelineIds.contains(ids[i]))return true;return false};Animation.prototype.apply=function(skeleton,lastTime,time,loop,events,alpha,blend,direction){if(!skeleton)throw new Error("skeleton cannot be null.");if(loop&&this.duration!=0){time%=this.duration;if(lastTime>0)lastTime%=this.duration}var timelines=this.timelines;for(var i=0,n=timelines.length;i<n;i++)timelines[i].apply(skeleton,lastTime,time,events,alpha,blend,direction)};return Animation}();var MixBlend;(function(MixBlend){MixBlend[MixBlend["setup"]=0]="setup";MixBlend[MixBlend["first"]=1]="first";MixBlend[MixBlend["replace"]=2]="replace";MixBlend[MixBlend["add"]=3]="add"})(MixBlend||(MixBlend={}));var MixDirection;(function(MixDirection){MixDirection[MixDirection["mixIn"]=0]="mixIn";MixDirection[MixDirection["mixOut"]=1]="mixOut"})(MixDirection||(MixDirection={}));var Property={rotate:0,x:1,y:2,scaleX:3,scaleY:4,shearX:5,shearY:6,rgb:7,alpha:8,rgb2:9,attachment:10,deform:11,event:12,drawOrder:13,ikConstraint:14,transformConstraint:15,pathConstraintPosition:16,pathConstraintSpacing:17,pathConstraintMix:18};var Timeline=function(){function Timeline(frameCount,propertyIds){this.propertyIds=propertyIds;this.frames=Utils.newFloatArray(frameCount*this.getFrameEntries())}Timeline.prototype.getPropertyIds=function(){return this.propertyIds};Timeline.prototype.getFrameEntries=function(){return 1};Timeline.prototype.getFrameCount=function(){return this.frames.length/this.getFrameEntries()};Timeline.prototype.getDuration=function(){return this.frames[this.frames.length-this.getFrameEntries()]};Timeline.search1=function(frames,time){var n=frames.length;for(var i=1;i<n;i++)if(frames[i]>time)return i-1;return n-1};Timeline.search=function(frames,time,step){var n=frames.length;for(var i=step;i<n;i+=step)if(frames[i]>time)return i-step;return n-step};return Timeline}();var CurveTimeline=function(_super){__extends$1(CurveTimeline,_super);function CurveTimeline(frameCount,bezierCount,propertyIds){var _this=_super.call(this,frameCount,propertyIds)||this;_this.curves=Utils.newFloatArray(frameCount+bezierCount*18);_this.curves[frameCount-1]=1;return _this}CurveTimeline.prototype.setLinear=function(frame){this.curves[frame]=0};CurveTimeline.prototype.setStepped=function(frame){this.curves[frame]=1};CurveTimeline.prototype.shrink=function(bezierCount){var size=this.getFrameCount()+bezierCount*18;if(this.curves.length>size){var newCurves=Utils.newFloatArray(size);Utils.arrayCopy(this.curves,0,newCurves,0,size);this.curves=newCurves}};CurveTimeline.prototype.setBezier=function(bezier,frame,value,time1,value1,cx1,cy1,cx2,cy2,time2,value2){var curves=this.curves;var i=this.getFrameCount()+bezier*18;if(value==0)curves[frame]=2+i;var tmpx=(time1-cx1*2+cx2)*.03,tmpy=(value1-cy1*2+cy2)*.03;var dddx=((cx1-cx2)*3-time1+time2)*.006,dddy=((cy1-cy2)*3-value1+value2)*.006;var ddx=tmpx*2+dddx,ddy=tmpy*2+dddy;var dx=(cx1-time1)*.3+tmpx+dddx*.16666667,dy=(cy1-value1)*.3+tmpy+dddy*.16666667;var x=time1+dx,y=value1+dy;for(var n=i+18;i<n;i+=2){curves[i]=x;curves[i+1]=y;dx+=ddx;dy+=ddy;ddx+=dddx;ddy+=dddy;x+=dx;y+=dy}};CurveTimeline.prototype.getBezierValue=function(time,frameIndex,valueOffset,i){var curves=this.curves;if(curves[i]>time){var x_1=this.frames[frameIndex],y_1=this.frames[frameIndex+valueOffset];return y_1+(time-x_1)/(curves[i]-x_1)*(curves[i+1]-y_1)}var n=i+18;for(i+=2;i<n;i+=2){if(curves[i]>=time){var x_2=curves[i-2],y_2=curves[i-1];return y_2+(time-x_2)/(curves[i]-x_2)*(curves[i+1]-y_2)}}frameIndex+=this.getFrameEntries();var x=curves[n-2],y=curves[n-1];return y+(time-x)/(this.frames[frameIndex]-x)*(this.frames[frameIndex+valueOffset]-y)};return CurveTimeline}(Timeline);var CurveTimeline1=function(_super){__extends$1(CurveTimeline1,_super);function CurveTimeline1(frameCount,bezierCount,propertyId){return _super.call(this,frameCount,bezierCount,[propertyId])||this}CurveTimeline1.prototype.getFrameEntries=function(){return 2};CurveTimeline1.prototype.setFrame=function(frame,time,value){frame<<=1;this.frames[frame]=time;this.frames[frame+1]=value};CurveTimeline1.prototype.getCurveValue=function(time){var frames=this.frames;var i=frames.length-2;for(var ii=2;ii<=i;ii+=2){if(frames[ii]>time){i=ii-2;break}}var curveType=this.curves[i>>1];switch(curveType){case 0:var before=frames[i],value=frames[i+1];return value+(time-before)/(frames[i+2]-before)*(frames[i+2+1]-value);case 1:return frames[i+1]}return this.getBezierValue(time,i,1,curveType-2)};return CurveTimeline1}(CurveTimeline);var CurveTimeline2=function(_super){__extends$1(CurveTimeline2,_super);function CurveTimeline2(frameCount,bezierCount,propertyId1,propertyId2){return _super.call(this,frameCount,bezierCount,[propertyId1,propertyId2])||this}CurveTimeline2.prototype.getFrameEntries=function(){return 3};CurveTimeline2.prototype.setFrame=function(frame,time,value1,value2){frame*=3;this.frames[frame]=time;this.frames[frame+1]=value1;this.frames[frame+2]=value2};return CurveTimeline2}(CurveTimeline);var RotateTimeline=function(_super){__extends$1(RotateTimeline,_super);function RotateTimeline(frameCount,bezierCount,boneIndex){var _this=_super.call(this,frameCount,bezierCount,Property.rotate+"|"+boneIndex)||this;_this.boneIndex=0;_this.boneIndex=boneIndex;return _this}RotateTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.rotation=bone.data.rotation;return;case MixBlend.first:bone.rotation+=(bone.data.rotation-bone.rotation)*alpha}return}var r=this.getCurveValue(time);switch(blend){case MixBlend.setup:bone.rotation=bone.data.rotation+r*alpha;break;case MixBlend.first:case MixBlend.replace:r+=bone.data.rotation-bone.rotation;case MixBlend.add:bone.rotation+=r*alpha}};return RotateTimeline}(CurveTimeline1);var TranslateTimeline=function(_super){__extends$1(TranslateTimeline,_super);function TranslateTimeline(frameCount,bezierCount,boneIndex){var _this=_super.call(this,frameCount,bezierCount,Property.x+"|"+boneIndex,Property.y+"|"+boneIndex)||this;_this.boneIndex=0;_this.boneIndex=boneIndex;return _this}TranslateTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.x=bone.data.x;bone.y=bone.data.y;return;case MixBlend.first:bone.x+=(bone.data.x-bone.x)*alpha;bone.y+=(bone.data.y-bone.y)*alpha}return}var x=0,y=0;var i=Timeline.search(frames,time,3);var curveType=this.curves[i/3];switch(curveType){case 0:var before=frames[i];x=frames[i+1];y=frames[i+2];var t=(time-before)/(frames[i+3]-before);x+=(frames[i+3+1]-x)*t;y+=(frames[i+3+2]-y)*t;break;case 1:x=frames[i+1];y=frames[i+2];break;default:x=this.getBezierValue(time,i,1,curveType-2);y=this.getBezierValue(time,i,2,curveType+18-2)}switch(blend){case MixBlend.setup:bone.x=bone.data.x+x*alpha;bone.y=bone.data.y+y*alpha;break;case MixBlend.first:case MixBlend.replace:bone.x+=(bone.data.x+x-bone.x)*alpha;bone.y+=(bone.data.y+y-bone.y)*alpha;break;case MixBlend.add:bone.x+=x*alpha;bone.y+=y*alpha}};return TranslateTimeline}(CurveTimeline2);var TranslateXTimeline=function(_super){__extends$1(TranslateXTimeline,_super);function TranslateXTimeline(frameCount,bezierCount,boneIndex){var _this=_super.call(this,frameCount,bezierCount,Property.x+"|"+boneIndex)||this;_this.boneIndex=0;_this.boneIndex=boneIndex;return _this}TranslateXTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.x=bone.data.x;return;case MixBlend.first:bone.x+=(bone.data.x-bone.x)*alpha}return}var x=this.getCurveValue(time);switch(blend){case MixBlend.setup:bone.x=bone.data.x+x*alpha;break;case MixBlend.first:case MixBlend.replace:bone.x+=(bone.data.x+x-bone.x)*alpha;break;case MixBlend.add:bone.x+=x*alpha}};return TranslateXTimeline}(CurveTimeline1);var TranslateYTimeline=function(_super){__extends$1(TranslateYTimeline,_super);function TranslateYTimeline(frameCount,bezierCount,boneIndex){var _this=_super.call(this,frameCount,bezierCount,Property.y+"|"+boneIndex)||this;_this.boneIndex=0;_this.boneIndex=boneIndex;return _this}TranslateYTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.y=bone.data.y;return;case MixBlend.first:bone.y+=(bone.data.y-bone.y)*alpha}return}var y=this.getCurveValue(time);switch(blend){case MixBlend.setup:bone.y=bone.data.y+y*alpha;break;case MixBlend.first:case MixBlend.replace:bone.y+=(bone.data.y+y-bone.y)*alpha;break;case MixBlend.add:bone.y+=y*alpha}};return TranslateYTimeline}(CurveTimeline1);var ScaleTimeline=function(_super){__extends$1(ScaleTimeline,_super);function ScaleTimeline(frameCount,bezierCount,boneIndex){var _this=_super.call(this,frameCount,bezierCount,Property.scaleX+"|"+boneIndex,Property.scaleY+"|"+boneIndex)||this;_this.boneIndex=0;_this.boneIndex=boneIndex;return _this}ScaleTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.scaleX=bone.data.scaleX;bone.scaleY=bone.data.scaleY;return;case MixBlend.first:bone.scaleX+=(bone.data.scaleX-bone.scaleX)*alpha;bone.scaleY+=(bone.data.scaleY-bone.scaleY)*alpha}return}var x,y;var i=Timeline.search(frames,time,3);var curveType=this.curves[i/3];switch(curveType){case 0:var before=frames[i];x=frames[i+1];y=frames[i+2];var t=(time-before)/(frames[i+3]-before);x+=(frames[i+3+1]-x)*t;y+=(frames[i+3+2]-y)*t;break;case 1:x=frames[i+1];y=frames[i+2];break;default:x=this.getBezierValue(time,i,1,curveType-2);y=this.getBezierValue(time,i,2,curveType+18-2)}x*=bone.data.scaleX;y*=bone.data.scaleY;if(alpha==1){if(blend==MixBlend.add){bone.scaleX+=x-bone.data.scaleX;bone.scaleY+=y-bone.data.scaleY}else{bone.scaleX=x;bone.scaleY=y}}else{var bx=0,by=0;if(direction==MixDirection.mixOut){switch(blend){case MixBlend.setup:bx=bone.data.scaleX;by=bone.data.scaleY;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bx)*alpha;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-by)*alpha;break;case MixBlend.first:case MixBlend.replace:bx=bone.scaleX;by=bone.scaleY;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bx)*alpha;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-by)*alpha;break;case MixBlend.add:bx=bone.scaleX;by=bone.scaleY;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bone.data.scaleX)*alpha;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-bone.data.scaleY)*alpha}}else{switch(blend){case MixBlend.setup:bx=Math.abs(bone.data.scaleX)*MathUtils.signum(x);by=Math.abs(bone.data.scaleY)*MathUtils.signum(y);bone.scaleX=bx+(x-bx)*alpha;bone.scaleY=by+(y-by)*alpha;break;case MixBlend.first:case MixBlend.replace:bx=Math.abs(bone.scaleX)*MathUtils.signum(x);by=Math.abs(bone.scaleY)*MathUtils.signum(y);bone.scaleX=bx+(x-bx)*alpha;bone.scaleY=by+(y-by)*alpha;break;case MixBlend.add:bx=MathUtils.signum(x);by=MathUtils.signum(y);bone.scaleX=Math.abs(bone.scaleX)*bx+(x-Math.abs(bone.data.scaleX)*bx)*alpha;bone.scaleY=Math.abs(bone.scaleY)*by+(y-Math.abs(bone.data.scaleY)*by)*alpha}}}};return ScaleTimeline}(CurveTimeline2);var ScaleXTimeline=function(_super){__extends$1(ScaleXTimeline,_super);function ScaleXTimeline(frameCount,bezierCount,boneIndex){var _this=_super.call(this,frameCount,bezierCount,Property.scaleX+"|"+boneIndex)||this;_this.boneIndex=0;_this.boneIndex=boneIndex;return _this}ScaleXTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.scaleX=bone.data.scaleX;return;case MixBlend.first:bone.scaleX+=(bone.data.scaleX-bone.scaleX)*alpha}return}var x=this.getCurveValue(time)*bone.data.scaleX;if(alpha==1){if(blend==MixBlend.add)bone.scaleX+=x-bone.data.scaleX;else bone.scaleX=x}else{var bx=0;if(direction==MixDirection.mixOut){switch(blend){case MixBlend.setup:bx=bone.data.scaleX;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bx)*alpha;break;case MixBlend.first:case MixBlend.replace:bx=bone.scaleX;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bx)*alpha;break;case MixBlend.add:bx=bone.scaleX;bone.scaleX=bx+(Math.abs(x)*MathUtils.signum(bx)-bone.data.scaleX)*alpha}}else{switch(blend){case MixBlend.setup:bx=Math.abs(bone.data.scaleX)*MathUtils.signum(x);bone.scaleX=bx+(x-bx)*alpha;break;case MixBlend.first:case MixBlend.replace:bx=Math.abs(bone.scaleX)*MathUtils.signum(x);bone.scaleX=bx+(x-bx)*alpha;break;case MixBlend.add:bx=MathUtils.signum(x);bone.scaleX=Math.abs(bone.scaleX)*bx+(x-Math.abs(bone.data.scaleX)*bx)*alpha}}}};return ScaleXTimeline}(CurveTimeline1);var ScaleYTimeline=function(_super){__extends$1(ScaleYTimeline,_super);function ScaleYTimeline(frameCount,bezierCount,boneIndex){var _this=_super.call(this,frameCount,bezierCount,Property.scaleY+"|"+boneIndex)||this;_this.boneIndex=0;_this.boneIndex=boneIndex;return _this}ScaleYTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.scaleY=bone.data.scaleY;return;case MixBlend.first:bone.scaleY+=(bone.data.scaleY-bone.scaleY)*alpha}return}var y=this.getCurveValue(time)*bone.data.scaleY;if(alpha==1){if(blend==MixBlend.add)bone.scaleY+=y-bone.data.scaleY;else bone.scaleY=y}else{var by=0;if(direction==MixDirection.mixOut){switch(blend){case MixBlend.setup:by=bone.data.scaleY;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-by)*alpha;break;case MixBlend.first:case MixBlend.replace:by=bone.scaleY;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-by)*alpha;break;case MixBlend.add:by=bone.scaleY;bone.scaleY=by+(Math.abs(y)*MathUtils.signum(by)-bone.data.scaleY)*alpha}}else{switch(blend){case MixBlend.setup:by=Math.abs(bone.data.scaleY)*MathUtils.signum(y);bone.scaleY=by+(y-by)*alpha;break;case MixBlend.first:case MixBlend.replace:by=Math.abs(bone.scaleY)*MathUtils.signum(y);bone.scaleY=by+(y-by)*alpha;break;case MixBlend.add:by=MathUtils.signum(y);bone.scaleY=Math.abs(bone.scaleY)*by+(y-Math.abs(bone.data.scaleY)*by)*alpha}}}};return ScaleYTimeline}(CurveTimeline1);var ShearTimeline=function(_super){__extends$1(ShearTimeline,_super);function ShearTimeline(frameCount,bezierCount,boneIndex){var _this=_super.call(this,frameCount,bezierCount,Property.shearX+"|"+boneIndex,Property.shearY+"|"+boneIndex)||this;_this.boneIndex=0;_this.boneIndex=boneIndex;return _this}ShearTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.shearX=bone.data.shearX;bone.shearY=bone.data.shearY;return;case MixBlend.first:bone.shearX+=(bone.data.shearX-bone.shearX)*alpha;bone.shearY+=(bone.data.shearY-bone.shearY)*alpha}return}var x=0,y=0;var i=Timeline.search(frames,time,3);var curveType=this.curves[i/3];switch(curveType){case 0:var before=frames[i];x=frames[i+1];y=frames[i+2];var t=(time-before)/(frames[i+3]-before);x+=(frames[i+3+1]-x)*t;y+=(frames[i+3+2]-y)*t;break;case 1:x=frames[i+1];y=frames[i+2];break;default:x=this.getBezierValue(time,i,1,curveType-2);y=this.getBezierValue(time,i,2,curveType+18-2)}switch(blend){case MixBlend.setup:bone.shearX=bone.data.shearX+x*alpha;bone.shearY=bone.data.shearY+y*alpha;break;case MixBlend.first:case MixBlend.replace:bone.shearX+=(bone.data.shearX+x-bone.shearX)*alpha;bone.shearY+=(bone.data.shearY+y-bone.shearY)*alpha;break;case MixBlend.add:bone.shearX+=x*alpha;bone.shearY+=y*alpha}};return ShearTimeline}(CurveTimeline2);var ShearXTimeline=function(_super){__extends$1(ShearXTimeline,_super);function ShearXTimeline(frameCount,bezierCount,boneIndex){var _this=_super.call(this,frameCount,bezierCount,Property.shearX+"|"+boneIndex)||this;_this.boneIndex=0;_this.boneIndex=boneIndex;return _this}ShearXTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.shearX=bone.data.shearX;return;case MixBlend.first:bone.shearX+=(bone.data.shearX-bone.shearX)*alpha}return}var x=this.getCurveValue(time);switch(blend){case MixBlend.setup:bone.shearX=bone.data.shearX+x*alpha;break;case MixBlend.first:case MixBlend.replace:bone.shearX+=(bone.data.shearX+x-bone.shearX)*alpha;break;case MixBlend.add:bone.shearX+=x*alpha}};return ShearXTimeline}(CurveTimeline1);var ShearYTimeline=function(_super){__extends$1(ShearYTimeline,_super);function ShearYTimeline(frameCount,bezierCount,boneIndex){var _this=_super.call(this,frameCount,bezierCount,Property.shearY+"|"+boneIndex)||this;_this.boneIndex=0;_this.boneIndex=boneIndex;return _this}ShearYTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var bone=skeleton.bones[this.boneIndex];if(!bone.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.shearY=bone.data.shearY;return;case MixBlend.first:bone.shearY+=(bone.data.shearY-bone.shearY)*alpha}return}var y=this.getCurveValue(time);switch(blend){case MixBlend.setup:bone.shearY=bone.data.shearY+y*alpha;break;case MixBlend.first:case MixBlend.replace:bone.shearY+=(bone.data.shearY+y-bone.shearY)*alpha;break;case MixBlend.add:bone.shearY+=y*alpha}};return ShearYTimeline}(CurveTimeline1);var RGBATimeline=function(_super){__extends$1(RGBATimeline,_super);function RGBATimeline(frameCount,bezierCount,slotIndex){var _this=_super.call(this,frameCount,bezierCount,[Property.rgb+"|"+slotIndex,Property.alpha+"|"+slotIndex])||this;_this.slotIndex=0;_this.slotIndex=slotIndex;return _this}RGBATimeline.prototype.getFrameEntries=function(){return 5};RGBATimeline.prototype.setFrame=function(frame,time,r,g,b,a){frame*=5;this.frames[frame]=time;this.frames[frame+1]=r;this.frames[frame+2]=g;this.frames[frame+3]=b;this.frames[frame+4]=a};RGBATimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;var frames=this.frames;var color=slot.color;if(time<frames[0]){var setup=slot.data.color;switch(blend){case MixBlend.setup:color.setFromColor(setup);return;case MixBlend.first:color.add((setup.r-color.r)*alpha,(setup.g-color.g)*alpha,(setup.b-color.b)*alpha,(setup.a-color.a)*alpha)}return}var r=0,g=0,b=0,a=0;var i=Timeline.search(frames,time,5);var curveType=this.curves[i/5];switch(curveType){case 0:var before=frames[i];r=frames[i+1];g=frames[i+2];b=frames[i+3];a=frames[i+4];var t=(time-before)/(frames[i+5]-before);r+=(frames[i+5+1]-r)*t;g+=(frames[i+5+2]-g)*t;b+=(frames[i+5+3]-b)*t;a+=(frames[i+5+4]-a)*t;break;case 1:r=frames[i+1];g=frames[i+2];b=frames[i+3];a=frames[i+4];break;default:r=this.getBezierValue(time,i,1,curveType-2);g=this.getBezierValue(time,i,2,curveType+18-2);b=this.getBezierValue(time,i,3,curveType+18*2-2);a=this.getBezierValue(time,i,4,curveType+18*3-2)}if(alpha==1)color.set(r,g,b,a);else{if(blend==MixBlend.setup)color.setFromColor(slot.data.color);color.add((r-color.r)*alpha,(g-color.g)*alpha,(b-color.b)*alpha,(a-color.a)*alpha)}};return RGBATimeline}(CurveTimeline);var RGBTimeline=function(_super){__extends$1(RGBTimeline,_super);function RGBTimeline(frameCount,bezierCount,slotIndex){var _this=_super.call(this,frameCount,bezierCount,[Property.rgb+"|"+slotIndex])||this;_this.slotIndex=0;_this.slotIndex=slotIndex;return _this}RGBTimeline.prototype.getFrameEntries=function(){return 4};RGBTimeline.prototype.setFrame=function(frame,time,r,g,b){frame<<=2;this.frames[frame]=time;this.frames[frame+1]=r;this.frames[frame+2]=g;this.frames[frame+3]=b};RGBTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;var frames=this.frames;var color=slot.color;if(time<frames[0]){var setup=slot.data.color;switch(blend){case MixBlend.setup:color.r=setup.r;color.g=setup.g;color.b=setup.b;return;case MixBlend.first:color.r+=(setup.r-color.r)*alpha;color.g+=(setup.g-color.g)*alpha;color.b+=(setup.b-color.b)*alpha}return}var r=0,g=0,b=0;var i=Timeline.search(frames,time,4);var curveType=this.curves[i>>2];switch(curveType){case 0:var before=frames[i];r=frames[i+1];g=frames[i+2];b=frames[i+3];var t=(time-before)/(frames[i+4]-before);r+=(frames[i+4+1]-r)*t;g+=(frames[i+4+2]-g)*t;b+=(frames[i+4+3]-b)*t;break;case 1:r=frames[i+1];g=frames[i+2];b=frames[i+3];break;default:r=this.getBezierValue(time,i,1,curveType-2);g=this.getBezierValue(time,i,2,curveType+18-2);b=this.getBezierValue(time,i,3,curveType+18*2-2)}if(alpha==1){color.r=r;color.g=g;color.b=b}else{if(blend==MixBlend.setup){var setup=slot.data.color;color.r=setup.r;color.g=setup.g;color.b=setup.b}color.r+=(r-color.r)*alpha;color.g+=(g-color.g)*alpha;color.b+=(b-color.b)*alpha}};return RGBTimeline}(CurveTimeline);var AlphaTimeline=function(_super){__extends$1(AlphaTimeline,_super);function AlphaTimeline(frameCount,bezierCount,slotIndex){var _this=_super.call(this,frameCount,bezierCount,Property.alpha+"|"+slotIndex)||this;_this.slotIndex=0;_this.slotIndex=slotIndex;return _this}AlphaTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;var color=slot.color;if(time<this.frames[0]){var setup=slot.data.color;switch(blend){case MixBlend.setup:color.a=setup.a;return;case MixBlend.first:color.a+=(setup.a-color.a)*alpha}return}var a=this.getCurveValue(time);if(alpha==1)color.a=a;else{if(blend==MixBlend.setup)color.a=slot.data.color.a;color.a+=(a-color.a)*alpha}};return AlphaTimeline}(CurveTimeline1);var RGBA2Timeline=function(_super){__extends$1(RGBA2Timeline,_super);function RGBA2Timeline(frameCount,bezierCount,slotIndex){var _this=_super.call(this,frameCount,bezierCount,[Property.rgb+"|"+slotIndex,Property.alpha+"|"+slotIndex,Property.rgb2+"|"+slotIndex])||this;_this.slotIndex=0;_this.slotIndex=slotIndex;return _this}RGBA2Timeline.prototype.getFrameEntries=function(){return 8};RGBA2Timeline.prototype.setFrame=function(frame,time,r,g,b,a,r2,g2,b2){frame<<=3;this.frames[frame]=time;this.frames[frame+1]=r;this.frames[frame+2]=g;this.frames[frame+3]=b;this.frames[frame+4]=a;this.frames[frame+5]=r2;this.frames[frame+6]=g2;this.frames[frame+7]=b2};RGBA2Timeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;var frames=this.frames;var light=slot.color,dark=slot.darkColor;if(time<frames[0]){var setupLight=slot.data.color,setupDark=slot.data.darkColor;switch(blend){case MixBlend.setup:light.setFromColor(setupLight);dark.r=setupDark.r;dark.g=setupDark.g;dark.b=setupDark.b;return;case MixBlend.first:light.add((setupLight.r-light.r)*alpha,(setupLight.g-light.g)*alpha,(setupLight.b-light.b)*alpha,(setupLight.a-light.a)*alpha);dark.r+=(setupDark.r-dark.r)*alpha;dark.g+=(setupDark.g-dark.g)*alpha;dark.b+=(setupDark.b-dark.b)*alpha}return}var r=0,g=0,b=0,a=0,r2=0,g2=0,b2=0;var i=Timeline.search(frames,time,8);var curveType=this.curves[i>>3];switch(curveType){case 0:var before=frames[i];r=frames[i+1];g=frames[i+2];b=frames[i+3];a=frames[i+4];r2=frames[i+5];g2=frames[i+6];b2=frames[i+7];var t=(time-before)/(frames[i+8]-before);r+=(frames[i+8+1]-r)*t;g+=(frames[i+8+2]-g)*t;b+=(frames[i+8+3]-b)*t;a+=(frames[i+8+4]-a)*t;r2+=(frames[i+8+5]-r2)*t;g2+=(frames[i+8+6]-g2)*t;b2+=(frames[i+8+7]-b2)*t;break;case 1:r=frames[i+1];g=frames[i+2];b=frames[i+3];a=frames[i+4];r2=frames[i+5];g2=frames[i+6];b2=frames[i+7];break;default:r=this.getBezierValue(time,i,1,curveType-2);g=this.getBezierValue(time,i,2,curveType+18-2);b=this.getBezierValue(time,i,3,curveType+18*2-2);a=this.getBezierValue(time,i,4,curveType+18*3-2);r2=this.getBezierValue(time,i,5,curveType+18*4-2);g2=this.getBezierValue(time,i,6,curveType+18*5-2);b2=this.getBezierValue(time,i,7,curveType+18*6-2)}if(alpha==1){light.set(r,g,b,a);dark.r=r2;dark.g=g2;dark.b=b2}else{if(blend==MixBlend.setup){light.setFromColor(slot.data.color);var setupDark=slot.data.darkColor;dark.r=setupDark.r;dark.g=setupDark.g;dark.b=setupDark.b}light.add((r-light.r)*alpha,(g-light.g)*alpha,(b-light.b)*alpha,(a-light.a)*alpha);dark.r+=(r2-dark.r)*alpha;dark.g+=(g2-dark.g)*alpha;dark.b+=(b2-dark.b)*alpha}};return RGBA2Timeline}(CurveTimeline);var RGB2Timeline=function(_super){__extends$1(RGB2Timeline,_super);function RGB2Timeline(frameCount,bezierCount,slotIndex){var _this=_super.call(this,frameCount,bezierCount,[Property.rgb+"|"+slotIndex,Property.rgb2+"|"+slotIndex])||this;_this.slotIndex=0;_this.slotIndex=slotIndex;return _this}RGB2Timeline.prototype.getFrameEntries=function(){return 7};RGB2Timeline.prototype.setFrame=function(frame,time,r,g,b,r2,g2,b2){frame*=7;this.frames[frame]=time;this.frames[frame+1]=r;this.frames[frame+2]=g;this.frames[frame+3]=b;this.frames[frame+4]=r2;this.frames[frame+5]=g2;this.frames[frame+6]=b2};RGB2Timeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;var frames=this.frames;var light=slot.color,dark=slot.darkColor;if(time<frames[0]){var setupLight=slot.data.color,setupDark=slot.data.darkColor;switch(blend){case MixBlend.setup:light.r=setupLight.r;light.g=setupLight.g;light.b=setupLight.b;dark.r=setupDark.r;dark.g=setupDark.g;dark.b=setupDark.b;return;case MixBlend.first:light.r+=(setupLight.r-light.r)*alpha;light.g+=(setupLight.g-light.g)*alpha;light.b+=(setupLight.b-light.b)*alpha;dark.r+=(setupDark.r-dark.r)*alpha;dark.g+=(setupDark.g-dark.g)*alpha;dark.b+=(setupDark.b-dark.b)*alpha}return}var r=0,g=0,b=0,r2=0,g2=0,b2=0;var i=Timeline.search(frames,time,7);var curveType=this.curves[i/7];switch(curveType){case 0:var before=frames[i];r=frames[i+1];g=frames[i+2];b=frames[i+3];r2=frames[i+4];g2=frames[i+5];b2=frames[i+6];var t=(time-before)/(frames[i+7]-before);r+=(frames[i+7+1]-r)*t;g+=(frames[i+7+2]-g)*t;b+=(frames[i+7+3]-b)*t;r2+=(frames[i+7+4]-r2)*t;g2+=(frames[i+7+5]-g2)*t;b2+=(frames[i+7+6]-b2)*t;break;case 1:r=frames[i+1];g=frames[i+2];b=frames[i+3];r2=frames[i+4];g2=frames[i+5];b2=frames[i+6];break;default:r=this.getBezierValue(time,i,1,curveType-2);g=this.getBezierValue(time,i,2,curveType+18-2);b=this.getBezierValue(time,i,3,curveType+18*2-2);r2=this.getBezierValue(time,i,4,curveType+18*3-2);g2=this.getBezierValue(time,i,5,curveType+18*4-2);b2=this.getBezierValue(time,i,6,curveType+18*5-2)}if(alpha==1){light.r=r;light.g=g;light.b=b;dark.r=r2;dark.g=g2;dark.b=b2}else{if(blend==MixBlend.setup){var setupLight=slot.data.color,setupDark=slot.data.darkColor;light.r=setupLight.r;light.g=setupLight.g;light.b=setupLight.b;dark.r=setupDark.r;dark.g=setupDark.g;dark.b=setupDark.b}light.r+=(r-light.r)*alpha;light.g+=(g-light.g)*alpha;light.b+=(b-light.b)*alpha;dark.r+=(r2-dark.r)*alpha;dark.g+=(g2-dark.g)*alpha;dark.b+=(b2-dark.b)*alpha}};return RGB2Timeline}(CurveTimeline);var AttachmentTimeline=function(_super){__extends$1(AttachmentTimeline,_super);function AttachmentTimeline(frameCount,slotIndex){var _this=_super.call(this,frameCount,[Property.attachment+"|"+slotIndex])||this;_this.slotIndex=0;_this.slotIndex=slotIndex;_this.attachmentNames=new Array(frameCount);return _this}AttachmentTimeline.prototype.getFrameCount=function(){return this.frames.length};AttachmentTimeline.prototype.setFrame=function(frame,time,attachmentName){this.frames[frame]=time;this.attachmentNames[frame]=attachmentName};AttachmentTimeline.prototype.apply=function(skeleton,lastTime,time,events,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;if(direction==MixDirection.mixOut){if(blend==MixBlend.setup)this.setAttachment(skeleton,slot,slot.data.attachmentName);return}if(time<this.frames[0]){if(blend==MixBlend.setup||blend==MixBlend.first)this.setAttachment(skeleton,slot,slot.data.attachmentName);return}this.setAttachment(skeleton,slot,this.attachmentNames[Timeline.search1(this.frames,time)])};AttachmentTimeline.prototype.setAttachment=function(skeleton,slot,attachmentName){slot.setAttachment(!attachmentName?null:skeleton.getAttachment(this.slotIndex,attachmentName))};return AttachmentTimeline}(Timeline);var DeformTimeline=function(_super){__extends$1(DeformTimeline,_super);function DeformTimeline(frameCount,bezierCount,slotIndex,attachment){var _this=_super.call(this,frameCount,bezierCount,[Property.deform+"|"+slotIndex+"|"+attachment.id])||this;_this.slotIndex=0;_this.slotIndex=slotIndex;_this.attachment=attachment;_this.vertices=new Array(frameCount);return _this}DeformTimeline.prototype.getFrameCount=function(){return this.frames.length};DeformTimeline.prototype.setFrame=function(frame,time,vertices){this.frames[frame]=time;this.vertices[frame]=vertices};DeformTimeline.prototype.setBezier=function(bezier,frame,value,time1,value1,cx1,cy1,cx2,cy2,time2,value2){var curves=this.curves;var i=this.getFrameCount()+bezier*18;if(value==0)curves[frame]=2+i;var tmpx=(time1-cx1*2+cx2)*.03,tmpy=cy2*.03-cy1*.06;var dddx=((cx1-cx2)*3-time1+time2)*.006,dddy=(cy1-cy2+.33333333)*.018;var ddx=tmpx*2+dddx,ddy=tmpy*2+dddy;var dx=(cx1-time1)*.3+tmpx+dddx*.16666667,dy=cy1*.3+tmpy+dddy*.16666667;var x=time1+dx,y=dy;for(var n=i+18;i<n;i+=2){curves[i]=x;curves[i+1]=y;dx+=ddx;dy+=ddy;ddx+=dddx;ddy+=dddy;x+=dx;y+=dy}};DeformTimeline.prototype.getCurvePercent=function(time,frame){var curves=this.curves;var i=curves[frame];switch(i){case 0:var x_3=this.frames[frame];return(time-x_3)/(this.frames[frame+this.getFrameEntries()]-x_3);case 1:return 0}i-=2;if(curves[i]>time){var x_4=this.frames[frame];return curves[i+1]*(time-x_4)/(curves[i]-x_4)}var n=i+18;for(i+=2;i<n;i+=2){if(curves[i]>=time){var x_5=curves[i-2],y_3=curves[i-1];return y_3+(time-x_5)/(curves[i]-x_5)*(curves[i+1]-y_3)}}var x=curves[n-2],y=curves[n-1];return y+(1-y)*(time-x)/(this.frames[frame+this.getFrameEntries()]-x)};DeformTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var slot=skeleton.slots[this.slotIndex];if(!slot.bone.active)return;var slotAttachment=slot.getAttachment();if(!(slotAttachment instanceof VertexAttachment)||slotAttachment.deformAttachment!=this.attachment)return;var deform=slot.deform;if(deform.length==0)blend=MixBlend.setup;var vertices=this.vertices;var vertexCount=vertices[0].length;var frames=this.frames;if(time<frames[0]){var vertexAttachment=slotAttachment;switch(blend){case MixBlend.setup:deform.length=0;return;case MixBlend.first:if(alpha==1){deform.length=0;return}deform.length=vertexCount;if(!vertexAttachment.bones){var setupVertices=vertexAttachment.vertices;for(var i=0;i<vertexCount;i++)deform[i]+=(setupVertices[i]-deform[i])*alpha}else{alpha=1-alpha;for(var i=0;i<vertexCount;i++)deform[i]*=alpha}}return}deform.length=vertexCount;if(time>=frames[frames.length-1]){var lastVertices=vertices[frames.length-1];if(alpha==1){if(blend==MixBlend.add){var vertexAttachment=slotAttachment;if(!vertexAttachment.bones){var setupVertices=vertexAttachment.vertices;for(var i_1=0;i_1<vertexCount;i_1++)deform[i_1]+=lastVertices[i_1]-setupVertices[i_1]}else{for(var i_2=0;i_2<vertexCount;i_2++)deform[i_2]+=lastVertices[i_2]}}else Utils.arrayCopy(lastVertices,0,deform,0,vertexCount)}else{switch(blend){case MixBlend.setup:{var vertexAttachment_1=slotAttachment;if(!vertexAttachment_1.bones){var setupVertices=vertexAttachment_1.vertices;for(var i_3=0;i_3<vertexCount;i_3++){var setup=setupVertices[i_3];deform[i_3]=setup+(lastVertices[i_3]-setup)*alpha}}else{for(var i_4=0;i_4<vertexCount;i_4++)deform[i_4]=lastVertices[i_4]*alpha}break}case MixBlend.first:case MixBlend.replace:for(var i_5=0;i_5<vertexCount;i_5++)deform[i_5]+=(lastVertices[i_5]-deform[i_5])*alpha;break;case MixBlend.add:var vertexAttachment=slotAttachment;if(!vertexAttachment.bones){var setupVertices=vertexAttachment.vertices;for(var i_6=0;i_6<vertexCount;i_6++)deform[i_6]+=(lastVertices[i_6]-setupVertices[i_6])*alpha}else{for(var i_7=0;i_7<vertexCount;i_7++)deform[i_7]+=lastVertices[i_7]*alpha}}}return}var frame=Timeline.search1(frames,time);var percent=this.getCurvePercent(time,frame);var prevVertices=vertices[frame];var nextVertices=vertices[frame+1];if(alpha==1){if(blend==MixBlend.add){var vertexAttachment=slotAttachment;if(!vertexAttachment.bones){var setupVertices=vertexAttachment.vertices;for(var i_8=0;i_8<vertexCount;i_8++){var prev=prevVertices[i_8];deform[i_8]+=prev+(nextVertices[i_8]-prev)*percent-setupVertices[i_8]}}else{for(var i_9=0;i_9<vertexCount;i_9++){var prev=prevVertices[i_9];deform[i_9]+=prev+(nextVertices[i_9]-prev)*percent}}}else{for(var i_10=0;i_10<vertexCount;i_10++){var prev=prevVertices[i_10];deform[i_10]=prev+(nextVertices[i_10]-prev)*percent}}}else{switch(blend){case MixBlend.setup:{var vertexAttachment_2=slotAttachment;if(!vertexAttachment_2.bones){var setupVertices=vertexAttachment_2.vertices;for(var i_11=0;i_11<vertexCount;i_11++){var prev=prevVertices[i_11],setup=setupVertices[i_11];deform[i_11]=setup+(prev+(nextVertices[i_11]-prev)*percent-setup)*alpha}}else{for(var i_12=0;i_12<vertexCount;i_12++){var prev=prevVertices[i_12];deform[i_12]=(prev+(nextVertices[i_12]-prev)*percent)*alpha}}break}case MixBlend.first:case MixBlend.replace:for(var i_13=0;i_13<vertexCount;i_13++){var prev=prevVertices[i_13];deform[i_13]+=(prev+(nextVertices[i_13]-prev)*percent-deform[i_13])*alpha}break;case MixBlend.add:var vertexAttachment=slotAttachment;if(!vertexAttachment.bones){var setupVertices=vertexAttachment.vertices;for(var i_14=0;i_14<vertexCount;i_14++){var prev=prevVertices[i_14];deform[i_14]+=(prev+(nextVertices[i_14]-prev)*percent-setupVertices[i_14])*alpha}}else{for(var i_15=0;i_15<vertexCount;i_15++){var prev=prevVertices[i_15];deform[i_15]+=(prev+(nextVertices[i_15]-prev)*percent)*alpha}}}}};return DeformTimeline}(CurveTimeline);var EventTimeline=function(_super){__extends$1(EventTimeline,_super);function EventTimeline(frameCount){var _this=_super.call(this,frameCount,EventTimeline.propertyIds)||this;_this.events=new Array(frameCount);return _this}EventTimeline.prototype.getFrameCount=function(){return this.frames.length};EventTimeline.prototype.setFrame=function(frame,event){this.frames[frame]=event.time;this.events[frame]=event};EventTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){if(!firedEvents)return;var frames=this.frames;var frameCount=this.frames.length;if(lastTime>time){this.apply(skeleton,lastTime,Number.MAX_VALUE,firedEvents,alpha,blend,direction);lastTime=-1}else if(lastTime>=frames[frameCount-1])return;if(time<frames[0])return;var i=0;if(lastTime<frames[0])i=0;else{i=Timeline.search1(frames,lastTime)+1;var frameTime=frames[i];while(i>0){if(frames[i-1]!=frameTime)break;i--}}for(;i<frameCount&&time>=frames[i];i++)firedEvents.push(this.events[i])};EventTimeline.propertyIds=[""+Property.event];return EventTimeline}(Timeline);var DrawOrderTimeline=function(_super){__extends$1(DrawOrderTimeline,_super);function DrawOrderTimeline(frameCount){var _this=_super.call(this,frameCount,DrawOrderTimeline.propertyIds)||this;_this.drawOrders=new Array(frameCount);return _this}DrawOrderTimeline.prototype.getFrameCount=function(){return this.frames.length};DrawOrderTimeline.prototype.setFrame=function(frame,time,drawOrder){this.frames[frame]=time;this.drawOrders[frame]=drawOrder};DrawOrderTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){if(direction==MixDirection.mixOut){if(blend==MixBlend.setup)Utils.arrayCopy(skeleton.slots,0,skeleton.drawOrder,0,skeleton.slots.length);return}if(time<this.frames[0]){if(blend==MixBlend.setup||blend==MixBlend.first)Utils.arrayCopy(skeleton.slots,0,skeleton.drawOrder,0,skeleton.slots.length);return}var drawOrderToSetupIndex=this.drawOrders[Timeline.search1(this.frames,time)];if(!drawOrderToSetupIndex)Utils.arrayCopy(skeleton.slots,0,skeleton.drawOrder,0,skeleton.slots.length);else{var drawOrder=skeleton.drawOrder;var slots=skeleton.slots;for(var i=0,n=drawOrderToSetupIndex.length;i<n;i++)drawOrder[i]=slots[drawOrderToSetupIndex[i]]}};DrawOrderTimeline.propertyIds=[""+Property.drawOrder];return DrawOrderTimeline}(Timeline);var IkConstraintTimeline=function(_super){__extends$1(IkConstraintTimeline,_super);function IkConstraintTimeline(frameCount,bezierCount,ikConstraintIndex){var _this=_super.call(this,frameCount,bezierCount,[Property.ikConstraint+"|"+ikConstraintIndex])||this;_this.ikConstraintIndex=ikConstraintIndex;return _this}IkConstraintTimeline.prototype.getFrameEntries=function(){return 6};IkConstraintTimeline.prototype.setFrame=function(frame,time,mix,softness,bendDirection,compress,stretch){frame*=6;this.frames[frame]=time;this.frames[frame+1]=mix;this.frames[frame+2]=softness;this.frames[frame+3]=bendDirection;this.frames[frame+4]=compress?1:0;this.frames[frame+5]=stretch?1:0};IkConstraintTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var constraint=skeleton.ikConstraints[this.ikConstraintIndex];if(!constraint.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:constraint.mix=constraint.data.mix;constraint.softness=constraint.data.softness;constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch;return;case MixBlend.first:constraint.mix+=(constraint.data.mix-constraint.mix)*alpha;constraint.softness+=(constraint.data.softness-constraint.softness)*alpha;constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch}return}var mix=0,softness=0;var i=Timeline.search(frames,time,6);var curveType=this.curves[i/6];switch(curveType){case 0:var before=frames[i];mix=frames[i+1];softness=frames[i+2];var t=(time-before)/(frames[i+6]-before);mix+=(frames[i+6+1]-mix)*t;softness+=(frames[i+6+2]-softness)*t;break;case 1:mix=frames[i+1];softness=frames[i+2];break;default:mix=this.getBezierValue(time,i,1,curveType-2);softness=this.getBezierValue(time,i,2,curveType+18-2)}if(blend==MixBlend.setup){constraint.mix=constraint.data.mix+(mix-constraint.data.mix)*alpha;constraint.softness=constraint.data.softness+(softness-constraint.data.softness)*alpha;if(direction==MixDirection.mixOut){constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch}else{constraint.bendDirection=frames[i+3];constraint.compress=frames[i+4]!=0;constraint.stretch=frames[i+5]!=0}}else{constraint.mix+=(mix-constraint.mix)*alpha;constraint.softness+=(softness-constraint.softness)*alpha;if(direction==MixDirection.mixIn){constraint.bendDirection=frames[i+3];constraint.compress=frames[i+4]!=0;constraint.stretch=frames[i+5]!=0}}};return IkConstraintTimeline}(CurveTimeline);var TransformConstraintTimeline=function(_super){__extends$1(TransformConstraintTimeline,_super);function TransformConstraintTimeline(frameCount,bezierCount,transformConstraintIndex){var _this=_super.call(this,frameCount,bezierCount,[Property.transformConstraint+"|"+transformConstraintIndex])||this;_this.transformConstraintIndex=transformConstraintIndex;return _this}TransformConstraintTimeline.prototype.getFrameEntries=function(){return 7};TransformConstraintTimeline.prototype.setFrame=function(frame,time,mixRotate,mixX,mixY,mixScaleX,mixScaleY,mixShearY){var frames=this.frames;frame*=7;frames[frame]=time;frames[frame+1]=mixRotate;frames[frame+2]=mixX;frames[frame+3]=mixY;frames[frame+4]=mixScaleX;frames[frame+5]=mixScaleY;frames[frame+6]=mixShearY};TransformConstraintTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var constraint=skeleton.transformConstraints[this.transformConstraintIndex];if(!constraint.active)return;var frames=this.frames;if(time<frames[0]){var data=constraint.data;switch(blend){case MixBlend.setup:constraint.mixRotate=data.mixRotate;constraint.mixX=data.mixX;constraint.mixY=data.mixY;constraint.mixScaleX=data.mixScaleX;constraint.mixScaleY=data.mixScaleY;constraint.mixShearY=data.mixShearY;return;case MixBlend.first:constraint.mixRotate+=(data.mixRotate-constraint.mixRotate)*alpha;constraint.mixX+=(data.mixX-constraint.mixX)*alpha;constraint.mixY+=(data.mixY-constraint.mixY)*alpha;constraint.mixScaleX+=(data.mixScaleX-constraint.mixScaleX)*alpha;constraint.mixScaleY+=(data.mixScaleY-constraint.mixScaleY)*alpha;constraint.mixShearY+=(data.mixShearY-constraint.mixShearY)*alpha}return}var rotate,x,y,scaleX,scaleY,shearY;var i=Timeline.search(frames,time,7);var curveType=this.curves[i/7];switch(curveType){case 0:var before=frames[i];rotate=frames[i+1];x=frames[i+2];y=frames[i+3];scaleX=frames[i+4];scaleY=frames[i+5];shearY=frames[i+6];var t=(time-before)/(frames[i+7]-before);rotate+=(frames[i+7+1]-rotate)*t;x+=(frames[i+7+2]-x)*t;y+=(frames[i+7+3]-y)*t;scaleX+=(frames[i+7+4]-scaleX)*t;scaleY+=(frames[i+7+5]-scaleY)*t;shearY+=(frames[i+7+6]-shearY)*t;break;case 1:rotate=frames[i+1];x=frames[i+2];y=frames[i+3];scaleX=frames[i+4];scaleY=frames[i+5];shearY=frames[i+6];break;default:rotate=this.getBezierValue(time,i,1,curveType-2);x=this.getBezierValue(time,i,2,curveType+18-2);y=this.getBezierValue(time,i,3,curveType+18*2-2);scaleX=this.getBezierValue(time,i,4,curveType+18*3-2);scaleY=this.getBezierValue(time,i,5,curveType+18*4-2);shearY=this.getBezierValue(time,i,6,curveType+18*5-2)}if(blend==MixBlend.setup){var data=constraint.data;constraint.mixRotate=data.mixRotate+(rotate-data.mixRotate)*alpha;constraint.mixX=data.mixX+(x-data.mixX)*alpha;constraint.mixY=data.mixY+(y-data.mixY)*alpha;constraint.mixScaleX=data.mixScaleX+(scaleX-data.mixScaleX)*alpha;constraint.mixScaleY=data.mixScaleY+(scaleY-data.mixScaleY)*alpha;constraint.mixShearY=data.mixShearY+(shearY-data.mixShearY)*alpha}else{constraint.mixRotate+=(rotate-constraint.mixRotate)*alpha;constraint.mixX+=(x-constraint.mixX)*alpha;constraint.mixY+=(y-constraint.mixY)*alpha;constraint.mixScaleX+=(scaleX-constraint.mixScaleX)*alpha;constraint.mixScaleY+=(scaleY-constraint.mixScaleY)*alpha;constraint.mixShearY+=(shearY-constraint.mixShearY)*alpha}};return TransformConstraintTimeline}(CurveTimeline);var PathConstraintPositionTimeline=function(_super){__extends$1(PathConstraintPositionTimeline,_super);function PathConstraintPositionTimeline(frameCount,bezierCount,pathConstraintIndex){var _this=_super.call(this,frameCount,bezierCount,Property.pathConstraintPosition+"|"+pathConstraintIndex)||this;_this.pathConstraintIndex=pathConstraintIndex;return _this}PathConstraintPositionTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var constraint=skeleton.pathConstraints[this.pathConstraintIndex];if(!constraint.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:constraint.position=constraint.data.position;return;case MixBlend.first:constraint.position+=(constraint.data.position-constraint.position)*alpha}return}var position=this.getCurveValue(time);if(blend==MixBlend.setup)constraint.position=constraint.data.position+(position-constraint.data.position)*alpha;else constraint.position+=(position-constraint.position)*alpha};return PathConstraintPositionTimeline}(CurveTimeline1);var PathConstraintSpacingTimeline=function(_super){__extends$1(PathConstraintSpacingTimeline,_super);function PathConstraintSpacingTimeline(frameCount,bezierCount,pathConstraintIndex){var _this=_super.call(this,frameCount,bezierCount,Property.pathConstraintSpacing+"|"+pathConstraintIndex)||this;_this.pathConstraintIndex=0;_this.pathConstraintIndex=pathConstraintIndex;return _this}PathConstraintSpacingTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var constraint=skeleton.pathConstraints[this.pathConstraintIndex];if(!constraint.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:constraint.spacing=constraint.data.spacing;return;case MixBlend.first:constraint.spacing+=(constraint.data.spacing-constraint.spacing)*alpha}return}var spacing=this.getCurveValue(time);if(blend==MixBlend.setup)constraint.spacing=constraint.data.spacing+(spacing-constraint.data.spacing)*alpha;else constraint.spacing+=(spacing-constraint.spacing)*alpha};return PathConstraintSpacingTimeline}(CurveTimeline1);var PathConstraintMixTimeline=function(_super){__extends$1(PathConstraintMixTimeline,_super);function PathConstraintMixTimeline(frameCount,bezierCount,pathConstraintIndex){var _this=_super.call(this,frameCount,bezierCount,[Property.pathConstraintMix+"|"+pathConstraintIndex])||this;_this.pathConstraintIndex=0;_this.pathConstraintIndex=pathConstraintIndex;return _this}PathConstraintMixTimeline.prototype.getFrameEntries=function(){return 4};PathConstraintMixTimeline.prototype.setFrame=function(frame,time,mixRotate,mixX,mixY){var frames=this.frames;frame<<=2;frames[frame]=time;frames[frame+1]=mixRotate;frames[frame+2]=mixX;frames[frame+3]=mixY};PathConstraintMixTimeline.prototype.apply=function(skeleton,lastTime,time,firedEvents,alpha,blend,direction){var constraint=skeleton.pathConstraints[this.pathConstraintIndex];if(!constraint.active)return;var frames=this.frames;if(time<frames[0]){switch(blend){case MixBlend.setup:constraint.mixRotate=constraint.data.mixRotate;constraint.mixX=constraint.data.mixX;constraint.mixY=constraint.data.mixY;return;case MixBlend.first:constraint.mixRotate+=(constraint.data.mixRotate-constraint.mixRotate)*alpha;constraint.mixX+=(constraint.data.mixX-constraint.mixX)*alpha;constraint.mixY+=(constraint.data.mixY-constraint.mixY)*alpha}return}var rotate,x,y;var i=Timeline.search(frames,time,4);var curveType=this.curves[i>>2];switch(curveType){case 0:var before=frames[i];rotate=frames[i+1];x=frames[i+2];y=frames[i+3];var t=(time-before)/(frames[i+4]-before);rotate+=(frames[i+4+1]-rotate)*t;x+=(frames[i+4+2]-x)*t;y+=(frames[i+4+3]-y)*t;break;case 1:rotate=frames[i+1];x=frames[i+2];y=frames[i+3];break;default:rotate=this.getBezierValue(time,i,1,curveType-2);x=this.getBezierValue(time,i,2,curveType+18-2);y=this.getBezierValue(time,i,3,curveType+18*2-2)}if(blend==MixBlend.setup){var data=constraint.data;constraint.mixRotate=data.mixRotate+(rotate-data.mixRotate)*alpha;constraint.mixX=data.mixX+(x-data.mixX)*alpha;constraint.mixY=data.mixY+(y-data.mixY)*alpha}else{constraint.mixRotate+=(rotate-constraint.mixRotate)*alpha;constraint.mixX+=(x-constraint.mixX)*alpha;constraint.mixY+=(y-constraint.mixY)*alpha}};return PathConstraintMixTimeline}(CurveTimeline);var AnimationState=function(){function AnimationState(data){this.tracks=new Array;this.timeScale=1;this.unkeyedState=0;this.events=new Array;this.listeners=new Array;this.queue=new EventQueue(this);this.propertyIDs=new StringSet;this.animationsChanged=false;this.trackEntryPool=new Pool(function(){return new TrackEntry});this.data=data}AnimationState.emptyAnimation=function(){if(!_emptyAnimation)_emptyAnimation=new Animation("<empty>",[],0);return _emptyAnimation};AnimationState.prototype.update=function(delta){delta*=this.timeScale;var tracks=this.tracks;for(var i=0,n=tracks.length;i<n;i++){var current=tracks[i];if(!current)continue;current.animationLast=current.nextAnimationLast;current.trackLast=current.nextTrackLast;var currentDelta=delta*current.timeScale;if(current.delay>0){current.delay-=currentDelta;if(current.delay>0)continue;currentDelta=-current.delay;current.delay=0}var next=current.next;if(next){var nextTime=current.trackLast-next.delay;if(nextTime>=0){next.delay=0;next.trackTime+=current.timeScale==0?0:(nextTime/current.timeScale+delta)*next.timeScale;current.trackTime+=currentDelta;this.setCurrent(i,next,true);while(next.mixingFrom){next.mixTime+=delta;next=next.mixingFrom}continue}}else if(current.trackLast>=current.trackEnd&&!current.mixingFrom){tracks[i]=null;this.queue.end(current);this.clearNext(current);continue}if(current.mixingFrom&&this.updateMixingFrom(current,delta)){var from=current.mixingFrom;current.mixingFrom=null;if(from)from.mixingTo=null;while(from){this.queue.end(from);from=from.mixingFrom}}current.trackTime+=currentDelta}this.queue.drain()};AnimationState.prototype.updateMixingFrom=function(to,delta){var from=to.mixingFrom;if(!from)return true;var finished=this.updateMixingFrom(from,delta);from.animationLast=from.nextAnimationLast;from.trackLast=from.nextTrackLast;if(to.mixTime>0&&to.mixTime>=to.mixDuration){if(from.totalAlpha==0||to.mixDuration==0){to.mixingFrom=from.mixingFrom;if(from.mixingFrom)from.mixingFrom.mixingTo=to;to.interruptAlpha=from.interruptAlpha;this.queue.end(from)}return finished}from.trackTime+=delta*from.timeScale;to.mixTime+=delta;return false};AnimationState.prototype.apply=function(skeleton){if(!skeleton)throw new Error("skeleton cannot be null.");if(this.animationsChanged)this._animationsChanged();var events=this.events;var tracks=this.tracks;var applied=false;for(var i_1=0,n_1=tracks.length;i_1<n_1;i_1++){var current=tracks[i_1];if(!current||current.delay>0)continue;applied=true;var blend=i_1==0?MixBlend.first:current.mixBlend;var mix=current.alpha;if(current.mixingFrom)mix*=this.applyMixingFrom(current,skeleton,blend);else if(current.trackTime>=current.trackEnd&&!current.next)mix=0;var animationLast=current.animationLast,animationTime=current.getAnimationTime(),applyTime=animationTime;var applyEvents=events;if(current.reverse){applyTime=current.animation.duration-applyTime;applyEvents=null}var timelines=current.animation.timelines;var timelineCount=timelines.length;if(i_1==0&&mix==1||blend==MixBlend.add){for(var ii=0;ii<timelineCount;ii++){Utils.webkit602BugfixHelper(mix,blend);var timeline=timelines[ii];if(timeline instanceof AttachmentTimeline)this.applyAttachmentTimeline(timeline,skeleton,applyTime,blend,true);else timeline.apply(skeleton,animationLast,applyTime,applyEvents,mix,blend,MixDirection.mixIn)}}else{var timelineMode=current.timelineMode;var firstFrame=current.timelinesRotation.length!=timelineCount<<1;if(firstFrame)current.timelinesRotation.length=timelineCount<<1;for(var ii=0;ii<timelineCount;ii++){var timeline_1=timelines[ii];var timelineBlend=timelineMode[ii]==SUBSEQUENT?blend:MixBlend.setup;if(timeline_1 instanceof RotateTimeline){this.applyRotateTimeline(timeline_1,skeleton,applyTime,mix,timelineBlend,current.timelinesRotation,ii<<1,firstFrame)}else if(timeline_1 instanceof AttachmentTimeline){this.applyAttachmentTimeline(timeline_1,skeleton,applyTime,blend,true)}else{Utils.webkit602BugfixHelper(mix,blend);timeline_1.apply(skeleton,animationLast,applyTime,applyEvents,mix,timelineBlend,MixDirection.mixIn)}}}this.queueEvents(current,animationTime);events.length=0;current.nextAnimationLast=animationTime;current.nextTrackLast=current.trackTime}var setupState=this.unkeyedState+SETUP;var slots=skeleton.slots;for(var i=0,n=skeleton.slots.length;i<n;i++){var slot=slots[i];if(slot.attachmentState==setupState){var attachmentName=slot.data.attachmentName;slot.setAttachment(!attachmentName?null:skeleton.getAttachment(slot.data.index,attachmentName))}}this.unkeyedState+=2;this.queue.drain();return applied};AnimationState.prototype.applyMixingFrom=function(to,skeleton,blend){var from=to.mixingFrom;if(from.mixingFrom)this.applyMixingFrom(from,skeleton,blend);var mix=0;if(to.mixDuration==0){mix=1;if(blend==MixBlend.first)blend=MixBlend.setup}else{mix=to.mixTime/to.mixDuration;if(mix>1)mix=1;if(blend!=MixBlend.first)blend=from.mixBlend}var attachments=mix<from.attachmentThreshold,drawOrder=mix<from.drawOrderThreshold;var timelines=from.animation.timelines;var timelineCount=timelines.length;var alphaHold=from.alpha*to.interruptAlpha,alphaMix=alphaHold*(1-mix);var animationLast=from.animationLast,animationTime=from.getAnimationTime(),applyTime=animationTime;var events=null;if(from.reverse)applyTime=from.animation.duration-applyTime;else if(mix<from.eventThreshold)events=this.events;if(blend==MixBlend.add){for(var i=0;i<timelineCount;i++)timelines[i].apply(skeleton,animationLast,applyTime,events,alphaMix,blend,MixDirection.mixOut)}else{var timelineMode=from.timelineMode;var timelineHoldMix=from.timelineHoldMix;var firstFrame=from.timelinesRotation.length!=timelineCount<<1;if(firstFrame)from.timelinesRotation.length=timelineCount<<1;from.totalAlpha=0;for(var i=0;i<timelineCount;i++){var timeline=timelines[i];var direction=MixDirection.mixOut;var timelineBlend=void 0;var alpha=0;switch(timelineMode[i]){case SUBSEQUENT:if(!drawOrder&&timeline instanceof DrawOrderTimeline)continue;timelineBlend=blend;alpha=alphaMix;break;case FIRST:timelineBlend=MixBlend.setup;alpha=alphaMix;break;case HOLD_SUBSEQUENT:timelineBlend=blend;alpha=alphaHold;break;case HOLD_FIRST:timelineBlend=MixBlend.setup;alpha=alphaHold;break;default:timelineBlend=MixBlend.setup;var holdMix=timelineHoldMix[i];alpha=alphaHold*Math.max(0,1-holdMix.mixTime/holdMix.mixDuration);break}from.totalAlpha+=alpha;if(timeline instanceof RotateTimeline)this.applyRotateTimeline(timeline,skeleton,applyTime,alpha,timelineBlend,from.timelinesRotation,i<<1,firstFrame);else if(timeline instanceof AttachmentTimeline)this.applyAttachmentTimeline(timeline,skeleton,applyTime,timelineBlend,attachments);else{Utils.webkit602BugfixHelper(alpha,blend);if(drawOrder&&timeline instanceof DrawOrderTimeline&&timelineBlend==MixBlend.setup)direction=MixDirection.mixIn;timeline.apply(skeleton,animationLast,applyTime,events,alpha,timelineBlend,direction)}}}if(to.mixDuration>0)this.queueEvents(from,animationTime);this.events.length=0;from.nextAnimationLast=animationTime;from.nextTrackLast=from.trackTime;return mix};AnimationState.prototype.applyAttachmentTimeline=function(timeline,skeleton,time,blend,attachments){var slot=skeleton.slots[timeline.slotIndex];if(!slot.bone.active)return;if(time<timeline.frames[0]){if(blend==MixBlend.setup||blend==MixBlend.first)this.setAttachment(skeleton,slot,slot.data.attachmentName,attachments)}else this.setAttachment(skeleton,slot,timeline.attachmentNames[Timeline.search1(timeline.frames,time)],attachments);if(slot.attachmentState<=this.unkeyedState)slot.attachmentState=this.unkeyedState+SETUP};AnimationState.prototype.setAttachment=function(skeleton,slot,attachmentName,attachments){slot.setAttachment(!attachmentName?null:skeleton.getAttachment(slot.data.index,attachmentName));if(attachments)slot.attachmentState=this.unkeyedState+CURRENT};AnimationState.prototype.applyRotateTimeline=function(timeline,skeleton,time,alpha,blend,timelinesRotation,i,firstFrame){if(firstFrame)timelinesRotation[i]=0;if(alpha==1){timeline.apply(skeleton,0,time,null,1,blend,MixDirection.mixIn);return}var bone=skeleton.bones[timeline.boneIndex];if(!bone.active)return;var frames=timeline.frames;var r1=0,r2=0;if(time<frames[0]){switch(blend){case MixBlend.setup:bone.rotation=bone.data.rotation;default:return;case MixBlend.first:r1=bone.rotation;r2=bone.data.rotation}}else{r1=blend==MixBlend.setup?bone.data.rotation:bone.rotation;r2=bone.data.rotation+timeline.getCurveValue(time)}var total=0,diff=r2-r1;diff-=(16384-(16384.499999999996-diff/360|0))*360;if(diff==0){total=timelinesRotation[i]}else{var lastTotal=0,lastDiff=0;if(firstFrame){lastTotal=0;lastDiff=diff}else{lastTotal=timelinesRotation[i];lastDiff=timelinesRotation[i+1]}var current=diff>0,dir=lastTotal>=0;if(MathUtils.signum(lastDiff)!=MathUtils.signum(diff)&&Math.abs(lastDiff)<=90){if(Math.abs(lastTotal)>180)lastTotal+=360*MathUtils.signum(lastTotal);dir=current}total=diff+lastTotal-lastTotal%360;if(dir!=current)total+=360*MathUtils.signum(lastTotal);timelinesRotation[i]=total}timelinesRotation[i+1]=diff;bone.rotation=r1+total*alpha};AnimationState.prototype.queueEvents=function(entry,animationTime){var animationStart=entry.animationStart,animationEnd=entry.animationEnd;var duration=animationEnd-animationStart;var trackLastWrapped=entry.trackLast%duration;var events=this.events;var i=0,n=events.length;for(;i<n;i++){var event_1=events[i];if(event_1.time<trackLastWrapped)break;if(event_1.time>animationEnd)continue;this.queue.event(entry,event_1)}var complete=false;if(entry.loop)complete=duration==0||trackLastWrapped>entry.trackTime%duration;else complete=animationTime>=animationEnd&&entry.animationLast<animationEnd;if(complete)this.queue.complete(entry);for(;i<n;i++){var event_2=events[i];if(event_2.time<animationStart)continue;this.queue.event(entry,event_2)}};AnimationState.prototype.clearTracks=function(){var oldDrainDisabled=this.queue.drainDisabled;this.queue.drainDisabled=true;for(var i=0,n=this.tracks.length;i<n;i++)this.clearTrack(i);this.tracks.length=0;this.queue.drainDisabled=oldDrainDisabled;this.queue.drain()};AnimationState.prototype.clearTrack=function(trackIndex){if(trackIndex>=this.tracks.length)return;var current=this.tracks[trackIndex];if(!current)return;this.queue.end(current);this.clearNext(current);var entry=current;while(true){var from=entry.mixingFrom;if(!from)break;this.queue.end(from);entry.mixingFrom=null;entry.mixingTo=null;entry=from}this.tracks[current.trackIndex]=null;this.queue.drain()};AnimationState.prototype.setCurrent=function(index,current,interrupt){var from=this.expandToIndex(index);this.tracks[index]=current;current.previous=null;if(from){if(interrupt)this.queue.interrupt(from);current.mixingFrom=from;from.mixingTo=current;current.mixTime=0;if(from.mixingFrom&&from.mixDuration>0)current.interruptAlpha*=Math.min(1,from.mixTime/from.mixDuration);from.timelinesRotation.length=0}this.queue.start(current)};AnimationState.prototype.setAnimation=function(trackIndex,animationName,loop){if(loop===void 0){loop=false}var animation=this.data.skeletonData.findAnimation(animationName);if(!animation)throw new Error("Animation not found: "+animationName);return this.setAnimationWith(trackIndex,animation,loop)};AnimationState.prototype.setAnimationWith=function(trackIndex,animation,loop){if(loop===void 0){loop=false}if(!animation)throw new Error("animation cannot be null.");var interrupt=true;var current=this.expandToIndex(trackIndex);if(current){if(current.nextTrackLast==-1){this.tracks[trackIndex]=current.mixingFrom;this.queue.interrupt(current);this.queue.end(current);this.clearNext(current);current=current.mixingFrom;interrupt=false}else this.clearNext(current)}var entry=this.trackEntry(trackIndex,animation,loop,current);this.setCurrent(trackIndex,entry,interrupt);this.queue.drain();return entry};AnimationState.prototype.addAnimation=function(trackIndex,animationName,loop,delay){if(loop===void 0){loop=false}if(delay===void 0){delay=0}var animation=this.data.skeletonData.findAnimation(animationName);if(!animation)throw new Error("Animation not found: "+animationName);return this.addAnimationWith(trackIndex,animation,loop,delay)};AnimationState.prototype.addAnimationWith=function(trackIndex,animation,loop,delay){if(loop===void 0){loop=false}if(delay===void 0){delay=0}if(!animation)throw new Error("animation cannot be null.");var last=this.expandToIndex(trackIndex);if(last){while(last.next)last=last.next}var entry=this.trackEntry(trackIndex,animation,loop,last);if(!last){this.setCurrent(trackIndex,entry,true);this.queue.drain()}else{last.next=entry;entry.previous=last;if(delay<=0)delay+=last.getTrackComplete()-entry.mixDuration}entry.delay=delay;return entry};AnimationState.prototype.setEmptyAnimation=function(trackIndex,mixDuration){if(mixDuration===void 0){mixDuration=0}var entry=this.setAnimationWith(trackIndex,AnimationState.emptyAnimation(),false);entry.mixDuration=mixDuration;entry.trackEnd=mixDuration;return entry};AnimationState.prototype.addEmptyAnimation=function(trackIndex,mixDuration,delay){if(mixDuration===void 0){mixDuration=0}if(delay===void 0){delay=0}var entry=this.addAnimationWith(trackIndex,AnimationState.emptyAnimation(),false,delay<=0?1:delay);entry.mixDuration=mixDuration;entry.trackEnd=mixDuration;if(delay<=0&&entry.previous)entry.delay=entry.previous.getTrackComplete()-entry.mixDuration+delay;return entry};AnimationState.prototype.setEmptyAnimations=function(mixDuration){if(mixDuration===void 0){mixDuration=0}var oldDrainDisabled=this.queue.drainDisabled;this.queue.drainDisabled=true;for(var i=0,n=this.tracks.length;i<n;i++){var current=this.tracks[i];if(current)this.setEmptyAnimation(current.trackIndex,mixDuration)}this.queue.drainDisabled=oldDrainDisabled;this.queue.drain()};AnimationState.prototype.expandToIndex=function(index){if(index<this.tracks.length)return this.tracks[index];Utils.ensureArrayCapacity(this.tracks,index+1,null);this.tracks.length=index+1;return null};AnimationState.prototype.trackEntry=function(trackIndex,animation,loop,last){var entry=this.trackEntryPool.obtain();entry.trackIndex=trackIndex;entry.animation=animation;entry.loop=loop;entry.holdPrevious=false;entry.eventThreshold=0;entry.attachmentThreshold=0;entry.drawOrderThreshold=0;entry.animationStart=0;entry.animationEnd=animation.duration;entry.animationLast=-1;entry.nextAnimationLast=-1;entry.delay=0;entry.trackTime=0;entry.trackLast=-1;entry.nextTrackLast=-1;entry.trackEnd=Number.MAX_VALUE;entry.timeScale=1;entry.alpha=1;entry.interruptAlpha=1;entry.mixTime=0;entry.mixDuration=!last?0:this.data.getMix(last.animation,animation);entry.mixBlend=MixBlend.replace;return entry};AnimationState.prototype.clearNext=function(entry){var next=entry.next;while(next){this.queue.dispose(next);next=next.next}entry.next=null};AnimationState.prototype._animationsChanged=function(){this.animationsChanged=false;this.propertyIDs.clear();var tracks=this.tracks;for(var i=0,n=tracks.length;i<n;i++){var entry=tracks[i];if(!entry)continue;while(entry.mixingFrom)entry=entry.mixingFrom;do{if(!entry.mixingTo||entry.mixBlend!=MixBlend.add)this.computeHold(entry);entry=entry.mixingTo}while(entry)}};AnimationState.prototype.computeHold=function(entry){var to=entry.mixingTo;var timelines=entry.animation.timelines;var timelinesCount=entry.animation.timelines.length;var timelineMode=entry.timelineMode;timelineMode.length=timelinesCount;var timelineHoldMix=entry.timelineHoldMix;timelineHoldMix.length=0;var propertyIDs=this.propertyIDs;if(to&&to.holdPrevious){for(var i=0;i<timelinesCount;i++)timelineMode[i]=propertyIDs.addAll(timelines[i].getPropertyIds())?HOLD_FIRST:HOLD_SUBSEQUENT;return}outer:for(var i=0;i<timelinesCount;i++){var timeline=timelines[i];var ids=timeline.getPropertyIds();if(!propertyIDs.addAll(ids))timelineMode[i]=SUBSEQUENT;else if(!to||timeline instanceof AttachmentTimeline||timeline instanceof DrawOrderTimeline||timeline instanceof EventTimeline||!to.animation.hasTimeline(ids)){timelineMode[i]=FIRST}else{for(var next=to.mixingTo;next;next=next.mixingTo){if(next.animation.hasTimeline(ids))continue;if(entry.mixDuration>0){timelineMode[i]=HOLD_MIX;timelineHoldMix[i]=next;continue outer}break}timelineMode[i]=HOLD_FIRST}}};AnimationState.prototype.getCurrent=function(trackIndex){if(trackIndex>=this.tracks.length)return null;return this.tracks[trackIndex]};AnimationState.prototype.addListener=function(listener){if(!listener)throw new Error("listener cannot be null.");this.listeners.push(listener)};AnimationState.prototype.removeListener=function(listener){var index=this.listeners.indexOf(listener);if(index>=0)this.listeners.splice(index,1)};AnimationState.prototype.clearListeners=function(){this.listeners.length=0};AnimationState.prototype.clearListenerNotifications=function(){this.queue.clear()};AnimationState.prototype.setAnimationByName=function(trackIndex,animationName,loop){if(!AnimationState.deprecatedWarning1){AnimationState.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")}this.setAnimation(trackIndex,animationName,loop)};AnimationState.prototype.addAnimationByName=function(trackIndex,animationName,loop,delay){if(!AnimationState.deprecatedWarning2){AnimationState.deprecatedWarning2=true;console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")}this.addAnimation(trackIndex,animationName,loop,delay)};AnimationState.prototype.hasAnimation=function(animationName){var animation=this.data.skeletonData.findAnimation(animationName);return animation!==null};AnimationState.prototype.hasAnimationByName=function(animationName){if(!AnimationState.deprecatedWarning3){AnimationState.deprecatedWarning3=true;console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")}return this.hasAnimation(animationName)};AnimationState.deprecatedWarning1=false;AnimationState.deprecatedWarning2=false;AnimationState.deprecatedWarning3=false;return AnimationState}();var TrackEntry=function(){function TrackEntry(){this.mixBlend=MixBlend.replace;this.timelineMode=new Array;this.timelineHoldMix=new Array;this.timelinesRotation=new Array}TrackEntry.prototype.reset=function(){this.previous=null;this.next=null;this.mixingFrom=null;this.mixingTo=null;this.animation=null;this.listener=null;this.timelineMode.length=0;this.timelineHoldMix.length=0;this.timelinesRotation.length=0};TrackEntry.prototype.getAnimationTime=function(){if(this.loop){var duration=this.animationEnd-this.animationStart;if(duration==0)return this.animationStart;return this.trackTime%duration+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)};TrackEntry.prototype.setAnimationLast=function(animationLast){this.animationLast=animationLast;this.nextAnimationLast=animationLast};TrackEntry.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart};TrackEntry.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0};TrackEntry.prototype.getTrackComplete=function(){var duration=this.animationEnd-this.animationStart;if(duration!=0){if(this.loop)return duration*(1+(this.trackTime/duration|0));if(this.trackTime<duration)return duration}return this.trackTime};Object.defineProperty(TrackEntry.prototype,"time",{get:function(){if(!TrackEntry.deprecatedWarning1){TrackEntry.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")}return this.trackTime},set:function(value){if(!TrackEntry.deprecatedWarning1){TrackEntry.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")}this.trackTime=value},enumerable:false,configurable:true});Object.defineProperty(TrackEntry.prototype,"endTime",{get:function(){if(!TrackEntry.deprecatedWarning2){TrackEntry.deprecatedWarning2=true;console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")}return this.trackTime},set:function(value){if(!TrackEntry.deprecatedWarning2){TrackEntry.deprecatedWarning2=true;console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")}this.trackTime=value},enumerable:false,configurable:true});TrackEntry.prototype.loopsCount=function(){return Math.floor(this.trackTime/this.trackEnd)};TrackEntry.deprecatedWarning1=false;TrackEntry.deprecatedWarning2=false;return TrackEntry}();var EventQueue=function(){function EventQueue(animState){this.objects=[];this.drainDisabled=false;this.animState=animState}EventQueue.prototype.start=function(entry){this.objects.push(EventType.start);this.objects.push(entry);this.animState.animationsChanged=true};EventQueue.prototype.interrupt=function(entry){this.objects.push(EventType.interrupt);this.objects.push(entry)};EventQueue.prototype.end=function(entry){this.objects.push(EventType.end);this.objects.push(entry);this.animState.animationsChanged=true};EventQueue.prototype.dispose=function(entry){this.objects.push(EventType.dispose);this.objects.push(entry)};EventQueue.prototype.complete=function(entry){this.objects.push(EventType.complete);this.objects.push(entry)};EventQueue.prototype.event=function(entry,event){this.objects.push(EventType.event);this.objects.push(entry);this.objects.push(event)};EventQueue.prototype.drain=function(){if(this.drainDisabled)return;this.drainDisabled=true;var objects=this.objects;var listeners=this.animState.listeners;for(var i=0;i<objects.length;i+=2){var type=objects[i];var entry=objects[i+1];switch(type){case EventType.start:if(entry.listener!=null&&entry.listener.start)entry.listener.start(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].start)listeners[ii].start(entry);break;case EventType.interrupt:if(entry.listener!=null&&entry.listener.interrupt)entry.listener.interrupt(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].interrupt)listeners[ii].interrupt(entry);break;case EventType.end:if(entry.listener!=null&&entry.listener.end)entry.listener.end(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].end)listeners[ii].end(entry);case EventType.dispose:if(entry.listener!=null&&entry.listener.dispose)entry.listener.dispose(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].dispose)listeners[ii].dispose(entry);this.animState.trackEntryPool.free(entry);break;case EventType.complete:if(entry.listener!=null&&entry.listener.complete)entry.listener.complete(entry);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].complete)listeners[ii].complete(entry);break;case EventType.event:var event_3=objects[i+++2];if(entry.listener!=null&&entry.listener.event)entry.listener.event(entry,event_3);for(var ii=0;ii<listeners.length;ii++)if(listeners[ii].event)listeners[ii].event(entry,event_3);break}}this.clear();this.drainDisabled=false};EventQueue.prototype.clear=function(){this.objects.length=0};return EventQueue}();var EventType;(function(EventType){EventType[EventType["start"]=0]="start";EventType[EventType["interrupt"]=1]="interrupt";EventType[EventType["end"]=2]="end";EventType[EventType["dispose"]=3]="dispose";EventType[EventType["complete"]=4]="complete";EventType[EventType["event"]=5]="event"})(EventType||(EventType={}));var AnimationStateAdapter=function(){function AnimationStateAdapter(){}AnimationStateAdapter.prototype.start=function(entry){};AnimationStateAdapter.prototype.interrupt=function(entry){};AnimationStateAdapter.prototype.end=function(entry){};AnimationStateAdapter.prototype.dispose=function(entry){};AnimationStateAdapter.prototype.complete=function(entry){};AnimationStateAdapter.prototype.event=function(entry,event){};return AnimationStateAdapter}();var SUBSEQUENT=0;var FIRST=1;var HOLD_SUBSEQUENT=2;var HOLD_FIRST=3;var HOLD_MIX=4;var SETUP=1;var CURRENT=2;var _emptyAnimation=null;var AnimationStateData=function(){function AnimationStateData(skeletonData){this.animationToMixTime={};this.defaultMix=0;if(skeletonData==null)throw new Error("skeletonData cannot be null.");this.skeletonData=skeletonData}AnimationStateData.prototype.setMix=function(fromName,toName,duration){var from=this.skeletonData.findAnimation(fromName);if(from==null)throw new Error("Animation not found: "+fromName);var to=this.skeletonData.findAnimation(toName);if(to==null)throw new Error("Animation not found: "+toName);this.setMixWith(from,to,duration)};AnimationStateData.prototype.setMixWith=function(from,to,duration){if(from==null)throw new Error("from cannot be null.");if(to==null)throw new Error("to cannot be null.");var key=from.name+"."+to.name;this.animationToMixTime[key]=duration};AnimationStateData.prototype.getMix=function(from,to){var key=from.name+"."+to.name;var value=this.animationToMixTime[key];return value===undefined?this.defaultMix:value};return AnimationStateData}();var AtlasAttachmentLoader=function(){function AtlasAttachmentLoader(atlas){this.atlas=atlas}AtlasAttachmentLoader.prototype.newRegionAttachment=function(skin,name,path){var region=this.atlas.findRegion(path);if(region==null)throw new Error("Region not found in atlas: "+path+" (region attachment: "+name+")");var attachment=new RegionAttachment(name);attachment.region=region;return attachment};AtlasAttachmentLoader.prototype.newMeshAttachment=function(skin,name,path){var region=this.atlas.findRegion(path);if(region==null)throw new Error("Region not found in atlas: "+path+" (mesh attachment: "+name+")");var attachment=new MeshAttachment(name);attachment.region=region;return attachment};AtlasAttachmentLoader.prototype.newBoundingBoxAttachment=function(skin,name){return new BoundingBoxAttachment(name)};AtlasAttachmentLoader.prototype.newPathAttachment=function(skin,name){return new PathAttachment(name)};AtlasAttachmentLoader.prototype.newPointAttachment=function(skin,name){return new PointAttachment(name)};AtlasAttachmentLoader.prototype.newClippingAttachment=function(skin,name){return new ClippingAttachment(name)};return AtlasAttachmentLoader}();var BoneData=function(){function BoneData(index,name,parent){this.x=0;this.y=0;this.rotation=0;this.scaleX=1;this.scaleY=1;this.shearX=0;this.shearY=0;this.transformMode=TransformMode.Normal;this.skinRequired=false;this.color=new Color;if(index<0)throw new Error("index must be >= 0.");if(name==null)throw new Error("name cannot be null.");this.index=index;this.name=name;this.parent=parent}return BoneData}();var TransformMode;(function(TransformMode){TransformMode[TransformMode["Normal"]=0]="Normal";TransformMode[TransformMode["OnlyTranslation"]=1]="OnlyTranslation";TransformMode[TransformMode["NoRotationOrReflection"]=2]="NoRotationOrReflection";TransformMode[TransformMode["NoScale"]=3]="NoScale";TransformMode[TransformMode["NoScaleOrReflection"]=4]="NoScaleOrReflection"})(TransformMode||(TransformMode={}));var Bone=function(){function Bone(data,skeleton,parent){this.matrix=new math.Matrix;this.children=new Array;this.x=0;this.y=0;this.rotation=0;this.scaleX=0;this.scaleY=0;this.shearX=0;this.shearY=0;this.ax=0;this.ay=0;this.arotation=0;this.ascaleX=0;this.ascaleY=0;this.ashearX=0;this.ashearY=0;this.sorted=false;this.active=false;if(!data)throw new Error("data cannot be null.");if(!skeleton)throw new Error("skeleton cannot be null.");this.data=data;this.skeleton=skeleton;this.parent=parent;this.setToSetupPose()}Object.defineProperty(Bone.prototype,"worldX",{get:function(){return this.matrix.tx},enumerable:false,configurable:true});Object.defineProperty(Bone.prototype,"worldY",{get:function(){return this.matrix.ty},enumerable:false,configurable:true});Bone.prototype.isActive=function(){return this.active};Bone.prototype.update=function(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)};Bone.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)};Bone.prototype.updateWorldTransformWith=function(x,y,rotation,scaleX,scaleY,shearX,shearY){this.ax=x;this.ay=y;this.arotation=rotation;this.ascaleX=scaleX;this.ascaleY=scaleY;this.ashearX=shearX;this.ashearY=shearY;var parent=this.parent;var m=this.matrix;var sx=this.skeleton.scaleX;var sy=settings.yDown?-this.skeleton.scaleY:this.skeleton.scaleY;if(!parent){var skeleton=this.skeleton;var rotationY=rotation+90+shearY;m.a=MathUtils.cosDeg(rotation+shearX)*scaleX*sx;m.c=MathUtils.cosDeg(rotationY)*scaleY*sx;m.b=MathUtils.sinDeg(rotation+shearX)*scaleX*sy;m.d=MathUtils.sinDeg(rotationY)*scaleY*sy;m.tx=x*sx+skeleton.x;m.ty=y*sy+skeleton.y;return}var pa=parent.matrix.a,pb=parent.matrix.c,pc=parent.matrix.b,pd=parent.matrix.d;m.tx=pa*x+pb*y+parent.matrix.tx;m.ty=pc*x+pd*y+parent.matrix.ty;switch(this.data.transformMode){case TransformMode.Normal:{var rotationY=rotation+90+shearY;var la=MathUtils.cosDeg(rotation+shearX)*scaleX;var lb=MathUtils.cosDeg(rotationY)*scaleY;var lc=MathUtils.sinDeg(rotation+shearX)*scaleX;var ld=MathUtils.sinDeg(rotationY)*scaleY;m.a=pa*la+pb*lc;m.c=pa*lb+pb*ld;m.b=pc*la+pd*lc;m.d=pc*lb+pd*ld;return}case TransformMode.OnlyTranslation:{var rotationY=rotation+90+shearY;m.a=MathUtils.cosDeg(rotation+shearX)*scaleX;m.c=MathUtils.cosDeg(rotationY)*scaleY;m.b=MathUtils.sinDeg(rotation+shearX)*scaleX;m.d=MathUtils.sinDeg(rotationY)*scaleY;break}case TransformMode.NoRotationOrReflection:{var s=pa*pa+pc*pc;var prx=0;if(s>1e-4){s=Math.abs(pa*pd-pb*pc)/s;pa/=this.skeleton.scaleX;pc/=this.skeleton.scaleY;pb=pc*s;pd=pa*s;prx=Math.atan2(pc,pa)*MathUtils.radDeg}else{pa=0;pc=0;prx=90-Math.atan2(pd,pb)*MathUtils.radDeg}var rx=rotation+shearX-prx;var ry=rotation+shearY-prx+90;var la=MathUtils.cosDeg(rx)*scaleX;var lb=MathUtils.cosDeg(ry)*scaleY;var lc=MathUtils.sinDeg(rx)*scaleX;var ld=MathUtils.sinDeg(ry)*scaleY;m.a=pa*la-pb*lc;m.c=pa*lb-pb*ld;m.b=pc*la+pd*lc;m.d=pc*lb+pd*ld;break}case TransformMode.NoScale:case TransformMode.NoScaleOrReflection:{var cos=MathUtils.cosDeg(rotation);var sin=MathUtils.sinDeg(rotation);var za=(pa*cos+pb*sin)/sx;var zc=(pc*cos+pd*sin)/sy;var s=Math.sqrt(za*za+zc*zc);if(s>1e-5)s=1/s;za*=s;zc*=s;s=Math.sqrt(za*za+zc*zc);if(this.data.transformMode==TransformMode.NoScale&&pa*pd-pb*pc<0!=(settings.yDown?this.skeleton.scaleX<0!=this.skeleton.scaleY>0:this.skeleton.scaleX<0!=this.skeleton.scaleY<0))s=-s;var r=Math.PI/2+Math.atan2(zc,za);var zb=Math.cos(r)*s;var zd=Math.sin(r)*s;var la=MathUtils.cosDeg(shearX)*scaleX;var lb=MathUtils.cosDeg(90+shearY)*scaleY;var lc=MathUtils.sinDeg(shearX)*scaleX;var ld=MathUtils.sinDeg(90+shearY)*scaleY;m.a=za*la+zb*lc;m.c=za*lb+zb*ld;m.b=zc*la+zd*lc;m.d=zc*lb+zd*ld;break}}m.a*=sx;m.c*=sx;m.b*=sy;m.d*=sy};Bone.prototype.setToSetupPose=function(){var data=this.data;this.x=data.x;this.y=data.y;this.rotation=data.rotation;this.scaleX=data.scaleX;this.scaleY=data.scaleY;this.shearX=data.shearX;this.shearY=data.shearY};Bone.prototype.getWorldRotationX=function(){return Math.atan2(this.matrix.b,this.matrix.a)*MathUtils.radDeg};Bone.prototype.getWorldRotationY=function(){return Math.atan2(this.matrix.d,this.matrix.c)*MathUtils.radDeg};Bone.prototype.getWorldScaleX=function(){var m=this.matrix;return Math.sqrt(m.a*m.a+m.b*m.b)};Bone.prototype.getWorldScaleY=function(){var m=this.matrix;return Math.sqrt(m.c*m.c+m.d*m.d)};Bone.prototype.updateAppliedTransform=function(){var parent=this.parent;var m=this.matrix;if(!parent){this.ax=m.tx;this.ay=m.ty;this.arotation=Math.atan2(m.b,m.a)*MathUtils.radDeg;this.ascaleX=Math.sqrt(m.a*m.a+m.b*m.b);this.ascaleY=Math.sqrt(m.c*m.c+m.d*m.d);this.ashearX=0;this.ashearY=Math.atan2(m.a*m.c+m.b*m.d,m.a*m.d-m.b*m.c)*MathUtils.radDeg;return}var pm=parent.matrix;var pid=1/(pm.a*pm.d-pm.b*pm.c);var dx=m.tx-pm.tx,dy=m.ty-pm.ty;this.ax=dx*pm.d*pid-dy*pm.c*pid;this.ay=dy*pm.a*pid-dx*pm.b*pid;var ia=pid*pm.d;var id=pid*pm.a;var ib=pid*pm.c;var ic=pid*pm.b;var ra=ia*m.a-ib*m.b;var rb=ia*m.c-ib*m.d;var rc=id*m.b-ic*m.a;var rd=id*m.d-ic*m.c;this.ashearX=0;this.ascaleX=Math.sqrt(ra*ra+rc*rc);if(this.ascaleX>1e-4){var det=ra*rd-rb*rc;this.ascaleY=det/this.ascaleX;this.ashearY=Math.atan2(ra*rb+rc*rd,det)*MathUtils.radDeg;this.arotation=Math.atan2(rc,ra)*MathUtils.radDeg}else{this.ascaleX=0;this.ascaleY=Math.sqrt(rb*rb+rd*rd);this.ashearY=0;this.arotation=90-Math.atan2(rd,rb)*MathUtils.radDeg}};Bone.prototype.worldToLocal=function(world){var m=this.matrix;var a=m.a,b=m.c,c=m.b,d=m.d;var invDet=1/(a*d-b*c);var x=world.x-m.tx,y=world.y-m.ty;world.x=x*d*invDet-y*b*invDet;world.y=y*a*invDet-x*c*invDet;return world};Bone.prototype.localToWorld=function(local){var m=this.matrix;var x=local.x,y=local.y;local.x=x*m.a+y*m.c+m.tx;local.y=x*m.b+y*m.d+m.ty;return local};Bone.prototype.worldToLocalRotation=function(worldRotation){var sin=MathUtils.sinDeg(worldRotation),cos=MathUtils.cosDeg(worldRotation);var mat=this.matrix;return Math.atan2(mat.a*sin-mat.b*cos,mat.d*cos-mat.c*sin)*MathUtils.radDeg};Bone.prototype.localToWorldRotation=function(localRotation){localRotation-=this.rotation-this.shearX;var sin=MathUtils.sinDeg(localRotation),cos=MathUtils.cosDeg(localRotation);var mat=this.matrix;return Math.atan2(cos*mat.b+sin*mat.d,cos*mat.a+sin*mat.c)*MathUtils.radDeg};Bone.prototype.rotateWorld=function(degrees){var mat=this.matrix;var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var cos=MathUtils.cosDeg(degrees),sin=MathUtils.sinDeg(degrees);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d};return Bone}();var ConstraintData=function(){function ConstraintData(name,order,skinRequired){this.name=name;this.order=order;this.skinRequired=skinRequired}return ConstraintData}();var Event=function(){function Event(time,data){if(data==null)throw new Error("data cannot be null.");this.time=time;this.data=data}return Event}();var EventData=function(){function EventData(name){this.name=name}return EventData}();var IkConstraint=function(){function IkConstraint(data,skeleton){this.bendDirection=0;this.compress=false;this.stretch=false;this.mix=1;this.softness=0;this.active=false;if(!data)throw new Error("data cannot be null.");if(!skeleton)throw new Error("skeleton cannot be null.");this.data=data;this.mix=data.mix;this.softness=data.softness;this.bendDirection=data.bendDirection;this.compress=data.compress;this.stretch=data.stretch;this.bones=new Array;for(var i=0;i<data.bones.length;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findBone(data.target.name)}IkConstraint.prototype.isActive=function(){return this.active};IkConstraint.prototype.update=function(){if(this.mix==0)return;var target=this.target;var bones=this.bones;switch(bones.length){case 1:this.apply1(bones[0],target.worldX,target.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(bones[0],bones[1],target.worldX,target.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix);break}};IkConstraint.prototype.apply1=function(bone,targetX,targetY,compress,stretch,uniform,alpha){var p=bone.parent.matrix;var pa=p.a,pb=p.c,pc=p.b,pd=p.d;var rotationIK=-bone.ashearX-bone.arotation,tx=0,ty=0;switch(bone.data.transformMode){case TransformMode.OnlyTranslation:tx=targetX-bone.worldX;ty=targetY-bone.worldY;break;case TransformMode.NoRotationOrReflection:var s=Math.abs(pa*pd-pb*pc)/(pa*pa+pc*pc);var sa=pa/bone.skeleton.scaleX;var sc=pc/bone.skeleton.scaleY;pb=-sc*s*bone.skeleton.scaleX;pd=sa*s*bone.skeleton.scaleY;rotationIK+=Math.atan2(sc,sa)*MathUtils.radDeg;default:var x=targetX-p.tx,y=targetY-p.ty;var d=pa*pd-pb*pc;tx=(x*pd-y*pb)/d-bone.ax;ty=(y*pa-x*pc)/d-bone.ay}rotationIK+=Math.atan2(ty,tx)*MathUtils.radDeg;if(bone.ascaleX<0)rotationIK+=180;if(rotationIK>180)rotationIK-=360;else if(rotationIK<-180)rotationIK+=360;var sx=bone.ascaleX,sy=bone.ascaleY;if(compress||stretch){switch(bone.data.transformMode){case TransformMode.NoScale:case TransformMode.NoScaleOrReflection:tx=targetX-bone.worldX;ty=targetY-bone.worldY}var b=bone.data.length*sx,dd=Math.sqrt(tx*tx+ty*ty);if(compress&&dd<b||stretch&&dd>b&&b>1e-4){var s=(dd/b-1)*alpha+1;sx*=s;if(uniform)sy*=s}}bone.updateWorldTransformWith(bone.ax,bone.ay,bone.arotation+rotationIK*alpha,sx,sy,bone.ashearX,bone.ashearY)};IkConstraint.prototype.apply2=function(parent,child,targetX,targetY,bendDir,stretch,uniform,softness,alpha){var px=parent.ax,py=parent.ay,psx=parent.ascaleX,psy=parent.ascaleY,sx=psx,sy=psy,csx=child.ascaleX;var pmat=parent.matrix;var os1=0,os2=0,s2=0;if(psx<0){psx=-psx;os1=180;s2=-1}else{os1=0;s2=1}if(psy<0){psy=-psy;s2=-s2}if(csx<0){csx=-csx;os2=180}else os2=0;var cx=child.ax,cy=0,cwx=0,cwy=0,a=pmat.a,b=pmat.c,c=pmat.b,d=pmat.d;var u=Math.abs(psx-psy)<=1e-4;if(!u||stretch){cy=0;cwx=a*cx+pmat.tx;cwy=c*cx+pmat.ty}else{cy=child.ay;cwx=a*cx+b*cy+pmat.tx;cwy=c*cx+d*cy+pmat.ty}var pp=parent.parent.matrix;a=pp.a;b=pp.c;c=pp.b;d=pp.d;var id=1/(a*d-b*c),x=cwx-pp.tx,y=cwy-pp.ty;var dx=(x*d-y*b)*id-px,dy=(y*a-x*c)*id-py;var l1=Math.sqrt(dx*dx+dy*dy),l2=child.data.length*csx,a1,a2;if(l1<1e-4){this.apply1(parent,targetX,targetY,false,stretch,false,alpha);child.updateWorldTransformWith(cx,cy,0,child.ascaleX,child.ascaleY,child.ashearX,child.ashearY);return}x=targetX-pp.tx;y=targetY-pp.ty;var tx=(x*d-y*b)*id-px,ty=(y*a-x*c)*id-py;var dd=tx*tx+ty*ty;if(softness!=0){softness*=psx*(csx+1)*.5;var td=Math.sqrt(dd),sd=td-l1-l2*psx+softness;if(sd>0){var p=Math.min(1,sd/(softness*2))-1;p=(sd-softness*(1-p*p))/td;tx-=p*tx;ty-=p*ty;dd=tx*tx+ty*ty}}outer:if(u){l2*=psx;var cos=(dd-l1*l1-l2*l2)/(2*l1*l2);if(cos<-1){cos=-1;a2=Math.PI*bendDir}else if(cos>1){cos=1;a2=0;if(stretch){a=(Math.sqrt(dd)/(l1+l2)-1)*alpha+1;sx*=a;if(uniform)sy*=a}}else a2=Math.acos(cos)*bendDir;a=l1+l2*cos;b=l2*Math.sin(a2);a1=Math.atan2(ty*a-tx*b,tx*a+ty*b)}else{a=psx*l2;b=psy*l2;var aa=a*a,bb=b*b,ta=Math.atan2(ty,tx);c=bb*l1*l1+aa*dd-aa*bb;var c1=-2*bb*l1,c2=bb-aa;d=c1*c1-4*c2*c;if(d>=0){var q=Math.sqrt(d);if(c1<0)q=-q;q=-(c1+q)*.5;var r0=q/c2,r1=c/q;var r=Math.abs(r0)<Math.abs(r1)?r0:r1;if(r*r<=dd){y=Math.sqrt(dd-r*r)*bendDir;a1=ta-Math.atan2(y,r);a2=Math.atan2(y/psy,(r-l1)/psx);break outer}}var minAngle=MathUtils.PI,minX=l1-a,minDist=minX*minX,minY=0;var maxAngle=0,maxX=l1+a,maxDist=maxX*maxX,maxY=0;c=-a*l1/(aa-bb);if(c>=-1&&c<=1){c=Math.acos(c);x=a*Math.cos(c)+l1;y=b*Math.sin(c);d=x*x+y*y;if(d<minDist){minAngle=c;minDist=d;minX=x;minY=y}if(d>maxDist){maxAngle=c;maxDist=d;maxX=x;maxY=y}}if(dd<=(minDist+maxDist)*.5){a1=ta-Math.atan2(minY*bendDir,minX);a2=minAngle*bendDir}else{a1=ta-Math.atan2(maxY*bendDir,maxX);a2=maxAngle*bendDir}}var os=Math.atan2(cy,cx)*s2;var rotation=parent.arotation;a1=(a1-os)*MathUtils.radDeg+os1-rotation;if(a1>180)a1-=360;else if(a1<-180)a1+=360;parent.updateWorldTransformWith(px,py,rotation+a1*alpha,sx,sy,0,0);rotation=child.arotation;a2=((a2+os)*MathUtils.radDeg-child.ashearX)*s2+os2-rotation;if(a2>180)a2-=360;else if(a2<-180)a2+=360;child.updateWorldTransformWith(cx,cy,rotation+a2*alpha,child.ascaleX,child.ascaleY,child.ashearX,child.ashearY)};return IkConstraint}();var IkConstraintData=function(_super){__extends$1(IkConstraintData,_super);function IkConstraintData(name){var _this=_super.call(this,name,0,false)||this;_this.bones=new Array;_this.bendDirection=1;_this.compress=false;_this.stretch=false;_this.uniform=false;_this.mix=1;_this.softness=0;return _this}return IkConstraintData}(ConstraintData);var PathConstraintData=function(_super){__extends$1(PathConstraintData,_super);function PathConstraintData(name){var _this=_super.call(this,name,0,false)||this;_this.bones=new Array;_this.mixRotate=0;_this.mixX=0;_this.mixY=0;return _this}return PathConstraintData}(ConstraintData);var PositionMode;(function(PositionMode){PositionMode[PositionMode["Fixed"]=0]="Fixed";PositionMode[PositionMode["Percent"]=1]="Percent"})(PositionMode||(PositionMode={}));var SpacingMode;(function(SpacingMode){SpacingMode[SpacingMode["Length"]=0]="Length";SpacingMode[SpacingMode["Fixed"]=1]="Fixed";SpacingMode[SpacingMode["Percent"]=2]="Percent";SpacingMode[SpacingMode["Proportional"]=3]="Proportional"})(SpacingMode||(SpacingMode={}));var RotateMode;(function(RotateMode){RotateMode[RotateMode["Tangent"]=0]="Tangent";RotateMode[RotateMode["Chain"]=1]="Chain";RotateMode[RotateMode["ChainScale"]=2]="ChainScale"})(RotateMode||(RotateMode={}));var PathConstraint=function(){function PathConstraint(data,skeleton){this.position=0;this.spacing=0;this.mixRotate=0;this.mixX=0;this.mixY=0;this.spaces=new Array;this.positions=new Array;this.world=new Array;this.curves=new Array;this.lengths=new Array;this.segments=new Array;this.active=false;if(data==null)throw new Error("data cannot be null.");if(skeleton==null)throw new Error("skeleton cannot be null.");this.data=data;this.bones=new Array;for(var i=0,n=data.bones.length;i<n;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findSlot(data.target.name);this.position=data.position;this.spacing=data.spacing;this.mixRotate=data.mixRotate;this.mixX=data.mixX;this.mixY=data.mixY}PathConstraint.prototype.isActive=function(){return this.active};PathConstraint.prototype.update=function(){var attachment=this.target.getAttachment();if(!(attachment instanceof PathAttachment))return;var mixRotate=this.mixRotate,mixX=this.mixX,mixY=this.mixY;if(mixRotate==0&&mixX==0&&mixY==0)return;var data=this.data;var tangents=data.rotateMode==RotateMode.Tangent,scale=data.rotateMode==RotateMode.ChainScale;var boneCount=this.bones.length,spacesCount=tangents?boneCount:boneCount+1;var bones=this.bones;var spaces=Utils.setArraySize(this.spaces,spacesCount),lengths=scale?this.lengths=Utils.setArraySize(this.lengths,boneCount):null;var spacing=this.spacing;switch(data.spacingMode){case SpacingMode.Percent:if(scale){for(var i=0,n=spacesCount-1;i<n;i++){var bone=bones[i];var setupLength=bone.data.length;if(setupLength<PathConstraint.epsilon)lengths[i]=0;else{var x=setupLength*bone.matrix.a,y=setupLength*bone.matrix.b;lengths[i]=Math.sqrt(x*x+y*y)}}}Utils.arrayFill(spaces,1,spacesCount,spacing);break;case SpacingMode.Proportional:var sum=0;for(var i=0,n=spacesCount-1;i<n;){var bone=bones[i];var setupLength=bone.data.length;if(setupLength<PathConstraint.epsilon){if(scale)lengths[i]=0;spaces[++i]=spacing}else{var x=setupLength*bone.matrix.a,y=setupLength*bone.matrix.b;var length_1=Math.sqrt(x*x+y*y);if(scale)lengths[i]=length_1;spaces[++i]=length_1;sum+=length_1}}if(sum>0){sum=spacesCount/sum*spacing;for(var i=1;i<spacesCount;i++)spaces[i]*=sum}break;default:var lengthSpacing=data.spacingMode==SpacingMode.Length;for(var i=0,n=spacesCount-1;i<n;){var bone=bones[i];var setupLength=bone.data.length;if(setupLength<PathConstraint.epsilon){if(scale)lengths[i]=0;spaces[++i]=spacing}else{var x=setupLength*bone.matrix.a,y=setupLength*bone.matrix.b;var length_2=Math.sqrt(x*x+y*y);if(scale)lengths[i]=length_2;spaces[++i]=(lengthSpacing?setupLength+spacing:spacing)*length_2/setupLength}}}var positions=this.computeWorldPositions(attachment,spacesCount,tangents);var boneX=positions[0],boneY=positions[1],offsetRotation=data.offsetRotation;var tip=false;if(offsetRotation==0)tip=data.rotateMode==RotateMode.Chain;else{tip=false;var p=this.target.bone.matrix;offsetRotation*=p.a*p.d-p.b*p.c>0?MathUtils.degRad:-MathUtils.degRad}for(var i=0,p=3;i<boneCount;i++,p+=3){var bone=bones[i];var mat=bone.matrix;mat.tx+=(boneX-mat.tx)*mixX;mat.ty+=(boneY-mat.ty)*mixY;var x=positions[p],y=positions[p+1],dx=x-boneX,dy=y-boneY;if(scale){var length_3=lengths[i];if(length_3!=0){var s=(Math.sqrt(dx*dx+dy*dy)/length_3-1)*mixRotate+1;mat.a*=s;mat.b*=s}}boneX=x;boneY=y;if(mixRotate>0){var a=mat.a,b=mat.c,c=mat.b,d=mat.d,r=0,cos=0,sin=0;if(tangents)r=positions[p-1];else if(spaces[i+1]==0)r=positions[p+2];else r=Math.atan2(dy,dx);r-=Math.atan2(c,a);if(tip){cos=Math.cos(r);sin=Math.sin(r);var length_4=bone.data.length;boneX+=(length_4*(cos*a-sin*c)-dx)*mixRotate;boneY+=(length_4*(sin*a+cos*c)-dy)*mixRotate}else{r+=offsetRotation}if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r*=mixRotate;cos=Math.cos(r);sin=Math.sin(r);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d}bone.updateAppliedTransform()}};PathConstraint.prototype.computeWorldPositions=function(path,spacesCount,tangents){var target=this.target;var position=this.position;var spaces=this.spaces,out=Utils.setArraySize(this.positions,spacesCount*3+2),world=null;var closed=path.closed;var verticesLength=path.worldVerticesLength,curveCount=verticesLength/6,prevCurve=PathConstraint.NONE;if(!path.constantSpeed){var lengths=path.lengths;curveCount-=closed?1:2;var pathLength_1=lengths[curveCount];if(this.data.positionMode==PositionMode.Percent)position*=pathLength_1;var multiplier_1;switch(this.data.spacingMode){case SpacingMode.Percent:multiplier_1=pathLength_1;break;case SpacingMode.Proportional:multiplier_1=pathLength_1/spacesCount;break;default:multiplier_1=1}world=Utils.setArraySize(this.world,8);for(var i=0,o=0,curve=0;i<spacesCount;i++,o+=3){var space=spaces[i]*multiplier_1;position+=space;var p=position;if(closed){p%=pathLength_1;if(p<0)p+=pathLength_1;curve=0}else if(p<0){if(prevCurve!=PathConstraint.BEFORE){prevCurve=PathConstraint.BEFORE;path.computeWorldVertices(target,2,4,world,0,2)}this.addBeforePosition(p,world,0,out,o);continue}else if(p>pathLength_1){if(prevCurve!=PathConstraint.AFTER){prevCurve=PathConstraint.AFTER;path.computeWorldVertices(target,verticesLength-6,4,world,0,2)}this.addAfterPosition(p-pathLength_1,world,0,out,o);continue}for(;;curve++){var length_5=lengths[curve];if(p>length_5)continue;if(curve==0)p/=length_5;else{var prev=lengths[curve-1];p=(p-prev)/(length_5-prev)}break}if(curve!=prevCurve){prevCurve=curve;if(closed&&curve==curveCount){path.computeWorldVertices(target,verticesLength-4,4,world,0,2);path.computeWorldVertices(target,0,4,world,4,2)}else path.computeWorldVertices(target,curve*6+2,8,world,0,2)}this.addCurvePosition(p,world[0],world[1],world[2],world[3],world[4],world[5],world[6],world[7],out,o,tangents||i>0&&space==0)}return out}if(closed){verticesLength+=2;world=Utils.setArraySize(this.world,verticesLength);path.computeWorldVertices(target,2,verticesLength-4,world,0,2);path.computeWorldVertices(target,0,2,world,verticesLength-4,2);world[verticesLength-2]=world[0];world[verticesLength-1]=world[1]}else{curveCount--;verticesLength-=4;world=Utils.setArraySize(this.world,verticesLength);path.computeWorldVertices(target,2,verticesLength,world,0,2)}var curves=Utils.setArraySize(this.curves,curveCount);var pathLength=0;var x1=world[0],y1=world[1],cx1=0,cy1=0,cx2=0,cy2=0,x2=0,y2=0;var tmpx=0,tmpy=0,dddfx=0,dddfy=0,ddfx=0,ddfy=0,dfx=0,dfy=0;for(var i=0,w=2;i<curveCount;i++,w+=6){cx1=world[w];cy1=world[w+1];cx2=world[w+2];cy2=world[w+3];x2=world[w+4];y2=world[w+5];tmpx=(x1-cx1*2+cx2)*.1875;tmpy=(y1-cy1*2+cy2)*.1875;dddfx=((cx1-cx2)*3-x1+x2)*.09375;dddfy=((cy1-cy2)*3-y1+y2)*.09375;ddfx=tmpx*2+dddfx;ddfy=tmpy*2+dddfy;dfx=(cx1-x1)*.75+tmpx+dddfx*.16666667;dfy=(cy1-y1)*.75+tmpy+dddfy*.16666667;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx;dfy+=ddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx+dddfx;dfy+=ddfy+dddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);curves[i]=pathLength;x1=x2;y1=y2}if(this.data.positionMode==PositionMode.Percent)position*=pathLength;var multiplier=0;switch(this.data.spacingMode){case SpacingMode.Percent:multiplier=pathLength;break;case SpacingMode.Proportional:multiplier=pathLength/spacesCount;break;default:multiplier=1}var segments=this.segments;var curveLength=0;for(var i=0,o=0,curve=0,segment=0;i<spacesCount;i++,o+=3){var space=spaces[i]*multiplier;position+=space;var p=position;if(closed){p%=pathLength;if(p<0)p+=pathLength;curve=0}else if(p<0){this.addBeforePosition(p,world,0,out,o);continue}else if(p>pathLength){this.addAfterPosition(p-pathLength,world,verticesLength-4,out,o);continue}for(;;curve++){var length_6=curves[curve];if(p>length_6)continue;if(curve==0)p/=length_6;else{var prev=curves[curve-1];p=(p-prev)/(length_6-prev)}break}if(curve!=prevCurve){prevCurve=curve;var ii=curve*6;x1=world[ii];y1=world[ii+1];cx1=world[ii+2];cy1=world[ii+3];cx2=world[ii+4];cy2=world[ii+5];x2=world[ii+6];y2=world[ii+7];tmpx=(x1-cx1*2+cx2)*.03;tmpy=(y1-cy1*2+cy2)*.03;dddfx=((cx1-cx2)*3-x1+x2)*.006;dddfy=((cy1-cy2)*3-y1+y2)*.006;ddfx=tmpx*2+dddfx;ddfy=tmpy*2+dddfy;dfx=(cx1-x1)*.3+tmpx+dddfx*.16666667;dfy=(cy1-y1)*.3+tmpy+dddfy*.16666667;curveLength=Math.sqrt(dfx*dfx+dfy*dfy);segments[0]=curveLength;for(ii=1;ii<8;ii++){dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[ii]=curveLength}dfx+=ddfx;dfy+=ddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[8]=curveLength;dfx+=ddfx+dddfx;dfy+=ddfy+dddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[9]=curveLength;segment=0}p*=curveLength;for(;;segment++){var length_7=segments[segment];if(p>length_7)continue;if(segment==0)p/=length_7;else{var prev=segments[segment-1];p=segment+(p-prev)/(length_7-prev)}break}this.addCurvePosition(p*.1,x1,y1,cx1,cy1,cx2,cy2,x2,y2,out,o,tangents||i>0&&space==0)}return out};PathConstraint.prototype.addBeforePosition=function(p,temp,i,out,o){var x1=temp[i],y1=temp[i+1],dx=temp[i+2]-x1,dy=temp[i+3]-y1,r=Math.atan2(dy,dx);out[o]=x1+p*Math.cos(r);out[o+1]=y1+p*Math.sin(r);out[o+2]=r};PathConstraint.prototype.addAfterPosition=function(p,temp,i,out,o){var x1=temp[i+2],y1=temp[i+3],dx=x1-temp[i],dy=y1-temp[i+1],r=Math.atan2(dy,dx);out[o]=x1+p*Math.cos(r);out[o+1]=y1+p*Math.sin(r);out[o+2]=r};PathConstraint.prototype.addCurvePosition=function(p,x1,y1,cx1,cy1,cx2,cy2,x2,y2,out,o,tangents){if(p==0||isNaN(p)){out[o]=x1;out[o+1]=y1;out[o+2]=Math.atan2(cy1-y1,cx1-x1);return}var tt=p*p,ttt=tt*p,u=1-p,uu=u*u,uuu=uu*u;var ut=u*p,ut3=ut*3,uut3=u*ut3,utt3=ut3*p;var x=x1*uuu+cx1*uut3+cx2*utt3+x2*ttt,y=y1*uuu+cy1*uut3+cy2*utt3+y2*ttt;out[o]=x;out[o+1]=y;if(tangents){if(p<.001)out[o+2]=Math.atan2(cy1-y1,cx1-x1);else out[o+2]=Math.atan2(y-(y1*uu+cy1*ut*2+cy2*tt),x-(x1*uu+cx1*ut*2+cx2*tt))}};PathConstraint.NONE=-1;PathConstraint.BEFORE=-2;PathConstraint.AFTER=-3;PathConstraint.epsilon=1e-5;return PathConstraint}();var Slot=function(){function Slot(data,bone){this.deform=new Array;if(data==null)throw new Error("data cannot be null.");if(bone==null)throw new Error("bone cannot be null.");this.data=data;this.bone=bone;this.color=new Color;this.darkColor=data.darkColor==null?null:new Color;this.setToSetupPose();this.blendMode=this.data.blendMode}Slot.prototype.getSkeleton=function(){return this.bone.skeleton};Slot.prototype.getAttachment=function(){return this.attachment};Slot.prototype.setAttachment=function(attachment){if(this.attachment==attachment)return;this.attachment=attachment;this.attachmentTime=this.bone.skeleton.time;this.deform.length=0};Slot.prototype.setAttachmentTime=function(time){this.attachmentTime=this.bone.skeleton.time-time};Slot.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime};Slot.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color);if(this.darkColor!=null)this.darkColor.setFromColor(this.data.darkColor);if(this.data.attachmentName==null)this.attachment=null;else{this.attachment=null;this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))}};return Slot}();var TransformConstraint=function(){function TransformConstraint(data,skeleton){this.mixRotate=0;this.mixX=0;this.mixY=0;this.mixScaleX=0;this.mixScaleY=0;this.mixShearY=0;this.temp=new Vector2;this.active=false;if(!data)throw new Error("data cannot be null.");if(!skeleton)throw new Error("skeleton cannot be null.");this.data=data;this.mixRotate=data.mixRotate;this.mixX=data.mixX;this.mixY=data.mixY;this.mixScaleX=data.mixScaleX;this.mixScaleY=data.mixScaleY;this.mixShearY=data.mixShearY;this.bones=new Array;for(var i=0;i<data.bones.length;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findBone(data.target.name)}TransformConstraint.prototype.isActive=function(){return this.active};TransformConstraint.prototype.update=function(){if(this.mixRotate==0&&this.mixX==0&&this.mixY==0&&this.mixScaleX==0&&this.mixScaleX==0&&this.mixShearY==0)return;if(this.data.local){if(this.data.relative)this.applyRelativeLocal();else this.applyAbsoluteLocal()}else{if(this.data.relative)this.applyRelativeWorld();else this.applyAbsoluteWorld()}};TransformConstraint.prototype.applyAbsoluteWorld=function(){var mixRotate=this.mixRotate,mixX=this.mixX,mixY=this.mixY,mixScaleX=this.mixScaleX,mixScaleY=this.mixScaleY,mixShearY=this.mixShearY;var translate=mixX!=0||mixY!=0;var target=this.target;var targetMat=target.matrix;var ta=targetMat.a,tb=targetMat.c,tc=targetMat.b,td=targetMat.d;var degRadReflect=ta*td-tb*tc>0?MathUtils.degRad:-MathUtils.degRad;var offsetRotation=this.data.offsetRotation*degRadReflect;var offsetShearY=this.data.offsetShearY*degRadReflect;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];var mat=bone.matrix;if(mixRotate!=0){var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var r=Math.atan2(tc,ta)-Math.atan2(c,a)+offsetRotation;if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r*=mixRotate;var cos=Math.cos(r),sin=Math.sin(r);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d}if(translate){var temp=this.temp;target.localToWorld(temp.set(this.data.offsetX,this.data.offsetY));mat.tx+=(temp.x-mat.tx)*mixX;mat.ty+=(temp.y-mat.ty)*mixY}if(mixScaleX!=0){var s=Math.sqrt(mat.a*mat.a+mat.b*mat.b);if(s!=0)s=(s+(Math.sqrt(ta*ta+tc*tc)-s+this.data.offsetScaleX)*mixScaleX)/s;mat.a*=s;mat.b*=s}if(mixScaleY!=0){var s=Math.sqrt(mat.c*mat.c+mat.d*mat.d);if(s!=0)s=(s+(Math.sqrt(tb*tb+td*td)-s+this.data.offsetScaleY)*mixScaleY)/s;mat.c*=s;mat.d*=s}if(mixShearY>0){var b=mat.c,d=mat.d;var by=Math.atan2(d,b);var r=Math.atan2(td,tb)-Math.atan2(tc,ta)-(by-Math.atan2(mat.b,mat.a));if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r=by+(r+offsetShearY)*mixShearY;var s=Math.sqrt(b*b+d*d);mat.c=Math.cos(r)*s;mat.d=Math.sin(r)*s}bone.updateAppliedTransform()}};TransformConstraint.prototype.applyRelativeWorld=function(){var mixRotate=this.mixRotate,mixX=this.mixX,mixY=this.mixY,mixScaleX=this.mixScaleX,mixScaleY=this.mixScaleY,mixShearY=this.mixShearY;var translate=mixX!=0||mixY!=0;var target=this.target;var targetMat=target.matrix;var ta=targetMat.a,tb=targetMat.c,tc=targetMat.b,td=targetMat.d;var degRadReflect=ta*td-tb*tc>0?MathUtils.degRad:-MathUtils.degRad;var offsetRotation=this.data.offsetRotation*degRadReflect,offsetShearY=this.data.offsetShearY*degRadReflect;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];var mat=bone.matrix;if(mixRotate!=0){var a=mat.a,b=mat.c,c=mat.b,d=mat.d;var r=Math.atan2(tc,ta)+offsetRotation;if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;r*=mixRotate;var cos=Math.cos(r),sin=Math.sin(r);mat.a=cos*a-sin*c;mat.c=cos*b-sin*d;mat.b=sin*a+cos*c;mat.d=sin*b+cos*d}if(translate){var temp=this.temp;target.localToWorld(temp.set(this.data.offsetX,this.data.offsetY));mat.tx+=temp.x*mixX;mat.ty+=temp.y*mixY}if(mixScaleX!=0){var s=(Math.sqrt(ta*ta+tc*tc)-1+this.data.offsetScaleX)*mixScaleX+1;mat.a*=s;mat.b*=s}if(mixScaleY!=0){var s=(Math.sqrt(tb*tb+td*td)-1+this.data.offsetScaleY)*mixScaleY+1;mat.c*=s;mat.d*=s}if(mixShearY>0){var r=Math.atan2(td,tb)-Math.atan2(tc,ta);if(r>MathUtils.PI)r-=MathUtils.PI2;else if(r<-MathUtils.PI)r+=MathUtils.PI2;var b=mat.c,d=mat.d;r=Math.atan2(d,b)+(r-MathUtils.PI/2+offsetShearY)*mixShearY;var s=Math.sqrt(b*b+d*d);mat.c=Math.cos(r)*s;mat.d=Math.sin(r)*s}bone.updateAppliedTransform()}};TransformConstraint.prototype.applyAbsoluteLocal=function(){var mixRotate=this.mixRotate,mixX=this.mixX,mixY=this.mixY,mixScaleX=this.mixScaleX,mixScaleY=this.mixScaleY,mixShearY=this.mixShearY;var target=this.target;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];var rotation=bone.arotation;if(mixRotate!=0){var r=target.arotation-rotation+this.data.offsetRotation;r-=(16384-(16384.499999999996-r/360|0))*360;rotation+=r*mixRotate}var x=bone.ax,y=bone.ay;x+=(target.ax-x+this.data.offsetX)*mixX;y+=(target.ay-y+this.data.offsetY)*mixY;var scaleX=bone.ascaleX,scaleY=bone.ascaleY;if(mixScaleX!=0&&scaleX!=0)scaleX=(scaleX+(target.ascaleX-scaleX+this.data.offsetScaleX)*mixScaleX)/scaleX;if(mixScaleY!=0&&scaleY!=0)scaleY=(scaleY+(target.ascaleY-scaleY+this.data.offsetScaleY)*mixScaleY)/scaleY;var shearY=bone.ashearY;if(mixShearY!=0){var r=target.ashearY-shearY+this.data.offsetShearY;r-=(16384-(16384.499999999996-r/360|0))*360;shearY+=r*mixShearY}bone.updateWorldTransformWith(x,y,rotation,scaleX,scaleY,bone.ashearX,shearY)}};TransformConstraint.prototype.applyRelativeLocal=function(){var mixRotate=this.mixRotate,mixX=this.mixX,mixY=this.mixY,mixScaleX=this.mixScaleX,mixScaleY=this.mixScaleY,mixShearY=this.mixShearY;var target=this.target;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];var rotation=bone.arotation+(target.arotation+this.data.offsetRotation)*mixRotate;var x=bone.ax+(target.ax+this.data.offsetX)*mixX;var y=bone.ay+(target.ay+this.data.offsetY)*mixY;var scaleX=bone.ascaleX*((target.ascaleX-1+this.data.offsetScaleX)*mixScaleX)+1;var scaleY=bone.ascaleY*((target.ascaleY-1+this.data.offsetScaleY)*mixScaleY)+1;var shearY=bone.ashearY+(target.ashearY+this.data.offsetShearY)*mixShearY;bone.updateWorldTransformWith(x,y,rotation,scaleX,scaleY,bone.ashearX,shearY)}};return TransformConstraint}();var Skeleton=function(){function Skeleton(data){this._updateCache=new Array;this.time=0;this.scaleX=1;this.scaleY=1;this.x=0;this.y=0;if(!data)throw new Error("data cannot be null.");this.data=data;this.bones=new Array;for(var i=0;i<data.bones.length;i++){var boneData=data.bones[i];var bone=void 0;if(!boneData.parent)bone=new Bone(boneData,this,null);else{var parent_1=this.bones[boneData.parent.index];bone=new Bone(boneData,this,parent_1);parent_1.children.push(bone)}this.bones.push(bone)}this.slots=new Array;this.drawOrder=new Array;for(var i=0;i<data.slots.length;i++){var slotData=data.slots[i];var bone=this.bones[slotData.boneData.index];var slot=new Slot(slotData,bone);this.slots.push(slot);this.drawOrder.push(slot)}this.ikConstraints=new Array;for(var i=0;i<data.ikConstraints.length;i++){var ikConstraintData=data.ikConstraints[i];this.ikConstraints.push(new IkConstraint(ikConstraintData,this))}this.transformConstraints=new Array;for(var i=0;i<data.transformConstraints.length;i++){var transformConstraintData=data.transformConstraints[i];this.transformConstraints.push(new TransformConstraint(transformConstraintData,this))}this.pathConstraints=new Array;for(var i=0;i<data.pathConstraints.length;i++){var pathConstraintData=data.pathConstraints[i];this.pathConstraints.push(new PathConstraint(pathConstraintData,this))}this.color=new Color(1,1,1,1);this.updateCache()}Skeleton.prototype.updateCache=function(){var updateCache=this._updateCache;updateCache.length=0;var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];bone.sorted=bone.data.skinRequired;bone.active=!bone.sorted}if(this.skin){var skinBones=this.skin.bones;for(var i=0,n=this.skin.bones.length;i<n;i++){var bone=this.bones[skinBones[i].index];do{bone.sorted=false;bone.active=true;bone=bone.parent}while(bone)}}var ikConstraints=this.ikConstraints;var transformConstraints=this.transformConstraints;var pathConstraints=this.pathConstraints;var ikCount=ikConstraints.length,transformCount=transformConstraints.length,pathCount=pathConstraints.length;var constraintCount=ikCount+transformCount+pathCount;outer:for(var i=0;i<constraintCount;i++){for(var ii=0;ii<ikCount;ii++){var constraint=ikConstraints[ii];if(constraint.data.order==i){this.sortIkConstraint(constraint);continue outer}}for(var ii=0;ii<transformCount;ii++){var constraint=transformConstraints[ii];if(constraint.data.order==i){this.sortTransformConstraint(constraint);continue outer}}for(var ii=0;ii<pathCount;ii++){var constraint=pathConstraints[ii];if(constraint.data.order==i){this.sortPathConstraint(constraint);continue outer}}}for(var i=0,n=bones.length;i<n;i++)this.sortBone(bones[i])};Skeleton.prototype.sortIkConstraint=function(constraint){constraint.active=constraint.target.isActive()&&(!constraint.data.skinRequired||this.skin&&Utils.contains(this.skin.constraints,constraint.data,true));if(!constraint.active)return;var target=constraint.target;this.sortBone(target);var constrained=constraint.bones;var parent=constrained[0];this.sortBone(parent);if(constrained.length==1){this._updateCache.push(constraint);this.sortReset(parent.children)}else{var child=constrained[constrained.length-1];this.sortBone(child);this._updateCache.push(constraint);this.sortReset(parent.children);child.sorted=true}};Skeleton.prototype.sortPathConstraint=function(constraint){constraint.active=constraint.target.bone.isActive()&&(!constraint.data.skinRequired||this.skin&&Utils.contains(this.skin.constraints,constraint.data,true));if(!constraint.active)return;var slot=constraint.target;var slotIndex=slot.data.index;var slotBone=slot.bone;if(this.skin)this.sortPathConstraintAttachment(this.skin,slotIndex,slotBone);if(this.data.defaultSkin&&this.data.defaultSkin!=this.skin)this.sortPathConstraintAttachment(this.data.defaultSkin,slotIndex,slotBone);for(var i=0,n=this.data.skins.length;i<n;i++)this.sortPathConstraintAttachment(this.data.skins[i],slotIndex,slotBone);var attachment=slot.getAttachment();if(attachment instanceof PathAttachment)this.sortPathConstraintAttachmentWith(attachment,slotBone);var constrained=constraint.bones;var boneCount=constrained.length;for(var i=0;i<boneCount;i++)this.sortBone(constrained[i]);this._updateCache.push(constraint);for(var i=0;i<boneCount;i++)this.sortReset(constrained[i].children);for(var i=0;i<boneCount;i++)constrained[i].sorted=true};Skeleton.prototype.sortTransformConstraint=function(constraint){constraint.active=constraint.target.isActive()&&(!constraint.data.skinRequired||this.skin&&Utils.contains(this.skin.constraints,constraint.data,true));if(!constraint.active)return;this.sortBone(constraint.target);var constrained=constraint.bones;var boneCount=constrained.length;if(constraint.data.local){for(var i=0;i<boneCount;i++){var child=constrained[i];this.sortBone(child.parent);this.sortBone(child)}}else{for(var i=0;i<boneCount;i++){this.sortBone(constrained[i])}}this._updateCache.push(constraint);for(var i=0;i<boneCount;i++)this.sortReset(constrained[i].children);for(var i=0;i<boneCount;i++)constrained[i].sorted=true};Skeleton.prototype.sortPathConstraintAttachment=function(skin,slotIndex,slotBone){var attachments=skin.attachments[slotIndex];if(!attachments)return;for(var key in attachments){this.sortPathConstraintAttachmentWith(attachments[key],slotBone)}};Skeleton.prototype.sortPathConstraintAttachmentWith=function(attachment,slotBone){if(!(attachment instanceof PathAttachment))return;var pathBones=attachment.bones;if(!pathBones)this.sortBone(slotBone);else{var bones=this.bones;for(var i=0,n=pathBones.length;i<n;){var nn=pathBones[i++];nn+=i;while(i<nn)this.sortBone(bones[pathBones[i++]])}}};Skeleton.prototype.sortBone=function(bone){if(bone.sorted)return;var parent=bone.parent;if(parent)this.sortBone(parent);bone.sorted=true;this._updateCache.push(bone)};Skeleton.prototype.sortReset=function(bones){for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(!bone.active)continue;if(bone.sorted)this.sortReset(bone.children);bone.sorted=false}};Skeleton.prototype.updateWorldTransform=function(){var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];bone.ax=bone.x;bone.ay=bone.y;bone.arotation=bone.rotation;bone.ascaleX=bone.scaleX;bone.ascaleY=bone.scaleY;bone.ashearX=bone.shearX;bone.ashearY=bone.shearY}var updateCache=this._updateCache;for(var i=0,n=updateCache.length;i<n;i++)updateCache[i].update()};Skeleton.prototype.updateWorldTransformWith=function(parent){var rootBone=this.getRootBone();var pa=parent.matrix.a,pb=parent.matrix.c,pc=parent.matrix.b,pd=parent.matrix.d;rootBone.matrix.tx=pa*this.x+pb*this.y+parent.worldX;rootBone.matrix.ty=pc*this.x+pd*this.y+parent.worldY;var rotationY=rootBone.rotation+90+rootBone.shearY;var la=MathUtils.cosDeg(rootBone.rotation+rootBone.shearX)*rootBone.scaleX;var lb=MathUtils.cosDeg(rotationY)*rootBone.scaleY;var lc=MathUtils.sinDeg(rootBone.rotation+rootBone.shearX)*rootBone.scaleX;var ld=MathUtils.sinDeg(rotationY)*rootBone.scaleY;var sx=this.scaleX;var sy=settings.yDown?-this.scaleY:this.scaleY;rootBone.matrix.a=(pa*la+pb*lc)*sx;rootBone.matrix.c=(pa*lb+pb*ld)*sx;rootBone.matrix.b=(pc*la+pd*lc)*sy;rootBone.matrix.d=(pc*lb+pd*ld)*sy;var updateCache=this._updateCache;for(var i=0,n=updateCache.length;i<n;i++){var updatable=updateCache[i];if(updatable!=rootBone)updatable.update()}};Skeleton.prototype.setToSetupPose=function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()};Skeleton.prototype.setBonesToSetupPose=function(){var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)bones[i].setToSetupPose();var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++){var constraint=ikConstraints[i];constraint.mix=constraint.data.mix;constraint.softness=constraint.data.softness;constraint.bendDirection=constraint.data.bendDirection;constraint.compress=constraint.data.compress;constraint.stretch=constraint.data.stretch}var transformConstraints=this.transformConstraints;for(var i=0,n=transformConstraints.length;i<n;i++){var constraint=transformConstraints[i];var data=constraint.data;constraint.mixRotate=data.mixRotate;constraint.mixX=data.mixX;constraint.mixY=data.mixY;constraint.mixScaleX=data.mixScaleX;constraint.mixScaleY=data.mixScaleY;constraint.mixShearY=data.mixShearY}var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++){var constraint=pathConstraints[i];var data=constraint.data;constraint.position=data.position;constraint.spacing=data.spacing;constraint.mixRotate=data.mixRotate;constraint.mixX=data.mixX;constraint.mixY=data.mixY}};Skeleton.prototype.setSlotsToSetupPose=function(){var slots=this.slots;Utils.arrayCopy(slots,0,this.drawOrder,0,slots.length);for(var i=0,n=slots.length;i<n;i++)slots[i].setToSetupPose()};Skeleton.prototype.getRootBone=function(){if(this.bones.length==0)return null;return this.bones[0]};Skeleton.prototype.findBone=function(boneName){if(!boneName)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(bone.data.name==boneName)return bone}return null};Skeleton.prototype.findBoneIndex=function(boneName){if(!boneName)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)if(bones[i].data.name==boneName)return i;return-1};Skeleton.prototype.findSlot=function(slotName){if(!slotName)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];if(slot.data.name==slotName)return slot}return null};Skeleton.prototype.findSlotIndex=function(slotName){if(!slotName)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++)if(slots[i].data.name==slotName)return i;return-1};Skeleton.prototype.setSkinByName=function(skinName){var skin=this.data.findSkin(skinName);if(!skin)throw new Error("Skin not found: "+skinName);this.setSkin(skin)};Skeleton.prototype.setSkin=function(newSkin){if(newSkin==this.skin)return;if(newSkin){if(this.skin)newSkin.attachAll(this,this.skin);else{var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];var name_1=slot.data.attachmentName;if(name_1){var attachment=newSkin.getAttachment(i,name_1);if(attachment)slot.setAttachment(attachment)}}}}this.skin=newSkin;this.updateCache()};Skeleton.prototype.getAttachmentByName=function(slotName,attachmentName){return this.getAttachment(this.data.findSlotIndex(slotName),attachmentName)};Skeleton.prototype.getAttachment=function(slotIndex,attachmentName){if(!attachmentName)throw new Error("attachmentName cannot be null.");if(this.skin){var attachment=this.skin.getAttachment(slotIndex,attachmentName);if(attachment)return attachment}if(this.data.defaultSkin)return this.data.defaultSkin.getAttachment(slotIndex,attachmentName);return null};Skeleton.prototype.setAttachment=function(slotName,attachmentName){if(!slotName)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];if(slot.data.name==slotName){var attachment=null;if(attachmentName){attachment=this.getAttachment(i,attachmentName);if(!attachment)throw new Error("Attachment not found: "+attachmentName+", for slot: "+slotName)}slot.setAttachment(attachment);return}}throw new Error("Slot not found: "+slotName)};Skeleton.prototype.findIkConstraint=function(constraintName){if(!constraintName)throw new Error("constraintName cannot be null.");var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++){var ikConstraint=ikConstraints[i];if(ikConstraint.data.name==constraintName)return ikConstraint}return null};Skeleton.prototype.findTransformConstraint=function(constraintName){if(!constraintName)throw new Error("constraintName cannot be null.");var transformConstraints=this.transformConstraints;for(var i=0,n=transformConstraints.length;i<n;i++){var constraint=transformConstraints[i];if(constraint.data.name==constraintName)return constraint}return null};Skeleton.prototype.findPathConstraint=function(constraintName){if(!constraintName)throw new Error("constraintName cannot be null.");var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++){var constraint=pathConstraints[i];if(constraint.data.name==constraintName)return constraint}return null};Skeleton.prototype.getBounds=function(offset,size,temp){if(temp===void 0){temp=new Array(2)}if(!offset)throw new Error("offset cannot be null.");if(!size)throw new Error("size cannot be null.");var drawOrder=this.drawOrder;var minX=Number.POSITIVE_INFINITY,minY=Number.POSITIVE_INFINITY,maxX=Number.NEGATIVE_INFINITY,maxY=Number.NEGATIVE_INFINITY;for(var i=0,n=drawOrder.length;i<n;i++){var slot=drawOrder[i];if(!slot.bone.active)continue;var verticesLength=0;var vertices=null;var attachment=slot.getAttachment();if(attachment instanceof RegionAttachment){verticesLength=8;vertices=Utils.setArraySize(temp,verticesLength,0);attachment.computeWorldVertices(slot.bone,vertices,0,2)}else if(attachment instanceof MeshAttachment){var mesh=attachment;verticesLength=mesh.worldVerticesLength;vertices=Utils.setArraySize(temp,verticesLength,0);mesh.computeWorldVertices(slot,0,verticesLength,vertices,0,2)}if(vertices){for(var ii=0,nn=vertices.length;ii<nn;ii+=2){var x=vertices[ii],y=vertices[ii+1];minX=Math.min(minX,x);minY=Math.min(minY,y);maxX=Math.max(maxX,x);maxY=Math.max(maxY,y)}}}offset.set(minX,minY);size.set(maxX-minX,maxY-minY)};Skeleton.prototype.update=function(delta){this.time+=delta};Object.defineProperty(Skeleton.prototype,"flipX",{get:function(){return this.scaleX==-1},set:function(value){if(!Skeleton.deprecatedWarning1){Skeleton.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")}this.scaleX=value?1:-1},enumerable:false,configurable:true});Object.defineProperty(Skeleton.prototype,"flipY",{get:function(){return this.scaleY==-1},set:function(value){if(!Skeleton.deprecatedWarning1){Skeleton.deprecatedWarning1=true;console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")}this.scaleY=value?1:-1},enumerable:false,configurable:true});Skeleton.deprecatedWarning1=false;return Skeleton}();var SkeletonData=function(){function SkeletonData(){this.bones=new Array;this.slots=new Array;this.skins=new Array;this.events=new Array;this.animations=new Array;this.ikConstraints=new Array;this.transformConstraints=new Array;this.pathConstraints=new Array;this.fps=0}SkeletonData.prototype.findBone=function(boneName){if(!boneName)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];if(bone.name==boneName)return bone}return null};SkeletonData.prototype.findBoneIndex=function(boneName){if(!boneName)throw new Error("boneName cannot be null.");var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)if(bones[i].name==boneName)return i;return-1};SkeletonData.prototype.findSlot=function(slotName){if(!slotName)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];if(slot.name==slotName)return slot}return null};SkeletonData.prototype.findSlotIndex=function(slotName){if(!slotName)throw new Error("slotName cannot be null.");var slots=this.slots;for(var i=0,n=slots.length;i<n;i++)if(slots[i].name==slotName)return i;return-1};SkeletonData.prototype.findSkin=function(skinName){if(!skinName)throw new Error("skinName cannot be null.");var skins=this.skins;for(var i=0,n=skins.length;i<n;i++){var skin=skins[i];if(skin.name==skinName)return skin}return null};SkeletonData.prototype.findEvent=function(eventDataName){if(!eventDataName)throw new Error("eventDataName cannot be null.");var events=this.events;for(var i=0,n=events.length;i<n;i++){var event_1=events[i];if(event_1.name==eventDataName)return event_1}return null};SkeletonData.prototype.findAnimation=function(animationName){if(!animationName)throw new Error("animationName cannot be null.");var animations=this.animations;for(var i=0,n=animations.length;i<n;i++){var animation=animations[i];if(animation.name==animationName)return animation}return null};SkeletonData.prototype.findIkConstraint=function(constraintName){if(!constraintName)throw new Error("constraintName cannot be null.");var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++){var constraint=ikConstraints[i];if(constraint.name==constraintName)return constraint}return null};SkeletonData.prototype.findTransformConstraint=function(constraintName){if(!constraintName)throw new Error("constraintName cannot be null.");var transformConstraints=this.transformConstraints;for(var i=0,n=transformConstraints.length;i<n;i++){var constraint=transformConstraints[i];if(constraint.name==constraintName)return constraint}return null};SkeletonData.prototype.findPathConstraint=function(constraintName){if(!constraintName)throw new Error("constraintName cannot be null.");var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++){var constraint=pathConstraints[i];if(constraint.name==constraintName)return constraint}return null};SkeletonData.prototype.findPathConstraintIndex=function(pathConstraintName){if(pathConstraintName==null)throw new Error("pathConstraintName cannot be null.");var pathConstraints=this.pathConstraints;for(var i=0,n=pathConstraints.length;i<n;i++)if(pathConstraints[i].name==pathConstraintName)return i;return-1};return SkeletonData}();var SlotData=function(){function SlotData(index,name,boneData){this.color=new Color(1,1,1,1);if(index<0)throw new Error("index must be >= 0.");if(!name)throw new Error("name cannot be null.");if(!boneData)throw new Error("boneData cannot be null.");this.index=index;this.name=name;this.boneData=boneData}return SlotData}();var TransformConstraintData=function(_super){__extends$1(TransformConstraintData,_super);function TransformConstraintData(name){var _this=_super.call(this,name,0,false)||this;_this.bones=new Array;_this.mixRotate=0;_this.mixX=0;_this.mixY=0;_this.mixScaleX=0;_this.mixScaleY=0;_this.mixShearY=0;_this.offsetRotation=0;_this.offsetX=0;_this.offsetY=0;_this.offsetScaleX=0;_this.offsetScaleY=0;_this.offsetShearY=0;_this.relative=false;_this.local=false;return _this}return TransformConstraintData}(ConstraintData);var SkinEntry=function(){function SkinEntry(slotIndex,name,attachment){this.slotIndex=slotIndex;this.name=name;this.attachment=attachment}return SkinEntry}();var Skin=function(){function Skin(name){this.attachments=new Array;this.bones=Array();this.constraints=new Array;if(!name)throw new Error("name cannot be null.");this.name=name}Skin.prototype.setAttachment=function(slotIndex,name,attachment){if(!attachment)throw new Error("attachment cannot be null.");var attachments=this.attachments;if(slotIndex>=attachments.length)attachments.length=slotIndex+1;if(!attachments[slotIndex])attachments[slotIndex]={};attachments[slotIndex][name]=attachment};Skin.prototype.addSkin=function(skin){for(var i=0;i<skin.bones.length;i++){var bone=skin.bones[i];var contained=false;for(var ii=0;ii<this.bones.length;ii++){if(this.bones[ii]==bone){contained=true;break}}if(!contained)this.bones.push(bone)}for(var i=0;i<skin.constraints.length;i++){var constraint=skin.constraints[i];var contained=false;for(var ii=0;ii<this.constraints.length;ii++){if(this.constraints[ii]==constraint){contained=true;break}}if(!contained)this.constraints.push(constraint)}var attachments=skin.getAttachments();for(var i=0;i<attachments.length;i++){var attachment=attachments[i];this.setAttachment(attachment.slotIndex,attachment.name,attachment.attachment)}};Skin.prototype.copySkin=function(skin){for(var i=0;i<skin.bones.length;i++){var bone=skin.bones[i];var contained=false;for(var ii=0;ii<this.bones.length;ii++){if(this.bones[ii]==bone){contained=true;break}}if(!contained)this.bones.push(bone)}for(var i=0;i<skin.constraints.length;i++){var constraint=skin.constraints[i];var contained=false;for(var ii=0;ii<this.constraints.length;ii++){if(this.constraints[ii]==constraint){contained=true;break}}if(!contained)this.constraints.push(constraint)}var attachments=skin.getAttachments();for(var i=0;i<attachments.length;i++){var attachment=attachments[i];if(!attachment.attachment)continue;if(attachment.attachment instanceof MeshAttachment){attachment.attachment=attachment.attachment.newLinkedMesh();this.setAttachment(attachment.slotIndex,attachment.name,attachment.attachment)}else{attachment.attachment=attachment.attachment.copy();this.setAttachment(attachment.slotIndex,attachment.name,attachment.attachment)}}};Skin.prototype.getAttachment=function(slotIndex,name){var dictionary=this.attachments[slotIndex];return dictionary?dictionary[name]:null};Skin.prototype.removeAttachment=function(slotIndex,name){var dictionary=this.attachments[slotIndex];if(dictionary)dictionary[name]=null};Skin.prototype.getAttachments=function(){var entries=new Array;for(var i=0;i<this.attachments.length;i++){var slotAttachments=this.attachments[i];if(slotAttachments){for(var name_1 in slotAttachments){var attachment=slotAttachments[name_1];if(attachment)entries.push(new SkinEntry(i,name_1,attachment))}}}return entries};Skin.prototype.getAttachmentsForSlot=function(slotIndex,attachments){var slotAttachments=this.attachments[slotIndex];if(slotAttachments){for(var name_2 in slotAttachments){var attachment=slotAttachments[name_2];if(attachment)attachments.push(new SkinEntry(slotIndex,name_2,attachment))}}};Skin.prototype.clear=function(){this.attachments.length=0;this.bones.length=0;this.constraints.length=0};Skin.prototype.attachAll=function(skeleton,oldSkin){var slotIndex=0;for(var i=0;i<skeleton.slots.length;i++){var slot=skeleton.slots[i];var slotAttachment=slot.getAttachment();if(slotAttachment&&slotIndex<oldSkin.attachments.length){var dictionary=oldSkin.attachments[slotIndex];for(var key in dictionary){var skinAttachment=dictionary[key];if(slotAttachment==skinAttachment){var attachment=this.getAttachment(slotIndex,key);if(attachment)slot.setAttachment(attachment);break}}}slotIndex++}};return Skin}();var SkeletonBinary=function(){function SkeletonBinary(attachmentLoader){this.scale=1;this.linkedMeshes=new Array;this.attachmentLoader=attachmentLoader}SkeletonBinary.prototype.readSkeletonData=function(binary){var scale=this.scale;var skeletonData=new SkeletonData;skeletonData.name="";var input=new BinaryInput(binary);var lowHash=input.readInt32();var highHash=input.readInt32();skeletonData.hash=highHash==0&&lowHash==0?null:highHash.toString(16)+lowHash.toString(16);skeletonData.version=input.readString();if(skeletonData.version.substr(0,3)!=="4.0"){var error="Spine 4.0 loader cant load version "+skeletonData.version+". Please configure your pixi-spine bundle";console.error(error)}skeletonData.x=input.readFloat();skeletonData.y=input.readFloat();skeletonData.width=input.readFloat();skeletonData.height=input.readFloat();var nonessential=input.readBoolean();if(nonessential){skeletonData.fps=input.readFloat();skeletonData.imagesPath=input.readString();skeletonData.audioPath=input.readString()}var n=0;n=input.readInt(true);for(var i=0;i<n;i++)input.strings.push(input.readString());n=input.readInt(true);for(var i=0;i<n;i++){var name_1=input.readString();var parent_1=i==0?null:skeletonData.bones[input.readInt(true)];var data=new BoneData(i,name_1,parent_1);data.rotation=input.readFloat();data.x=input.readFloat()*scale;data.y=input.readFloat()*scale;data.scaleX=input.readFloat();data.scaleY=input.readFloat();data.shearX=input.readFloat();data.shearY=input.readFloat();data.length=input.readFloat()*scale;data.transformMode=input.readInt(true);data.skinRequired=input.readBoolean();if(nonessential)Color.rgba8888ToColor(data.color,input.readInt32());skeletonData.bones.push(data)}n=input.readInt(true);for(var i=0;i<n;i++){var slotName=input.readString();var boneData=skeletonData.bones[input.readInt(true)];var data=new SlotData(i,slotName,boneData);Color.rgba8888ToColor(data.color,input.readInt32());var darkColor=input.readInt32();if(darkColor!=-1)Color.rgb888ToColor(data.darkColor=new Color,darkColor);data.attachmentName=input.readStringRef();data.blendMode=SkeletonBinary.BlendModeValues[input.readInt(true)];skeletonData.slots.push(data)}n=input.readInt(true);for(var i=0,nn=void 0;i<n;i++){var data=new IkConstraintData(input.readString());data.order=input.readInt(true);data.skinRequired=input.readBoolean();nn=input.readInt(true);for(var ii=0;ii<nn;ii++)data.bones.push(skeletonData.bones[input.readInt(true)]);data.target=skeletonData.bones[input.readInt(true)];data.mix=input.readFloat();data.softness=input.readFloat()*scale;data.bendDirection=input.readByte();data.compress=input.readBoolean();data.stretch=input.readBoolean();data.uniform=input.readBoolean();skeletonData.ikConstraints.push(data)}n=input.readInt(true);for(var i=0,nn=void 0;i<n;i++){var data=new TransformConstraintData(input.readString());data.order=input.readInt(true);data.skinRequired=input.readBoolean();nn=input.readInt(true);for(var ii=0;ii<nn;ii++)data.bones.push(skeletonData.bones[input.readInt(true)]);data.target=skeletonData.bones[input.readInt(true)];data.local=input.readBoolean();data.relative=input.readBoolean();data.offsetRotation=input.readFloat();data.offsetX=input.readFloat()*scale;data.offsetY=input.readFloat()*scale;data.offsetScaleX=input.readFloat();data.offsetScaleY=input.readFloat();data.offsetShearY=input.readFloat();data.mixRotate=input.readFloat();data.mixX=input.readFloat();data.mixY=input.readFloat();data.mixScaleX=input.readFloat();data.mixScaleY=input.readFloat();data.mixShearY=input.readFloat();skeletonData.transformConstraints.push(data)}n=input.readInt(true);for(var i=0,nn=void 0;i<n;i++){var data=new PathConstraintData(input.readString());data.order=input.readInt(true);data.skinRequired=input.readBoolean();nn=input.readInt(true);for(var ii=0;ii<nn;ii++)data.bones.push(skeletonData.bones[input.readInt(true)]);data.target=skeletonData.slots[input.readInt(true)];data.positionMode=input.readInt(true);data.spacingMode=input.readInt(true);data.rotateMode=input.readInt(true);data.offsetRotation=input.readFloat();data.position=input.readFloat();if(data.positionMode==PositionMode.Fixed)data.position*=scale;data.spacing=input.readFloat();if(data.spacingMode==SpacingMode.Length||data.spacingMode==SpacingMode.Fixed)data.spacing*=scale;data.mixRotate=input.readFloat();data.mixX=input.readFloat();data.mixY=input.readFloat();skeletonData.pathConstraints.push(data)}var defaultSkin=this.readSkin(input,skeletonData,true,nonessential);if(defaultSkin){skeletonData.defaultSkin=defaultSkin;skeletonData.skins.push(defaultSkin)}{var i=skeletonData.skins.length;Utils.setArraySize(skeletonData.skins,n=i+input.readInt(true));for(;i<n;i++)skeletonData.skins[i]=this.readSkin(input,skeletonData,false,nonessential)}n=this.linkedMeshes.length;for(var i=0;i<n;i++){var linkedMesh=this.linkedMeshes[i];var skin=!linkedMesh.skin?skeletonData.defaultSkin:skeletonData.findSkin(linkedMesh.skin);var parent_2=skin.getAttachment(linkedMesh.slotIndex,linkedMesh.parent);linkedMesh.mesh.deformAttachment=linkedMesh.inheritDeform?parent_2:linkedMesh.mesh;linkedMesh.mesh.setParentMesh(parent_2)}this.linkedMeshes.length=0;n=input.readInt(true);for(var i=0;i<n;i++){var data=new EventData(input.readStringRef());data.intValue=input.readInt(false);data.floatValue=input.readFloat();data.stringValue=input.readString();data.audioPath=input.readString();if(data.audioPath){data.volume=input.readFloat();data.balance=input.readFloat()}skeletonData.events.push(data)}n=input.readInt(true);for(var i=0;i<n;i++)skeletonData.animations.push(this.readAnimation(input,input.readString(),skeletonData));return skeletonData};SkeletonBinary.prototype.readSkin=function(input,skeletonData,defaultSkin,nonessential){var skin=null;var slotCount=0;if(defaultSkin){slotCount=input.readInt(true);if(slotCount==0)return null;skin=new Skin("default")}else{skin=new Skin(input.readStringRef());skin.bones.length=input.readInt(true);for(var i=0,n=skin.bones.length;i<n;i++)skin.bones[i]=skeletonData.bones[input.readInt(true)];for(var i=0,n=input.readInt(true);i<n;i++)skin.constraints.push(skeletonData.ikConstraints[input.readInt(true)]);for(var i=0,n=input.readInt(true);i<n;i++)skin.constraints.push(skeletonData.transformConstraints[input.readInt(true)]);for(var i=0,n=input.readInt(true);i<n;i++)skin.constraints.push(skeletonData.pathConstraints[input.readInt(true)]);slotCount=input.readInt(true)}for(var i=0;i<slotCount;i++){var slotIndex=input.readInt(true);for(var ii=0,nn=input.readInt(true);ii<nn;ii++){var name_2=input.readStringRef();var attachment=this.readAttachment(input,skeletonData,skin,slotIndex,name_2,nonessential);if(attachment)skin.setAttachment(slotIndex,name_2,attachment)}}return skin};SkeletonBinary.prototype.readAttachment=function(input,skeletonData,skin,slotIndex,attachmentName,nonessential){var scale=this.scale;var name=input.readStringRef();if(!name)name=attachmentName;switch(input.readByte()){case exports.AttachmentType.Region:{var path=input.readStringRef();var rotation=input.readFloat();var x=input.readFloat();var y=input.readFloat();var scaleX=input.readFloat();var scaleY=input.readFloat();var width=input.readFloat();var height=input.readFloat();var color=input.readInt32();if(!path)path=name;var region=this.attachmentLoader.newRegionAttachment(skin,name,path);if(!region)return null;region.path=path;region.x=x*scale;region.y=y*scale;region.scaleX=scaleX;region.scaleY=scaleY;region.rotation=rotation;region.width=width*scale;region.height=height*scale;Color.rgba8888ToColor(region.color,color);return region}case exports.AttachmentType.BoundingBox:{var vertexCount=input.readInt(true);var vertices=this.readVertices(input,vertexCount);var color=nonessential?input.readInt32():0;var box=this.attachmentLoader.newBoundingBoxAttachment(skin,name);if(!box)return null;box.worldVerticesLength=vertexCount<<1;box.vertices=vertices.vertices;box.bones=vertices.bones;if(nonessential)Color.rgba8888ToColor(box.color,color);return box}case exports.AttachmentType.Mesh:{var path=input.readStringRef();var color=input.readInt32();var vertexCount=input.readInt(true);var uvs=this.readFloatArray(input,vertexCount<<1,1);var triangles=this.readShortArray(input);var vertices=this.readVertices(input,vertexCount);var hullLength=input.readInt(true);var edges=null;var width=0,height=0;if(nonessential){edges=this.readShortArray(input);width=input.readFloat();height=input.readFloat()}if(!path)path=name;var mesh=this.attachmentLoader.newMeshAttachment(skin,name,path);if(!mesh)return null;mesh.path=path;Color.rgba8888ToColor(mesh.color,color);mesh.bones=vertices.bones;mesh.vertices=vertices.vertices;mesh.worldVerticesLength=vertexCount<<1;mesh.triangles=triangles;mesh.regionUVs=new Float32Array(uvs);mesh.hullLength=hullLength<<1;if(nonessential){mesh.edges=edges;mesh.width=width*scale;mesh.height=height*scale}return mesh}case exports.AttachmentType.LinkedMesh:{var path=input.readStringRef();var color=input.readInt32();var skinName=input.readStringRef();var parent_3=input.readStringRef();var inheritDeform=input.readBoolean();var width=0,height=0;if(nonessential){width=input.readFloat();height=input.readFloat()}if(!path)path=name;var mesh=this.attachmentLoader.newMeshAttachment(skin,name,path);if(!mesh)return null;mesh.path=path;Color.rgba8888ToColor(mesh.color,color);if(nonessential){mesh.width=width*scale;mesh.height=height*scale}this.linkedMeshes.push(new LinkedMesh$1(mesh,skinName,slotIndex,parent_3,inheritDeform));return mesh}case exports.AttachmentType.Path:{var closed_1=input.readBoolean();var constantSpeed=input.readBoolean();var vertexCount=input.readInt(true);var vertices=this.readVertices(input,vertexCount);var lengths=Utils.newArray(vertexCount/3,0);for(var i=0,n=lengths.length;i<n;i++)lengths[i]=input.readFloat()*scale;var color=nonessential?input.readInt32():0;var path=this.attachmentLoader.newPathAttachment(skin,name);if(!path)return null;path.closed=closed_1;path.constantSpeed=constantSpeed;path.worldVerticesLength=vertexCount<<1;path.vertices=vertices.vertices;path.bones=vertices.bones;path.lengths=lengths;if(nonessential)Color.rgba8888ToColor(path.color,color);return path}case exports.AttachmentType.Point:{var rotation=input.readFloat();var x=input.readFloat();var y=input.readFloat();var color=nonessential?input.readInt32():0;var point=this.attachmentLoader.newPointAttachment(skin,name);if(!point)return null;point.x=x*scale;point.y=y*scale;point.rotation=rotation;if(nonessential)Color.rgba8888ToColor(point.color,color);return point}case exports.AttachmentType.Clipping:{var endSlotIndex=input.readInt(true);var vertexCount=input.readInt(true);var vertices=this.readVertices(input,vertexCount);var color=nonessential?input.readInt32():0;var clip=this.attachmentLoader.newClippingAttachment(skin,name);if(!clip)return null;clip.endSlot=skeletonData.slots[endSlotIndex];clip.worldVerticesLength=vertexCount<<1;clip.vertices=vertices.vertices;clip.bones=vertices.bones;if(nonessential)Color.rgba8888ToColor(clip.color,color);return clip}}return null};SkeletonBinary.prototype.readVertices=function(input,vertexCount){var scale=this.scale;var verticesLength=vertexCount<<1;var vertices=new Vertices;if(!input.readBoolean()){vertices.vertices=this.readFloatArray(input,verticesLength,scale);return vertices}var weights=new Array;var bonesArray=new Array;for(var i=0;i<vertexCount;i++){var boneCount=input.readInt(true);bonesArray.push(boneCount);for(var ii=0;ii<boneCount;ii++){bonesArray.push(input.readInt(true));weights.push(input.readFloat()*scale);weights.push(input.readFloat()*scale);weights.push(input.readFloat())}}vertices.vertices=Utils.toFloatArray(weights);vertices.bones=bonesArray;return vertices};SkeletonBinary.prototype.readFloatArray=function(input,n,scale){var array=new Array(n);if(scale==1){for(var i=0;i<n;i++)array[i]=input.readFloat()}else{for(var i=0;i<n;i++)array[i]=input.readFloat()*scale}return array};SkeletonBinary.prototype.readShortArray=function(input){var n=input.readInt(true);var array=new Array(n);for(var i=0;i<n;i++)array[i]=input.readShort();return array};SkeletonBinary.prototype.readAnimation=function(input,name,skeletonData){input.readInt(true);var timelines=new Array;var scale=this.scale;for(var i=0,n=input.readInt(true);i<n;i++){var slotIndex=input.readInt(true);for(var ii=0,nn=input.readInt(true);ii<nn;ii++){var timelineType=input.readByte();var frameCount=input.readInt(true);var frameLast=frameCount-1;switch(timelineType){case SLOT_ATTACHMENT:{var timeline=new AttachmentTimeline(frameCount,slotIndex);for(var frame=0;frame<frameCount;frame++)timeline.setFrame(frame,input.readFloat(),input.readStringRef());timelines.push(timeline);break}case SLOT_RGBA:{var bezierCount=input.readInt(true);var timeline=new RGBATimeline(frameCount,bezierCount,slotIndex);var time=input.readFloat();var r=input.readUnsignedByte()/255;var g=input.readUnsignedByte()/255;var b=input.readUnsignedByte()/255;var a=input.readUnsignedByte()/255;for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,r,g,b,a);if(frame==frameLast)break;var time2=input.readFloat();var r2=input.readUnsignedByte()/255;var g2=input.readUnsignedByte()/255;var b2=input.readUnsignedByte()/255;var a2=input.readUnsignedByte()/255;switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,r,r2,1);setBezier(input,timeline,bezier++,frame,1,time,time2,g,g2,1);setBezier(input,timeline,bezier++,frame,2,time,time2,b,b2,1);setBezier(input,timeline,bezier++,frame,3,time,time2,a,a2,1)}time=time2;r=r2;g=g2;b=b2;a=a2}timelines.push(timeline);break}case SLOT_RGB:{var bezierCount=input.readInt(true);var timeline=new RGBTimeline(frameCount,bezierCount,slotIndex);var time=input.readFloat();var r=input.readUnsignedByte()/255;var g=input.readUnsignedByte()/255;var b=input.readUnsignedByte()/255;for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,r,g,b);if(frame==frameLast)break;var time2=input.readFloat();var r2=input.readUnsignedByte()/255;var g2=input.readUnsignedByte()/255;var b2=input.readUnsignedByte()/255;switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,r,r2,1);setBezier(input,timeline,bezier++,frame,1,time,time2,g,g2,1);setBezier(input,timeline,bezier++,frame,2,time,time2,b,b2,1)}time=time2;r=r2;g=g2;b=b2}timelines.push(timeline);break}case SLOT_RGBA2:{var bezierCount=input.readInt(true);var timeline=new RGBA2Timeline(frameCount,bezierCount,slotIndex);var time=input.readFloat();var r=input.readUnsignedByte()/255;var g=input.readUnsignedByte()/255;var b=input.readUnsignedByte()/255;var a=input.readUnsignedByte()/255;var r2=input.readUnsignedByte()/255;var g2=input.readUnsignedByte()/255;var b2=input.readUnsignedByte()/255;for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,r,g,b,a,r2,g2,b2);if(frame==frameLast)break;var time2=input.readFloat();var nr=input.readUnsignedByte()/255;var ng=input.readUnsignedByte()/255;var nb=input.readUnsignedByte()/255;var na=input.readUnsignedByte()/255;var nr2=input.readUnsignedByte()/255;var ng2=input.readUnsignedByte()/255;var nb2=input.readUnsignedByte()/255;switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,r,nr,1);setBezier(input,timeline,bezier++,frame,1,time,time2,g,ng,1);setBezier(input,timeline,bezier++,frame,2,time,time2,b,nb,1);setBezier(input,timeline,bezier++,frame,3,time,time2,a,na,1);setBezier(input,timeline,bezier++,frame,4,time,time2,r2,nr2,1);setBezier(input,timeline,bezier++,frame,5,time,time2,g2,ng2,1);setBezier(input,timeline,bezier++,frame,6,time,time2,b2,nb2,1)}time=time2;r=nr;g=ng;b=nb;a=na;r2=nr2;g2=ng2;b2=nb2}timelines.push(timeline);break}case SLOT_RGB2:{var bezierCount=input.readInt(true);var timeline=new RGB2Timeline(frameCount,bezierCount,slotIndex);var time=input.readFloat();var r=input.readUnsignedByte()/255;var g=input.readUnsignedByte()/255;var b=input.readUnsignedByte()/255;var r2=input.readUnsignedByte()/255;var g2=input.readUnsignedByte()/255;var b2=input.readUnsignedByte()/255;for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,r,g,b,r2,g2,b2);if(frame==frameLast)break;var time2=input.readFloat();var nr=input.readUnsignedByte()/255;var ng=input.readUnsignedByte()/255;var nb=input.readUnsignedByte()/255;var nr2=input.readUnsignedByte()/255;var ng2=input.readUnsignedByte()/255;var nb2=input.readUnsignedByte()/255;switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,r,nr,1);setBezier(input,timeline,bezier++,frame,1,time,time2,g,ng,1);setBezier(input,timeline,bezier++,frame,2,time,time2,b,nb,1);setBezier(input,timeline,bezier++,frame,3,time,time2,r2,nr2,1);setBezier(input,timeline,bezier++,frame,4,time,time2,g2,ng2,1);setBezier(input,timeline,bezier++,frame,5,time,time2,b2,nb2,1)}time=time2;r=nr;g=ng;b=nb;r2=nr2;g2=ng2;b2=nb2}timelines.push(timeline);break}case SLOT_ALPHA:{var timeline=new AlphaTimeline(frameCount,input.readInt(true),slotIndex);var time=input.readFloat(),a=input.readUnsignedByte()/255;for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,a);if(frame==frameLast)break;var time2=input.readFloat();var a2=input.readUnsignedByte()/255;switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,a,a2,1)}time=time2;a=a2}timelines.push(timeline);break}}}}for(var i=0,n=input.readInt(true);i<n;i++){var boneIndex=input.readInt(true);for(var ii=0,nn=input.readInt(true);ii<nn;ii++){var type=input.readByte(),frameCount=input.readInt(true),bezierCount=input.readInt(true);switch(type){case BONE_ROTATE:timelines.push(readTimeline1$1(input,new RotateTimeline(frameCount,bezierCount,boneIndex),1));break;case BONE_TRANSLATE:timelines.push(readTimeline2$1(input,new TranslateTimeline(frameCount,bezierCount,boneIndex),scale));break;case BONE_TRANSLATEX:timelines.push(readTimeline1$1(input,new TranslateXTimeline(frameCount,bezierCount,boneIndex),scale));break;case BONE_TRANSLATEY:timelines.push(readTimeline1$1(input,new TranslateYTimeline(frameCount,bezierCount,boneIndex),scale));break;case BONE_SCALE:timelines.push(readTimeline2$1(input,new ScaleTimeline(frameCount,bezierCount,boneIndex),1));break;case BONE_SCALEX:timelines.push(readTimeline1$1(input,new ScaleXTimeline(frameCount,bezierCount,boneIndex),1));break;case BONE_SCALEY:timelines.push(readTimeline1$1(input,new ScaleYTimeline(frameCount,bezierCount,boneIndex),1));break;case BONE_SHEAR:timelines.push(readTimeline2$1(input,new ShearTimeline(frameCount,bezierCount,boneIndex),1));break;case BONE_SHEARX:timelines.push(readTimeline1$1(input,new ShearXTimeline(frameCount,bezierCount,boneIndex),1));break;case BONE_SHEARY:timelines.push(readTimeline1$1(input,new ShearYTimeline(frameCount,bezierCount,boneIndex),1))}}}for(var i=0,n=input.readInt(true);i<n;i++){var index=input.readInt(true),frameCount=input.readInt(true),frameLast=frameCount-1;var timeline=new IkConstraintTimeline(frameCount,input.readInt(true),index);var time=input.readFloat(),mix=input.readFloat(),softness=input.readFloat()*scale;for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,mix,softness,input.readByte(),input.readBoolean(),input.readBoolean());if(frame==frameLast)break;var time2=input.readFloat(),mix2=input.readFloat(),softness2=input.readFloat()*scale;switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,mix,mix2,1);setBezier(input,timeline,bezier++,frame,1,time,time2,softness,softness2,scale)}time=time2;mix=mix2;softness=softness2}timelines.push(timeline)}for(var i=0,n=input.readInt(true);i<n;i++){var index=input.readInt(true),frameCount=input.readInt(true),frameLast=frameCount-1;var timeline=new TransformConstraintTimeline(frameCount,input.readInt(true),index);var time=input.readFloat(),mixRotate=input.readFloat(),mixX=input.readFloat(),mixY=input.readFloat(),mixScaleX=input.readFloat(),mixScaleY=input.readFloat(),mixShearY=input.readFloat();for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,mixRotate,mixX,mixY,mixScaleX,mixScaleY,mixShearY);if(frame==frameLast)break;var time2=input.readFloat(),mixRotate2=input.readFloat(),mixX2=input.readFloat(),mixY2=input.readFloat(),mixScaleX2=input.readFloat(),mixScaleY2=input.readFloat(),mixShearY2=input.readFloat();switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,mixRotate,mixRotate2,1);setBezier(input,timeline,bezier++,frame,1,time,time2,mixX,mixX2,1);setBezier(input,timeline,bezier++,frame,2,time,time2,mixY,mixY2,1);setBezier(input,timeline,bezier++,frame,3,time,time2,mixScaleX,mixScaleX2,1);setBezier(input,timeline,bezier++,frame,4,time,time2,mixScaleY,mixScaleY2,1);setBezier(input,timeline,bezier++,frame,5,time,time2,mixShearY,mixShearY2,1)}time=time2;mixRotate=mixRotate2;mixX=mixX2;mixY=mixY2;mixScaleX=mixScaleX2;mixScaleY=mixScaleY2;mixShearY=mixShearY2}timelines.push(timeline)}for(var i=0,n=input.readInt(true);i<n;i++){var index=input.readInt(true);var data=skeletonData.pathConstraints[index];for(var ii=0,nn=input.readInt(true);ii<nn;ii++){switch(input.readByte()){case PATH_POSITION:timelines.push(readTimeline1$1(input,new PathConstraintPositionTimeline(input.readInt(true),input.readInt(true),index),data.positionMode==PositionMode.Fixed?scale:1));break;case PATH_SPACING:timelines.push(readTimeline1$1(input,new PathConstraintSpacingTimeline(input.readInt(true),input.readInt(true),index),data.spacingMode==SpacingMode.Length||data.spacingMode==SpacingMode.Fixed?scale:1));break;case PATH_MIX:var timeline=new PathConstraintMixTimeline(input.readInt(true),input.readInt(true),index);var time=input.readFloat(),mixRotate=input.readFloat(),mixX=input.readFloat(),mixY=input.readFloat();for(var frame=0,bezier=0,frameLast=timeline.getFrameCount()-1;;frame++){timeline.setFrame(frame,time,mixRotate,mixX,mixY);if(frame==frameLast)break;var time2=input.readFloat(),mixRotate2=input.readFloat(),mixX2=input.readFloat(),mixY2=input.readFloat();switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,mixRotate,mixRotate2,1);setBezier(input,timeline,bezier++,frame,1,time,time2,mixX,mixX2,1);setBezier(input,timeline,bezier++,frame,2,time,time2,mixY,mixY2,1)}time=time2;mixRotate=mixRotate2;mixX=mixX2;mixY=mixY2}timelines.push(timeline)}}}for(var i=0,n=input.readInt(true);i<n;i++){var skin=skeletonData.skins[input.readInt(true)];for(var ii=0,nn=input.readInt(true);ii<nn;ii++){var slotIndex=input.readInt(true);for(var iii=0,nnn=input.readInt(true);iii<nnn;iii++){var attachmentName=input.readStringRef();var attachment=skin.getAttachment(slotIndex,attachmentName);var weighted=attachment.bones;var vertices=attachment.vertices;var deformLength=weighted?vertices.length/3*2:vertices.length;var frameCount=input.readInt(true);var frameLast=frameCount-1;var bezierCount=input.readInt(true);var timeline=new DeformTimeline(frameCount,bezierCount,slotIndex,attachment);var time=input.readFloat();for(var frame=0,bezier=0;;frame++){var deform=void 0;var end=input.readInt(true);if(end==0)deform=weighted?Utils.newFloatArray(deformLength):vertices;else{deform=Utils.newFloatArray(deformLength);var start=input.readInt(true);end+=start;if(scale==1){for(var v=start;v<end;v++)deform[v]=input.readFloat()}else{for(var v=start;v<end;v++)deform[v]=input.readFloat()*scale}if(!weighted){for(var v=0,vn=deform.length;v<vn;v++)deform[v]+=vertices[v]}}timeline.setFrame(frame,time,deform);if(frame==frameLast)break;var time2=input.readFloat();switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,0,1,1)}time=time2}timelines.push(timeline)}}}var drawOrderCount=input.readInt(true);if(drawOrderCount>0){var timeline=new DrawOrderTimeline(drawOrderCount);var slotCount=skeletonData.slots.length;for(var i=0;i<drawOrderCount;i++){var time=input.readFloat();var offsetCount=input.readInt(true);var drawOrder=Utils.newArray(slotCount,0);for(var ii=slotCount-1;ii>=0;ii--)drawOrder[ii]=-1;var unchanged=Utils.newArray(slotCount-offsetCount,0);var originalIndex=0,unchangedIndex=0;for(var ii=0;ii<offsetCount;ii++){var slotIndex=input.readInt(true);while(originalIndex!=slotIndex)unchanged[unchangedIndex++]=originalIndex++;drawOrder[originalIndex+input.readInt(true)]=originalIndex++}while(originalIndex<slotCount)unchanged[unchangedIndex++]=originalIndex++;for(var ii=slotCount-1;ii>=0;ii--)if(drawOrder[ii]==-1)drawOrder[ii]=unchanged[--unchangedIndex];timeline.setFrame(i,time,drawOrder)}timelines.push(timeline)}var eventCount=input.readInt(true);if(eventCount>0){var timeline=new EventTimeline(eventCount);for(var i=0;i<eventCount;i++){var time=input.readFloat();var eventData=skeletonData.events[input.readInt(true)];var event_1=new Event(time,eventData);event_1.intValue=input.readInt(false);event_1.floatValue=input.readFloat();event_1.stringValue=input.readBoolean()?input.readString():eventData.stringValue;if(event_1.data.audioPath){event_1.volume=input.readFloat();event_1.balance=input.readFloat()}timeline.setFrame(i,event_1)}timelines.push(timeline)}var duration=0;for(var i=0,n=timelines.length;i<n;i++)duration=Math.max(duration,timelines[i].getDuration());return new Animation(name,timelines,duration)};SkeletonBinary.BlendModeValues=[constants.BLEND_MODES.NORMAL,constants.BLEND_MODES.ADD,constants.BLEND_MODES.MULTIPLY,constants.BLEND_MODES.SCREEN];return SkeletonBinary}();var LinkedMesh$1=function(){function LinkedMesh(mesh,skin,slotIndex,parent,inheritDeform){this.mesh=mesh;this.skin=skin;this.slotIndex=slotIndex;this.parent=parent;this.inheritDeform=inheritDeform}return LinkedMesh}();var Vertices=function(){function Vertices(bones,vertices){if(bones===void 0){bones=null}if(vertices===void 0){vertices=null}this.bones=bones;this.vertices=vertices}return Vertices}();function readTimeline1$1(input,timeline,scale){var time=input.readFloat(),value=input.readFloat()*scale;for(var frame=0,bezier=0,frameLast=timeline.getFrameCount()-1;;frame++){timeline.setFrame(frame,time,value);if(frame==frameLast)break;var time2=input.readFloat(),value2=input.readFloat()*scale;switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,value,value2,1)}time=time2;value=value2}return timeline}function readTimeline2$1(input,timeline,scale){var time=input.readFloat(),value1=input.readFloat()*scale,value2=input.readFloat()*scale;for(var frame=0,bezier=0,frameLast=timeline.getFrameCount()-1;;frame++){timeline.setFrame(frame,time,value1,value2);if(frame==frameLast)break;var time2=input.readFloat(),nvalue1=input.readFloat()*scale,nvalue2=input.readFloat()*scale;switch(input.readByte()){case CURVE_STEPPED:timeline.setStepped(frame);break;case CURVE_BEZIER:setBezier(input,timeline,bezier++,frame,0,time,time2,value1,nvalue1,scale);setBezier(input,timeline,bezier++,frame,1,time,time2,value2,nvalue2,scale)}time=time2;value1=nvalue1;value2=nvalue2}return timeline}function setBezier(input,timeline,bezier,frame,value,time1,time2,value1,value2,scale){timeline.setBezier(bezier,frame,value,time1,value1,input.readFloat(),input.readFloat()*scale,input.readFloat(),input.readFloat()*scale,time2,value2)}var BONE_ROTATE=0;var BONE_TRANSLATE=1;var BONE_TRANSLATEX=2;var BONE_TRANSLATEY=3;var BONE_SCALE=4;var BONE_SCALEX=5;var BONE_SCALEY=6;var BONE_SHEAR=7;var BONE_SHEARX=8;var BONE_SHEARY=9;var SLOT_ATTACHMENT=0;var SLOT_RGBA=1;var SLOT_RGB=2;var SLOT_RGBA2=3;var SLOT_RGB2=4;var SLOT_ALPHA=5;var PATH_POSITION=0;var PATH_SPACING=1;var PATH_MIX=2;var CURVE_STEPPED=1;var CURVE_BEZIER=2;var SkeletonBounds=function(){function SkeletonBounds(){this.minX=0;this.minY=0;this.maxX=0;this.maxY=0;this.boundingBoxes=new Array;this.polygons=new Array;this.polygonPool=new Pool(function(){return Utils.newFloatArray(16)})}SkeletonBounds.prototype.update=function(skeleton,updateAabb){if(skeleton==null)throw new Error("skeleton cannot be null.");var boundingBoxes=this.boundingBoxes;var polygons=this.polygons;var polygonPool=this.polygonPool;var slots=skeleton.slots;var slotCount=slots.length;boundingBoxes.length=0;polygonPool.freeAll(polygons);polygons.length=0;for(var i=0;i<slotCount;i++){var slot=slots[i];if(!slot.bone.active)continue;var attachment=slot.getAttachment();if(attachment instanceof BoundingBoxAttachment){var boundingBox=attachment;boundingBoxes.push(boundingBox);var polygon=polygonPool.obtain();if(polygon.length!=boundingBox.worldVerticesLength){polygon=Utils.newFloatArray(boundingBox.worldVerticesLength)}polygons.push(polygon);boundingBox.computeWorldVertices(slot,0,boundingBox.worldVerticesLength,polygon,0,2)}}if(updateAabb){this.aabbCompute()}else{this.minX=Number.POSITIVE_INFINITY;this.minY=Number.POSITIVE_INFINITY;this.maxX=Number.NEGATIVE_INFINITY;this.maxY=Number.NEGATIVE_INFINITY}};SkeletonBounds.prototype.aabbCompute=function(){var minX=Number.POSITIVE_INFINITY,minY=Number.POSITIVE_INFINITY,maxX=Number.NEGATIVE_INFINITY,maxY=Number.NEGATIVE_INFINITY;var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++){var polygon=polygons[i];var vertices=polygon;for(var ii=0,nn=polygon.length;ii<nn;ii+=2){var x=vertices[ii];var y=vertices[ii+1];minX=Math.min(minX,x);minY=Math.min(minY,y);maxX=Math.max(maxX,x);maxY=Math.max(maxY,y)}}this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};SkeletonBounds.prototype.aabbContainsPoint=function(x,y){return x>=this.minX&&x<=this.maxX&&y>=this.minY&&y<=this.maxY};SkeletonBounds.prototype.aabbIntersectsSegment=function(x1,y1,x2,y2){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;if(x1<=minX&&x2<=minX||y1<=minY&&y2<=minY||x1>=maxX&&x2>=maxX||y1>=maxY&&y2>=maxY)return false;var m=(y2-y1)/(x2-x1);var y=m*(minX-x1)+y1;if(y>minY&&y<maxY)return true;y=m*(maxX-x1)+y1;if(y>minY&&y<maxY)return true;var x=(minY-y1)/m+x1;if(x>minX&&x<maxX)return true;x=(maxY-y1)/m+x1;if(x>minX&&x<maxX)return true;return false};SkeletonBounds.prototype.aabbIntersectsSkeleton=function(bounds){return this.minX<bounds.maxX&&this.maxX>bounds.minX&&this.minY<bounds.maxY&&this.maxY>bounds.minY};SkeletonBounds.prototype.containsPoint=function(x,y){var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++)if(this.containsPointPolygon(polygons[i],x,y))return this.boundingBoxes[i];return null};SkeletonBounds.prototype.containsPointPolygon=function(polygon,x,y){var vertices=polygon;var nn=polygon.length;var prevIndex=nn-2;var inside=false;for(var ii=0;ii<nn;ii+=2){var vertexY=vertices[ii+1];var prevY=vertices[prevIndex+1];if(vertexY<y&&prevY>=y||prevY<y&&vertexY>=y){var vertexX=vertices[ii];if(vertexX+(y-vertexY)/(prevY-vertexY)*(vertices[prevIndex]-vertexX)<x)inside=!inside}prevIndex=ii}return inside};SkeletonBounds.prototype.intersectsSegment=function(x1,y1,x2,y2){var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++)if(this.intersectsSegmentPolygon(polygons[i],x1,y1,x2,y2))return this.boundingBoxes[i];return null};SkeletonBounds.prototype.intersectsSegmentPolygon=function(polygon,x1,y1,x2,y2){var vertices=polygon;var nn=polygon.length;var width12=x1-x2,height12=y1-y2;var det1=x1*y2-y1*x2;var x3=vertices[nn-2],y3=vertices[nn-1];for(var ii=0;ii<nn;ii+=2){var x4=vertices[ii],y4=vertices[ii+1];var det2=x3*y4-y3*x4;var width34=x3-x4,height34=y3-y4;var det3=width12*height34-height12*width34;var x=(det1*width34-width12*det2)/det3;if((x>=x3&&x<=x4||x>=x4&&x<=x3)&&(x>=x1&&x<=x2||x>=x2&&x<=x1)){var y=(det1*height34-height12*det2)/det3;if((y>=y3&&y<=y4||y>=y4&&y<=y3)&&(y>=y1&&y<=y2||y>=y2&&y<=y1))return true}x3=x4;y3=y4}return false};SkeletonBounds.prototype.getPolygon=function(boundingBox){if(boundingBox==null)throw new Error("boundingBox cannot be null.");var index=this.boundingBoxes.indexOf(boundingBox);return index==-1?null:this.polygons[index]};SkeletonBounds.prototype.getWidth=function(){return this.maxX-this.minX};SkeletonBounds.prototype.getHeight=function(){return this.maxY-this.minY};return SkeletonBounds}();var SkeletonJson=function(){function SkeletonJson(attachmentLoader){this.scale=1;this.linkedMeshes=new Array;this.attachmentLoader=attachmentLoader}SkeletonJson.prototype.readSkeletonData=function(json){var scale=this.scale;var skeletonData=new SkeletonData;var root=typeof json==="string"?JSON.parse(json):json;var skeletonMap=root.skeleton;if(skeletonMap){skeletonData.hash=skeletonMap.hash;skeletonData.version=skeletonMap.spine;if(skeletonData.version.substr(0,3)!=="4.0"){var error="Spine 4.0 loader cant load version "+skeletonMap.spine+". Please configure your pixi-spine bundle";console.error(error)}skeletonData.x=skeletonMap.x;skeletonData.y=skeletonMap.y;skeletonData.width=skeletonMap.width;skeletonData.height=skeletonMap.height;skeletonData.fps=skeletonMap.fps;skeletonData.imagesPath=skeletonMap.images}if(root.bones){for(var i=0;i<root.bones.length;i++){var boneMap=root.bones[i];var parent_1=null;var parentName=getValue(boneMap,"parent",null);if(parentName!=null){parent_1=skeletonData.findBone(parentName);if(parent_1==null)throw new Error("Parent bone not found: "+parentName)}var data=new BoneData(skeletonData.bones.length,boneMap.name,parent_1);data.length=getValue(boneMap,"length",0)*scale;data.x=getValue(boneMap,"x",0)*scale;data.y=getValue(boneMap,"y",0)*scale;data.rotation=getValue(boneMap,"rotation",0);data.scaleX=getValue(boneMap,"scaleX",1);data.scaleY=getValue(boneMap,"scaleY",1);data.shearX=getValue(boneMap,"shearX",0);data.shearY=getValue(boneMap,"shearY",0);data.transformMode=Utils.enumValue(TransformMode,getValue(boneMap,"transform","Normal"));data.skinRequired=getValue(boneMap,"skin",false);var color=getValue(boneMap,"color",null);if(color)data.color.setFromString(color);skeletonData.bones.push(data)}}if(root.slots){for(var i=0;i<root.slots.length;i++){var slotMap=root.slots[i];var slotName=slotMap.name;var boneName=slotMap.bone;var boneData=skeletonData.findBone(boneName);if(boneData==null)throw new Error("Slot bone not found: "+boneName);var data=new SlotData(skeletonData.slots.length,slotName,boneData);var color=getValue(slotMap,"color",null);if(color)data.color.setFromString(color);var dark=getValue(slotMap,"dark",null);if(dark)data.darkColor=Color.fromString(dark);data.attachmentName=getValue(slotMap,"attachment",null);data.blendMode=SkeletonJson.blendModeFromString(getValue(slotMap,"blend","normal"));skeletonData.slots.push(data)}}if(root.ik){for(var i=0;i<root.ik.length;i++){var constraintMap=root.ik[i];var data=new IkConstraintData(constraintMap.name);data.order=getValue(constraintMap,"order",0);data.skinRequired=getValue(constraintMap,"skin",false);for(var ii=0;ii<constraintMap.bones.length;ii++){var boneName=constraintMap.bones[ii];var bone=skeletonData.findBone(boneName);if(bone==null)throw new Error("IK bone not found: "+boneName);data.bones.push(bone)}data.target=skeletonData.findBone(constraintMap.target);data.mix=getValue(constraintMap,"mix",1);data.softness=getValue(constraintMap,"softness",0)*scale;data.bendDirection=getValue(constraintMap,"bendPositive",true)?1:-1;data.compress=getValue(constraintMap,"compress",false);data.stretch=getValue(constraintMap,"stretch",false);data.uniform=getValue(constraintMap,"uniform",false);skeletonData.ikConstraints.push(data)}}if(root.transform){for(var i=0;i<root.transform.length;i++){var constraintMap=root.transform[i];var data=new TransformConstraintData(constraintMap.name);data.order=getValue(constraintMap,"order",0);data.skinRequired=getValue(constraintMap,"skin",false);for(var ii=0;ii<constraintMap.bones.length;ii++){var boneName=constraintMap.bones[ii];var bone=skeletonData.findBone(boneName);if(bone==null)throw new Error("Transform constraint bone not found: "+boneName);data.bones.push(bone)}var targetName=constraintMap.target;data.target=skeletonData.findBone(targetName);if(data.target==null)throw new Error("Transform constraint target bone not found: "+targetName);data.local=getValue(constraintMap,"local",false);data.relative=getValue(constraintMap,"relative",false);data.offsetRotation=getValue(constraintMap,"rotation",0);data.offsetX=getValue(constraintMap,"x",0)*scale;data.offsetY=getValue(constraintMap,"y",0)*scale;data.offsetScaleX=getValue(constraintMap,"scaleX",0);data.offsetScaleY=getValue(constraintMap,"scaleY",0);data.offsetShearY=getValue(constraintMap,"shearY",0);data.mixRotate=getValue(constraintMap,"mixRotate",1);data.mixX=getValue(constraintMap,"mixX",1);data.mixY=getValue(constraintMap,"mixY",data.mixX);data.mixScaleX=getValue(constraintMap,"mixScaleX",1);data.mixScaleY=getValue(constraintMap,"mixScaleY",data.mixScaleX);data.mixShearY=getValue(constraintMap,"mixShearY",1);skeletonData.transformConstraints.push(data)}}if(root.path){for(var i=0;i<root.path.length;i++){var constraintMap=root.path[i];var data=new PathConstraintData(constraintMap.name);data.order=getValue(constraintMap,"order",0);data.skinRequired=getValue(constraintMap,"skin",false);for(var ii=0;ii<constraintMap.bones.length;ii++){var boneName=constraintMap.bones[ii];var bone=skeletonData.findBone(boneName);if(bone==null)throw new Error("Transform constraint bone not found: "+boneName);data.bones.push(bone)}var targetName=constraintMap.target;data.target=skeletonData.findSlot(targetName);if(data.target==null)throw new Error("Path target slot not found: "+targetName);data.positionMode=Utils.enumValue(PositionMode,getValue(constraintMap,"positionMode","Percent"));data.spacingMode=Utils.enumValue(SpacingMode,getValue(constraintMap,"spacingMode","Length"));data.rotateMode=Utils.enumValue(RotateMode,getValue(constraintMap,"rotateMode","Tangent"));data.offsetRotation=getValue(constraintMap,"rotation",0);data.position=getValue(constraintMap,"position",0);if(data.positionMode==PositionMode.Fixed)data.position*=scale;data.spacing=getValue(constraintMap,"spacing",0);if(data.spacingMode==SpacingMode.Length||data.spacingMode==SpacingMode.Fixed)data.spacing*=scale;data.mixRotate=getValue(constraintMap,"mixRotate",1);data.mixX=getValue(constraintMap,"mixX",1);data.mixY=getValue(constraintMap,"mixY",data.mixX);skeletonData.pathConstraints.push(data)}}if(root.skins){for(var i=0;i<root.skins.length;i++){var skinMap=root.skins[i];var skin=new Skin(skinMap.name);if(skinMap.bones){for(var ii=0;ii<skinMap.bones.length;ii++){var bone=skeletonData.findBone(skinMap.bones[ii]);if(bone==null)throw new Error("Skin bone not found: "+skinMap.bones[i]);skin.bones.push(bone)}}if(skinMap.ik){for(var ii=0;ii<skinMap.ik.length;ii++){var constraint=skeletonData.findIkConstraint(skinMap.ik[ii]);if(constraint==null)throw new Error("Skin IK constraint not found: "+skinMap.ik[i]);skin.constraints.push(constraint)}}if(skinMap.transform){for(var ii=0;ii<skinMap.transform.length;ii++){var constraint=skeletonData.findTransformConstraint(skinMap.transform[ii]);if(constraint==null)throw new Error("Skin transform constraint not found: "+skinMap.transform[i]);skin.constraints.push(constraint)}}if(skinMap.path){for(var ii=0;ii<skinMap.path.length;ii++){var constraint=skeletonData.findPathConstraint(skinMap.path[ii]);if(constraint==null)throw new Error("Skin path constraint not found: "+skinMap.path[i]);skin.constraints.push(constraint)}}for(var slotName in skinMap.attachments){var slot=skeletonData.findSlot(slotName);if(slot==null)throw new Error("Slot not found: "+slotName);var slotMap=skinMap.attachments[slotName];for(var entryName in slotMap){var attachment=this.readAttachment(slotMap[entryName],skin,slot.index,entryName,skeletonData);if(attachment)skin.setAttachment(slot.index,entryName,attachment)}}skeletonData.skins.push(skin);if(skin.name=="default")skeletonData.defaultSkin=skin}}for(var i=0,n=this.linkedMeshes.length;i<n;i++){var linkedMesh=this.linkedMeshes[i];var skin=!linkedMesh.skin?skeletonData.defaultSkin:skeletonData.findSkin(linkedMesh.skin);var parent_2=skin.getAttachment(linkedMesh.slotIndex,linkedMesh.parent);linkedMesh.mesh.deformAttachment=linkedMesh.inheritDeform?parent_2:linkedMesh.mesh;linkedMesh.mesh.setParentMesh(parent_2)}this.linkedMeshes.length=0;if(root.events){for(var eventName in root.events){var eventMap=root.events[eventName];var data=new EventData(eventName);data.intValue=getValue(eventMap,"int",0);data.floatValue=getValue(eventMap,"float",0);data.stringValue=getValue(eventMap,"string","");data.audioPath=getValue(eventMap,"audio",null);if(data.audioPath){data.volume=getValue(eventMap,"volume",1);data.balance=getValue(eventMap,"balance",0)}skeletonData.events.push(data)}}if(root.animations){for(var animationName in root.animations){var animationMap=root.animations[animationName];this.readAnimation(animationMap,animationName,skeletonData)}}return skeletonData};SkeletonJson.prototype.readAttachment=function(map,skin,slotIndex,name,skeletonData){var scale=this.scale;name=getValue(map,"name",name);switch(getValue(map,"type","region")){case"region":{var path=getValue(map,"path",name);var region=this.attachmentLoader.newRegionAttachment(skin,name,path);if(!region)return null;region.path=path;region.x=getValue(map,"x",0)*scale;region.y=getValue(map,"y",0)*scale;region.scaleX=getValue(map,"scaleX",1);region.scaleY=getValue(map,"scaleY",1);region.rotation=getValue(map,"rotation",0);region.width=map.width*scale;region.height=map.height*scale;var color=getValue(map,"color",null);if(color)region.color.setFromString(color);return region}case"boundingbox":{var box=this.attachmentLoader.newBoundingBoxAttachment(skin,name);if(!box)return null;this.readVertices(map,box,map.vertexCount<<1);var color=getValue(map,"color",null);if(color)box.color.setFromString(color);return box}case"mesh":case"linkedmesh":{var path=getValue(map,"path",name);var mesh=this.attachmentLoader.newMeshAttachment(skin,name,path);if(!mesh)return null;mesh.path=path;var color=getValue(map,"color",null);if(color)mesh.color.setFromString(color);mesh.width=getValue(map,"width",0)*scale;mesh.height=getValue(map,"height",0)*scale;var parent_3=getValue(map,"parent",null);if(parent_3){this.linkedMeshes.push(new LinkedMesh(mesh,getValue(map,"skin",null),slotIndex,parent_3,getValue(map,"deform",true)));return mesh}var uvs=map.uvs;this.readVertices(map,mesh,uvs.length);mesh.triangles=map.triangles;mesh.regionUVs=new Float32Array(uvs);mesh.edges=getValue(map,"edges",null);mesh.hullLength=getValue(map,"hull",0)*2;return mesh}case"path":{var path=this.attachmentLoader.newPathAttachment(skin,name);if(!path)return null;path.closed=getValue(map,"closed",false);path.constantSpeed=getValue(map,"constantSpeed",true);var vertexCount=map.vertexCount;this.readVertices(map,path,vertexCount<<1);var lengths=Utils.newArray(vertexCount/3,0);for(var i=0;i<map.lengths.length;i++)lengths[i]=map.lengths[i]*scale;path.lengths=lengths;var color=getValue(map,"color",null);if(color)path.color.setFromString(color);return path}case"point":{var point=this.attachmentLoader.newPointAttachment(skin,name);if(!point)return null;point.x=getValue(map,"x",0)*scale;point.y=getValue(map,"y",0)*scale;point.rotation=getValue(map,"rotation",0);var color=getValue(map,"color",null);if(color)point.color.setFromString(color);return point}case"clipping":{var clip=this.attachmentLoader.newClippingAttachment(skin,name);if(!clip)return null;var end=getValue(map,"end",null);if(end!=null){var slot=skeletonData.findSlot(end);if(slot==null)throw new Error("Clipping end slot not found: "+end);clip.endSlot=slot}var vertexCount=map.vertexCount;this.readVertices(map,clip,vertexCount<<1);var color=getValue(map,"color",null);if(color)clip.color.setFromString(color);return clip}}return null};SkeletonJson.prototype.readVertices=function(map,attachment,verticesLength){var scale=this.scale;attachment.worldVerticesLength=verticesLength;var vertices=map.vertices;if(verticesLength==vertices.length){var scaledVertices=Utils.toFloatArray(vertices);if(scale!=1){for(var i=0,n=vertices.length;i<n;i++)scaledVertices[i]*=scale}attachment.vertices=scaledVertices;return}var weights=new Array;var bones=new Array;for(var i=0,n=vertices.length;i<n;){var boneCount=vertices[i++];bones.push(boneCount);for(var nn=i+boneCount*4;i<nn;i+=4){bones.push(vertices[i]);weights.push(vertices[i+1]*scale);weights.push(vertices[i+2]*scale);weights.push(vertices[i+3])}}attachment.bones=bones;attachment.vertices=Utils.toFloatArray(weights)};SkeletonJson.prototype.readAnimation=function(map,name,skeletonData){var scale=this.scale;var timelines=new Array;if(map.slots){for(var slotName in map.slots){var slotMap=map.slots[slotName];var slotIndex=skeletonData.findSlotIndex(slotName);if(slotIndex==-1)throw new Error("Slot not found: "+slotName);for(var timelineName in slotMap){var timelineMap=slotMap[timelineName];if(!timelineMap)continue;if(timelineName=="attachment"){var timeline=new AttachmentTimeline(timelineMap.length,slotIndex);for(var frame=0;frame<timelineMap.length;frame++){var keyMap=timelineMap[frame];timeline.setFrame(frame,getValue(keyMap,"time",0),keyMap.name)}timelines.push(timeline)}else if(timelineName=="rgba"){var timeline=new RGBATimeline(timelineMap.length,timelineMap.length<<2,slotIndex);var keyMap=timelineMap[0];var time=getValue(keyMap,"time",0);var color=Color.fromString(keyMap.color);for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,color.r,color.g,color.b,color.a);var nextMap=timelineMap[frame+1];if(!nextMap){timeline.shrink(bezier);break}var time2=getValue(nextMap,"time",0);var newColor=Color.fromString(nextMap.color);var curve=keyMap.curve;if(curve){bezier=readCurve(curve,timeline,bezier,frame,0,time,time2,color.r,newColor.r,1);bezier=readCurve(curve,timeline,bezier,frame,1,time,time2,color.g,newColor.g,1);bezier=readCurve(curve,timeline,bezier,frame,2,time,time2,color.b,newColor.b,1);bezier=readCurve(curve,timeline,bezier,frame,3,time,time2,color.a,newColor.a,1)}time=time2;color=newColor;keyMap=nextMap}timelines.push(timeline)}else if(timelineName=="rgb"){var timeline=new RGBTimeline(timelineMap.length,timelineMap.length*3,slotIndex);var keyMap=timelineMap[0];var time=getValue(keyMap,"time",0);var color=Color.fromString(keyMap.color);for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,color.r,color.g,color.b);var nextMap=timelineMap[frame+1];if(!nextMap){timeline.shrink(bezier);break}var time2=getValue(nextMap,"time",0);var newColor=Color.fromString(nextMap.color);var curve=keyMap.curve;if(curve){bezier=readCurve(curve,timeline,bezier,frame,0,time,time2,color.r,newColor.r,1);bezier=readCurve(curve,timeline,bezier,frame,1,time,time2,color.g,newColor.g,1);bezier=readCurve(curve,timeline,bezier,frame,2,time,time2,color.b,newColor.b,1)}time=time2;color=newColor;keyMap=nextMap}timelines.push(timeline)}else if(timelineName=="alpha"){timelines.push(readTimeline1(timelineMap,new AlphaTimeline(timelineMap.length,timelineMap.length,slotIndex),0,1))}else if(timelineName=="rgba2"){var timeline=new RGBA2Timeline(timelineMap.length,timelineMap.length*7,slotIndex);var keyMap=timelineMap[0];var time=getValue(keyMap,"time",0);var color=Color.fromString(keyMap.light);var color2=Color.fromString(keyMap.dark);for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,color.r,color.g,color.b,color.a,color2.r,color2.g,color2.b);var nextMap=timelineMap[frame+1];if(!nextMap){timeline.shrink(bezier);break}var time2=getValue(nextMap,"time",0);var newColor=Color.fromString(nextMap.light);var newColor2=Color.fromString(nextMap.dark);var curve=keyMap.curve;if(curve){bezier=readCurve(curve,timeline,bezier,frame,0,time,time2,color.r,newColor.r,1);bezier=readCurve(curve,timeline,bezier,frame,1,time,time2,color.g,newColor.g,1);bezier=readCurve(curve,timeline,bezier,frame,2,time,time2,color.b,newColor.b,1);bezier=readCurve(curve,timeline,bezier,frame,3,time,time2,color.a,newColor.a,1);bezier=readCurve(curve,timeline,bezier,frame,4,time,time2,color2.r,newColor2.r,1);bezier=readCurve(curve,timeline,bezier,frame,5,time,time2,color2.g,newColor2.g,1);bezier=readCurve(curve,timeline,bezier,frame,6,time,time2,color2.b,newColor2.b,1)}time=time2;color=newColor;color2=newColor2;keyMap=nextMap}timelines.push(timeline)}else if(timelineName=="rgb2"){var timeline=new RGB2Timeline(timelineMap.length,timelineMap.length*6,slotIndex);var keyMap=timelineMap[0];var time=getValue(keyMap,"time",0);var color=Color.fromString(keyMap.light);var color2=Color.fromString(keyMap.dark);for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,color.r,color.g,color.b,color2.r,color2.g,color2.b);var nextMap=timelineMap[frame+1];if(!nextMap){timeline.shrink(bezier);break}var time2=getValue(nextMap,"time",0);var newColor=Color.fromString(nextMap.light);var newColor2=Color.fromString(nextMap.dark);var curve=keyMap.curve;if(curve){bezier=readCurve(curve,timeline,bezier,frame,0,time,time2,color.r,newColor.r,1);bezier=readCurve(curve,timeline,bezier,frame,1,time,time2,color.g,newColor.g,1);bezier=readCurve(curve,timeline,bezier,frame,2,time,time2,color.b,newColor.b,1);bezier=readCurve(curve,timeline,bezier,frame,3,time,time2,color2.r,newColor2.r,1);bezier=readCurve(curve,timeline,bezier,frame,4,time,time2,color2.g,newColor2.g,1);bezier=readCurve(curve,timeline,bezier,frame,5,time,time2,color2.b,newColor2.b,1)}time=time2;color=newColor;color2=newColor2;keyMap=nextMap}timelines.push(timeline)}else throw new Error("Invalid timeline type for a slot: "+timelineName+" ("+slotName+")")}}}if(map.bones){for(var boneName in map.bones){var boneMap=map.bones[boneName];var boneIndex=skeletonData.findBoneIndex(boneName);if(boneIndex==-1)throw new Error("Bone not found: "+boneName);for(var timelineName in boneMap){var timelineMap=boneMap[timelineName];if(timelineMap.length==0)continue;if(timelineName==="rotate"){timelines.push(readTimeline1(timelineMap,new RotateTimeline(timelineMap.length,timelineMap.length,boneIndex),0,1))}else if(timelineName==="translate"){var timeline=new TranslateTimeline(timelineMap.length,timelineMap.length<<1,boneIndex);timelines.push(readTimeline2(timelineMap,timeline,"x","y",0,scale))}else if(timelineName==="translatex"){var timeline=new TranslateXTimeline(timelineMap.length,timelineMap.length,boneIndex);timelines.push(readTimeline1(timelineMap,timeline,0,scale))}else if(timelineName==="translatey"){var timeline=new TranslateYTimeline(timelineMap.length,timelineMap.length,boneIndex);timelines.push(readTimeline1(timelineMap,timeline,0,scale))}else if(timelineName==="scale"){var timeline=new ScaleTimeline(timelineMap.length,timelineMap.length<<1,boneIndex);timelines.push(readTimeline2(timelineMap,timeline,"x","y",1,1))}else if(timelineName==="scalex"){var timeline=new ScaleXTimeline(timelineMap.length,timelineMap.length,boneIndex);timelines.push(readTimeline1(timelineMap,timeline,1,1))}else if(timelineName==="scaley"){var timeline=new ScaleYTimeline(timelineMap.length,timelineMap.length,boneIndex);timelines.push(readTimeline1(timelineMap,timeline,1,1))}else if(timelineName==="shear"){var timeline=new ShearTimeline(timelineMap.length,timelineMap.length<<1,boneIndex);timelines.push(readTimeline2(timelineMap,timeline,"x","y",0,1))}else if(timelineName==="shearx"){var timeline=new ShearXTimeline(timelineMap.length,timelineMap.length,boneIndex);timelines.push(readTimeline1(timelineMap,timeline,0,1))}else if(timelineName==="sheary"){var timeline=new ShearYTimeline(timelineMap.length,timelineMap.length,boneIndex);timelines.push(readTimeline1(timelineMap,timeline,0,1))}}}}if(map.ik){for(var constraintName in map.ik){var constraintMap=map.ik[constraintName];var keyMap=constraintMap[0];if(!keyMap)continue;var constraint=skeletonData.findIkConstraint(constraintName);var constraintIndex=skeletonData.ikConstraints.indexOf(constraint);var timeline=new IkConstraintTimeline(constraintMap.length,constraintMap.length<<1,constraintIndex);var time=getValue(keyMap,"time",0);var mix=getValue(keyMap,"mix",1);var softness=getValue(keyMap,"softness",0)*scale;for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,mix,softness,getValue(keyMap,"bendPositive",true)?1:-1,getValue(keyMap,"compress",false),getValue(keyMap,"stretch",false));var nextMap=constraintMap[frame+1];if(!nextMap){timeline.shrink(bezier);break}var time2=getValue(nextMap,"time",0);var mix2=getValue(nextMap,"mix",1);var softness2=getValue(nextMap,"softness",0)*scale;var curve=keyMap.curve;if(curve){bezier=readCurve(curve,timeline,bezier,frame,0,time,time2,mix,mix2,1);bezier=readCurve(curve,timeline,bezier,frame,1,time,time2,softness,softness2,scale)}time=time2;mix=mix2;softness=softness2;keyMap=nextMap}timelines.push(timeline)}}if(map.transform){for(var constraintName in map.transform){var timelineMap=map.transform[constraintName];var keyMap=timelineMap[0];if(!keyMap)continue;var constraint=skeletonData.findTransformConstraint(constraintName);var constraintIndex=skeletonData.transformConstraints.indexOf(constraint);var timeline=new TransformConstraintTimeline(timelineMap.length,timelineMap.length<<2,constraintIndex);var time=getValue(keyMap,"time",0);var mixRotate=getValue(keyMap,"mixRotate",1);var mixX=getValue(keyMap,"mixX",1);var mixY=getValue(keyMap,"mixY",mixX);var mixScaleX=getValue(keyMap,"mixScaleX",1);var mixScaleY=getValue(keyMap,"mixScaleY",mixScaleX);var mixShearY=getValue(keyMap,"mixShearY",1);for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,mixRotate,mixX,mixY,mixScaleX,mixScaleY,mixShearY);var nextMap=timelineMap[frame+1];if(!nextMap){timeline.shrink(bezier);break}var time2=getValue(nextMap,"time",0);var mixRotate2=getValue(nextMap,"mixRotate",1);var mixX2=getValue(nextMap,"mixX",1);var mixY2=getValue(nextMap,"mixY",mixX2);var mixScaleX2=getValue(nextMap,"mixScaleX",1);var mixScaleY2=getValue(nextMap,"mixScaleY",mixScaleX2);var mixShearY2=getValue(nextMap,"mixShearY",1);var curve=keyMap.curve;if(curve){bezier=readCurve(curve,timeline,bezier,frame,0,time,time2,mixRotate,mixRotate2,1);bezier=readCurve(curve,timeline,bezier,frame,1,time,time2,mixX,mixX2,1);bezier=readCurve(curve,timeline,bezier,frame,2,time,time2,mixY,mixY2,1);bezier=readCurve(curve,timeline,bezier,frame,3,time,time2,mixScaleX,mixScaleX2,1);bezier=readCurve(curve,timeline,bezier,frame,4,time,time2,mixScaleY,mixScaleY2,1);bezier=readCurve(curve,timeline,bezier,frame,5,time,time2,mixShearY,mixShearY2,1)}time=time2;mixRotate=mixRotate2;mixX=mixX2;mixY=mixY2;mixScaleX=mixScaleX2;mixScaleY=mixScaleY2;mixScaleX=mixScaleX2;keyMap=nextMap}timelines.push(timeline)}}if(map.path){for(var constraintName in map.path){var constraintMap=map.path[constraintName];var constraintIndex=skeletonData.findPathConstraintIndex(constraintName);if(constraintIndex==-1)throw new Error("Path constraint not found: "+constraintName);var constraint=skeletonData.pathConstraints[constraintIndex];for(var timelineName in constraintMap){var timelineMap=constraintMap[timelineName];var keyMap=timelineMap[0];if(!keyMap)continue;if(timelineName==="position"){var timeline=new PathConstraintPositionTimeline(timelineMap.length,timelineMap.length,constraintIndex);timelines.push(readTimeline1(timelineMap,timeline,0,constraint.positionMode==PositionMode.Fixed?scale:1))}else if(timelineName==="spacing"){var timeline=new PathConstraintSpacingTimeline(timelineMap.length,timelineMap.length,constraintIndex);timelines.push(readTimeline1(timelineMap,timeline,0,constraint.spacingMode==SpacingMode.Length||constraint.spacingMode==SpacingMode.Fixed?scale:1))}else if(timelineName==="mix"){var timeline=new PathConstraintMixTimeline(timelineMap.size,timelineMap.size*3,constraintIndex);var time=getValue(keyMap,"time",0);var mixRotate=getValue(keyMap,"mixRotate",1);var mixX=getValue(keyMap,"mixX",1);var mixY=getValue(keyMap,"mixY",mixX);for(var frame=0,bezier=0;;frame++){timeline.setFrame(frame,time,mixRotate,mixX,mixY);var nextMap=timelineMap[frame+1];if(!nextMap){timeline.shrink(bezier);break}var time2=getValue(nextMap,"time",0);var mixRotate2=getValue(nextMap,"mixRotate",1);var mixX2=getValue(nextMap,"mixX",1);var mixY2=getValue(nextMap,"mixY",mixX2);var curve=keyMap.curve;if(curve){bezier=readCurve(curve,timeline,bezier,frame,0,time,time2,mixRotate,mixRotate2,1);bezier=readCurve(curve,timeline,bezier,frame,1,time,time2,mixX,mixX2,1);bezier=readCurve(curve,timeline,bezier,frame,2,time,time2,mixY,mixY2,1)}time=time2;mixRotate=mixRotate2;mixX=mixX2;mixY=mixY2;keyMap=nextMap}timelines.push(timeline)}}}}if(map.deform){for(var deformName in map.deform){var deformMap=map.deform[deformName];var skin=skeletonData.findSkin(deformName);if(skin==null){if(settings.FAIL_ON_NON_EXISTING_SKIN){throw new Error("Skin not found: "+deformName)}else{continue}}for(var slotName in deformMap){var slotMap=deformMap[slotName];var slotIndex=skeletonData.findSlotIndex(slotName);if(slotIndex==-1)throw new Error("Slot not found: "+slotMap.name);for(var timelineName in slotMap){var timelineMap=slotMap[timelineName];var keyMap=timelineMap[0];if(!keyMap)continue;var attachment=skin.getAttachment(slotIndex,timelineName);if(attachment==null)throw new Error("Deform attachment not found: "+timelineMap.name);var weighted=attachment.bones!=null;var vertices=attachment.vertices;var deformLength=weighted?vertices.length/3*2:vertices.length;var timeline=new DeformTimeline(timelineMap.length,timelineMap.length,slotIndex,attachment);var time=getValue(keyMap,"time",0);for(var frame=0,bezier=0;;frame++){var deform=void 0;var verticesValue=getValue(keyMap,"vertices",null);if(!verticesValue)deform=weighted?Utils.newFloatArray(deformLength):vertices;else{deform=Utils.newFloatArray(deformLength);var start=getValue(keyMap,"offset",0);Utils.arrayCopy(verticesValue,0,deform,start,verticesValue.length);if(scale!=1){for(var i=start,n=i+verticesValue.length;i<n;i++)deform[i]*=scale}if(!weighted){for(var i=0;i<deformLength;i++)deform[i]+=vertices[i]}}timeline.setFrame(frame,time,deform);var nextMap=timelineMap[frame+1];if(!nextMap){timeline.shrink(bezier);break}var time2=getValue(nextMap,"time",0);var curve=keyMap.curve;if(curve)bezier=readCurve(curve,timeline,bezier,frame,0,time,time2,0,1,1);time=time2;keyMap=nextMap}timelines.push(timeline)}}}}if(map.drawOrder){var timeline=new DrawOrderTimeline(map.drawOrder.length);var slotCount=skeletonData.slots.length;var frame=0;for(var i=0;i<map.drawOrder.length;i++,frame++){var drawOrderMap=map.drawOrder[i];var drawOrder=null;var offsets=getValue(drawOrderMap,"offsets",null);if(offsets){drawOrder=Utils.newArray(slotCount,-1);var unchanged=Utils.newArray(slotCount-offsets.length,0);var originalIndex=0,unchangedIndex=0;for(var ii=0;ii<offsets.length;ii++){var offsetMap=offsets[ii];var slotIndex=skeletonData.findSlotIndex(offsetMap.slot);while(originalIndex!=slotIndex)unchanged[unchangedIndex++]=originalIndex++;drawOrder[originalIndex+offsetMap.offset]=originalIndex++}while(originalIndex<slotCount)unchanged[unchangedIndex++]=originalIndex++;for(var ii=slotCount-1;ii>=0;ii--)if(drawOrder[ii]==-1)drawOrder[ii]=unchanged[--unchangedIndex]}timeline.setFrame(frame,getValue(drawOrderMap,"time",0),drawOrder)}timelines.push(timeline)}if(map.events){var timeline=new EventTimeline(map.events.length);var frame=0;for(var i=0;i<map.events.length;i++,frame++){var eventMap=map.events[i];var eventData=skeletonData.findEvent(eventMap.name);var event_1=new Event(Utils.toSinglePrecision(getValue(eventMap,"time",0)),eventData);event_1.intValue=getValue(eventMap,"int",eventData.intValue);event_1.floatValue=getValue(eventMap,"float",eventData.floatValue);event_1.stringValue=getValue(eventMap,"string",eventData.stringValue);if(event_1.data.audioPath){event_1.volume=getValue(eventMap,"volume",1);event_1.balance=getValue(eventMap,"balance",0)}timeline.setFrame(frame,event_1)}timelines.push(timeline)}var duration=0;for(var i=0,n=timelines.length;i<n;i++)duration=Math.max(duration,timelines[i].getDuration());if(isNaN(duration)){throw new Error("Error while parsing animation, duration is NaN")}skeletonData.animations.push(new Animation(name,timelines,duration))};SkeletonJson.blendModeFromString=function(str){str=str.toLowerCase();if(str=="normal")return constants.BLEND_MODES.NORMAL;if(str=="additive")return constants.BLEND_MODES.ADD;if(str=="multiply")return constants.BLEND_MODES.MULTIPLY;if(str=="screen")return constants.BLEND_MODES.SCREEN;throw new Error("Unknown blend mode: "+str)};return SkeletonJson}();var LinkedMesh=function(){function LinkedMesh(mesh,skin,slotIndex,parent,inheritDeform){this.mesh=mesh;this.skin=skin;this.slotIndex=slotIndex;this.parent=parent;this.inheritDeform=inheritDeform}return LinkedMesh}();function readTimeline1(keys,timeline,defaultValue,scale){var keyMap=keys[0];var time=getValue(keyMap,"time",0);var value=getValue(keyMap,"value",defaultValue)*scale;var bezier=0;for(var frame=0;;frame++){timeline.setFrame(frame,time,value);var nextMap=keys[frame+1];if(!nextMap){timeline.shrink(bezier);return timeline}var time2=getValue(nextMap,"time",0);var value2=getValue(nextMap,"value",defaultValue)*scale;if(keyMap.curve)bezier=readCurve(keyMap.curve,timeline,bezier,frame,0,time,time2,value,value2,scale);time=time2;value=value2;keyMap=nextMap}}function readTimeline2(keys,timeline,name1,name2,defaultValue,scale){var keyMap=keys[0];var time=getValue(keyMap,"time",0);var value1=getValue(keyMap,name1,defaultValue)*scale;var value2=getValue(keyMap,name2,defaultValue)*scale;var bezier=0;for(var frame=0;;frame++){timeline.setFrame(frame,time,value1,value2);var nextMap=keys[frame+1];if(!nextMap){timeline.shrink(bezier);return timeline}var time2=getValue(nextMap,"time",0);var nvalue1=getValue(nextMap,name1,defaultValue)*scale;var nvalue2=getValue(nextMap,name2,defaultValue)*scale;var curve=keyMap.curve;if(curve){bezier=readCurve(curve,timeline,bezier,frame,0,time,time2,value1,nvalue1,scale);bezier=readCurve(curve,timeline,bezier,frame,1,time,time2,value2,nvalue2,scale)}time=time2;value1=nvalue1;value2=nvalue2;keyMap=nextMap}}function readCurve(curve,timeline,bezier,frame,value,time1,time2,value1,value2,scale){if(curve=="stepped"){timeline.setStepped(frame);return bezier}var i=value<<2;var cx1=curve[i];var cy1=curve[i+1]*scale;var cx2=curve[i+2];var cy2=curve[i+3]*scale;timeline.setBezier(bezier,frame,value,time1,value1,cx1,cy1,cx2,cy2,time2,value2);return bezier+1}function getValue(map,property,defaultValue){return map[property]!==undefined?map[property]:defaultValue}var Spine$1=function(_super){__extends$1(Spine,_super);function Spine(){return _super!==null&&_super.apply(this,arguments)||this}Spine.prototype.createSkeleton=function(spineData){this.skeleton=new Skeleton(spineData);this.skeleton.updateWorldTransform();this.stateData=new AnimationStateData(spineData);this.state=new AnimationState(this.stateData)};return Spine}(SpineBase);var spine40=Object.freeze({__proto__:null,AlphaTimeline:AlphaTimeline,Animation:Animation,AnimationState:AnimationState,AnimationStateAdapter:AnimationStateAdapter,AnimationStateData:AnimationStateData,AtlasAttachmentLoader:AtlasAttachmentLoader,Attachment:Attachment,AttachmentTimeline:AttachmentTimeline,Bone:Bone,BoneData:BoneData,BoundingBoxAttachment:BoundingBoxAttachment,ClippingAttachment:ClippingAttachment,ConstraintData:ConstraintData,CurveTimeline:CurveTimeline,CurveTimeline1:CurveTimeline1,CurveTimeline2:CurveTimeline2,DeformTimeline:DeformTimeline,DrawOrderTimeline:DrawOrderTimeline,Event:Event,EventData:EventData,EventQueue:EventQueue,EventTimeline:EventTimeline,get EventType(){return EventType},IkConstraint:IkConstraint,IkConstraintData:IkConstraintData,IkConstraintTimeline:IkConstraintTimeline,JitterEffect:JitterEffect,MeshAttachment:MeshAttachment,get MixBlend(){return MixBlend},get MixDirection(){return MixDirection},PathAttachment:PathAttachment,PathConstraint:PathConstraint,PathConstraintData:PathConstraintData,PathConstraintMixTimeline:PathConstraintMixTimeline,PathConstraintPositionTimeline:PathConstraintPositionTimeline,PathConstraintSpacingTimeline:PathConstraintSpacingTimeline,PointAttachment:PointAttachment,get PositionMode(){return PositionMode},RGB2Timeline:RGB2Timeline,RGBA2Timeline:RGBA2Timeline,RGBATimeline:RGBATimeline,RGBTimeline:RGBTimeline,RegionAttachment:RegionAttachment,get RotateMode(){return RotateMode},RotateTimeline:RotateTimeline,ScaleTimeline:ScaleTimeline,ScaleXTimeline:ScaleXTimeline,ScaleYTimeline:ScaleYTimeline,ShearTimeline:ShearTimeline,ShearXTimeline:ShearXTimeline,ShearYTimeline:ShearYTimeline,Skeleton:Skeleton,SkeletonBinary:SkeletonBinary,SkeletonBounds:SkeletonBounds,SkeletonData:SkeletonData,SkeletonJson:SkeletonJson,Skin:Skin,SkinEntry:SkinEntry,Slot:Slot,SlotData:SlotData,get SpacingMode(){return SpacingMode},Spine:Spine$1,SwirlEffect:SwirlEffect,Timeline:Timeline,TrackEntry:TrackEntry,TransformConstraint:TransformConstraint,TransformConstraintData:TransformConstraintData,TransformConstraintTimeline:TransformConstraintTimeline,get TransformMode(){return TransformMode},TranslateTimeline:TranslateTimeline,TranslateXTimeline:TranslateXTimeline,TranslateYTimeline:TranslateYTimeline,VertexAttachment:VertexAttachment});var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};function __extends(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var SPINE_VERSION;(function(SPINE_VERSION){SPINE_VERSION[SPINE_VERSION["UNKNOWN"]=0]="UNKNOWN";SPINE_VERSION[SPINE_VERSION["VER37"]=37]="VER37";SPINE_VERSION[SPINE_VERSION["VER38"]=38]="VER38";SPINE_VERSION[SPINE_VERSION["VER40"]=40]="VER40"})(SPINE_VERSION||(SPINE_VERSION={}));function detectSpineVersion(version){var ver3=version.substr(0,3);var verNum=Math.floor(+ver3*10+.001);if(ver3==="3.7"){return SPINE_VERSION.VER37}if(ver3==="3.8"){return SPINE_VERSION.VER38}if(ver3==="4.0"){return SPINE_VERSION.VER40}if(verNum<SPINE_VERSION.VER37){return SPINE_VERSION.VER37}return SPINE_VERSION.UNKNOWN}var UniBinaryParser=function(){function UniBinaryParser(){this.scale=1}UniBinaryParser.prototype.readSkeletonData=function(atlas,dataToParse){var input=new BinaryInput(dataToParse);input.readString();var version=input.readString();var ver=detectSpineVersion(version);var parser=null;if(ver===SPINE_VERSION.VER38){parser=new SkeletonBinary$1(new AtlasAttachmentLoader$2(atlas))}input=new BinaryInput(dataToParse);input.readInt32();input.readInt32();version=input.readString();ver=detectSpineVersion(version);if(ver===SPINE_VERSION.VER40){parser=new SkeletonBinary(new AtlasAttachmentLoader(atlas))}if(!parser){var error="Unsupported version of spine model "+version+", please update pixi-spine";console.error(error)}parser.scale=this.scale;return parser.readSkeletonData(dataToParse)};return UniBinaryParser}();var UniJsonParser=function(){function UniJsonParser(){this.scale=1}UniJsonParser.prototype.readSkeletonData=function(atlas,dataToParse){var version=dataToParse.skeleton.spine;var ver=detectSpineVersion(version);var parser=null;if(ver===SPINE_VERSION.VER37){parser=new SkeletonJson$1(new AtlasAttachmentLoader$1(atlas))}if(ver===SPINE_VERSION.VER38){parser=new SkeletonJson$2(new AtlasAttachmentLoader$2(atlas))}if(ver===SPINE_VERSION.VER40){parser=new SkeletonJson(new AtlasAttachmentLoader(atlas))}if(!parser){var error="Unsupported version of spine model "+version+", please update pixi-spine";console.error(error)}parser.scale=this.scale;return parser.readSkeletonData(dataToParse)};return UniJsonParser}();var SpineParser=function(_super){__extends(SpineParser,_super);function SpineParser(){return _super!==null&&_super.apply(this,arguments)||this}SpineParser.prototype.createBinaryParser=function(){return new UniBinaryParser};SpineParser.prototype.createJsonParser=function(){return new UniJsonParser};SpineParser.prototype.parseData=function(resource,parser,atlas,dataToParse){var parserCast=parser;resource.spineData=parserCast.readSkeletonData(atlas,dataToParse);resource.spineAtlas=atlas};SpineParser.registerLoaderPlugin=function(){loaders.Loader.registerPlugin(SpineParser)};SpineParser.use=(new SpineParser).genMiddleware().use;return SpineParser}(AbstractSpineParser);var Spine=function(_super){__extends(Spine,_super);function Spine(){return _super!==null&&_super.apply(this,arguments)||this}Spine.prototype.createSkeleton=function(spineData){var ver=detectSpineVersion(spineData.version);var spine=null;if(ver===SPINE_VERSION.VER37){spine=spine37}if(ver===SPINE_VERSION.VER38){spine=spine38}if(ver===SPINE_VERSION.VER40){spine=spine40}if(!spine){var error="Cant detect version of spine model "+spineData.version;console.error(error)}this.skeleton=new spine.Skeleton(spineData);this.skeleton.updateWorldTransform();this.stateData=new spine.AnimationStateData(spineData);this.state=new spine.AnimationState(this.stateData)};return Spine}(SpineBase);SpineParser.registerLoaderPlugin();exports.BinaryInput=BinaryInput;exports.Color=Color;exports.DebugUtils=DebugUtils;exports.IntSet=IntSet;exports.Interpolation=Interpolation;exports.MathUtils=MathUtils;exports.Pool=Pool;exports.Pow=Pow;exports.PowOut=PowOut;exports.SkeletonBounds=SkeletonBounds;exports.Spine=Spine;exports.SpineBase=SpineBase;exports.SpineMesh=SpineMesh;exports.SpineParser=SpineParser;exports.SpineSprite=SpineSprite;exports.StringSet=StringSet;exports.TextureAtlas=TextureAtlas;exports.TextureAtlasPage=TextureAtlasPage;exports.TextureAtlasRegion=TextureAtlasRegion;exports.TextureRegion=TextureRegion;exports.TimeKeeper=TimeKeeper;exports.Utils=Utils;exports.Vector2=Vector2;exports.WindowedMean=WindowedMean;exports.filterFromString=filterFromString;exports.settings=settings;exports.wrapFromString=wrapFromString;Object.defineProperty(exports,"__esModule",{value:true})});if(typeof pixi_spine!=="undefined"){Object.assign(this.PIXI.spine,pixi_spine)}var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,r,p){if(p.get||p.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[r]=p.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(e){var r=0;return $jscomp.iteratorPrototype(function(){return r<e.length?{done:!1,value:e[r++]}:{done:!0}})};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(e,r){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var p=0,m={next:function(){if(p<e.length){var u=p++;return{value:r(u,e[u]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};$jscomp.polyfill=function(e,r,p,m){if(r){p=$jscomp.global;e=e.split(".");for(m=0;m<e.length-1;m++){var u=e[m];u in p||(p[u]={});p=p[u]}e=e[e.length-1];m=p[e];r=r(m);r!=m&&null!=r&&$jscomp.defineProperty(p,e,{configurable:!0,writable:!0,value:r})}};$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6-impl","es3");var $jscomp$this=this;(function(e,r){"function"===typeof define&&define.amd?define([],r):"object"===typeof module&&module.exports?module.exports=r():e.anime=r()})(this,function(){function e(a){if(!h.col(a))try{return document.querySelectorAll(a)}catch(c){}}function r(a,c){for(var d=a.length,b=2<=arguments.length?arguments[1]:void 0,f=[],n=0;n<d;n++)if(n in a){var k=a[n];c.call(b,k,n,a)&&f.push(k)}return f}function p(a){return a.reduce(function(a,d){return a.concat(h.arr(d)?p(d):d)},[])}function m(a){if(h.arr(a))return a;h.str(a)&&(a=e(a)||a);return a instanceof NodeList||a instanceof HTMLCollection?[].slice.call(a):[a]}function u(a,c){return a.some(function(a){return a===c})}function C(a){var c={},d;for(d in a)c[d]=a[d];return c}function D(a,c){var d=C(a),b;for(b in a)d[b]=c.hasOwnProperty(b)?c[b]:a[b];return d}function z(a,c){var d=C(a),b;for(b in c)d[b]=h.und(a[b])?c[b]:a[b];return d}function T(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,c,d,k){return c+c+d+d+k+k});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);a=parseInt(c[1],16);var d=parseInt(c[2],16),c=parseInt(c[3],16);return"rgba("+a+","+d+","+c+",1)"}function U(a){function c(a,c,b){0>b&&(b+=1);1<b&&--b;return b<1/6?a+6*(c-a)*b:.5>b?c:b<2/3?a+(c-a)*(2/3-b)*6:a}var d=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(a)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(a);a=parseInt(d[1])/360;var b=parseInt(d[2])/100,f=parseInt(d[3])/100,d=d[4]||1;if(0==b)f=b=a=f;else{var n=.5>f?f*(1+b):f+b-f*b,k=2*f-n,f=c(k,n,a+1/3),b=c(k,n,a);a=c(k,n,a-1/3)}return"rgba("+255*f+","+255*b+","+255*a+","+d+")"}function y(a){if(a=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(a))return a[2]}function V(a){if(-1<a.indexOf("translate")||"perspective"===a)return"px";if(-1<a.indexOf("rotate")||-1<a.indexOf("skew"))return"deg"}function I(a,c){return h.fnc(a)?a(c.target,c.id,c.total):a}function E(a,c){if(c in a.style)return getComputedStyle(a).getPropertyValue(c.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase())||"0"}function J(a,c){if(h.dom(a)&&u(W,c))return"transform";if(h.dom(a)&&(a.getAttribute(c)||h.svg(a)&&a[c]))return"attribute";if(h.dom(a)&&"transform"!==c&&E(a,c))return"css";if(null!=a[c])return"object"}function X(a,c){var d=V(c),d=-1<c.indexOf("scale")?1:0+d;a=a.style.transform;if(!a)return d;for(var b=[],f=[],n=[],k=/(\w+)\((.+?)\)/g;b=k.exec(a);)f.push(b[1]),n.push(b[2]);a=r(n,function(a,b){return f[b]===c});return a.length?a[0]:d}function K(a,c){switch(J(a,c)){case"transform":return X(a,c);case"css":return E(a,c);case"attribute":return a.getAttribute(c)}return a[c]||0}function L(a,c){var d=/^(\*=|\+=|-=)/.exec(a);if(!d)return a;var b=y(a)||0;c=parseFloat(c);a=parseFloat(a.replace(d[0],""));switch(d[0][0]){case"+":return c+a+b;case"-":return c-a+b;case"*":return c*a+b}}function F(a,c){return Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2))}function M(a){a=a.points;for(var c=0,d,b=0;b<a.numberOfItems;b++){var f=a.getItem(b);0<b&&(c+=F(d,f));d=f}return c}function N(a){if(a.getTotalLength)return a.getTotalLength();switch(a.tagName.toLowerCase()){case"circle":return 2*Math.PI*a.getAttribute("r");case"rect":return 2*a.getAttribute("width")+2*a.getAttribute("height");case"line":return F({x:a.getAttribute("x1"),y:a.getAttribute("y1")},{x:a.getAttribute("x2"),y:a.getAttribute("y2")});case"polyline":return M(a);case"polygon":var c=a.points;return M(a)+F(c.getItem(c.numberOfItems-1),c.getItem(0))}}function Y(a,c){function d(b){b=void 0===b?0:b;return a.el.getPointAtLength(1<=c+b?c+b:0)}var b=d(),f=d(-1),n=d(1);switch(a.property){case"x":return b.x;case"y":return b.y;case"angle":return 180*Math.atan2(n.y-f.y,n.x-f.x)/Math.PI}}function O(a,c){var d=/-?\d*\.?\d+/g,b;b=h.pth(a)?a.totalLength:a;if(h.col(b))if(h.rgb(b)){var f=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(b);b=f?"rgba("+f[1]+",1)":b}else b=h.hex(b)?T(b):h.hsl(b)?U(b):void 0;else f=(f=y(b))?b.substr(0,b.length-f.length):b,b=c&&!/\s/g.test(b)?f+c:f;b+="";return{original:b,numbers:b.match(d)?b.match(d).map(Number):[0],strings:h.str(a)||c?b.split(d):[]}}function P(a){a=a?p(h.arr(a)?a.map(m):m(a)):[];return r(a,function(a,d,b){return b.indexOf(a)===d})}function Z(a){var c=P(a);return c.map(function(a,b){return{target:a,id:b,total:c.length}})}function aa(a,c){var d=C(c);if(h.arr(a)){var b=a.length;2!==b||h.obj(a[0])?h.fnc(c.duration)||(d.duration=c.duration/b):a={value:a}}return m(a).map(function(a,b){b=b?0:c.delay;a=h.obj(a)&&!h.pth(a)?a:{value:a};h.und(a.delay)&&(a.delay=b);return a}).map(function(a){return z(a,d)})}function ba(a,c){var d={},b;for(b in a){var f=I(a[b],c);h.arr(f)&&(f=f.map(function(a){return I(a,c)}),1===f.length&&(f=f[0]));d[b]=f}d.duration=parseFloat(d.duration);d.delay=parseFloat(d.delay);return d}function ca(a){return h.arr(a)?A.apply(this,a):Q[a]}function da(a,c){var d;return a.tweens.map(function(b){b=ba(b,c);var f=b.value,e=K(c.target,a.name),k=d?d.to.original:e,k=h.arr(f)?f[0]:k,w=L(h.arr(f)?f[1]:f,k),e=y(w)||y(k)||y(e);b.from=O(k,e);b.to=O(w,e);b.start=d?d.end:a.offset;b.end=b.start+b.delay+b.duration;b.easing=ca(b.easing);b.elasticity=(1e3-Math.min(Math.max(b.elasticity,1),999))/1e3;b.isPath=h.pth(f);b.isColor=h.col(b.from.original);b.isColor&&(b.round=1);return d=b})}function ea(a,c){return r(p(a.map(function(a){return c.map(function(b){var c=J(a.target,b.name);if(c){var d=da(b,a);b={type:c,property:b.name,animatable:a,tweens:d,duration:d[d.length-1].end,delay:d[0].delay}}else b=void 0;return b})})),function(a){return!h.und(a)})}function R(a,c,d,b){var f="delay"===a;return c.length?(f?Math.min:Math.max).apply(Math,c.map(function(b){return b[a]})):f?b.delay:d.offset+b.delay+b.duration}function fa(a){var c=D(ga,a),d=D(S,a),b=Z(a.targets),f=[],e=z(c,d),k;for(k in a)e.hasOwnProperty(k)||"targets"===k||f.push({name:k,offset:e.offset,tweens:aa(a[k],d)});a=ea(b,f);return z(c,{children:[],animatables:b,animations:a,duration:R("duration",a,c,d),delay:R("delay",a,c,d)})}function q(a){function c(){return window.Promise&&new Promise(function(a){return p=a})}function d(a){return g.reversed?g.duration-a:a}function b(a){for(var b=0,c={},d=g.animations,f=d.length;b<f;){var e=d[b],k=e.animatable,h=e.tweens,n=h.length-1,l=h[n];n&&(l=r(h,function(b){return a<b.end})[0]||l);for(var h=Math.min(Math.max(a-l.start-l.delay,0),l.duration)/l.duration,w=isNaN(h)?1:l.easing(h,l.elasticity),h=l.to.strings,p=l.round,n=[],m=void 0,m=l.to.numbers.length,t=0;t<m;t++){var x=void 0,x=l.to.numbers[t],q=l.from.numbers[t],x=l.isPath?Y(l.value,w*x):q+w*(x-q);p&&(l.isColor&&2<t||(x=Math.round(x*p)/p));n.push(x)}if(l=h.length)for(m=h[0],w=0;w<l;w++)p=h[w+1],t=n[w],isNaN(t)||(m=p?m+(t+p):m+(t+" "));else m=n[0];ha[e.type](k.target,e.property,m,c,k.id);e.currentValue=m;b++}if(b=Object.keys(c).length)for(d=0;d<b;d++)H||(H=E(document.body,"transform")?"transform":"-webkit-transform"),g.animatables[d].target.style[H]=c[d].join(" ");g.currentTime=a;g.progress=a/g.duration*100}function f(a){if(g[a])g[a](g)}function e(){g.remaining&&!0!==g.remaining&&g.remaining--}function k(a){var k=g.duration,n=g.offset,w=n+g.delay,r=g.currentTime,x=g.reversed,q=d(a);if(g.children.length){var u=g.children,v=u.length;if(q>=g.currentTime)for(var G=0;G<v;G++)u[G].seek(q);else for(;v--;)u[v].seek(q)}if(q>=w||!k)g.began||(g.began=!0,f("begin")),f("run");if(q>n&&q<k)b(q);else if(q<=n&&0!==r&&(b(0),x&&e()),q>=k&&r!==k||!k)b(k),x||e();f("update");a>=k&&(g.remaining?(t=h,"alternate"===g.direction&&(g.reversed=!g.reversed)):(g.pause(),g.completed||(g.completed=!0,f("complete"),"Promise"in window&&(p(),m=c()))),l=0)}a=void 0===a?{}:a;var h,t,l=0,p=null,m=c(),g=fa(a);g.reset=function(){var a=g.direction,c=g.loop;g.currentTime=0;g.progress=0;g.paused=!0;g.began=!1;g.completed=!1;g.reversed="reverse"===a;g.remaining="alternate"===a&&1===c?2:c;b(0);for(a=g.children.length;a--;)g.children[a].reset()};g.tick=function(a){h=a;t||(t=h);k((l+h-t)*q.speed)};g.seek=function(a){k(d(a))};g.pause=function(){var a=v.indexOf(g);-1<a&&v.splice(a,1);g.paused=!0};g.play=function(){g.paused&&(g.paused=!1,t=0,l=d(g.currentTime),v.push(g),B||ia())};g.reverse=function(){g.reversed=!g.reversed;t=0;l=d(g.currentTime)};g.restart=function(){g.pause();g.reset();g.play()};g.finished=m;g.reset();g.autoplay&&g.play();return g}var ga={update:void 0,begin:void 0,run:void 0,complete:void 0,loop:1,direction:"normal",autoplay:!0,offset:0},S={duration:1e3,delay:0,easing:"easeOutElastic",elasticity:500,round:0},W="translateX translateY translateZ rotate rotateX rotateY rotateZ scale scaleX scaleY scaleZ skewX skewY perspective".split(" "),H,h={arr:function(a){return Array.isArray(a)},obj:function(a){return-1<Object.prototype.toString.call(a).indexOf("Object")},pth:function(a){return h.obj(a)&&a.hasOwnProperty("totalLength")},svg:function(a){return a instanceof SVGElement},dom:function(a){return a.nodeType||h.svg(a)},str:function(a){return"string"===typeof a},fnc:function(a){return"function"===typeof a},und:function(a){return"undefined"===typeof a},hex:function(a){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(a)},rgb:function(a){return/^rgb/.test(a)},hsl:function(a){return/^hsl/.test(a)},col:function(a){return h.hex(a)||h.rgb(a)||h.hsl(a)}},A=function(){function a(a,d,b){return(((1-3*b+3*d)*a+(3*b-6*d))*a+3*d)*a}return function(c,d,b,f){if(0<=c&&1>=c&&0<=b&&1>=b){var e=new Float32Array(11);if(c!==d||b!==f)for(var k=0;11>k;++k)e[k]=a(.1*k,c,b);return function(k){if(c===d&&b===f)return k;if(0===k)return 0;if(1===k)return 1;for(var h=0,l=1;10!==l&&e[l]<=k;++l)h+=.1;--l;var l=h+(k-e[l])/(e[l+1]-e[l])*.1,n=3*(1-3*b+3*c)*l*l+2*(3*b-6*c)*l+3*c;if(.001<=n){for(h=0;4>h;++h){n=3*(1-3*b+3*c)*l*l+2*(3*b-6*c)*l+3*c;if(0===n)break;var m=a(l,c,b)-k,l=l-m/n}k=l}else if(0===n)k=l;else{var l=h,h=h+.1,g=0;do{m=l+(h-l)/2,n=a(m,c,b)-k,0<n?h=m:l=m}while(1e-7<Math.abs(n)&&10>++g);k=m}return a(k,d,f)}}}}(),Q=function(){function a(a,b){return 0===a||1===a?a:-Math.pow(2,10*(a-1))*Math.sin(2*(a-1-b/(2*Math.PI)*Math.asin(1))*Math.PI/b)}var c="Quad Cubic Quart Quint Sine Expo Circ Back Elastic".split(" "),d={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],a],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(b,c){return 1-a(1-b,c)}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(b,c){return.5>b?a(2*b,c)/2:1-a(-2*b+2,c)/2}]},b={linear:A(.25,.25,.75,.75)},f={},e;for(e in d)f.type=e,d[f.type].forEach(function(a){return function(d,f){b["ease"+a.type+c[f]]=h.fnc(d)?d:A.apply($jscomp$this,d)}}(f)),f={type:f.type};return b}(),ha={css:function(a,c,d){return a.style[c]=d},attribute:function(a,c,d){return a.setAttribute(c,d)},object:function(a,c,d){return a[c]=d},transform:function(a,c,d,b,f){b[f]||(b[f]=[]);b[f].push(c+"("+d+")")}},v=[],B=0,ia=function(){function a(){B=requestAnimationFrame(c)}function c(c){var b=v.length;if(b){for(var d=0;d<b;)v[d]&&v[d].tick(c),d++;a()}else cancelAnimationFrame(B),B=0}return a}();q.version="2.2.0";q.speed=1;q.running=v;q.remove=function(a){a=P(a);for(var c=v.length;c--;)for(var d=v[c],b=d.animations,f=b.length;f--;)u(a,b[f].animatable.target)&&(b.splice(f,1),b.length||d.pause())};q.getValue=K;q.path=function(a,c){var d=h.str(a)?e(a)[0]:a,b=c||100;return function(a){return{el:d,property:a,totalLength:N(d)*(b/100)}}};q.setDashoffset=function(a){var c=N(a);a.setAttribute("stroke-dasharray",c);return c};q.bezier=A;q.easings=Q;q.timeline=function(a){var c=q(a);c.pause();c.duration=0;c.add=function(d){c.children.forEach(function(a){a.began=!0;a.completed=!0});m(d).forEach(function(b){var d=z(b,D(S,a||{}));d.targets=d.targets||a.targets;b=c.duration;var e=d.offset;d.autoplay=!1;d.direction=c.direction;d.offset=h.und(e)?b:L(e,b);c.began=!0;c.completed=!0;c.seek(d.offset);d=q(d);d.began=!0;d.completed=!0;d.duration>b&&(c.duration=d.duration);c.children.push(d)});c.seek(0);c.reset();c.autoplay&&c.restart();return c};return c};q.random=function(a,c){return Math.floor(Math.random()*(c-a+1))+a};return q});const CARD_HEIGHT=240;var INTRO_ANIMATIONS=[];var SETUP_ANIMATIONS=[];const SMBEvent=Object.freeze({AfterIntro:"after intro",AfterPreBattle:"after prebattle",AfterAction:"after action",AfterRound:"after round",BattleFinished:"battle finished",AfterOutro:"after outro",AfterBattleResultDialog:"after battle result dialog"});const SMBEventEmitter=Object.freeze({_emitter:document.createElement("div"),_handlers:new WeakMap,on(type,handler,opts={}){this._emitter.addEventListener(type,handler,opts);if(!opts.once){this._handlers.set(handler,type)}},once(type,handler){this.on(type,handler,{once:true})},dispatch(type,payload){const event=new Event(type);event.payload=payload;this._emitter.dispatchEvent(event)}});function initialize(){if(SM.Player&&SM.Player.settings.mute_all)SMAudio.SetGlobalVolume(0);if(!SMAudio.isSoundAndMusicMuted){$("#btnMute span").removeClass("glyphicon-volume-off").addClass("glyphicon-volume-up")}else{$("#btnMute span").removeClass("glyphicon-volume-up").addClass("glyphicon-volume-off")}setSpeedButtonIcon();anime.speed=SMBPlayback.Speed;if(battleTracker.isBrawl){initBrawlBar()}setTimeout(()=>{const $cardArea=$("#cardArea");const $cardInfo=$(".card-info");battleTracker.team1.monsters.forEach((el,i)=>{if(i<6){var cardDetails=SM.GetCardDetails(el.card_detail_id);$cardArea.append(SM.ShowComponent("battle_card",{team:"team1",card_index:i+1,card_detail_id:cardDetails.id,uid:el.uid,name:cardDetails.name,gold:el.gold,edition:el.edition,level:el.level,skin:el.skin}));renderStats("#card_team1_"+(i+1),el)}});battleTracker.team2.monsters.forEach((el,i)=>{if(i<6){var cardDetails=SM.GetCardDetails(el.card_detail_id);$cardArea.append(SM.ShowComponent("battle_card",{team:"team2",card_index:i+1,card_detail_id:cardDetails.id,uid:el.uid,name:cardDetails.name,gold:el.gold,edition:el.edition,level:el.level,skin:el.skin}));renderStats("#card_team2_"+(i+1),el)}});$cardArea.find(".cardContainer").each(function(i,card){card.addEventListener("mouseover",function handleMouseOver(e){const cardUid=card.getAttribute("uid");const cardDetails=SM.GetCardDetails(card.dataset.cardDetailId);const cardBattleState=battleTracker.getMonsterStateById(cardUid);const monster=battleTracker.getMonsterById(cardUid);$(card).children(".card-info").html(SM.ShowComponent("battle_card_hover",{id:cardDetails.id,card_detail_id:cardDetails.id,edition:monster.edition,abilities:cardBattleState.abilities,buffs:cardBattleState.state.other,level:monster.level,skin:monster.skin,gold:monster.gold}));const isTeam2=$(this).hasClass("team2");$cardInfo.addClass(isTeam2?"team2":"");const $cardInfoBuffsAbilities=$(card).find(".battle__card-info-buffsAndAbilities");const cardInfoBuffsAbilitiesBounds=$cardInfoBuffsAbilities.get(0).getBoundingClientRect();const isTeam1=!isTeam2;if(isTeam1&&cardInfoBuffsAbilitiesBounds.height>CARD_HEIGHT){$cardInfoBuffsAbilities.addClass("battle__card-info-buffsAndAbilities--long")}else{$cardInfoBuffsAbilities.removeClass("battle__card-info-buffsAndAbilities--long")}})});t1Array=$(".team1").toArray();t2Array=$(".team2").toArray();SMBPortrait.Team1=new SMBPortrait("#t1_portrait",battleTracker.team1,battleTracker.player1,"left",battle.ruleset);SMBPortrait.Team2=new SMBPortrait("#t2_portrait",battleTracker.team2,battleTracker.player2,"right",battle.ruleset);SMBPortrait.LoadPortraits();if(SM.Player&&SM.Player.settings.skip_battle_intro){setupBoard();setupBoardSkip()}else{intro()}},300*SMBPlayback.iSpeed)}function initBrawlBar(){const homePlayer=battleTracker.homePlayer;$("#home_player .bio__avatar").append(SM.ShowComponent("avatar",homePlayer));$("#home_player .bio__name__pre").text(homePlayer.title_pre||"");$("#home_player .bio__name__display").text(homePlayer.display_name||homePlayer.name);$("#home_player .bio__name__post").text(homePlayer.title_post||"");$("#fray_limits").html(SM.ShowComponent("guilds/brawl/fray_info",battleTracker.getBattleLimits()));const home_perk_data=[];const perks=battleTracker.brawlPerks;if(perks){if(perks.bonuses.home_tie_break){home_perk_data.push({img:"1_advantage_128.png",tooltip:SM.Translator.t("guild.barracks.tactics.one_alt_text",{_:`Host guild always wins when there’s a Draw. Host guild units attack first in Ties.`}),tooltip_width:200})}if(perks.bonuses.away_blocked_cards&&perks.bonuses.away_blocked_cards.length>0){const banished_card_1_details=SM.GetCardDetails(perks.bonuses.away_blocked_cards[0]);const banished_card_1_name=banished_card_1_details.name.toUpperCase().replace(/'/g,"&apos;");const banished_card_1_icon=SM.ShowComponent("guilds/buildings/banished_avatar",{banished_cards:perks.bonuses.away_blocked_cards,index:0,suppress_label:true});home_perk_data.push({img:"3_banish1_128.png",tooltip:SM.Translator.t("guild.barracks.tactics.banish_bg_text",{_:`<div class='banished-icon'>%{avatar}</div><div class='tooltip-title-text'>%{name}</div>was banished from the visiting Battle Mage’s roster. They could not use this character when creating a team.`,avatar:banished_card_1_icon,name:banished_card_1_name}),tooltip_width:250})}if(perks.bonuses.away_blocked_cards&&perks.bonuses.away_blocked_cards.length>1){const banished_card_2_details=SM.GetCardDetails(perks.bonuses.away_blocked_cards[1]);const banished_card_2_name=banished_card_2_details.name.toUpperCase().replace(/'/g,"&apos;");const banished_card_2_icon=SM.ShowComponent("guilds/buildings/banished_avatar",{banished_cards:perks.bonuses.away_blocked_cards,index:1,suppress_label:true});home_perk_data.push({img:"6_banish2_128.png",tooltip:SM.Translator.t("guild.barracks.tactics.banish_bg_text",{_:`<div class='banished-icon'>%{avatar}</div><div class='tooltip-title-text'>%{name}</div>was banished from the visiting Battle Mage’s roster. They could not use this character when creating a team.`,avatar:banished_card_2_icon,name:banished_card_2_name}),tooltip_width:250})}if(perks.modifiers&&perks.modifiers.length>0){perks.modifiers.forEach(m=>{if(m.stat==="speed"&&Math.abs(m.delta)===1&&m.target==="away"){home_perk_data.push({img:"9_ambush_128.png",tooltip:SM.Translator.t("guild.barracks.tactics.ambush_bg_text",{_:`All visiting team Monsters suffer a +/- 1 Speed disadvantage in battle.`}),tooltip_width:200})}})}}if(home_perk_data.length===0){$("#tactics_none").show()}else{$("#tactics_list").show();for(let i=0;i<home_perk_data.length;i++){let perk=home_perk_data[i];$(`#tactic_icon_${i+1} img`).attr("src",`https://d36mxiodymuqjm.cloudfront.net/website/guilds/brawls/tactics/img_tactic-${perk.img}`);$(`#tactic_icon_${i+1} img`).attr("data-toggle","tooltip");$(`#tactic_icon_${i+1} img`).attr("data-placement","bottom");$(`#tactic_icon_${i+1} img`).attr("data-template",`<div class="tooltip" role="tooltip" style="margin-top: 10px;"><div class="tooltip-inner modern" style="min-width: ${perk.tooltip_width}px; max-width: ${perk.tooltip_width}px;"></div></div>`);$(`#tactic_icon_${i+1} img`).attr("data-title",perk.tooltip);$(`#tactic_icon_${i+1}`).show();$(`#tactic_icon_${i+1} img`).tooltip({html:true})}}}function btnMuteClick(){if(SM.Player&&SM.Player.settings.mute_all)return;if(!SMAudio.isSoundAndMusicMuted){SMAudio.MuteSoundAndMusic();$("#btnMute span").removeClass("glyphicon-volume-up").addClass("glyphicon-volume-off")}else{SMAudio.UnmuteSoundAndMusic();$("#btnMute span").removeClass("glyphicon-volume-off").addClass("glyphicon-volume-up")}}function intro(){var vs=$(".vs");var divider=$(".divider");var t1Div=$("#t1_portrait");var t2Div=$("#t2_portrait");$("#intro-overlay").show();INTRO_ANIMATIONS.push(anime({targets:"#intro-overlay",backgroundColor:"#000",easing:"easeOutQuart"}));t1Div.show();INTRO_ANIMATIONS.push(anime.timeline().add({targets:t1Div[0],easing:"easeOutQuint",translateX:[900,280],translateY:[144,247],scale:[1,2.5],rotateY:50,begin:()=>{SMBSounds.BattleStart()}}).add({targets:t1Div[0],translateX:260,translateY:247,scale:2.5,duration:2500,rotateY:50,easing:"linear"}));vs.show();INTRO_ANIMATIONS.push(anime({targets:vs[0],scale:[0,1]}));t2Div.show();$(t2Div.children()[2]).css("transform","rotateY(180deg)");INTRO_ANIMATIONS.push(anime.timeline().add({targets:t2Div[0],easing:"easeOutQuint",translateX:[0,864],translateY:[600,247],scale:[1,2.5],rotateY:-50}).add({targets:t2Div[0],translateX:884,translateY:247,scale:2.5,duration:2500,easing:"linear",rotateY:-50,complete:setupBoard}));divider.show();INTRO_ANIMATIONS.push(anime({targets:divider[0],translateX:[700,115],translateY:[-2e3,-84],skewX:[-20,-20],easing:"easeInQuart",duration:1e3}))}function introSkip(){INTRO_ANIMATIONS.forEach(a=>{a.seek(a.duration)})}function setupBoard(){var vs=$(".vs");var divider=$(".divider");var t1Div=$("#t1_portrait");var t2Div=$("#t2_portrait");t1Div.show();t2Div.show();SETUP_ANIMATIONS.push(anime({targets:"#intro-overlay",backgroundColor:"rgba(0, 0, 0, 0)",easing:"easeInQuart",begin:()=>{SMBSounds.PlayMainBattleTheme()},complete:()=>{$("#intro-overlay").hide()}}));SETUP_ANIMATIONS.push(anime({targets:vs[0],easing:"easeInQuart",scale:0}));SETUP_ANIMATIONS.push(anime({targets:divider[0],translateX:-700,translateY:2e3,skewX:[-20,-20],easing:"easeInQuart",duration:1e3,complete:function(){divider.hide()}}));SETUP_ANIMATIONS.push(anime({targets:t1Div[0],easing:"easeOutQuint",translateX:Positions.team1.Summoner.x,translateY:Positions.team1.Summoner.y,scale:1}));SETUP_ANIMATIONS.push(anime({targets:t1Div.children()[2],easing:"easeOutQuint",rotateY:180}));SETUP_ANIMATIONS.push(anime({targets:t2Div.children()[2],easing:"easeOutQuint",rotateY:0}));SETUP_ANIMATIONS.push(anime({targets:t2Div[0],easing:"easeOutQuint",translateX:Positions.team2.Summoner.x,translateY:Positions.team2.Summoner.y,scale:1,complete:function(anim){summon()}}))}function setupBoardSkip(){SETUP_ANIMATIONS.forEach(a=>{a.seek(a.duration)})}function summon(){$(".arena-sponsor").show();$(".arena-sponsor").css("left",690-$(".arena-sponsor").width()/2+"px");$("img.arena-logo").show();$("img.arena-logo").css("left",690-$("img.arena-logo").width()/2+"px");var delay=0;t1Array.forEach(function(element,index){summonCard("#"+element.id,Positions.team1.Summoner,Positions.team1[index+1].x,Positions.team1[index+1].y,delay);delay+=SM.Player&&SM.Player.settings.skip_battle_intro?0:300});setTimeout(function(){delay=1e3;t2Array.forEach(function(element,index){summonCard("#"+element.id,Positions.team2.Summoner,Positions.team2[index+1].x,Positions.team2[index+1].y,delay);delay+=SM.Player&&SM.Player.settings.skip_battle_intro?0:300});setTimeout(()=>{$("#btnRumble").show();$(".arrows").show();$('[data-toggle="tooltip"]').tooltip({html:true});$(".cardContainer").removeClass("circle-gem");$(".cardContainer").css({"clip-path":""});SMBEventEmitter.dispatch(SMBEvent.AfterIntro)},(SM.Player&&SM.Player.settings.skip_battle_intro?0:4e3)*SMBPlayback.iSpeed)},(SM.Player&&SM.Player.settings.skip_battle_intro?0:1600)*SMBPlayback.iSpeed)}function summonCard(cardId,summonOrigin,xPosDest,yPosDest,delay){if(SM.Player&&SM.Player.settings.skip_battle_intro){$(cardId).show();$(cardId+" .battle-stats").show();$(cardId).css({transform:`translateX(${xPosDest}px) translateY(${yPosDest}px)`})}else{setTimeout(function(){$(cardId).show();$(cardId+" .battle-stats").show();anime.timeline().add({targets:cardId,easing:"easeOutQuint",translateX:[summonOrigin.x,xPosDest],translateY:[summonOrigin.y,yPosDest-100],scale:[3,3],filter:"brightness(1)",begin:()=>{SMBSounds.SummonMonster()}}).add({targets:cardId,easing:"easeOutQuint",translateX:xPosDest,translateY:yPosDest,"clip-path":"circle(500px at 101px 154px)",filter:["brightness(8)","brightness(1)"],scale:1})},delay*SMBPlayback.iSpeed)}}function flinch(target){targetPos=getElementTransformPosition(target);let shakearray=Array.from({length:10},()=>Math.floor(Math.random()*20)+10);anime.timeline().add({targets:target,translateX:"+=0",translateY:"+=0",rotateZ:shakearray,duration:100}).add({targets:target,translateX:targetPos.x,translateY:targetPos.y,rotateZ:0,duration:100})}function stopFightLoop(){isPaused=true;$("#btnPlay").show();$("#btnPause").hide()}function startFightLoop(){isPaused=false;$("#btnRumble").hide();setBtnControlDisplay(true);$("#btnPause").show();$("#btnPlay").hide();if(battleTracker.preRoundIndex==0){$(".bg-overlay").show();$(".action_info").hide();$(".conflict_rules").hide();$(".round_info").show();anime.timeline().add({targets:".bg-overlay",backgroundColor:"rgba(0, 0, 0, .8)",easing:"easeOutQuart"}).add({targets:".round_info",translateX:[2e3,745],translateY:[145,145],scale:1.3,easing:"easeOutQuart",duration:300,begin:()=>{SMBSounds.NextRound()},complete:()=>{anime({delay:1e3,targets:".round_info",translateX:[745,-7],translateY:393,easing:"easeInQuart",scale:1,duration:300});anime({delay:1e3,targets:".bg-overlay",backgroundColor:"rgba(0, 0, 0, 0)",easing:"easeInQuart",duration:300,complete:()=>{$(".bg-overlay").hide();battleTracker.saveHistory(0,t1Array,t2Array);PreBattleLoop();$(".action_info").show();$(".conflict_rules").css("display","flex");$(".round_info").css("z-index","")}})}})}else{if(battleTracker.isPreBattle)PreBattleLoop();else fightLoop()}}function btnSkipClick(){stopFightLoop();setBtnControlDisplay(false);SMBSounds.StopMainBattleTheme();SMBSounds.FightOverInterlude();SM.ShowDialog("battle_result",battleResultsObj,null,null,"static");SMBEventEmitter.dispatch(SMBEvent.AfterBattleResultDialog)}function btnBackClick(){if(isPaused&&anime.running.length==0){goBackOneRound()}else{$("#btnBack").data("goback",true);$("#btnBack").addClass("activated")}}function goBackOneRound(){$("#btnBack").data("goback",false);$("#btnBack").removeClass("activated");if(battleTracker.preRoundIndex==0)return;stopFightLoop();setBtnControlDisplay(false);anime.timeline().add({targets:"#cardArea",opacity:0,duration:500,easing:"easeInQuart",complete:()=>{var promiseMap=anime.running.map(x=>x.finished);Promise.all(promiseMap).then(()=>{if(battleTracker.actionIndex>0)battleTracker.restoreHistory(battleTracker.roundIndex);else battleTracker.restoreHistory(battleTracker.roundIndex-1<0?0:battleTracker.roundIndex-1);anime({targets:"#cardArea",opacity:1,delay:1e3,duration:500,easing:"easeOutQuart",complete:()=>{setBtnControlDisplay(true)}})})}})}function EndFight(){setBtnControlDisplay(false);$("#btnPause").hide();if(battleTracker.Results.winner!="DRAW"){var winner="#"+$("[team='"+battleTracker.Results.winner+"']")[0].id;var loser="#"+$("[team='"+battleTracker.Results.loser+"']")[0].id;var shakearray=Array.from({length:30},()=>Math.floor(Math.random()*20)-20);loserPos=getElementTransformPosition(loser);$(".round_info").css("z-index","0");$(winner).css("z-index","1001");$(".bg-overlay").show();SMBSounds.StopMainBattleTheme();SMBSounds.FightOverInterlude();anime.timeline().add({targets:loser,translateX:[loserPos.x,loserPos.x],translateY:[loserPos.y,loserPos.y],scale:1.2,duration:300,easing:"easeInQuart"}).add({targets:loser,opacity:0,translateX:[loserPos.x,loserPos.x],translateY:loserPos.y,rotateY:45,rotateZ:90,left:shakearray,scale:.1,filter:["brightness(.8)","brightness(8)"],duration:2500,easing:"linear"}).add({targets:".bg-overlay",delay:500,backgroundColor:"rgba(0, 0, 0, .7)",easing:"easeOutQuart"}).add({targets:winner,translateX:575,translateY:120,scale:1.5,easing:"easeOutQuart"}).finished.then(()=>{SMBEventEmitter.dispatch(SMBEvent.AfterOutro)})}else{SMBSounds.StopMainBattleTheme();SMBSounds.FightOverInterlude()}setTimeout(function(){SM.ShowDialog("battle_result",battleResultsObj,null,null,"static");SMBEventEmitter.dispatch(SMBEvent.AfterBattleResultDialog)},6e3*SMBPlayback.iSpeed);return}function fightLoop(){var timeout=0;var roundDelay=0;if(battleTracker.roundIndex==0){$(".action_number").text(battleTracker.preRoundIndex+battleTracker.actionIndex+1);$(".action_max").text(battleTracker.numberOfActions+battleTracker.numberOfPrebattleActions)}else{$(".action_number").text(battleTracker.actionIndex+1);$(".action_max").text(battleTracker.numberOfActions)}if(!battleTracker.peekNextActionInCurrentRound()){SMBEventEmitter.dispatch(SMBEvent.AfterRound)}var action=battleTracker.nextAction();SMBPlayback.SetSpeed(parseFloat(localStorage.getItem("sl:battle_speed")||"1"));if($("#btnBack").data("goback"))goBackOneRound();if(SM.settings.test_mode){console.log(action);console.log("Round: "+battleTracker.roundIndex);console.log("Action: "+battleTracker.actionIndex)}var prevRoundNum=battleTracker.roundIndex;if(prevRoundNum>0&&battleTracker.actionIndex==1||action==null){var promiseMap=anime.running.map(x=>x.finished);Promise.all(promiseMap).then(()=>{battleTracker.saveHistory(battleTracker.roundIndex,t1Array,t2Array)});roundDelay=1200;SMBEffects.FlashTarget(".round_info",200);$(".round_number").text(battleTracker.roundIndex+1);anime({targets:".round_number",scale:[2.5,1],duration:400,easing:"easeInQuart"});SMBSounds.NextRound()}if(action==null){setTimeout(()=>{if(!isPaused)fightLoop()},700*SMBPlayback.iSpeed);return}SMBEventEmitter.dispatch(SMBEvent.AfterAction,{action:action});if(action["BattleEnd"]){SMBEventEmitter.dispatch(SMBEvent.BattleFinished);EndFight();return}if(SM.CurrentView.view!="battle"){return}var atk=action.initiator!=null?"#"+$("[uid='"+action.initiator+"']")[0].id:"";var def=action.target!=null?"#"+$("[uid='"+action.target+"']")[0].id:"";setTimeout(()=>{switch(action.type){case"melee attack":timeout+=2500;handleMeleeAtk(atk,def,action);break;case"magic attack":timeout+=2e3;handleMagicAtk(atk,def,action);break;case"blast":timeout+=2500;handleBlast(atk,def,action);break;case"ranged attack":timeout+=2e3;handleRangedAtk(atk,def,action);break;case"heal":case"repair":case"triage":timeout+=1500;handleHeal(atk,def,action);break;case"group heal":timeout+=1500;handleHeal(atk,def,action);break;case"cleanse":timeout+=1500;handleCleanse(atk,def,action);break;case"fear":timeout+=2500;handleFear(atk,def,action);break;case"retaliate":timeout+=2500;handleRetaliate(atk,def,action);break;case"reflect":timeout+=2500;handleReflect(atk,def,action);break;case"thorns":timeout+=2500;handleThorns(atk,def,action);break;case"trample":timeout+=2500;handleTrample(atk,def,action);break;case"death":timeout+=2500;handleDeath(def);break;case"resurrect":timeout+=4500;handleResurrect(atk,def,action);break;case"remove_buff":timeout+=2500;handleStatUpdate(action);break;case"buff":case"halving":timeout+=2500;handleStatUpdate(action);break;case"poison":timeout+=2e3;handlePoison(def,action);break;case"life leech":case"scavenge":timeout+=1500;handleLifeLeech(atk,def,action);break;default:timeout+=1500;handleGenericAtk(atk,def,action);break}SMBFightTimer.SetTimeout(()=>{if(!isPaused)fightLoop()},timeout*SMBPlayback.iSpeed)},roundDelay*SMBPlayback.iSpeed)}function PreBattleLoop(){$(".action_number").text(battleTracker.preRoundIndex+1);$(".action_max").text(battleTracker.numberOfActions+battleTracker.numberOfPrebattleActions);const peekedAction=battleTracker.peekNextActionInPreBattle();if(!peekedAction){SMBEventEmitter.dispatch(SMBEvent.AfterPreBattle)}var action=battleTracker.nextPreRoundAction();SMBPlayback.SetSpeed(parseFloat(localStorage.getItem("sl:battle_speed")||"1"));if($("#btnBack").data("goback"))goBackOneRound();if(action["PreRoundEnd"]){if(!isPaused)fightLoop();return}if(Array.isArray(action.initiator)){action.initiator.forEach(uid=>SMBEffects.FlashTarget("[uid='"+uid+"']",600))}else{SMBEffects.FlashTarget("[uid='"+action.initiator+"']",600)}setTimeout(()=>{handleStatUpdate(action)},600*SMBPlayback.iSpeed);setTimeout(()=>{if(!isPaused)PreBattleLoop()},1700*SMBPlayback.iSpeed)}function onHitOutcome(initiator,target,action){if(action==null){$("#spriteHitEffect").css("transform",$(target).css("transform"));smbEffects.playRandomHitEffect();flinch(target);return}if(action.result=="hit"){$("#spriteHitEffect").css("transform",$(target).css("transform")+" scale(2)");smbEffects.playRandomHitEffect();if(action.damage>0)flinch(target);$(target+" .card-damageText").html(action.damage==0?"0":"-"+action.damage);$(target+" .card-damageText").show();anime({targets:target+" .card-damageText",translateY:"-=20",easing:"easeOutQuint",duration:700,complete:()=>{$(target+" .card-damageText").css("transform","");$(target+" .card-damageText").hide()}});updateStats(target,action.state)}else{updateStats(target,action.state);if(action.damage!=null){$("#spriteMiss").css("transform",$(target).css("transform"));var pos=getElementTransformPosition(target);$("#spriteMiss").show();anime({targets:"#spriteMiss",translateX:[pos.x,pos.x],translateY:[pos.y,pos.y-20],easing:"easeOutQuint",duration:900,complete:()=>{$("#spriteMiss").hide()}})}}}function onHealOutcome(target,action){if(action==null){return}if(action.damage>0){$(target+" .card-damageText").html("+"+action.damage);$(target+" .card-damageText").show();anime({targets:target+" .card-damageText",translateY:"-=20",easing:"easeOutQuint",duration:700,complete:()=>{$(target+" .card-damageText").css("transform","");$(target+" .card-damageText").hide()}});updateStats(target,action.state)}}function handleMeleeAtk(initiator,target,action){atkPos=getElementTransformPosition(initiator);targetPos=getElementTransformPosition(target);SMBEffects.FlashTarget(initiator,600);return anime.timeline().add({targets:initiator,easing:"easeOutQuint",translateX:"+=10",translateY:"+=10",rotateZ:"+=15",duration:500,delay:600,complete:()=>{if(action.result=="miss"){SMBSounds.MeleeMiss()}else{SMBSounds.MeleeHit()}}}).add({targets:initiator,easing:"easeInQuint",translateX:targetPos.x,translateY:targetPos.y,rotateZ:"-=30",duration:400,complete:()=>{onHitOutcome(initiator,target,action)}}).add({targets:initiator,easing:"easeOutQuint",translateX:atkPos.x,translateY:atkPos.y,duration:400}).finished}function handleStatUpdate(action){action.group_state.forEach((el,i)=>{var target="#"+$("[uid='"+el.monster+"']")[0].id;updateStats(target,el.state)})}function handleRangedAtk(initiator,target,action){atkPos=getElementTransformPosition(initiator);targetPos=getElementTransformPosition(target);SMBEffects.FlashTarget(initiator,600);$("#spriteStatic").attr("src",SM.settings.battles.asset_url+"Projectiles/axe.png");$("#spriteStatic").show();return anime.timeline().add({targets:"#spriteStatic",easing:"easeOutQuint",translateX:[atkPos.x,atkPos.x],translateY:[atkPos.y,atkPos.y],rotateZ:"+=360",duration:500,delay:600,complete:()=>{if(action.result=="miss"){SMBSounds.RangedMiss()}else{SMBSounds.RangedHit()}}}).add({targets:"#spriteStatic",easing:"easeInQuint",translateX:targetPos.x,translateY:targetPos.y,rotateZ:"-=360",duration:400,complete:()=>{$("#spriteStatic").hide();onHitOutcome(initiator,target,action)}}).finished}function handleMagicAtk(initiator,target,action){atkPos=getElementTransformPosition(initiator);targetPos=getElementTransformPosition(target);SMBEffects.FlashTarget(initiator,600);let fireball=smbEffects.playFireBall();return anime.timeline().add({targets:"#spriteProjectile",scale:[0,0],duration:1,begin:()=>{SMBSounds.MagicHit()}}).add({targets:"#spriteProjectile",easing:"easeOutQuint",translateX:[atkPos.x,atkPos.x],translateY:[atkPos.y,atkPos.y],rotateZ:"+=360",scale:[0,1.6,1],duration:600,delay:600}).add({targets:"#spriteProjectile",easing:"easeInQuint",translateX:targetPos.x,translateY:targetPos.y,rotateZ:"-=360",duration:400,complete:()=>{fireball.stop();onHitOutcome(initiator,target,action)}}).finished}function handleCleanse(initiator,target,action){SMBEffects.FlashTarget(initiator,600);setTimeout(()=>{updateStats(target,action.state)},800*SMBPlayback.iSpeed)}function handleHeal(initiator,target,action){SMBEffects.FlashTarget(initiator,600);setTimeout(()=>{SMBSounds.Heal();smbEffects.playHeal(target);setTimeout(()=>{onHealOutcome(target,action)},800*SMBPlayback.iSpeed)},600*SMBPlayback.iSpeed)}function handleDeath(target){anime.timeline().add({targets:target,filter:["grayscale(0)","grayscale(1)"],translateX:"+=50",translateY:"+=0",rotateZ:70,delay:500,duration:600,begin:()=>{SMBSounds.MonsterKO()},complete:()=>{$(target+" .card").hide();$(target+" .battle-stats").hide();$(target+" .card-battle-level").hide();smbEffects.playSmoke(target)}}).add({targets:target+" .card",delay:500,duration:0,complete:()=>{let numOfResurrects=battleTracker.getFutureActions("resurrect",$(target).attr("uid")).length;if(numOfResurrects==0){if($(target).hasClass("team1")){var index=t1Array.findIndex(el=>{return"#"+el.id==target});t1Array.splice(index,1);repositionTeam(t1Array)}else{var index=t2Array.findIndex(el=>{return"#"+el.id==target});t2Array.splice(index,1);repositionTeam(t2Array)}}}})}function handleFear(initiator,target,action){SMBEffects.FlashTarget(initiator,600);targetPos=getElementTransformPosition(target);$("#spriteText").html(action.type);$("#spriteText").css("transform",$(target).css("transform"));anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[targetPos.x,targetPos.x],translateY:[targetPos.y,"-=60"],duration:700,delay:1e3,begin:()=>{$("#spriteText").show()},complete:()=>{$(target+" .card-damageText").css("transform","");$("#spriteText").hide();flinch(target);if($(target).hasClass("team1")){var index=t1Array.findIndex(el=>{return"#"+el.id==target});var temp=t1Array.splice(index,1);t1Array.push(temp[0]);repositionTeam(t1Array)}else{var index=t2Array.findIndex(el=>{return"#"+el.id==target});var temp=t2Array.splice(index,1);t2Array.push(temp[0]);repositionTeam(t2Array)}}})}function handleResurrect(initiator,target,action){targetPos=getElementTransformPosition(target);$(target).css("transform","");$(target).css("filter","");$(target).css("opacity","0");$(target+" .card").show();SMBEffects.FlashTarget(initiator,600);atkPos=getElementTransformPosition(initiator);$("#spriteText").html(action.type);$("#spriteText").css("transform",$(initiator).css("transform"));anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[atkPos.x,atkPos.x],translateY:[atkPos.y,"-=60"],duration:700,delay:1e3,begin:()=>{$("#spriteText").show()},complete:()=>{$("#spriteText").hide();SMBSounds.Resurrect();smbEffects.playResurrect(target);anime({targets:target,translateX:targetPos.x-50,translateY:targetPos.y-20,duration:0});anime({targets:target,opacity:1,translateX:targetPos.x-50,translateY:targetPos.y,filter:["brightness(8)","brightness(1)"],easing:"easeOutQuint",duration:1e3,delay:600,complete:()=>{$(target+" .battle-stats").show();$(target+" .card-battle-level").show();updateStats(target,action.state)}})}})}function handleLifeLeech(initiator,target,action){atkPos=getElementTransformPosition(initiator);targetPos=getElementTransformPosition(target);$("#spriteText").html(action.type);$("#spriteText").css("transform",$(target).css("transform"));$("#spriteText").show();anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[targetPos.x,targetPos.x],translateY:[targetPos.y,"-=20"],duration:500,delay:600,complete:()=>{$("#spriteText").hide();onHealOutcome(target,action)}})}function handleGenericAtk(initiator,target,action){atkPos=getElementTransformPosition(initiator);targetPos=getElementTransformPosition(target);if(initiator==null||initiator==""){$("#spriteText").html(action.type);$("#spriteText").css("transform",$(target).css("transform"));$("#spriteText").show();anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[targetPos.x,targetPos.x],translateY:[targetPos.y,"-=20"],duration:500,delay:600,complete:()=>{$("#spriteText").hide();onHitOutcome(initiator,target,action)}});return}SMBEffects.FlashTarget(initiator,600);$("#spriteText").html(action.type);$("#spriteText").show();anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[atkPos.x,atkPos.x],translateY:[atkPos.y,atkPos.y],duration:500,delay:600}).add({targets:"#spriteText",easing:"easeInQuint",translateX:targetPos.x,translateY:targetPos.y,duration:400,complete:()=>{$("#spriteText").hide();onHitOutcome(initiator,target,action)}})}function handleBlast(initiator,target,action){atkPos=getElementTransformPosition(initiator);targetPos=getElementTransformPosition(target);$("#spriteText").html(action.type);$("#spriteText").css("transform",$(initiator).css("transform"));anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[targetPos.x,targetPos.x],translateY:[targetPos.y,"-=60"],duration:700,begin:()=>{$("#spriteText").show()},complete:()=>{$("#spriteText").hide();smbEffects.playBlast(target);setTimeout(()=>{onHitOutcome(null,target,action)},700*SMBPlayback.iSpeed)}})}function handleRetaliate(initiator,target,action){atkPos=getElementTransformPosition(initiator);targetPos=getElementTransformPosition(target);atkPos=getElementTransformPosition(initiator);$("#spriteText").html(action.type);$("#spriteText").css("transform",$(initiator).css("transform"));anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[atkPos.x,atkPos.x],translateY:[atkPos.y,"-=60"],duration:700,begin:()=>{$("#spriteText").show()},complete:()=>{$("#spriteText").hide();handleMeleeAtk(initiator,target,action)}})}function handlePoison(target,action){targetPos=getElementTransformPosition(target);$("#spriteText").html(action.type);$("#spriteText").css("transform",$(target).css("transform"));anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[targetPos.x,targetPos.x],translateY:[targetPos.y,"-=60"],duration:700,begin:()=>{$("#spriteText").show();SMBSounds.Poison();smbEffects.playPoison(target)},complete:()=>{$("#spriteText").hide();setTimeout(()=>{onHitOutcome(null,target,action)},1e3*SMBPlayback.iSpeed)}})}function handleTrample(initiator,target,action){atkPos=getElementTransformPosition(initiator);targetPos=getElementTransformPosition(target);atkPos=getElementTransformPosition(initiator);$("#spriteText").html(action.type);$("#spriteText").css("transform",$(initiator).css("transform"));anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[atkPos.x,atkPos.x],translateY:[atkPos.y,"-=60"],duration:700,begin:()=>{$("#spriteText").show()},complete:()=>{$("#spriteText").hide();handleMeleeAtk(initiator,target,action)}})}function handleThorns(initiator,target,action){atkPos=getElementTransformPosition(initiator);targetPos=getElementTransformPosition(target);atkPos=getElementTransformPosition(initiator);$("#spriteText").html(action.type);$("#spriteText").css("transform",$(initiator).css("transform"));anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[atkPos.x,atkPos.x],translateY:[atkPos.y,"-=60"],duration:700,begin:()=>{$("#spriteText").show()},complete:()=>{$("#spriteText").hide();SMBSounds.Thorns();smbEffects.playThorns(target);setTimeout(()=>{SMBSounds.Hit4();onHitOutcome(initiator,target,action)},1e3*SMBPlayback.iSpeed)}})}function handleReflect(initiator,target,action){atkPos=getElementTransformPosition(initiator);targetPos=getElementTransformPosition(target);atkPos=getElementTransformPosition(initiator);$("#spriteText").html(action.type);$("#spriteText").css("transform",$(initiator).css("transform"));anime.timeline().add({targets:"#spriteText",easing:"easeOutQuint",translateX:[atkPos.x,atkPos.x],translateY:[atkPos.y,"-=60"],duration:700,begin:()=>{$("#spriteText").show()},complete:()=>{$("#spriteText").hide();handleMagicAtk(initiator,target,action)}})}function repositionTeam(teamArray){teamArray.forEach((el,i)=>{anime({targets:"#"+el.id,translateX:$(el).hasClass("team1")?Positions.team1[i+1].x:Positions.team2[i+1].x,translateY:$(el).hasClass("team1")?Positions.team1[i+1].y:Positions.team2[i+1].y,easing:"easeOutQuint",duration:600,delay:200})})}function getElementTransformPosition(element){let el=$(element);let elementTransform=el.is("canvas")?$(element).parent().css("transform"):$(element).css("transform");let elementMatrix=Rematrix.parse(elementTransform);let x=elementMatrix[12]||elementMatrix[4];let y=elementMatrix[13]||elementMatrix[5];return{x:x,y:y}}function renderStats(target,actionState){$(target+" .battle-stats").html(render("/components/battle_stats",{data:actionState}))}function updateStats(target,actionState){updateStat(target,".stat-attack",actionState.stats[0]);updateStat(target,".stat-ranged",actionState.stats[1]);updateStat(target,".stat-magic",actionState.stats[2]);updateStat(target,".stat-speed",actionState.stats[5]);updateStat(target,".stat-armor",actionState.stats[3]);updateStat(target,".stat-health",actionState.stats[4],actionState.base_health);actionState.other.forEach((el,i)=>{var statEl=$(`${target} .battle-stats .stat-effects [title='${abilityNames[el[0]].pastTense}']`);if(statEl.length==0){var statImg=$("<img>",{class:"ability-"+i,src:"https://d36mxiodymuqjm.cloudfront.net/website/abilities/ability_"+abilityNames[el[0]].ability.toLowerCase().replace(" ","-")+".png",style:"display: none",title:abilityNames[el[0]].pastTense});$(target+" .battle-stats .stat-effects").append(statImg);switch(el[0]){case"Stun":smbEffects.playStun(target);statImg.css("display","");SMBSounds.Stun();SMBFightTimer.RestartTimeout(2e3*SMBPlayback.iSpeed);break;case"Poison":if(!battleTracker.isPreBattle){smbEffects.playPoison(target);SMBSounds.Poison();SMBFightTimer.RestartTimeout(2e3*SMBPlayback.iSpeed)}statImg.css("display","");break;case"Enrage":smbEffects.playEnrage(target);statImg.css("display","");SMBSounds.Enrage();SMBFightTimer.RestartTimeout(2e3*SMBPlayback.iSpeed);break;default:var numOfStats=$(target+" .battle-stats .stat-effects img").length;anime.timeline().add({targets:statImg[0],scale:[10,3],translateX:36-numOfStats*10,translateY:26,easing:"easeOutQuint",delay:battleTracker.isPreBattle?0:600,duration:500,begin:()=>{statImg.css("display","")}}).add({targets:statImg[0],scale:1,translateX:0,translateY:0,easing:"easeOutQuint",duration:500});break}}});var statEffectsDom=$(target+" .battle-stats .stat-effects img");statEffectsDom.each(function(){var el=$(this);var statEffect=el.attr("title");var properStatName=_.findKey(abilityNames,{pastTense:statEffect});if(actionState.other.filter((v,i)=>{return v[0]==properStatName}).length==0){anime({targets:el[0],translateY:10,opacity:0,easing:"easeInQuint",duration:1e3,complete:()=>{el.remove()}})}})}function updateStat(target,statClass,newValue,baseHealth){var statElement=$(target+" .battle-stats "+statClass);var textElement=$(target+" .battle-stats "+statClass+" .stat-text");var initialStat=textElement.attr("initial_stat");var currentStat=textElement.text();if(statElement.length==0){return}if(statClass==".stat-health"){if(newValue<baseHealth){textElement.css("color","red")}else{textElement.css("color","white")}}else{if(newValue>initialStat){textElement.css("color","green")}else if(newValue<initialStat){textElement.css("color","red")}else if(newValue==initialStat){textElement.css("color","white")}}if(newValue<currentStat){anime.timeline().add({targets:statElement[0],scale:.3,duration:200,easing:"easeInQuad",begin:()=>{if([".stat-attack",".stat-ranged",".stat-magic",".stat-speed"].indexOf(statClass)!=-1||battleTracker.isPreBattle){SMBSounds.Debuff();smbEffects.playDebuff(target)}},complete:()=>{textElement.text(newValue)}}).add({targets:statElement[0],scale:1.2,duration:400,easing:"easeOutExpo"}).add({targets:statElement[0],scale:1,duration:300,complete:()=>{if([".stat-armor",".stat-attack",".stat-ranged",".stat-magic"].includes(statClass)&&newValue==0){anime({targets:statElement[0],easing:"easeInQuad",duration:300,opacity:0})}}})}else if(newValue>currentStat){if([".stat-armor",".stat-attack",".stat-ranged",".stat-magic"].includes(statClass)&&newValue>0&&currentStat==0){$(statElement).show();$(statElement).css("opacity",1)}anime.timeline().add({targets:statElement[0],scale:1.3,duration:400,easing:"easeOutExpo",begin:()=>{if(statClass!=".stat-health"||battleTracker.isPreBattle){SMBSounds.Buff();smbEffects.playBuff(target)}},complete:()=>{textElement.text(newValue)}}).add({targets:statElement[0],scale:.7,duration:200,easing:"easeInQuad"}).add({targets:statElement[0],scale:1,duration:300})}}function setBtnControlDisplay(isDisplayed){$("#btnPlay").toggle(isDisplayed);$(".btnSpeed").toggle(isDisplayed);$("#btnBack").toggle(isDisplayed)}function btnSpeedClicked(){var currentSpeed=parseFloat(localStorage.getItem("sl:battle_speed")||"1");switch(currentSpeed){case.5:currentSpeed=1;break;case 1:currentSpeed=2;break;case 2:currentSpeed=3;break;case 3:currentSpeed=.5;break}localStorage.setItem("sl:battle_speed",currentSpeed);setSpeedButtonIcon()}function setSpeedButtonIcon(){var currentSpeed=parseFloat(localStorage.getItem("sl:battle_speed")||"1");$(".btnSpeed span").removeClass("glyphicon-3x");$(".btnSpeed span").removeClass("glyphicon-2x");$(".btnSpeed span").removeClass("glyphicon-1x");$(".btnSpeed span").removeClass("glyphicon-05x");switch(currentSpeed){case.5:$(".btnSpeed span").addClass("glyphicon-05x");break;case 1:$(".btnSpeed span").addClass("glyphicon-1x");break;case 2:$(".btnSpeed span").addClass("glyphicon-2x");break;case 3:$(".btnSpeed span").addClass("glyphicon-3x");break}}var abilityNames={Charging:{ability:"Recharge",pastTense:"Charging"},Stun:{ability:"Stun",pastTense:"Stunned"},Enrage:{ability:"Enrage",pastTense:"Enraged"},Poison:{ability:"Poison",pastTense:"Poisoned"},Slow:{ability:"Slow",pastTense:"Slowed"},Protected:{ability:"Protect",pastTense:"Protected"},Inspired:{ability:"Inspire",pastTense:"Inspired"},Weakened:{ability:"Weaken",pastTense:"Weakened"},Silenced:{ability:"Silence",pastTense:"Silenced"},Swiftened:{ability:"Swiftness",pastTense:"Swiftened"},Strengthened:{ability:"Strengthen",pastTense:"Strengthened"},Shielded:{ability:"Divine Shield",pastTense:"Shielded"},Demoralized:{ability:"Demoralize",pastTense:"Demoralized"},Afflicted:{ability:"Affliction",pastTense:"Afflicted"},Blinded:{ability:"Blind",pastTense:"Blinded"},Halved:{ability:"Halving",pastTense:"Halved"},Headwinds:{ability:"Headwinds",pastTense:"Headwinds"},Snared:{ability:"Snare",pastTense:"Snared"},"Last Stand":{ability:"Last Stand",pastTense:"Last Stand"},Rusted:{ability:"Rust",pastTense:"Rusted"},Crippled:{ability:"Cripple",pastTense:"Crippled"}};!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Spriteling=e()}(this,function(){"use strict";var s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t};function n(o,s,a,l){return new(a||(a=Promise))(function(t,e){function n(t){try{i(l.next(t))}catch(t){e(t)}}function r(t){try{i(l.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,r)}i((l=l.apply(o,s||[])).next())})}function a(n,r){var i,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=o[2&e[0]?"return":e[0]?"throw":"next"])&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[0,s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var q="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(t,e){return t(e={exports:{}},e.exports),e.exports}t(function(t,e){t.exports=function(){function u(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=0,e=void 0,i=void 0,a=function(t,e){p[r]=t,p[r+1]=e,2===(r+=2)&&(i?i(f):g())},t="undefined"!=typeof window?window:void 0,o=t||{},s=o.MutationObserver||o.WebKitMutationObserver,l="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),c="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var t=setTimeout;return function(){return t(f,1)}}var p=new Array(1e3);function f(){for(var t=0;t<r;t+=2){var e=p[t],n=p[t+1];e(n),p[t]=void 0,p[t+1]=void 0}r=0}var d,y,m,v,g=void 0;function w(t,e){var n=this,r=new this.constructor(_);void 0===r[S]&&D(r);var i=n._state;if(i){var o=arguments[i-1];a(function(){return R(i,r,o,n._result)})}else W(n,r,t,e);return r}function b(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(_);return O(e,t),e}l?g=function(){return process.nextTick(f)}:s?(y=0,m=new s(f),v=document.createTextNode(""),m.observe(v,{characterData:!0}),g=function(){v.data=y=++y%2}):c?((d=new MessageChannel).port1.onmessage=f,g=function(){return d.port2.postMessage(0)}):g=void 0===t?function(){try{var t=Function("return this")().require("vertx");return void 0!==(e=t.runOnLoop||t.runOnContext)?function(){e(f)}:h()}catch(t){return h()}}():h();var S=Math.random().toString(36).substring(2);function _(){}var A=void 0,x=1,F=2,P={error:null};function E(t){try{return t.then}catch(t){return P.error=t,P}}function T(t,e,n){var r,i,o,s;e.constructor===t.constructor&&n===w&&e.constructor.resolve===b?(o=t,(s=e)._state===x?k(o,s._result):s._state===F?C(o,s._result):W(s,void 0,function(t){return O(o,t)},function(t){return C(o,t)})):n===P?(C(t,P.error),P.error=null):void 0===n?k(t,e):u(n)?(r=e,i=n,a(function(e){var n=!1,t=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(i,r,function(t){n||(n=!0,r!==t?O(e,t):k(e,t))},function(t){n||(n=!0,C(e,t))},e._label);!n&&t&&(n=!0,C(e,t))},t)):k(t,e)}function O(t,e){var n,r;t===e?C(t,new TypeError("You cannot resolve a promise with itself")):(r=typeof(n=e),null===n||"object"!==r&&"function"!==r?k(t,e):T(t,e,E(e)))}function j(t){t._onerror&&t._onerror(t._result),H(t)}function k(t,e){t._state===A&&(t._result=e,t._state=x,0!==t._subscribers.length&&a(H,t))}function C(t,e){t._state===A&&(t._state=F,t._result=e,a(j,t))}function W(t,e,n,r){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+x]=n,i[o+F]=r,0===o&&t._state&&a(H,t)}function H(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],i=e[s+n],r?R(n,r,i,o):i(o);t._subscribers.length=0}}function R(t,e,n,r){var i=u(n),o=void 0,s=void 0,a=void 0,l=void 0;if(i){if((o=function(t,e){try{return t(e)}catch(t){return P.error=t,P}}(n,r))===P?(l=!0,s=o.error,o.error=null):a=!0,e===o)return void C(e,new TypeError("A promises callback cannot return that same promise."))}else o=r,a=!0;e._state!==A||(i&&a?O(e,o):l?C(e,s):t===x?k(e,o):t===F&&C(e,o))}var M=0;function D(t){t[S]=M++,t._state=void 0,t._result=void 0,t._subscribers=[]}var L=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(_),this.promise[S]||D(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?k(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&k(this.promise,this._result))):C(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===A&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===b){var i=E(e);if(i===w&&e._state!==A)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===z){var o=new n(_);T(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===A&&(this._remaining--,t===F?C(r,n):this._result[e]=n),0===this._remaining&&k(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;W(t,void 0,function(t){return n._settledAt(x,e,t)},function(t){return n._settledAt(F,e,t)})},t}(),z=function(){function e(t){this[S]=M++,this._result=this._state=void 0,this._subscribers=[],_!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){O(e,t)},function(t){C(e,t)})}catch(t){C(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})})},e}();return z.prototype.then=w,z.all=function(t){return new L(this,t).promise},z.race=function(i){var o=this;return n(i)?new o(function(t,e){for(var n=i.length,r=0;r<n;r++)o.resolve(i[r]).then(t,e)}):new o(function(t,e){return e(new TypeError("You must pass an array to race."))})},z.resolve=b,z.reject=function(t){var e=new this(_);return C(e,t),e},z._setScheduler=function(t){i=t},z._setAsap=function(t){a=t},z._asap=a,z.polyfill=function(){var t=void 0;if(void 0!==q)t=q;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=z},z.Promise=z}()}).polyfill();for(var e=function(t,e){var n,r;if(!t.nodeName)return e(new Error("First argument must be an image element"));if("img"!==t.nodeName.toLowerCase())return e(new Error("Element supplied is not an image"));if(t.src&&t.complete&&void 0!==t.naturalWidth)return e(null,!0);function i(){r?t.detachEvent("onload",i):t.removeEventListener("load",i,!1),e(null,!1)}(r=!t.addEventListener)?t.attachEvent("onload",i):t.addEventListener("load",i,!1),(t.readyState||t.complete)&&(n=t.src,t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",t.src=n)},r=t(function(s){(function(){var t,e,n,r,i,o;"undefined"!=typeof performance&&null!==performance&&performance.now?s.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(s.exports=function(){return(t()-i)/1e6},e=process.hrtime,r=(t=function(){var t;return 1e9*(t=e())[0]+t[1]})(),o=1e9*process.uptime(),i=r-o):Date.now?(s.exports=function(){return Date.now()-n},n=Date.now()):(s.exports=function(){return(new Date).getTime()-n},n=(new Date).getTime())}).call(q)}),i="undefined"==typeof window?q:window,o=["moz","webkit"],l="AnimationFrame",u=i["request"+l],c=i["cancel"+l]||i["cancelRequest"+l],h=0;!u&&h<o.length;h++)u=i[o[h]+"Request"+l],c=i[o[h]+"Cancel"+l]||i[o[h]+"CancelRequest"+l];if(!u||!c){var p=0,f=0,d=[];u=function(t){if(0===d.length){var e=r(),n=Math.max(0,1e3/60-(e-p));p=n+e,setTimeout(function(){for(var t=d.slice(0),e=d.length=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(p)}catch(t){setTimeout(function(){throw t},0)}},Math.round(n))}return d.push({handle:++f,callback:t,cancelled:!1}),f},c=function(t){for(var e=0;e<d.length;e++)d[e].handle===t&&(d[e].cancelled=!0)}}var y=function(t){return u.call(i,t)};y.cancel=function(){c.apply(i,arguments)};var m={play:!0,delay:50,tempo:1,run:-1,reversed:!(y.polyfill=function(t){t||(t=i),t.requestAnimationFrame=u,t.cancelAnimationFrame=c}),script:[],lastTime:0,nextDelay:0,currentSprite:1,currentFrame:-1,onPlay:null,onStop:null,onFrame:null,onOutOfView:null};return function(){function t(t,e,n){void 0===n&&(n=!1);var r=this;if(this.spriteSheet={loaded:!1,url:null,cols:null,rows:null,cutOffFrames:0,top:null,bottom:null,left:null,right:null,startSprite:1,downsizeRatio:1,totalSprites:0,sheetWidth:0,sheetHeight:0,frameWidth:0,frameHeight:0,animations:{},onLoaded:null},this.loop=function(t){void 0===t&&(t=0);var e=y(r.loop),n=r.playhead;r.element&&r.spriteSheet.loaded&&(t-n.lastTime>=n.nextDelay&&r.render(t),n.play||y.cancel(e))},e&&(this.element="string"==typeof e?document.querySelector(e):e),this.element||(void 0!==this.element&&this.log("warn",'element "'+e+'" not found, created new element instead'),this.element=document.createElement("div"),document.body.appendChild(this.element)),this.element.className+=" spriteling",this.spriteSheet=s({},this.spriteSheet,t),this.playhead=s({},m),this.debug=n||!1,t.cols||this.log("error","options.cols not set"),t.rows||this.log("error","options.rows not set"),!t.url){var i=window.getComputedStyle(this.element).getPropertyValue("background-image");i&&"none"!==i?this.spriteSheet.url=i.replace(/"/g,"").replace(/url\(|\)$/gi,""):this.log("error","no spritesheet image found, please specify it with options.url or set as css background")}this.loadingPromise=this.loadSpriteSheet().then(function(){r.spriteSheet.loaded=!0,1<r.spriteSheet.startSprite&&r.spriteSheet.startSprite<=r.spriteSheet.totalSprites&&r.drawFrame({sprite:r.spriteSheet.startSprite}),"function"==typeof r.spriteSheet.onLoaded&&r.spriteSheet.onLoaded()})}return t.prototype.showSprite=function(e){return n(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.loadingPromise];case 1:return t.sent(),this.playhead.play=!1,this.drawFrame({sprite:e}),[2]}})})},t.prototype.currentSprite=function(){return this.playhead.currentSprite},t.prototype.addScript=function(t,e){this.spriteSheet.animations[t]=e},t.prototype.play=function(i,o){return n(this,void 0,void 0,function(){var e,n,r;return a(this,function(t){switch(t.label){case 0:return[4,this.loadingPromise];case 1:return t.sent(),i||o?(e=void 0,n={},"string"!=typeof i||o?"string"==typeof i&&"object"==typeof o?(e=this.spriteSheet.animations[i],n=o):"object"!=typeof i||o||(e=i.script||this.playhead.script,n=i):this.spriteSheet.animations[i]?(this.log("info",'playing animation "'+i+'"'),e=this.spriteSheet.animations[i]):this.log("warn",'animation "'+i+'" not found'),e||(this.log("info",'playing animation "all"'),e=this.spriteSheet.animations.all),r=-1,n.reversed&&(r=e.length),this.playhead=s({},m,{script:e},n,{currentFrame:r})):this.playhead.play||(0===this.playhead.run&&(this.playhead.run=1),this.playhead.play=!0),0!==this.playhead.run&&this.playhead.play&&this.loop(),"function"==typeof this.playhead.onPlay&&this.playhead.onPlay(),[2]}})})},t.prototype.isPlaying=function(){return this.playhead.play},t.prototype.setTempo=function(e){return n(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.loadingPromise];case 1:return t.sent(),this.playhead.tempo=e,[2]}})})},t.prototype.getTempo=function(){return this.playhead.tempo},t.prototype.next=function(){return n(this,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return[4,this.loadingPromise];case 1:return t.sent(),this.playhead.currentFrame+=1,this.playhead.currentFrame===this.playhead.script.length&&(this.playhead.run-=1,this.playhead.currentFrame=0),this.playhead.play&&0===this.playhead.run?this.stop():(e=this.playhead.script[this.playhead.currentFrame],this.drawFrame(e)),[2]}})})},t.prototype.previous=function(){return n(this,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return[4,this.loadingPromise];case 1:return t.sent(),this.playhead.currentFrame-=1,this.playhead.currentFrame<0&&(this.playhead.currentFrame=this.playhead.script.length-1,this.playhead.run-=1),this.playhead.play&&0===this.playhead.run?this.stop():(e=this.playhead.script[this.playhead.currentFrame],this.drawFrame(e)),[2]}})})},t.prototype.goTo=function(r){return n(this,void 0,void 0,function(){var e,n;return a(this,function(t){switch(t.label){case 0:return[4,this.loadingPromise];case 1:return t.sent(),e=Math.floor(r/this.playhead.script.length),r=Math.floor(r-e*this.playhead.script.length),this.playhead.currentFrame=r,(n=this.playhead.script[this.playhead.currentFrame])&&(this.log("info","frame: "+this.playhead.currentFrame+", sprite: "+n.sprite),this.drawFrame(n)),[2]}})})},t.prototype.reverse=function(){return n(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.loadingPromise];case 1:return t.sent(),this.playhead.reversed=!this.playhead.reversed,[2]}})})},t.prototype.isReversed=function(){return this.playhead.reversed},t.prototype.stop=function(){return n(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.loadingPromise];case 1:return t.sent(),this.playhead.play=!1,"function"==typeof this.playhead.onStop&&this.playhead.onStop(),[2]}})})},t.prototype.reset=function(){return n(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.loadingPromise];case 1:return t.sent(),this.goTo(0),[2]}})})},t.prototype.destroy=function(){this.playhead.play=!1,this.element.parentNode.removeChild(this.element)},t.prototype.loadSpriteSheet=function(){var o=this;return new Promise(function(r){var i=new Image;i.src=o.spriteSheet.url,e(i,function(){var t=o.spriteSheet,e=o.element;o.log("info","loaded: "+t.url+", sprites "+t.cols+" x "+t.rows),t.sheetWidth=i.width,t.sheetHeight=i.height,t.frameWidth=t.sheetWidth/t.cols/t.downsizeRatio,t.frameHeight=t.sheetHeight/t.rows/t.downsizeRatio,t.totalSprites=t.cols*t.rows-t.cutOffFrames,e.style.position="absolute",e.style.width=t.frameWidth+"px",e.style.height=t.frameHeight+"px",e.style.backgroundImage="url("+t.url+")",e.style.backgroundPosition="0 0",1<t.downsizeRatio&&(e.style.backgroundSize=t.sheetWidth/t.downsizeRatio+"px "+t.sheetHeight/t.downsizeRatio+"px"),null!==t.top&&("center"===t.top?(e.style.top="50%",e.style.marginTop=t.frameHeight/2*-1+"px"):e.style.top=t.top+"px"),null!==t.right&&(e.style.right=t.right+"px"),null!==t.bottom&&(e.style.bottom=t.bottom+"px"),null!==t.left&&("center"===t.left?(e.style.left=t.left+"px",e.style.marginLeft=t.frameWidth/2*-1+"px"):e.style.left=t.left+"px"),o.autoScript();var n={script:t.animations.all};o.playhead=s({},m,n),r()})})},t.prototype.autoScript=function(){for(var t=[],e=0;e<this.spriteSheet.totalSprites;e++)t[e]={sprite:e+1};this.addScript("all",t)},t.prototype.render=function(i){return n(this,void 0,void 0,function(){var e,n,r;return a(this,function(t){switch(t.label){case 0:return e=this.element,n=this.playhead,null!==e.offsetParent&&this.inViewport()?0===n.run?[3,5]:n.reversed?[4,this.previous()]:[3,2]:[3,6];case 1:return t.sent(),[3,4];case 2:return[4,this.next()];case 3:t.sent(),t.label=4;case 4:r=n.script[n.currentFrame],this.log("info","run: "+n.run+", frame",r),n.lastTime=i,t.label=5;case 5:return[3,7];case 6:"function"==typeof n.onOutOfView&&n.onOutOfView(),t.label=7;case 7:return[2]}})})},t.prototype.drawFrame=function(t){var e=this.spriteSheet,n=this.playhead,r=this.element;if(this.playhead.nextDelay=t.delay?t.delay:this.playhead.delay,this.playhead.nextDelay/=this.playhead.tempo,t.sprite!==n.currentSprite){var i=r.getBoundingClientRect(),o=Math.ceil(t.sprite/e.cols),s=t.sprite-(o-1)*e.cols,a=(s-1)*e.frameWidth*-1,l=(o-1)*e.frameHeight*-1;(o>e.rows||s>e.cols)&&this.log("warn","position "+t.sprite+" out of bound"),n.currentSprite=t.sprite,r.style.backgroundPosition=a+"px "+l+"px",t.top&&(r.style.top=i.top+t.top+"px"),t.right&&(r.style.right=i.right+t.right+"px"),t.bottom&&(r.style.bottom=i.bottom+t.bottom+"px"),t.left&&(r.style.left=i.left+t.left+"px")}return"function"==typeof n.onFrame&&n.onFrame(n.currentFrame),!0},t.prototype.inViewport=function(){var t=this.spriteSheet,e=this.element.getBoundingClientRect();return 0<=e.top+t.frameHeight&&0<=e.left+t.frameWidth&&e.bottom-t.frameHeight<=(window.innerHeight||document.documentElement.clientHeight)&&e.right-t.frameWidth<=(window.innerWidth||document.documentElement.clientWidth)},t.prototype.log=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];"undefined"==typeof console||"info"===t&&!this.debug||console[t].apply(console,["Spriteling"].concat(e))},t}()});
//# sourceMappingURL=battle.min.js.map